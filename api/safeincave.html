<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>safeincave API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#mypackage">mypackage</a></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="safeincave/MomentumBC.html">MomentumBC</a></li>
                    <li><a href="safeincave/HeatBC.html">HeatBC</a></li>
                    <li><a href="safeincave/PostProcessingTools.html">PostProcessingTools</a></li>
                    <li><a href="safeincave/Utils.html">Utils</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#GridHandlerGMSH">GridHandlerGMSH</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GridHandlerGMSH.__init__">GridHandlerGMSH</a>
                        </li>
                        <li>
                                <a class="variable" href="#GridHandlerGMSH.grid_folder">grid_folder</a>
                        </li>
                        <li>
                                <a class="variable" href="#GridHandlerGMSH.geometry_name">geometry_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#GridHandlerGMSH.comm">comm</a>
                        </li>
                        <li>
                                <a class="variable" href="#GridHandlerGMSH.rank">rank</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.build_smoother">build_smoother</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.load_mesh">load_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.build_tags">build_tags</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.load_subdomains">load_subdomains</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.load_boundaries">load_boundaries</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.build_box_dimensions">build_box_dimensions</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_boundaries">get_boundaries</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_boundary_tags">get_boundary_tags</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_boundary_tag">get_boundary_tag</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_boundary_names">get_boundary_names</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_subdomain_tag">get_subdomain_tag</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_subdomains">get_subdomains</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_subdomain_names">get_subdomain_names</a>
                        </li>
                        <li>
                                <a class="function" href="#GridHandlerGMSH.get_parameter">get_parameter</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HeatDiffusion">HeatDiffusion</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HeatDiffusion.__init__">HeatDiffusion</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeatDiffusion.grid">grid</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeatDiffusion.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeatDiffusion.n_nodes">n_nodes</a>
                        </li>
                        <li>
                                <a class="variable" href="#HeatDiffusion.dt">dt</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.set_material">set_material</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.set_solver">set_solver</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.set_boundary_conditions">set_boundary_conditions</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.create_trial_test_functions">create_trial_test_functions</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.create_function_spaces">create_function_spaces</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.create_ds_dx">create_ds_dx</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.create_fenicsx_fields">create_fenicsx_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.split_solution">split_solution</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.update_T_old">update_T_old</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.set_initial_T">set_initial_T</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.get_T_elems">get_T_elems</a>
                        </li>
                        <li>
                                <a class="function" href="#HeatDiffusion.solve">solve</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LinearMomentumBase">LinearMomentumBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#LinearMomentumBase.grid">grid</a>
                        </li>
                        <li>
                                <a class="variable" href="#LinearMomentumBase.theta">theta</a>
                        </li>
                        <li>
                                <a class="variable" href="#LinearMomentumBase.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#LinearMomentumBase.n_nodes">n_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.commom_fields">commom_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.set_material">set_material</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.set_T">set_T</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.set_T0">set_T0</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.set_solver">set_solver</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.set_boundary_conditions">set_boundary_conditions</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_function_spaces">create_function_spaces</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_ds_dx">create_ds_dx</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_normal">create_normal</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.build_body_force">build_body_force</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_q_nodes">compute_q_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_q_elems">compute_q_elems</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_total_strain">compute_total_strain</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_eps_th">compute_eps_th</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_eps_ne_k">compute_eps_ne_k</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_eps_ne_rate">compute_eps_ne_rate</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.update_eps_ne_rate_old">update_eps_ne_rate_old</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.update_eps_ne_old">update_eps_ne_old</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.increment_internal_variables">increment_internal_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.update_internal_variables">update_internal_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_solution_vector">create_solution_vector</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.run_after_solve">run_after_solve</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_CT">compute_CT</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_eps_rhs">compute_eps_rhs</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_elastic_stress">compute_elastic_stress</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_stress">compute_stress</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_fenicsx_fields">create_fenicsx_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_pytorch_fields">create_pytorch_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.create_trial_test_functions">create_trial_test_functions</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.get_uV">get_uV</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.split_solution">split_solution</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.compute_p_nodes">compute_p_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.solve_elastic_response">solve_elastic_response</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentumBase.solve">solve</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LinearMomentum">LinearMomentum</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LinearMomentum.__init__">LinearMomentum</a>
                        </li>
                        <li>
                                <a class="variable" href="#LinearMomentum.V">V</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.create_fenicsx_fields">create_fenicsx_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.create_pytorch_fields">create_pytorch_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.create_trial_test_functions">create_trial_test_functions</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.get_uV">get_uV</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.compute_CT">compute_CT</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.compute_elastic_stress">compute_elastic_stress</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.compute_stress">compute_stress</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.compute_eps_rhs">compute_eps_rhs</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.solve_elastic_response">solve_elastic_response</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.split_solution">split_solution</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.compute_p_nodes">compute_p_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.compute_p_elems">compute_p_elems</a>
                        </li>
                        <li>
                                <a class="function" href="#LinearMomentum.solve">solve</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Material">Material</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Material.__init__">Material</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.elems_ne">elems_ne</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.elems_th">elems_th</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.elems_e">elems_e</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.C_inv">C_inv</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.C">C</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.C_tilde_inv">C_tilde_inv</a>
                        </li>
                        <li>
                                <a class="variable" href="#Material.C_tilde">C_tilde</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.set_density">set_density</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.set_specific_heat_capacity">set_specific_heat_capacity</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.set_thermal_conductivity">set_thermal_conductivity</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.set_thermal_expansion">set_thermal_expansion</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.add_to_elastic">add_to_elastic</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.add_to_non_elastic">add_to_non_elastic</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.add_to_thermoelastic">add_to_thermoelastic</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.compute_G_B">compute_G_B</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.compute_T_IT">compute_T_IT</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.compute_Bvol_Tvol">compute_Bvol_Tvol</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.compute_Gtilde_Btilde">compute_Gtilde_Btilde</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.compute_CT">compute_CT</a>
                        </li>
                        <li>
                                <a class="function" href="#Material.compute_CT_tilde">compute_CT_tilde</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NonElasticElement">NonElasticElement</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#NonElasticElement.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#NonElasticElement.eps_ne_rate">eps_ne_rate</a>
                        </li>
                        <li>
                                <a class="variable" href="#NonElasticElement.eps_ne_rate_old">eps_ne_rate_old</a>
                        </li>
                        <li>
                                <a class="variable" href="#NonElasticElement.eps_ne_old">eps_ne_old</a>
                        </li>
                        <li>
                                <a class="variable" href="#NonElasticElement.eps_ne_k">eps_ne_k</a>
                        </li>
                        <li>
                                <a class="variable" href="#NonElasticElement.B">B</a>
                        </li>
                        <li>
                                <a class="variable" href="#NonElasticElement.G">G</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_eps_ne_rate">compute_eps_ne_rate</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.increment_internal_variables">increment_internal_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.update_internal_variables">update_internal_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_eps_ne_k">compute_eps_ne_k</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.update_eps_ne_old">update_eps_ne_old</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.update_eps_ne_rate_old">update_eps_ne_rate_old</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_E">compute_E</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_B_and_H_over_h">compute_B_and_H_over_h</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_G_B">compute_G_B</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_T_IT">compute_T_IT</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_Bvol_Tvol">compute_Bvol_Tvol</a>
                        </li>
                        <li>
                                <a class="function" href="#NonElasticElement.compute_Gtilde_Btilde">compute_Gtilde_Btilde</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Spring">Spring</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Spring.__init__">Spring</a>
                        </li>
                        <li>
                                <a class="variable" href="#Spring.E">E</a>
                        </li>
                        <li>
                                <a class="variable" href="#Spring.nu">nu</a>
                        </li>
                        <li>
                                <a class="variable" href="#Spring.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Spring.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#Spring.eps_e">eps_e</a>
                        </li>
                        <li>
                                <a class="function" href="#Spring.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#Spring.compute_eps_e">compute_eps_e</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Thermoelastic">Thermoelastic</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Thermoelastic.__init__">Thermoelastic</a>
                        </li>
                        <li>
                                <a class="variable" href="#Thermoelastic.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#Thermoelastic.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Thermoelastic.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#Thermoelastic.eps_th">eps_th</a>
                        </li>
                        <li>
                                <a class="variable" href="#Thermoelastic.I">I</a>
                        </li>
                        <li>
                                <a class="function" href="#Thermoelastic.compute_eps_th">compute_eps_th</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Viscoelastic">Viscoelastic</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Viscoelastic.__init__">Viscoelastic</a>
                        </li>
                        <li>
                                <a class="variable" href="#Viscoelastic.eta">eta</a>
                        </li>
                        <li>
                                <a class="variable" href="#Viscoelastic.E">E</a>
                        </li>
                        <li>
                                <a class="variable" href="#Viscoelastic.nu">nu</a>
                        </li>
                        <li>
                                <a class="variable" href="#Viscoelastic.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Viscoelastic.C1">C1</a>
                        </li>
                        <li>
                                <a class="function" href="#Viscoelastic.compute_eps_ne_rate">compute_eps_ne_rate</a>
                        </li>
                        <li>
                                <a class="function" href="#Viscoelastic.compute_E">compute_E</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DislocationCreep">DislocationCreep</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DislocationCreep.__init__">DislocationCreep</a>
                        </li>
                        <li>
                                <a class="variable" href="#DislocationCreep.R">R</a>
                        </li>
                        <li>
                                <a class="variable" href="#DislocationCreep.Q">Q</a>
                        </li>
                        <li>
                                <a class="variable" href="#DislocationCreep.A">A</a>
                        </li>
                        <li>
                                <a class="variable" href="#DislocationCreep.n">n</a>
                        </li>
                        <li>
                                <a class="variable" href="#DislocationCreep.name">name</a>
                        </li>
                        <li>
                                <a class="function" href="#DislocationCreep.compute_eps_ne_rate">compute_eps_ne_rate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ViscoplasticDesai">ViscoplasticDesai</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ViscoplasticDesai.__init__">ViscoplasticDesai</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.mu_1">mu_1</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.N_1">N_1</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.a_1">a_1</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.eta">eta</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.n">n</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.beta_1">beta_1</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.beta">beta</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.m">m</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.gamma">gamma</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.sigma_t">sigma_t</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.alpha_0">alpha_0</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.F_0">F_0</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.n_elems">n_elems</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.Fvp">Fvp</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.qsi">qsi</a>
                        </li>
                        <li>
                                <a class="variable" href="#ViscoplasticDesai.qsi_old">qsi_old</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_residue">compute_residue</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.update_internal_variables">update_internal_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.increment_internal_variables">increment_internal_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_stress_invariants">compute_stress_invariants</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.extract_stress_components">extract_stress_components</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_Fvp">compute_Fvp</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_initial_hardening">compute_initial_hardening</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_eps_ne_rate">compute_eps_ne_rate</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_B_and_H_over_h">compute_B_and_H_over_h</a>
                        </li>
                        <li>
                                <a class="function" href="#ViscoplasticDesai.compute_H">compute_H</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SaveFields">SaveFields</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SaveFields.__init__">SaveFields</a>
                        </li>
                        <li>
                                <a class="variable" href="#SaveFields.eq">eq</a>
                        </li>
                        <li>
                                <a class="variable" href="#SaveFields.fields_data">fields_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#SaveFields.output_fields">output_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#SaveFields.set_output_folder">set_output_folder</a>
                        </li>
                        <li>
                                <a class="function" href="#SaveFields.add_output_field">add_output_field</a>
                        </li>
                        <li>
                                <a class="function" href="#SaveFields.initialize">initialize</a>
                        </li>
                        <li>
                                <a class="function" href="#SaveFields.save_fields">save_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#SaveFields.save_mesh">save_mesh</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Simulator_TM">Simulator_TM</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Simulator_TM.__init__">Simulator_TM</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_TM.eq_mom">eq_mom</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_TM.eq_heat">eq_heat</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_TM.t_control">t_control</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_TM.outputs">outputs</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_TM.compute_elastic_response">compute_elastic_response</a>
                        </li>
                        <li>
                                <a class="function" href="#Simulator_TM.run">run</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Simulator_T">Simulator_T</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Simulator_T.__init__">Simulator_T</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_T.eq_heat">eq_heat</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_T.t_control">t_control</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_T.outputs">outputs</a>
                        </li>
                        <li>
                                <a class="function" href="#Simulator_T.run">run</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Simulator_M">Simulator_M</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Simulator_M.__init__">Simulator_M</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_M.eq_mom">eq_mom</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_M.t_control">t_control</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_M.outputs">outputs</a>
                        </li>
                        <li>
                                <a class="variable" href="#Simulator_M.compute_elastic_response">compute_elastic_response</a>
                        </li>
                        <li>
                                <a class="function" href="#Simulator_M.run">run</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeControllerBase">TimeControllerBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TimeControllerBase.t_final">t_final</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeControllerBase.t_initial">t_initial</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeControllerBase.t">t</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeControllerBase.keep_looping">keep_looping</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeControllerBase.advance_time">advance_time</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeController">TimeController</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TimeController.__init__">TimeController</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeController.dt">dt</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeController.advance_time">advance_time</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimeControllerParabolic">TimeControllerParabolic</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TimeControllerParabolic.__init__">TimeControllerParabolic</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeControllerParabolic.n_time_steps">n_time_steps</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeControllerParabolic.time_list">time_list</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeControllerParabolic.dt">dt</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimeControllerParabolic.step_counter">step_counter</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeControllerParabolic.fun_parabolic">fun_parabolic</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeControllerParabolic.calculate_varying_times">calculate_varying_times</a>
                        </li>
                        <li>
                                <a class="function" href="#TimeControllerParabolic.advance_time">advance_time</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
safeincave    </h1>

                        <div class="docstring"><h1 id="mypackage">mypackage</h1>

<p>A short description of your package goes here.</p>

<p>This module exposes the public API for the package and
sets version information.</p>
</div>

                        <input id="mod-safeincave-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-safeincave-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">mypackage</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">=========</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">A short description of your package goes here.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">This module exposes the public API for the package and</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="sd">sets version information.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="c1"># Version info</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;2.0.0&quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span> <span class="nn">.Grid</span> <span class="kn">import</span> <span class="n">GridHandlerGMSH</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="kn">from</span> <span class="nn">.HeatEquation</span> <span class="kn">import</span> <span class="n">HeatDiffusion</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="kn">from</span> <span class="nn">.MomentumEquation</span> <span class="kn">import</span> <span class="n">LinearMomentumBase</span><span class="p">,</span> <span class="n">LinearMomentum</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="kn">from</span> <span class="nn">.MaterialProps</span> <span class="kn">import</span> <span class="n">Material</span><span class="p">,</span> <span class="n">NonElasticElement</span><span class="p">,</span> <span class="n">Spring</span><span class="p">,</span> <span class="n">Thermoelastic</span><span class="p">,</span> <span class="n">Viscoelastic</span><span class="p">,</span> <span class="n">DislocationCreep</span><span class="p">,</span> <span class="n">ViscoplasticDesai</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="kn">from</span> <span class="nn">.OutputHandler</span> <span class="kn">import</span> <span class="n">SaveFields</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a><span class="kn">from</span> <span class="nn">.Simulators</span> <span class="kn">import</span> <span class="n">Simulator_TM</span><span class="p">,</span> <span class="n">Simulator_T</span><span class="p">,</span> <span class="n">Simulator_M</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="kn">from</span> <span class="nn">.TimeHandler</span> <span class="kn">import</span> <span class="n">TimeControllerBase</span><span class="p">,</span> <span class="n">TimeController</span><span class="p">,</span> <span class="n">TimeControllerParabolic</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">MomentumBC</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">HeatBC</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">PostProcessingTools</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">Utils</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;GridHandlerGMSH&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;HeatBC&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;HeatDiffusion&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;LinearMomentumBase&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;LinearMomentum&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;Material&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;NonElasticElement&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;Spring&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;Thermoelastic&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;Viscoelastic&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;DislocationCreep&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;ViscoplasticDesai&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;SaveFields&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;Simulator_TM&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;Simulator_T&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;Simulator_M&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="s2">&quot;TimeControllerBase&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="s2">&quot;TimeController&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;TimeControllerParabolic&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="s2">&quot;MomentumBC&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>    <span class="s2">&quot;HeatBC&quot;</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>    <span class="s2">&quot;PostProcessingTools&quot;</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a>    <span class="s2">&quot;Utils&quot;</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a><span class="p">]</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Hermnio T. Honrio&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a><span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;h.tasinafohonor@tudelft.nl&quot;</span>
</span></pre></div>


            </section>
                <section id="GridHandlerGMSH">
                            <input id="GridHandlerGMSH-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GridHandlerGMSH</span>:

                <label class="view-source-button" for="GridHandlerGMSH-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH-31"><a href="#GridHandlerGMSH-31"><span class="linenos"> 31</span></a><span class="k">class</span> <span class="nc">GridHandlerGMSH</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-32"><a href="#GridHandlerGMSH-32"><span class="linenos"> 32</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-33"><a href="#GridHandlerGMSH-33"><span class="linenos"> 33</span></a><span class="sd">	Handler for reading a Gmsh mesh into DOLFINx and exposing convenient</span>
</span><span id="GridHandlerGMSH-34"><a href="#GridHandlerGMSH-34"><span class="linenos"> 34</span></a><span class="sd">	grid-related utilities (tags, regions, volumes, smoothers).</span>
</span><span id="GridHandlerGMSH-35"><a href="#GridHandlerGMSH-35"><span class="linenos"> 35</span></a>
</span><span id="GridHandlerGMSH-36"><a href="#GridHandlerGMSH-36"><span class="linenos"> 36</span></a><span class="sd">	The constructor loads the mesh, builds tag maps, extracts subdomain and</span>
</span><span id="GridHandlerGMSH-37"><a href="#GridHandlerGMSH-37"><span class="linenos"> 37</span></a><span class="sd">	boundary metadata, computes bounding-box dimensions, derives region-wise</span>
</span><span id="GridHandlerGMSH-38"><a href="#GridHandlerGMSH-38"><span class="linenos"> 38</span></a><span class="sd">	element indices, and constructs nodeelement smoothing operators.</span>
</span><span id="GridHandlerGMSH-39"><a href="#GridHandlerGMSH-39"><span class="linenos"> 39</span></a>
</span><span id="GridHandlerGMSH-40"><a href="#GridHandlerGMSH-40"><span class="linenos"> 40</span></a><span class="sd">	Parameters</span>
</span><span id="GridHandlerGMSH-41"><a href="#GridHandlerGMSH-41"><span class="linenos"> 41</span></a><span class="sd">	----------</span>
</span><span id="GridHandlerGMSH-42"><a href="#GridHandlerGMSH-42"><span class="linenos"> 42</span></a><span class="sd">	geometry_name : str</span>
</span><span id="GridHandlerGMSH-43"><a href="#GridHandlerGMSH-43"><span class="linenos"> 43</span></a><span class="sd">	    Base name (without extension) of the `.msh` file to read.</span>
</span><span id="GridHandlerGMSH-44"><a href="#GridHandlerGMSH-44"><span class="linenos"> 44</span></a><span class="sd">	grid_folder : str</span>
</span><span id="GridHandlerGMSH-45"><a href="#GridHandlerGMSH-45"><span class="linenos"> 45</span></a><span class="sd">	    Directory where the mesh file `{geometry_name}.msh` resides.</span>
</span><span id="GridHandlerGMSH-46"><a href="#GridHandlerGMSH-46"><span class="linenos"> 46</span></a>
</span><span id="GridHandlerGMSH-47"><a href="#GridHandlerGMSH-47"><span class="linenos"> 47</span></a><span class="sd">	Attributes</span>
</span><span id="GridHandlerGMSH-48"><a href="#GridHandlerGMSH-48"><span class="linenos"> 48</span></a><span class="sd">	----------</span>
</span><span id="GridHandlerGMSH-49"><a href="#GridHandlerGMSH-49"><span class="linenos"> 49</span></a><span class="sd">	grid_folder : str</span>
</span><span id="GridHandlerGMSH-50"><a href="#GridHandlerGMSH-50"><span class="linenos"> 50</span></a><span class="sd">	    Mesh directory provided at construction.</span>
</span><span id="GridHandlerGMSH-51"><a href="#GridHandlerGMSH-51"><span class="linenos"> 51</span></a><span class="sd">	geometry_name : str</span>
</span><span id="GridHandlerGMSH-52"><a href="#GridHandlerGMSH-52"><span class="linenos"> 52</span></a><span class="sd">	    Mesh base name provided at construction.</span>
</span><span id="GridHandlerGMSH-53"><a href="#GridHandlerGMSH-53"><span class="linenos"> 53</span></a><span class="sd">	comm : MPI.Comm</span>
</span><span id="GridHandlerGMSH-54"><a href="#GridHandlerGMSH-54"><span class="linenos"> 54</span></a><span class="sd">	    MPI communicator (defaults to `MPI.COMM_WORLD`).</span>
</span><span id="GridHandlerGMSH-55"><a href="#GridHandlerGMSH-55"><span class="linenos"> 55</span></a><span class="sd">	rank : int</span>
</span><span id="GridHandlerGMSH-56"><a href="#GridHandlerGMSH-56"><span class="linenos"> 56</span></a><span class="sd">	    Rank of the current process.</span>
</span><span id="GridHandlerGMSH-57"><a href="#GridHandlerGMSH-57"><span class="linenos"> 57</span></a><span class="sd">	mesh : dolfinx.mesh.Mesh</span>
</span><span id="GridHandlerGMSH-58"><a href="#GridHandlerGMSH-58"><span class="linenos"> 58</span></a><span class="sd">	    Loaded DOLFINx mesh.</span>
</span><span id="GridHandlerGMSH-59"><a href="#GridHandlerGMSH-59"><span class="linenos"> 59</span></a><span class="sd">	subdomains : dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH-60"><a href="#GridHandlerGMSH-60"><span class="linenos"> 60</span></a><span class="sd">	    Cell (volume) tags read from the mesh.</span>
</span><span id="GridHandlerGMSH-61"><a href="#GridHandlerGMSH-61"><span class="linenos"> 61</span></a><span class="sd">	boundaries : dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH-62"><a href="#GridHandlerGMSH-62"><span class="linenos"> 62</span></a><span class="sd">	    Facet (surface) tags read from the mesh.</span>
</span><span id="GridHandlerGMSH-63"><a href="#GridHandlerGMSH-63"><span class="linenos"> 63</span></a><span class="sd">	domain_dim : int</span>
</span><span id="GridHandlerGMSH-64"><a href="#GridHandlerGMSH-64"><span class="linenos"> 64</span></a><span class="sd">	    Topological dimension of the mesh cells.</span>
</span><span id="GridHandlerGMSH-65"><a href="#GridHandlerGMSH-65"><span class="linenos"> 65</span></a><span class="sd">	boundary_dim : int</span>
</span><span id="GridHandlerGMSH-66"><a href="#GridHandlerGMSH-66"><span class="linenos"> 66</span></a><span class="sd">	    Dimension of boundary entities (`domain_dim - 1`).</span>
</span><span id="GridHandlerGMSH-67"><a href="#GridHandlerGMSH-67"><span class="linenos"> 67</span></a><span class="sd">	n_elems : int</span>
</span><span id="GridHandlerGMSH-68"><a href="#GridHandlerGMSH-68"><span class="linenos"> 68</span></a><span class="sd">	    Number of local cells including ghosts.</span>
</span><span id="GridHandlerGMSH-69"><a href="#GridHandlerGMSH-69"><span class="linenos"> 69</span></a><span class="sd">	n_nodes : int</span>
</span><span id="GridHandlerGMSH-70"><a href="#GridHandlerGMSH-70"><span class="linenos"> 70</span></a><span class="sd">	    Number of local vertices including ghosts.</span>
</span><span id="GridHandlerGMSH-71"><a href="#GridHandlerGMSH-71"><span class="linenos"> 71</span></a><span class="sd">	tags : dict[int, dict[str, int]]</span>
</span><span id="GridHandlerGMSH-72"><a href="#GridHandlerGMSH-72"><span class="linenos"> 72</span></a><span class="sd">	    Mapping `dimension -&gt; {name -&gt; tag_id}` parsed from the Gmsh file.</span>
</span><span id="GridHandlerGMSH-73"><a href="#GridHandlerGMSH-73"><span class="linenos"> 73</span></a><span class="sd">	dolfin_tags : dict</span>
</span><span id="GridHandlerGMSH-74"><a href="#GridHandlerGMSH-74"><span class="linenos"> 74</span></a><span class="sd">	    Alias of `tags` for convenience.</span>
</span><span id="GridHandlerGMSH-75"><a href="#GridHandlerGMSH-75"><span class="linenos"> 75</span></a><span class="sd">	subdomain_tags : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH-76"><a href="#GridHandlerGMSH-76"><span class="linenos"> 76</span></a><span class="sd">	    Placeholder for subdomain-wise cell indices (filled later).</span>
</span><span id="GridHandlerGMSH-77"><a href="#GridHandlerGMSH-77"><span class="linenos"> 77</span></a><span class="sd">	boundary_tags : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH-78"><a href="#GridHandlerGMSH-78"><span class="linenos"> 78</span></a><span class="sd">	    Mapping from boundary name to list of exterior facet indices.</span>
</span><span id="GridHandlerGMSH-79"><a href="#GridHandlerGMSH-79"><span class="linenos"> 79</span></a><span class="sd">	Lx, Ly, Lz : float</span>
</span><span id="GridHandlerGMSH-80"><a href="#GridHandlerGMSH-80"><span class="linenos"> 80</span></a><span class="sd">	    Extents of the mesh bounding box in x, y, z.</span>
</span><span id="GridHandlerGMSH-81"><a href="#GridHandlerGMSH-81"><span class="linenos"> 81</span></a><span class="sd">	region_names : list[str]</span>
</span><span id="GridHandlerGMSH-82"><a href="#GridHandlerGMSH-82"><span class="linenos"> 82</span></a><span class="sd">	    List of subdomain (region) names.</span>
</span><span id="GridHandlerGMSH-83"><a href="#GridHandlerGMSH-83"><span class="linenos"> 83</span></a><span class="sd">	n_regions : int</span>
</span><span id="GridHandlerGMSH-84"><a href="#GridHandlerGMSH-84"><span class="linenos"> 84</span></a><span class="sd">	    Number of regions.</span>
</span><span id="GridHandlerGMSH-85"><a href="#GridHandlerGMSH-85"><span class="linenos"> 85</span></a><span class="sd">	region_indices : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH-86"><a href="#GridHandlerGMSH-86"><span class="linenos"> 86</span></a><span class="sd">	    Mapping from region name to list of cell indices in that region.</span>
</span><span id="GridHandlerGMSH-87"><a href="#GridHandlerGMSH-87"><span class="linenos"> 87</span></a><span class="sd">	tags_dict : dict[int, str]</span>
</span><span id="GridHandlerGMSH-88"><a href="#GridHandlerGMSH-88"><span class="linenos"> 88</span></a><span class="sd">	    Reverse mapping `{tag_id -&gt; region_name}`.</span>
</span><span id="GridHandlerGMSH-89"><a href="#GridHandlerGMSH-89"><span class="linenos"> 89</span></a><span class="sd">	volumes : numpy.ndarray</span>
</span><span id="GridHandlerGMSH-90"><a href="#GridHandlerGMSH-90"><span class="linenos"> 90</span></a><span class="sd">	    Per-cell volumes, shape `(n_elems,)`. Created by `build_smoother()`.</span>
</span><span id="GridHandlerGMSH-91"><a href="#GridHandlerGMSH-91"><span class="linenos"> 91</span></a><span class="sd">	stencil : list[list[int]]</span>
</span><span id="GridHandlerGMSH-92"><a href="#GridHandlerGMSH-92"><span class="linenos"> 92</span></a><span class="sd">	    Node-to-element adjacency (per-node list of incident cell indices).</span>
</span><span id="GridHandlerGMSH-93"><a href="#GridHandlerGMSH-93"><span class="linenos"> 93</span></a><span class="sd">	A_csr : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH-94"><a href="#GridHandlerGMSH-94"><span class="linenos"> 94</span></a><span class="sd">	    Node-to-element averaging weights, shape `(n_nodes, n_elems)`.</span>
</span><span id="GridHandlerGMSH-95"><a href="#GridHandlerGMSH-95"><span class="linenos"> 95</span></a><span class="sd">	B_csr : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH-96"><a href="#GridHandlerGMSH-96"><span class="linenos"> 96</span></a><span class="sd">	    Element-to-node averaging weights, shape `(n_elems, n_nodes)`.</span>
</span><span id="GridHandlerGMSH-97"><a href="#GridHandlerGMSH-97"><span class="linenos"> 97</span></a><span class="sd">	smoother : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH-98"><a href="#GridHandlerGMSH-98"><span class="linenos"> 98</span></a><span class="sd">	    Element-wise smoother `B_csr @ A_csr`, shape `(n_elems, n_elems)`.</span>
</span><span id="GridHandlerGMSH-99"><a href="#GridHandlerGMSH-99"><span class="linenos"> 99</span></a>
</span><span id="GridHandlerGMSH-100"><a href="#GridHandlerGMSH-100"><span class="linenos">100</span></a><span class="sd">	Notes</span>
</span><span id="GridHandlerGMSH-101"><a href="#GridHandlerGMSH-101"><span class="linenos">101</span></a><span class="sd">	-----</span>
</span><span id="GridHandlerGMSH-102"><a href="#GridHandlerGMSH-102"><span class="linenos">102</span></a><span class="sd">	- Assumes a tetrahedral volume mesh for volume and centroid calculations.</span>
</span><span id="GridHandlerGMSH-103"><a href="#GridHandlerGMSH-103"><span class="linenos">103</span></a><span class="sd">	- Counts (`n_elems`, `n_nodes`) include local ghosts for parallel runs.</span>
</span><span id="GridHandlerGMSH-104"><a href="#GridHandlerGMSH-104"><span class="linenos">104</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-105"><a href="#GridHandlerGMSH-105"><span class="linenos">105</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry_name</span><span class="p">,</span> <span class="n">grid_folder</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-106"><a href="#GridHandlerGMSH-106"><span class="linenos">106</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">grid_folder</span> <span class="o">=</span> <span class="n">grid_folder</span>
</span><span id="GridHandlerGMSH-107"><a href="#GridHandlerGMSH-107"><span class="linenos">107</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">geometry_name</span> <span class="o">=</span> <span class="n">geometry_name</span>
</span><span id="GridHandlerGMSH-108"><a href="#GridHandlerGMSH-108"><span class="linenos">108</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
</span><span id="GridHandlerGMSH-109"><a href="#GridHandlerGMSH-109"><span class="linenos">109</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span>
</span><span id="GridHandlerGMSH-110"><a href="#GridHandlerGMSH-110"><span class="linenos">110</span></a>
</span><span id="GridHandlerGMSH-111"><a href="#GridHandlerGMSH-111"><span class="linenos">111</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">load_mesh</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-112"><a href="#GridHandlerGMSH-112"><span class="linenos">112</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">build_tags</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-113"><a href="#GridHandlerGMSH-113"><span class="linenos">113</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">load_subdomains</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-114"><a href="#GridHandlerGMSH-114"><span class="linenos">114</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">load_boundaries</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-115"><a href="#GridHandlerGMSH-115"><span class="linenos">115</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">build_box_dimensions</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-116"><a href="#GridHandlerGMSH-116"><span class="linenos">116</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__extract_grid_data</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-117"><a href="#GridHandlerGMSH-117"><span class="linenos">117</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">build_smoother</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-118"><a href="#GridHandlerGMSH-118"><span class="linenos">118</span></a>
</span><span id="GridHandlerGMSH-119"><a href="#GridHandlerGMSH-119"><span class="linenos">119</span></a>	<span class="k">def</span> <span class="nf">__tetrahedron_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">z3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">z4</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-120"><a href="#GridHandlerGMSH-120"><span class="linenos">120</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-121"><a href="#GridHandlerGMSH-121"><span class="linenos">121</span></a><span class="sd">		Compute the absolute volume of a tetrahedron from its 4 vertices.</span>
</span><span id="GridHandlerGMSH-122"><a href="#GridHandlerGMSH-122"><span class="linenos">122</span></a>
</span><span id="GridHandlerGMSH-123"><a href="#GridHandlerGMSH-123"><span class="linenos">123</span></a><span class="sd">		Parameters</span>
</span><span id="GridHandlerGMSH-124"><a href="#GridHandlerGMSH-124"><span class="linenos">124</span></a><span class="sd">		----------</span>
</span><span id="GridHandlerGMSH-125"><a href="#GridHandlerGMSH-125"><span class="linenos">125</span></a><span class="sd">		x1, y1, z1, x2, y2, z2, x3, y3, z3, x4, y4, z4 : float</span>
</span><span id="GridHandlerGMSH-126"><a href="#GridHandlerGMSH-126"><span class="linenos">126</span></a><span class="sd">		    Coordinates of the four tetrahedron vertices.</span>
</span><span id="GridHandlerGMSH-127"><a href="#GridHandlerGMSH-127"><span class="linenos">127</span></a>
</span><span id="GridHandlerGMSH-128"><a href="#GridHandlerGMSH-128"><span class="linenos">128</span></a><span class="sd">		Returns</span>
</span><span id="GridHandlerGMSH-129"><a href="#GridHandlerGMSH-129"><span class="linenos">129</span></a><span class="sd">		-------</span>
</span><span id="GridHandlerGMSH-130"><a href="#GridHandlerGMSH-130"><span class="linenos">130</span></a><span class="sd">		float</span>
</span><span id="GridHandlerGMSH-131"><a href="#GridHandlerGMSH-131"><span class="linenos">131</span></a><span class="sd">		    Absolute volume of the tetrahedron.</span>
</span><span id="GridHandlerGMSH-132"><a href="#GridHandlerGMSH-132"><span class="linenos">132</span></a>
</span><span id="GridHandlerGMSH-133"><a href="#GridHandlerGMSH-133"><span class="linenos">133</span></a><span class="sd">		Notes</span>
</span><span id="GridHandlerGMSH-134"><a href="#GridHandlerGMSH-134"><span class="linenos">134</span></a><span class="sd">		-----</span>
</span><span id="GridHandlerGMSH-135"><a href="#GridHandlerGMSH-135"><span class="linenos">135</span></a><span class="sd">		Uses the scalar triple product formula:</span>
</span><span id="GridHandlerGMSH-136"><a href="#GridHandlerGMSH-136"><span class="linenos">136</span></a><span class="sd">		:math:`V = |((a-b) \\cdot ((c-b) \\times (d-b)))/6|`.</span>
</span><span id="GridHandlerGMSH-137"><a href="#GridHandlerGMSH-137"><span class="linenos">137</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-138"><a href="#GridHandlerGMSH-138"><span class="linenos">138</span></a>		<span class="n">volume</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">z4</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">z3</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y4</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span> <span class="o">+</span> 
</span><span id="GridHandlerGMSH-139"><a href="#GridHandlerGMSH-139"><span class="linenos">139</span></a>		             <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">z3</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">z4</span> <span class="o">-</span> <span class="n">z1</span><span class="p">))</span> <span class="o">+</span> 
</span><span id="GridHandlerGMSH-140"><a href="#GridHandlerGMSH-140"><span class="linenos">140</span></a>		             <span class="p">(</span><span class="n">z2</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y4</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))))</span>
</span><span id="GridHandlerGMSH-141"><a href="#GridHandlerGMSH-141"><span class="linenos">141</span></a>		<span class="k">return</span> <span class="n">volume</span>
</span><span id="GridHandlerGMSH-142"><a href="#GridHandlerGMSH-142"><span class="linenos">142</span></a>
</span><span id="GridHandlerGMSH-143"><a href="#GridHandlerGMSH-143"><span class="linenos">143</span></a>	<span class="k">def</span> <span class="nf">__compute_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-144"><a href="#GridHandlerGMSH-144"><span class="linenos">144</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-145"><a href="#GridHandlerGMSH-145"><span class="linenos">145</span></a><span class="sd">        Compute per-cell volumes for all tetrahedral elements.</span>
</span><span id="GridHandlerGMSH-146"><a href="#GridHandlerGMSH-146"><span class="linenos">146</span></a>
</span><span id="GridHandlerGMSH-147"><a href="#GridHandlerGMSH-147"><span class="linenos">147</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-148"><a href="#GridHandlerGMSH-148"><span class="linenos">148</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-149"><a href="#GridHandlerGMSH-149"><span class="linenos">149</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-150"><a href="#GridHandlerGMSH-150"><span class="linenos">150</span></a>
</span><span id="GridHandlerGMSH-151"><a href="#GridHandlerGMSH-151"><span class="linenos">151</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-152"><a href="#GridHandlerGMSH-152"><span class="linenos">152</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-153"><a href="#GridHandlerGMSH-153"><span class="linenos">153</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-154"><a href="#GridHandlerGMSH-154"><span class="linenos">154</span></a>
</span><span id="GridHandlerGMSH-155"><a href="#GridHandlerGMSH-155"><span class="linenos">155</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-156"><a href="#GridHandlerGMSH-156"><span class="linenos">156</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-157"><a href="#GridHandlerGMSH-157"><span class="linenos">157</span></a><span class="sd">        volumes : numpy.ndarray</span>
</span><span id="GridHandlerGMSH-158"><a href="#GridHandlerGMSH-158"><span class="linenos">158</span></a><span class="sd">            Sets `self.volumes` with shape `(n_elems,)`.</span>
</span><span id="GridHandlerGMSH-159"><a href="#GridHandlerGMSH-159"><span class="linenos">159</span></a>
</span><span id="GridHandlerGMSH-160"><a href="#GridHandlerGMSH-160"><span class="linenos">160</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-161"><a href="#GridHandlerGMSH-161"><span class="linenos">161</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-162"><a href="#GridHandlerGMSH-162"><span class="linenos">162</span></a><span class="sd">        Extracts connectivity (30) and coordinates from the DOLFINx mesh and</span>
</span><span id="GridHandlerGMSH-163"><a href="#GridHandlerGMSH-163"><span class="linenos">163</span></a><span class="sd">        applies `__tetrahedron_volume` to each cell.</span>
</span><span id="GridHandlerGMSH-164"><a href="#GridHandlerGMSH-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-165"><a href="#GridHandlerGMSH-165"><span class="linenos">165</span></a>		<span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">connectivity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-166"><a href="#GridHandlerGMSH-166"><span class="linenos">166</span></a>		<span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
</span><span id="GridHandlerGMSH-167"><a href="#GridHandlerGMSH-167"><span class="linenos">167</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-168"><a href="#GridHandlerGMSH-168"><span class="linenos">168</span></a>		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-169"><a href="#GridHandlerGMSH-169"><span class="linenos">169</span></a>			<span class="n">nodes</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-170"><a href="#GridHandlerGMSH-170"><span class="linenos">170</span></a>			<span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-171"><a href="#GridHandlerGMSH-171"><span class="linenos">171</span></a>			<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-172"><a href="#GridHandlerGMSH-172"><span class="linenos">172</span></a>			<span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">z3</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-173"><a href="#GridHandlerGMSH-173"><span class="linenos">173</span></a>			<span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">z4</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-174"><a href="#GridHandlerGMSH-174"><span class="linenos">174</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tetrahedron_volume</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">z3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">z4</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-175"><a href="#GridHandlerGMSH-175"><span class="linenos">175</span></a>
</span><span id="GridHandlerGMSH-176"><a href="#GridHandlerGMSH-176"><span class="linenos">176</span></a>	<span class="k">def</span> <span class="nf">__build_node_elem_stencil</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-177"><a href="#GridHandlerGMSH-177"><span class="linenos">177</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-178"><a href="#GridHandlerGMSH-178"><span class="linenos">178</span></a><span class="sd">        Build node-to-element adjacency lists.</span>
</span><span id="GridHandlerGMSH-179"><a href="#GridHandlerGMSH-179"><span class="linenos">179</span></a>
</span><span id="GridHandlerGMSH-180"><a href="#GridHandlerGMSH-180"><span class="linenos">180</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-181"><a href="#GridHandlerGMSH-181"><span class="linenos">181</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-182"><a href="#GridHandlerGMSH-182"><span class="linenos">182</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-183"><a href="#GridHandlerGMSH-183"><span class="linenos">183</span></a>
</span><span id="GridHandlerGMSH-184"><a href="#GridHandlerGMSH-184"><span class="linenos">184</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-185"><a href="#GridHandlerGMSH-185"><span class="linenos">185</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-186"><a href="#GridHandlerGMSH-186"><span class="linenos">186</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-187"><a href="#GridHandlerGMSH-187"><span class="linenos">187</span></a>
</span><span id="GridHandlerGMSH-188"><a href="#GridHandlerGMSH-188"><span class="linenos">188</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-189"><a href="#GridHandlerGMSH-189"><span class="linenos">189</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-190"><a href="#GridHandlerGMSH-190"><span class="linenos">190</span></a><span class="sd">        stencil : list[list[int]]</span>
</span><span id="GridHandlerGMSH-191"><a href="#GridHandlerGMSH-191"><span class="linenos">191</span></a><span class="sd">            Sets `self.stencil` such that `self.stencil[i]` contains the</span>
</span><span id="GridHandlerGMSH-192"><a href="#GridHandlerGMSH-192"><span class="linenos">192</span></a><span class="sd">            indices of elements shared by node `i`.</span>
</span><span id="GridHandlerGMSH-193"><a href="#GridHandlerGMSH-193"><span class="linenos">193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-194"><a href="#GridHandlerGMSH-194"><span class="linenos">194</span></a>		<span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">connectivity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-195"><a href="#GridHandlerGMSH-195"><span class="linenos">195</span></a>		<span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
</span><span id="GridHandlerGMSH-196"><a href="#GridHandlerGMSH-196"><span class="linenos">196</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">stencil</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)]</span>
</span><span id="GridHandlerGMSH-197"><a href="#GridHandlerGMSH-197"><span class="linenos">197</span></a>		<span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">elem_conn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-198"><a href="#GridHandlerGMSH-198"><span class="linenos">198</span></a>			<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">elem_conn</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-199"><a href="#GridHandlerGMSH-199"><span class="linenos">199</span></a>				<span class="k">if</span> <span class="n">elem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
</span><span id="GridHandlerGMSH-200"><a href="#GridHandlerGMSH-200"><span class="linenos">200</span></a>					<span class="bp">self</span><span class="o">.</span><span class="n">stencil</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-201"><a href="#GridHandlerGMSH-201"><span class="linenos">201</span></a>
</span><span id="GridHandlerGMSH-202"><a href="#GridHandlerGMSH-202"><span class="linenos">202</span></a>	<span class="k">def</span> <span class="nf">build_smoother</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-203"><a href="#GridHandlerGMSH-203"><span class="linenos">203</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-204"><a href="#GridHandlerGMSH-204"><span class="linenos">204</span></a><span class="sd">        Construct elementnode smoothing operators and their product.</span>
</span><span id="GridHandlerGMSH-205"><a href="#GridHandlerGMSH-205"><span class="linenos">205</span></a>
</span><span id="GridHandlerGMSH-206"><a href="#GridHandlerGMSH-206"><span class="linenos">206</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-207"><a href="#GridHandlerGMSH-207"><span class="linenos">207</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-208"><a href="#GridHandlerGMSH-208"><span class="linenos">208</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-209"><a href="#GridHandlerGMSH-209"><span class="linenos">209</span></a>
</span><span id="GridHandlerGMSH-210"><a href="#GridHandlerGMSH-210"><span class="linenos">210</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-211"><a href="#GridHandlerGMSH-211"><span class="linenos">211</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-212"><a href="#GridHandlerGMSH-212"><span class="linenos">212</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-213"><a href="#GridHandlerGMSH-213"><span class="linenos">213</span></a>
</span><span id="GridHandlerGMSH-214"><a href="#GridHandlerGMSH-214"><span class="linenos">214</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-215"><a href="#GridHandlerGMSH-215"><span class="linenos">215</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-216"><a href="#GridHandlerGMSH-216"><span class="linenos">216</span></a><span class="sd">        A_csr : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH-217"><a href="#GridHandlerGMSH-217"><span class="linenos">217</span></a><span class="sd">            Node-to-element weights, shape `(n_nodes, n_elems)`.</span>
</span><span id="GridHandlerGMSH-218"><a href="#GridHandlerGMSH-218"><span class="linenos">218</span></a><span class="sd">        B_csr : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH-219"><a href="#GridHandlerGMSH-219"><span class="linenos">219</span></a><span class="sd">            Element-to-node weights, shape `(n_elems, n_nodes)`.</span>
</span><span id="GridHandlerGMSH-220"><a href="#GridHandlerGMSH-220"><span class="linenos">220</span></a><span class="sd">        smoother : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH-221"><a href="#GridHandlerGMSH-221"><span class="linenos">221</span></a><span class="sd">            Product `B_csr @ A_csr`, shape `(n_elems, n_elems)`.</span>
</span><span id="GridHandlerGMSH-222"><a href="#GridHandlerGMSH-222"><span class="linenos">222</span></a>
</span><span id="GridHandlerGMSH-223"><a href="#GridHandlerGMSH-223"><span class="linenos">223</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-224"><a href="#GridHandlerGMSH-224"><span class="linenos">224</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-225"><a href="#GridHandlerGMSH-225"><span class="linenos">225</span></a><span class="sd">        - `A_csr[i, e] = vol_e / sum(vol_e&#39; for e&#39; in stencil[i])`.</span>
</span><span id="GridHandlerGMSH-226"><a href="#GridHandlerGMSH-226"><span class="linenos">226</span></a><span class="sd">        - `B_csr[e, i] = 1/4` for tetrahedra (uniform average over the 4 nodes).</span>
</span><span id="GridHandlerGMSH-227"><a href="#GridHandlerGMSH-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-228"><a href="#GridHandlerGMSH-228"><span class="linenos">228</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__compute_volumes</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-229"><a href="#GridHandlerGMSH-229"><span class="linenos">229</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__build_node_elem_stencil</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-230"><a href="#GridHandlerGMSH-230"><span class="linenos">230</span></a>		<span class="n">A_row</span><span class="p">,</span> <span class="n">A_col</span><span class="p">,</span> <span class="n">A_data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH-231"><a href="#GridHandlerGMSH-231"><span class="linenos">231</span></a>		<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-232"><a href="#GridHandlerGMSH-232"><span class="linenos">232</span></a>			<span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stencil</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-233"><a href="#GridHandlerGMSH-233"><span class="linenos">233</span></a>			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
</span><span id="GridHandlerGMSH-234"><a href="#GridHandlerGMSH-234"><span class="linenos">234</span></a>				<span class="n">A_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-235"><a href="#GridHandlerGMSH-235"><span class="linenos">235</span></a>				<span class="n">A_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-236"><a href="#GridHandlerGMSH-236"><span class="linenos">236</span></a>				<span class="n">A_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span><span class="o">/</span><span class="n">vol</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-237"><a href="#GridHandlerGMSH-237"><span class="linenos">237</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">A_csr</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">A_data</span><span class="p">,</span> <span class="p">(</span><span class="n">A_row</span><span class="p">,</span> <span class="n">A_col</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">))</span>
</span><span id="GridHandlerGMSH-238"><a href="#GridHandlerGMSH-238"><span class="linenos">238</span></a>		<span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">connectivity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-239"><a href="#GridHandlerGMSH-239"><span class="linenos">239</span></a>		<span class="n">B_row</span><span class="p">,</span> <span class="n">B_col</span><span class="p">,</span> <span class="n">B_data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH-240"><a href="#GridHandlerGMSH-240"><span class="linenos">240</span></a>		<span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-241"><a href="#GridHandlerGMSH-241"><span class="linenos">241</span></a>			<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-242"><a href="#GridHandlerGMSH-242"><span class="linenos">242</span></a>				<span class="n">B_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-243"><a href="#GridHandlerGMSH-243"><span class="linenos">243</span></a>				<span class="n">B_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-244"><a href="#GridHandlerGMSH-244"><span class="linenos">244</span></a>				<span class="n">B_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
</span><span id="GridHandlerGMSH-245"><a href="#GridHandlerGMSH-245"><span class="linenos">245</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B_csr</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">B_data</span><span class="p">,</span> <span class="p">(</span><span class="n">B_row</span><span class="p">,</span> <span class="n">B_col</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">))</span>
</span><span id="GridHandlerGMSH-246"><a href="#GridHandlerGMSH-246"><span class="linenos">246</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">smoother</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B_csr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A_csr</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-247"><a href="#GridHandlerGMSH-247"><span class="linenos">247</span></a>
</span><span id="GridHandlerGMSH-248"><a href="#GridHandlerGMSH-248"><span class="linenos">248</span></a>	<span class="k">def</span> <span class="nf">load_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-249"><a href="#GridHandlerGMSH-249"><span class="linenos">249</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-250"><a href="#GridHandlerGMSH-250"><span class="linenos">250</span></a><span class="sd">        Load mesh and tag metadata from a Gmsh `.msh` file.</span>
</span><span id="GridHandlerGMSH-251"><a href="#GridHandlerGMSH-251"><span class="linenos">251</span></a>
</span><span id="GridHandlerGMSH-252"><a href="#GridHandlerGMSH-252"><span class="linenos">252</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-253"><a href="#GridHandlerGMSH-253"><span class="linenos">253</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-254"><a href="#GridHandlerGMSH-254"><span class="linenos">254</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-255"><a href="#GridHandlerGMSH-255"><span class="linenos">255</span></a>
</span><span id="GridHandlerGMSH-256"><a href="#GridHandlerGMSH-256"><span class="linenos">256</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-257"><a href="#GridHandlerGMSH-257"><span class="linenos">257</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-258"><a href="#GridHandlerGMSH-258"><span class="linenos">258</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-259"><a href="#GridHandlerGMSH-259"><span class="linenos">259</span></a>
</span><span id="GridHandlerGMSH-260"><a href="#GridHandlerGMSH-260"><span class="linenos">260</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-261"><a href="#GridHandlerGMSH-261"><span class="linenos">261</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-262"><a href="#GridHandlerGMSH-262"><span class="linenos">262</span></a><span class="sd">        mesh : dolfinx.mesh.Mesh</span>
</span><span id="GridHandlerGMSH-263"><a href="#GridHandlerGMSH-263"><span class="linenos">263</span></a><span class="sd">            Sets `self.mesh`.</span>
</span><span id="GridHandlerGMSH-264"><a href="#GridHandlerGMSH-264"><span class="linenos">264</span></a><span class="sd">        subdomains : dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH-265"><a href="#GridHandlerGMSH-265"><span class="linenos">265</span></a><span class="sd">            Sets `self.subdomains` (cell tags).</span>
</span><span id="GridHandlerGMSH-266"><a href="#GridHandlerGMSH-266"><span class="linenos">266</span></a><span class="sd">        boundaries : dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH-267"><a href="#GridHandlerGMSH-267"><span class="linenos">267</span></a><span class="sd">            Sets `self.boundaries` (facet tags).</span>
</span><span id="GridHandlerGMSH-268"><a href="#GridHandlerGMSH-268"><span class="linenos">268</span></a><span class="sd">        domain_dim : int</span>
</span><span id="GridHandlerGMSH-269"><a href="#GridHandlerGMSH-269"><span class="linenos">269</span></a><span class="sd">            Sets `self.domain_dim` from mesh topology.</span>
</span><span id="GridHandlerGMSH-270"><a href="#GridHandlerGMSH-270"><span class="linenos">270</span></a><span class="sd">        boundary_dim : int</span>
</span><span id="GridHandlerGMSH-271"><a href="#GridHandlerGMSH-271"><span class="linenos">271</span></a><span class="sd">            Sets `self.boundary_dim = domain_dim - 1`.</span>
</span><span id="GridHandlerGMSH-272"><a href="#GridHandlerGMSH-272"><span class="linenos">272</span></a><span class="sd">        n_elems, n_nodes : int</span>
</span><span id="GridHandlerGMSH-273"><a href="#GridHandlerGMSH-273"><span class="linenos">273</span></a><span class="sd">            Sets local counts including ghosts.</span>
</span><span id="GridHandlerGMSH-274"><a href="#GridHandlerGMSH-274"><span class="linenos">274</span></a>
</span><span id="GridHandlerGMSH-275"><a href="#GridHandlerGMSH-275"><span class="linenos">275</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-276"><a href="#GridHandlerGMSH-276"><span class="linenos">276</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-277"><a href="#GridHandlerGMSH-277"><span class="linenos">277</span></a><span class="sd">        Uses `gmshio.read_from_msh(os.path.join(grid_folder, f&quot;{geometry_name}.msh&quot;), comm, rank=0)`.</span>
</span><span id="GridHandlerGMSH-278"><a href="#GridHandlerGMSH-278"><span class="linenos">278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-279"><a href="#GridHandlerGMSH-279"><span class="linenos">279</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdomains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span> <span class="o">=</span> <span class="n">gmshio</span><span class="o">.</span><span class="n">read_from_msh</span><span class="p">(</span>
</span><span id="GridHandlerGMSH-280"><a href="#GridHandlerGMSH-280"><span class="linenos">280</span></a>													    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_name</span><span class="si">}</span><span class="s2">.msh&quot;</span><span class="p">),</span>
</span><span id="GridHandlerGMSH-281"><a href="#GridHandlerGMSH-281"><span class="linenos">281</span></a>													    <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span>
</span><span id="GridHandlerGMSH-282"><a href="#GridHandlerGMSH-282"><span class="linenos">282</span></a>													    <span class="n">rank</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GridHandlerGMSH-283"><a href="#GridHandlerGMSH-283"><span class="linenos">283</span></a>													<span class="p">)</span>
</span><span id="GridHandlerGMSH-284"><a href="#GridHandlerGMSH-284"><span class="linenos">284</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">dim</span>
</span><span id="GridHandlerGMSH-285"><a href="#GridHandlerGMSH-285"><span class="linenos">285</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">boundary_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="GridHandlerGMSH-286"><a href="#GridHandlerGMSH-286"><span class="linenos">286</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">)</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">)</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-287"><a href="#GridHandlerGMSH-287"><span class="linenos">287</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-288"><a href="#GridHandlerGMSH-288"><span class="linenos">288</span></a>
</span><span id="GridHandlerGMSH-289"><a href="#GridHandlerGMSH-289"><span class="linenos">289</span></a>	<span class="k">def</span> <span class="nf">build_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-290"><a href="#GridHandlerGMSH-290"><span class="linenos">290</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-291"><a href="#GridHandlerGMSH-291"><span class="linenos">291</span></a><span class="sd">        Parse Gmsh field data into a dimensionnametag mapping.</span>
</span><span id="GridHandlerGMSH-292"><a href="#GridHandlerGMSH-292"><span class="linenos">292</span></a>
</span><span id="GridHandlerGMSH-293"><a href="#GridHandlerGMSH-293"><span class="linenos">293</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-294"><a href="#GridHandlerGMSH-294"><span class="linenos">294</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-295"><a href="#GridHandlerGMSH-295"><span class="linenos">295</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-296"><a href="#GridHandlerGMSH-296"><span class="linenos">296</span></a>
</span><span id="GridHandlerGMSH-297"><a href="#GridHandlerGMSH-297"><span class="linenos">297</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-298"><a href="#GridHandlerGMSH-298"><span class="linenos">298</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-299"><a href="#GridHandlerGMSH-299"><span class="linenos">299</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-300"><a href="#GridHandlerGMSH-300"><span class="linenos">300</span></a>
</span><span id="GridHandlerGMSH-301"><a href="#GridHandlerGMSH-301"><span class="linenos">301</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-302"><a href="#GridHandlerGMSH-302"><span class="linenos">302</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-303"><a href="#GridHandlerGMSH-303"><span class="linenos">303</span></a><span class="sd">        dolfin_tags : dict[int, dict[str, int]]</span>
</span><span id="GridHandlerGMSH-304"><a href="#GridHandlerGMSH-304"><span class="linenos">304</span></a><span class="sd">            Populates `self.dolfin_tags` with entries for dims 1, 2, 3.</span>
</span><span id="GridHandlerGMSH-305"><a href="#GridHandlerGMSH-305"><span class="linenos">305</span></a>
</span><span id="GridHandlerGMSH-306"><a href="#GridHandlerGMSH-306"><span class="linenos">306</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-307"><a href="#GridHandlerGMSH-307"><span class="linenos">307</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-308"><a href="#GridHandlerGMSH-308"><span class="linenos">308</span></a><span class="sd">        Reads the `.msh` via `meshio.read` to access `field_data`.</span>
</span><span id="GridHandlerGMSH-309"><a href="#GridHandlerGMSH-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-310"><a href="#GridHandlerGMSH-310"><span class="linenos">310</span></a>		<span class="n">grid</span> <span class="o">=</span> <span class="n">meshio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_name</span><span class="o">+</span><span class="s2">&quot;.msh&quot;</span><span class="p">))</span>
</span><span id="GridHandlerGMSH-311"><a href="#GridHandlerGMSH-311"><span class="linenos">311</span></a>		<span class="c1"># self.tags = {1:{}, 2:{}, 3:{}}</span>
</span><span id="GridHandlerGMSH-312"><a href="#GridHandlerGMSH-312"><span class="linenos">312</span></a>		<span class="c1"># for key, value in grid.field_data.items():</span>
</span><span id="GridHandlerGMSH-313"><a href="#GridHandlerGMSH-313"><span class="linenos">313</span></a>		<span class="c1"># 	self.tags[value[1]][key] = value[0]</span>
</span><span id="GridHandlerGMSH-314"><a href="#GridHandlerGMSH-314"><span class="linenos">314</span></a>		<span class="c1"># self.dolfin_tags = self.tags</span>
</span><span id="GridHandlerGMSH-315"><a href="#GridHandlerGMSH-315"><span class="linenos">315</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:{},</span> <span class="mi">2</span><span class="p">:{},</span> <span class="mi">3</span><span class="p">:{}}</span>
</span><span id="GridHandlerGMSH-316"><a href="#GridHandlerGMSH-316"><span class="linenos">316</span></a>		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">field_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GridHandlerGMSH-317"><a href="#GridHandlerGMSH-317"><span class="linenos">317</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-318"><a href="#GridHandlerGMSH-318"><span class="linenos">318</span></a>
</span><span id="GridHandlerGMSH-319"><a href="#GridHandlerGMSH-319"><span class="linenos">319</span></a>	<span class="k">def</span> <span class="nf">load_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-320"><a href="#GridHandlerGMSH-320"><span class="linenos">320</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-321"><a href="#GridHandlerGMSH-321"><span class="linenos">321</span></a><span class="sd">        Initialize container for subdomain cell indices per region name.</span>
</span><span id="GridHandlerGMSH-322"><a href="#GridHandlerGMSH-322"><span class="linenos">322</span></a>
</span><span id="GridHandlerGMSH-323"><a href="#GridHandlerGMSH-323"><span class="linenos">323</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-324"><a href="#GridHandlerGMSH-324"><span class="linenos">324</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-325"><a href="#GridHandlerGMSH-325"><span class="linenos">325</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-326"><a href="#GridHandlerGMSH-326"><span class="linenos">326</span></a>
</span><span id="GridHandlerGMSH-327"><a href="#GridHandlerGMSH-327"><span class="linenos">327</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-328"><a href="#GridHandlerGMSH-328"><span class="linenos">328</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-329"><a href="#GridHandlerGMSH-329"><span class="linenos">329</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-330"><a href="#GridHandlerGMSH-330"><span class="linenos">330</span></a>
</span><span id="GridHandlerGMSH-331"><a href="#GridHandlerGMSH-331"><span class="linenos">331</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-332"><a href="#GridHandlerGMSH-332"><span class="linenos">332</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-333"><a href="#GridHandlerGMSH-333"><span class="linenos">333</span></a><span class="sd">        subdomain_tags : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH-334"><a href="#GridHandlerGMSH-334"><span class="linenos">334</span></a><span class="sd">            Initializes empty lists keyed by subdomain names.</span>
</span><span id="GridHandlerGMSH-335"><a href="#GridHandlerGMSH-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-336"><a href="#GridHandlerGMSH-336"><span class="linenos">336</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">subdomain_tags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GridHandlerGMSH-337"><a href="#GridHandlerGMSH-337"><span class="linenos">337</span></a>		<span class="k">for</span> <span class="n">subdomain_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subdomain_names</span><span class="p">():</span>
</span><span id="GridHandlerGMSH-338"><a href="#GridHandlerGMSH-338"><span class="linenos">338</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">subdomain_tags</span><span class="p">[</span><span class="n">subdomain_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH-339"><a href="#GridHandlerGMSH-339"><span class="linenos">339</span></a>
</span><span id="GridHandlerGMSH-340"><a href="#GridHandlerGMSH-340"><span class="linenos">340</span></a>
</span><span id="GridHandlerGMSH-341"><a href="#GridHandlerGMSH-341"><span class="linenos">341</span></a>	<span class="k">def</span> <span class="nf">load_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-342"><a href="#GridHandlerGMSH-342"><span class="linenos">342</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-343"><a href="#GridHandlerGMSH-343"><span class="linenos">343</span></a><span class="sd">        Build a map from boundary name to exterior facet indices.</span>
</span><span id="GridHandlerGMSH-344"><a href="#GridHandlerGMSH-344"><span class="linenos">344</span></a>
</span><span id="GridHandlerGMSH-345"><a href="#GridHandlerGMSH-345"><span class="linenos">345</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-346"><a href="#GridHandlerGMSH-346"><span class="linenos">346</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-347"><a href="#GridHandlerGMSH-347"><span class="linenos">347</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-348"><a href="#GridHandlerGMSH-348"><span class="linenos">348</span></a>
</span><span id="GridHandlerGMSH-349"><a href="#GridHandlerGMSH-349"><span class="linenos">349</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-350"><a href="#GridHandlerGMSH-350"><span class="linenos">350</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-351"><a href="#GridHandlerGMSH-351"><span class="linenos">351</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-352"><a href="#GridHandlerGMSH-352"><span class="linenos">352</span></a>
</span><span id="GridHandlerGMSH-353"><a href="#GridHandlerGMSH-353"><span class="linenos">353</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-354"><a href="#GridHandlerGMSH-354"><span class="linenos">354</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-355"><a href="#GridHandlerGMSH-355"><span class="linenos">355</span></a><span class="sd">        boundary_tags : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH-356"><a href="#GridHandlerGMSH-356"><span class="linenos">356</span></a><span class="sd">            Populates with facet indices for each named boundary.</span>
</span><span id="GridHandlerGMSH-357"><a href="#GridHandlerGMSH-357"><span class="linenos">357</span></a>
</span><span id="GridHandlerGMSH-358"><a href="#GridHandlerGMSH-358"><span class="linenos">358</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-359"><a href="#GridHandlerGMSH-359"><span class="linenos">359</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-360"><a href="#GridHandlerGMSH-360"><span class="linenos">360</span></a><span class="sd">        Uses `mesh.exterior_facet_indices(self.mesh.topology)` and the facet</span>
</span><span id="GridHandlerGMSH-361"><a href="#GridHandlerGMSH-361"><span class="linenos">361</span></a><span class="sd">        tag values in `self.boundaries` to assign names via `self.dolfin_tags[2]`.</span>
</span><span id="GridHandlerGMSH-362"><a href="#GridHandlerGMSH-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-363"><a href="#GridHandlerGMSH-363"><span class="linenos">363</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GridHandlerGMSH-364"><a href="#GridHandlerGMSH-364"><span class="linenos">364</span></a>
</span><span id="GridHandlerGMSH-365"><a href="#GridHandlerGMSH-365"><span class="linenos">365</span></a>		<span class="k">for</span> <span class="n">boundary_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_names</span><span class="p">():</span>
</span><span id="GridHandlerGMSH-366"><a href="#GridHandlerGMSH-366"><span class="linenos">366</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span><span class="p">[</span><span class="n">boundary_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH-367"><a href="#GridHandlerGMSH-367"><span class="linenos">367</span></a>		
</span><span id="GridHandlerGMSH-368"><a href="#GridHandlerGMSH-368"><span class="linenos">368</span></a>		<span class="n">tag_to_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">fd</span><span class="p">:</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="GridHandlerGMSH-369"><a href="#GridHandlerGMSH-369"><span class="linenos">369</span></a>		<span class="n">boundary_facets</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">exterior_facet_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-370"><a href="#GridHandlerGMSH-370"><span class="linenos">370</span></a>		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">facet</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">boundary_facets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-371"><a href="#GridHandlerGMSH-371"><span class="linenos">371</span></a>			<span class="n">boundary_name</span> <span class="o">=</span> <span class="n">tag_to_name</span><span class="p">[</span><span class="n">facet</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-372"><a href="#GridHandlerGMSH-372"><span class="linenos">372</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span><span class="p">[</span><span class="n">boundary_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-373"><a href="#GridHandlerGMSH-373"><span class="linenos">373</span></a>
</span><span id="GridHandlerGMSH-374"><a href="#GridHandlerGMSH-374"><span class="linenos">374</span></a>
</span><span id="GridHandlerGMSH-375"><a href="#GridHandlerGMSH-375"><span class="linenos">375</span></a>	<span class="k">def</span> <span class="nf">build_box_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-376"><a href="#GridHandlerGMSH-376"><span class="linenos">376</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-377"><a href="#GridHandlerGMSH-377"><span class="linenos">377</span></a><span class="sd">        Compute axis-aligned bounding-box extents (Lx, Ly, Lz).</span>
</span><span id="GridHandlerGMSH-378"><a href="#GridHandlerGMSH-378"><span class="linenos">378</span></a>
</span><span id="GridHandlerGMSH-379"><a href="#GridHandlerGMSH-379"><span class="linenos">379</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-380"><a href="#GridHandlerGMSH-380"><span class="linenos">380</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-381"><a href="#GridHandlerGMSH-381"><span class="linenos">381</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-382"><a href="#GridHandlerGMSH-382"><span class="linenos">382</span></a>
</span><span id="GridHandlerGMSH-383"><a href="#GridHandlerGMSH-383"><span class="linenos">383</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-384"><a href="#GridHandlerGMSH-384"><span class="linenos">384</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-385"><a href="#GridHandlerGMSH-385"><span class="linenos">385</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-386"><a href="#GridHandlerGMSH-386"><span class="linenos">386</span></a>
</span><span id="GridHandlerGMSH-387"><a href="#GridHandlerGMSH-387"><span class="linenos">387</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-388"><a href="#GridHandlerGMSH-388"><span class="linenos">388</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-389"><a href="#GridHandlerGMSH-389"><span class="linenos">389</span></a><span class="sd">        Lx, Ly, Lz : float</span>
</span><span id="GridHandlerGMSH-390"><a href="#GridHandlerGMSH-390"><span class="linenos">390</span></a><span class="sd">            Sets the extents along x, y, z.</span>
</span><span id="GridHandlerGMSH-391"><a href="#GridHandlerGMSH-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-392"><a href="#GridHandlerGMSH-392"><span class="linenos">392</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">Lx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-393"><a href="#GridHandlerGMSH-393"><span class="linenos">393</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">Ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-394"><a href="#GridHandlerGMSH-394"><span class="linenos">394</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">Lz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-395"><a href="#GridHandlerGMSH-395"><span class="linenos">395</span></a>
</span><span id="GridHandlerGMSH-396"><a href="#GridHandlerGMSH-396"><span class="linenos">396</span></a>	<span class="k">def</span> <span class="nf">get_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-397"><a href="#GridHandlerGMSH-397"><span class="linenos">397</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-398"><a href="#GridHandlerGMSH-398"><span class="linenos">398</span></a><span class="sd">        Return the facet `MeshTags` object.</span>
</span><span id="GridHandlerGMSH-399"><a href="#GridHandlerGMSH-399"><span class="linenos">399</span></a>
</span><span id="GridHandlerGMSH-400"><a href="#GridHandlerGMSH-400"><span class="linenos">400</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-401"><a href="#GridHandlerGMSH-401"><span class="linenos">401</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-402"><a href="#GridHandlerGMSH-402"><span class="linenos">402</span></a><span class="sd">        dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH-403"><a href="#GridHandlerGMSH-403"><span class="linenos">403</span></a><span class="sd">            The boundary tags read from the mesh.</span>
</span><span id="GridHandlerGMSH-404"><a href="#GridHandlerGMSH-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-405"><a href="#GridHandlerGMSH-405"><span class="linenos">405</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span>
</span><span id="GridHandlerGMSH-406"><a href="#GridHandlerGMSH-406"><span class="linenos">406</span></a>
</span><span id="GridHandlerGMSH-407"><a href="#GridHandlerGMSH-407"><span class="linenos">407</span></a>	<span class="k">def</span> <span class="nf">get_boundary_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BOUNDARY_NAME</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-408"><a href="#GridHandlerGMSH-408"><span class="linenos">408</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-409"><a href="#GridHandlerGMSH-409"><span class="linenos">409</span></a><span class="sd">        Get list of exterior facet indices for a named boundary.</span>
</span><span id="GridHandlerGMSH-410"><a href="#GridHandlerGMSH-410"><span class="linenos">410</span></a>
</span><span id="GridHandlerGMSH-411"><a href="#GridHandlerGMSH-411"><span class="linenos">411</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-412"><a href="#GridHandlerGMSH-412"><span class="linenos">412</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-413"><a href="#GridHandlerGMSH-413"><span class="linenos">413</span></a><span class="sd">        BOUNDARY_NAME : str or None</span>
</span><span id="GridHandlerGMSH-414"><a href="#GridHandlerGMSH-414"><span class="linenos">414</span></a><span class="sd">            Boundary name as defined in the Gmsh field data. If `None`,</span>
</span><span id="GridHandlerGMSH-415"><a href="#GridHandlerGMSH-415"><span class="linenos">415</span></a><span class="sd">            returns `None`.</span>
</span><span id="GridHandlerGMSH-416"><a href="#GridHandlerGMSH-416"><span class="linenos">416</span></a>
</span><span id="GridHandlerGMSH-417"><a href="#GridHandlerGMSH-417"><span class="linenos">417</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-418"><a href="#GridHandlerGMSH-418"><span class="linenos">418</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-419"><a href="#GridHandlerGMSH-419"><span class="linenos">419</span></a><span class="sd">        list[int] or None</span>
</span><span id="GridHandlerGMSH-420"><a href="#GridHandlerGMSH-420"><span class="linenos">420</span></a><span class="sd">            Facet indices on the exterior boundary corresponding to the name,</span>
</span><span id="GridHandlerGMSH-421"><a href="#GridHandlerGMSH-421"><span class="linenos">421</span></a><span class="sd">            or `None` if `BOUNDARY_NAME` is `None`.</span>
</span><span id="GridHandlerGMSH-422"><a href="#GridHandlerGMSH-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-423"><a href="#GridHandlerGMSH-423"><span class="linenos">423</span></a>		<span class="k">if</span> <span class="n">BOUNDARY_NAME</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-424"><a href="#GridHandlerGMSH-424"><span class="linenos">424</span></a>			<span class="k">return</span> <span class="kc">None</span>
</span><span id="GridHandlerGMSH-425"><a href="#GridHandlerGMSH-425"><span class="linenos">425</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-426"><a href="#GridHandlerGMSH-426"><span class="linenos">426</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span><span class="p">[</span><span class="n">BOUNDARY_NAME</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-427"><a href="#GridHandlerGMSH-427"><span class="linenos">427</span></a>
</span><span id="GridHandlerGMSH-428"><a href="#GridHandlerGMSH-428"><span class="linenos">428</span></a>	<span class="k">def</span> <span class="nf">get_boundary_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BOUNDARY_NAME</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-429"><a href="#GridHandlerGMSH-429"><span class="linenos">429</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-430"><a href="#GridHandlerGMSH-430"><span class="linenos">430</span></a><span class="sd">        Get the integer tag ID for a named boundary.</span>
</span><span id="GridHandlerGMSH-431"><a href="#GridHandlerGMSH-431"><span class="linenos">431</span></a>
</span><span id="GridHandlerGMSH-432"><a href="#GridHandlerGMSH-432"><span class="linenos">432</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-433"><a href="#GridHandlerGMSH-433"><span class="linenos">433</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-434"><a href="#GridHandlerGMSH-434"><span class="linenos">434</span></a><span class="sd">        BOUNDARY_NAME : str or None</span>
</span><span id="GridHandlerGMSH-435"><a href="#GridHandlerGMSH-435"><span class="linenos">435</span></a><span class="sd">            Boundary name. If `None`, returns `None`.</span>
</span><span id="GridHandlerGMSH-436"><a href="#GridHandlerGMSH-436"><span class="linenos">436</span></a>
</span><span id="GridHandlerGMSH-437"><a href="#GridHandlerGMSH-437"><span class="linenos">437</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-438"><a href="#GridHandlerGMSH-438"><span class="linenos">438</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-439"><a href="#GridHandlerGMSH-439"><span class="linenos">439</span></a><span class="sd">        int or None</span>
</span><span id="GridHandlerGMSH-440"><a href="#GridHandlerGMSH-440"><span class="linenos">440</span></a><span class="sd">            Integer tag in `self.dolfin_tags[self.boundary_dim]`, or `None`.</span>
</span><span id="GridHandlerGMSH-441"><a href="#GridHandlerGMSH-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-442"><a href="#GridHandlerGMSH-442"><span class="linenos">442</span></a>		<span class="k">if</span> <span class="n">BOUNDARY_NAME</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-443"><a href="#GridHandlerGMSH-443"><span class="linenos">443</span></a>			<span class="k">return</span> <span class="kc">None</span>
</span><span id="GridHandlerGMSH-444"><a href="#GridHandlerGMSH-444"><span class="linenos">444</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-445"><a href="#GridHandlerGMSH-445"><span class="linenos">445</span></a>			<span class="n">tag_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_dim</span><span class="p">][</span><span class="n">BOUNDARY_NAME</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-446"><a href="#GridHandlerGMSH-446"><span class="linenos">446</span></a>			<span class="k">return</span> <span class="n">tag_number</span>
</span><span id="GridHandlerGMSH-447"><a href="#GridHandlerGMSH-447"><span class="linenos">447</span></a>
</span><span id="GridHandlerGMSH-448"><a href="#GridHandlerGMSH-448"><span class="linenos">448</span></a>	<span class="k">def</span> <span class="nf">get_boundary_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-449"><a href="#GridHandlerGMSH-449"><span class="linenos">449</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-450"><a href="#GridHandlerGMSH-450"><span class="linenos">450</span></a><span class="sd">        List all boundary names present in the mesh.</span>
</span><span id="GridHandlerGMSH-451"><a href="#GridHandlerGMSH-451"><span class="linenos">451</span></a>
</span><span id="GridHandlerGMSH-452"><a href="#GridHandlerGMSH-452"><span class="linenos">452</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-453"><a href="#GridHandlerGMSH-453"><span class="linenos">453</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-454"><a href="#GridHandlerGMSH-454"><span class="linenos">454</span></a><span class="sd">        list[str]</span>
</span><span id="GridHandlerGMSH-455"><a href="#GridHandlerGMSH-455"><span class="linenos">455</span></a><span class="sd">            Boundary names from `self.dolfin_tags[self.boundary_dim]`.</span>
</span><span id="GridHandlerGMSH-456"><a href="#GridHandlerGMSH-456"><span class="linenos">456</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-457"><a href="#GridHandlerGMSH-457"><span class="linenos">457</span></a>		<span class="n">boundary_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_dim</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="GridHandlerGMSH-458"><a href="#GridHandlerGMSH-458"><span class="linenos">458</span></a>		<span class="k">return</span> <span class="n">boundary_names</span>
</span><span id="GridHandlerGMSH-459"><a href="#GridHandlerGMSH-459"><span class="linenos">459</span></a>
</span><span id="GridHandlerGMSH-460"><a href="#GridHandlerGMSH-460"><span class="linenos">460</span></a>	<span class="k">def</span> <span class="nf">get_subdomain_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DOMAIN_NAME</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-461"><a href="#GridHandlerGMSH-461"><span class="linenos">461</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-462"><a href="#GridHandlerGMSH-462"><span class="linenos">462</span></a><span class="sd">        Get the integer tag ID for a named subdomain (cell region).</span>
</span><span id="GridHandlerGMSH-463"><a href="#GridHandlerGMSH-463"><span class="linenos">463</span></a>
</span><span id="GridHandlerGMSH-464"><a href="#GridHandlerGMSH-464"><span class="linenos">464</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-465"><a href="#GridHandlerGMSH-465"><span class="linenos">465</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-466"><a href="#GridHandlerGMSH-466"><span class="linenos">466</span></a><span class="sd">        DOMAIN_NAME : str</span>
</span><span id="GridHandlerGMSH-467"><a href="#GridHandlerGMSH-467"><span class="linenos">467</span></a><span class="sd">            Subdomain name.</span>
</span><span id="GridHandlerGMSH-468"><a href="#GridHandlerGMSH-468"><span class="linenos">468</span></a>
</span><span id="GridHandlerGMSH-469"><a href="#GridHandlerGMSH-469"><span class="linenos">469</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-470"><a href="#GridHandlerGMSH-470"><span class="linenos">470</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-471"><a href="#GridHandlerGMSH-471"><span class="linenos">471</span></a><span class="sd">        int</span>
</span><span id="GridHandlerGMSH-472"><a href="#GridHandlerGMSH-472"><span class="linenos">472</span></a><span class="sd">            Integer tag for the subdomain in `self.dolfin_tags[self.domain_dim]`.</span>
</span><span id="GridHandlerGMSH-473"><a href="#GridHandlerGMSH-473"><span class="linenos">473</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-474"><a href="#GridHandlerGMSH-474"><span class="linenos">474</span></a>		<span class="n">tag_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">][</span><span class="n">DOMAIN_NAME</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-475"><a href="#GridHandlerGMSH-475"><span class="linenos">475</span></a>		<span class="k">return</span> <span class="n">tag_number</span>
</span><span id="GridHandlerGMSH-476"><a href="#GridHandlerGMSH-476"><span class="linenos">476</span></a>
</span><span id="GridHandlerGMSH-477"><a href="#GridHandlerGMSH-477"><span class="linenos">477</span></a>	<span class="k">def</span> <span class="nf">get_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-478"><a href="#GridHandlerGMSH-478"><span class="linenos">478</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-479"><a href="#GridHandlerGMSH-479"><span class="linenos">479</span></a><span class="sd">        Return the cell `MeshTags` object.</span>
</span><span id="GridHandlerGMSH-480"><a href="#GridHandlerGMSH-480"><span class="linenos">480</span></a>
</span><span id="GridHandlerGMSH-481"><a href="#GridHandlerGMSH-481"><span class="linenos">481</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-482"><a href="#GridHandlerGMSH-482"><span class="linenos">482</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-483"><a href="#GridHandlerGMSH-483"><span class="linenos">483</span></a><span class="sd">        dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH-484"><a href="#GridHandlerGMSH-484"><span class="linenos">484</span></a><span class="sd">            The subdomain (cell) tags read from the mesh.</span>
</span><span id="GridHandlerGMSH-485"><a href="#GridHandlerGMSH-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-486"><a href="#GridHandlerGMSH-486"><span class="linenos">486</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdomains</span>
</span><span id="GridHandlerGMSH-487"><a href="#GridHandlerGMSH-487"><span class="linenos">487</span></a>
</span><span id="GridHandlerGMSH-488"><a href="#GridHandlerGMSH-488"><span class="linenos">488</span></a>	<span class="k">def</span> <span class="nf">get_subdomain_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-489"><a href="#GridHandlerGMSH-489"><span class="linenos">489</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-490"><a href="#GridHandlerGMSH-490"><span class="linenos">490</span></a><span class="sd">        List all subdomain (region) names present in the mesh.</span>
</span><span id="GridHandlerGMSH-491"><a href="#GridHandlerGMSH-491"><span class="linenos">491</span></a>
</span><span id="GridHandlerGMSH-492"><a href="#GridHandlerGMSH-492"><span class="linenos">492</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-493"><a href="#GridHandlerGMSH-493"><span class="linenos">493</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-494"><a href="#GridHandlerGMSH-494"><span class="linenos">494</span></a><span class="sd">        list[str]</span>
</span><span id="GridHandlerGMSH-495"><a href="#GridHandlerGMSH-495"><span class="linenos">495</span></a><span class="sd">            Subdomain names from `self.dolfin_tags[self.domain_dim]`.</span>
</span><span id="GridHandlerGMSH-496"><a href="#GridHandlerGMSH-496"><span class="linenos">496</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-497"><a href="#GridHandlerGMSH-497"><span class="linenos">497</span></a>		<span class="n">subdomain_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="GridHandlerGMSH-498"><a href="#GridHandlerGMSH-498"><span class="linenos">498</span></a>		<span class="k">return</span> <span class="n">subdomain_names</span>
</span><span id="GridHandlerGMSH-499"><a href="#GridHandlerGMSH-499"><span class="linenos">499</span></a>
</span><span id="GridHandlerGMSH-500"><a href="#GridHandlerGMSH-500"><span class="linenos">500</span></a>	<span class="k">def</span> <span class="nf">__extract_grid_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-501"><a href="#GridHandlerGMSH-501"><span class="linenos">501</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-502"><a href="#GridHandlerGMSH-502"><span class="linenos">502</span></a><span class="sd">        Build region indices for elements based on cell tags.</span>
</span><span id="GridHandlerGMSH-503"><a href="#GridHandlerGMSH-503"><span class="linenos">503</span></a>
</span><span id="GridHandlerGMSH-504"><a href="#GridHandlerGMSH-504"><span class="linenos">504</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-505"><a href="#GridHandlerGMSH-505"><span class="linenos">505</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-506"><a href="#GridHandlerGMSH-506"><span class="linenos">506</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-507"><a href="#GridHandlerGMSH-507"><span class="linenos">507</span></a>
</span><span id="GridHandlerGMSH-508"><a href="#GridHandlerGMSH-508"><span class="linenos">508</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-509"><a href="#GridHandlerGMSH-509"><span class="linenos">509</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-510"><a href="#GridHandlerGMSH-510"><span class="linenos">510</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH-511"><a href="#GridHandlerGMSH-511"><span class="linenos">511</span></a>
</span><span id="GridHandlerGMSH-512"><a href="#GridHandlerGMSH-512"><span class="linenos">512</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH-513"><a href="#GridHandlerGMSH-513"><span class="linenos">513</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH-514"><a href="#GridHandlerGMSH-514"><span class="linenos">514</span></a><span class="sd">        region_names : list[str]</span>
</span><span id="GridHandlerGMSH-515"><a href="#GridHandlerGMSH-515"><span class="linenos">515</span></a><span class="sd">            Sets from `get_subdomain_names()`.</span>
</span><span id="GridHandlerGMSH-516"><a href="#GridHandlerGMSH-516"><span class="linenos">516</span></a><span class="sd">        n_regions : int</span>
</span><span id="GridHandlerGMSH-517"><a href="#GridHandlerGMSH-517"><span class="linenos">517</span></a><span class="sd">            Total number of regions.</span>
</span><span id="GridHandlerGMSH-518"><a href="#GridHandlerGMSH-518"><span class="linenos">518</span></a><span class="sd">        region_indices : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH-519"><a href="#GridHandlerGMSH-519"><span class="linenos">519</span></a><span class="sd">            Maps each region name to a list of cell indices.</span>
</span><span id="GridHandlerGMSH-520"><a href="#GridHandlerGMSH-520"><span class="linenos">520</span></a><span class="sd">        tags_dict : dict[int, str]</span>
</span><span id="GridHandlerGMSH-521"><a href="#GridHandlerGMSH-521"><span class="linenos">521</span></a><span class="sd">            Reverse mapping from integer tag to region name.</span>
</span><span id="GridHandlerGMSH-522"><a href="#GridHandlerGMSH-522"><span class="linenos">522</span></a>
</span><span id="GridHandlerGMSH-523"><a href="#GridHandlerGMSH-523"><span class="linenos">523</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-524"><a href="#GridHandlerGMSH-524"><span class="linenos">524</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-525"><a href="#GridHandlerGMSH-525"><span class="linenos">525</span></a><span class="sd">        Iterates over local elements; if running in parallel, these are</span>
</span><span id="GridHandlerGMSH-526"><a href="#GridHandlerGMSH-526"><span class="linenos">526</span></a><span class="sd">        local (including ghosts).</span>
</span><span id="GridHandlerGMSH-527"><a href="#GridHandlerGMSH-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-528"><a href="#GridHandlerGMSH-528"><span class="linenos">528</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">region_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subdomain_names</span><span class="p">()</span>
</span><span id="GridHandlerGMSH-529"><a href="#GridHandlerGMSH-529"><span class="linenos">529</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_regions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_names</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-530"><a href="#GridHandlerGMSH-530"><span class="linenos">530</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GridHandlerGMSH-531"><a href="#GridHandlerGMSH-531"><span class="linenos">531</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">tags_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GridHandlerGMSH-532"><a href="#GridHandlerGMSH-532"><span class="linenos">532</span></a>
</span><span id="GridHandlerGMSH-533"><a href="#GridHandlerGMSH-533"><span class="linenos">533</span></a>		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_names</span><span class="p">)):</span>
</span><span id="GridHandlerGMSH-534"><a href="#GridHandlerGMSH-534"><span class="linenos">534</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">region_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH-535"><a href="#GridHandlerGMSH-535"><span class="linenos">535</span></a>			<span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subdomain_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="GridHandlerGMSH-536"><a href="#GridHandlerGMSH-536"><span class="linenos">536</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">tags_dict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-537"><a href="#GridHandlerGMSH-537"><span class="linenos">537</span></a>
</span><span id="GridHandlerGMSH-538"><a href="#GridHandlerGMSH-538"><span class="linenos">538</span></a>		<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-539"><a href="#GridHandlerGMSH-539"><span class="linenos">539</span></a>			<span class="n">region_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdomains</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-540"><a href="#GridHandlerGMSH-540"><span class="linenos">540</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tags_dict</span><span class="p">[</span><span class="n">region_marker</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-541"><a href="#GridHandlerGMSH-541"><span class="linenos">541</span></a>
</span><span id="GridHandlerGMSH-542"><a href="#GridHandlerGMSH-542"><span class="linenos">542</span></a>	<span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
</span><span id="GridHandlerGMSH-543"><a href="#GridHandlerGMSH-543"><span class="linenos">543</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-544"><a href="#GridHandlerGMSH-544"><span class="linenos">544</span></a><span class="sd">        Expand a parameter specification to per-element values.</span>
</span><span id="GridHandlerGMSH-545"><a href="#GridHandlerGMSH-545"><span class="linenos">545</span></a>
</span><span id="GridHandlerGMSH-546"><a href="#GridHandlerGMSH-546"><span class="linenos">546</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH-547"><a href="#GridHandlerGMSH-547"><span class="linenos">547</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH-548"><a href="#GridHandlerGMSH-548"><span class="linenos">548</span></a><span class="sd">        param : int or float or sequence or torch.Tensor</span>
</span><span id="GridHandlerGMSH-549"><a href="#GridHandlerGMSH-549"><span class="linenos">549</span></a><span class="sd">            - Scalar (`int`/`float`): broadcast to all elements.</span>
</span><span id="GridHandlerGMSH-550"><a href="#GridHandlerGMSH-550"><span class="linenos">550</span></a><span class="sd">            - Sequence of length `n_regions`: values per region in the</span>
</span><span id="GridHandlerGMSH-551"><a href="#GridHandlerGMSH-551"><span class="linenos">551</span></a><span class="sd">              order of `self.region_indices.keys()`.</span>
</span><span id="GridHandlerGMSH-552"><a href="#GridHandlerGMSH-552"><span class="linenos">552</span></a><span class="sd">            - Sequence or tensor of length `n_elems`: per-element values.</span>
</span><span id="GridHandlerGMSH-553"><a href="#GridHandlerGMSH-553"><span class="linenos">553</span></a>
</span><span id="GridHandlerGMSH-554"><a href="#GridHandlerGMSH-554"><span class="linenos">554</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH-555"><a href="#GridHandlerGMSH-555"><span class="linenos">555</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH-556"><a href="#GridHandlerGMSH-556"><span class="linenos">556</span></a><span class="sd">        torch.Tensor</span>
</span><span id="GridHandlerGMSH-557"><a href="#GridHandlerGMSH-557"><span class="linenos">557</span></a><span class="sd">            1D tensor of length `n_elems` with parameter values.</span>
</span><span id="GridHandlerGMSH-558"><a href="#GridHandlerGMSH-558"><span class="linenos">558</span></a>
</span><span id="GridHandlerGMSH-559"><a href="#GridHandlerGMSH-559"><span class="linenos">559</span></a><span class="sd">        Raises</span>
</span><span id="GridHandlerGMSH-560"><a href="#GridHandlerGMSH-560"><span class="linenos">560</span></a><span class="sd">        ------</span>
</span><span id="GridHandlerGMSH-561"><a href="#GridHandlerGMSH-561"><span class="linenos">561</span></a><span class="sd">        Exception</span>
</span><span id="GridHandlerGMSH-562"><a href="#GridHandlerGMSH-562"><span class="linenos">562</span></a><span class="sd">            If `param` length is neither `n_regions` nor `n_elems`.</span>
</span><span id="GridHandlerGMSH-563"><a href="#GridHandlerGMSH-563"><span class="linenos">563</span></a>
</span><span id="GridHandlerGMSH-564"><a href="#GridHandlerGMSH-564"><span class="linenos">564</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH-565"><a href="#GridHandlerGMSH-565"><span class="linenos">565</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH-566"><a href="#GridHandlerGMSH-566"><span class="linenos">566</span></a><span class="sd">        Converts Python sequences to `torch.Tensor` when needed. For the</span>
</span><span id="GridHandlerGMSH-567"><a href="#GridHandlerGMSH-567"><span class="linenos">567</span></a><span class="sd">        region-wise case, elements are filled according to</span>
</span><span id="GridHandlerGMSH-568"><a href="#GridHandlerGMSH-568"><span class="linenos">568</span></a><span class="sd">        `self.region_indices[region]` for each region name.</span>
</span><span id="GridHandlerGMSH-569"><a href="#GridHandlerGMSH-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH-570"><a href="#GridHandlerGMSH-570"><span class="linenos">570</span></a>		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-571"><a href="#GridHandlerGMSH-571"><span class="linenos">571</span></a>			<span class="k">return</span> <span class="n">to</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">param</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">)])</span>
</span><span id="GridHandlerGMSH-572"><a href="#GridHandlerGMSH-572"><span class="linenos">572</span></a>		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_regions</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-573"><a href="#GridHandlerGMSH-573"><span class="linenos">573</span></a>			<span class="n">param_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-574"><a href="#GridHandlerGMSH-574"><span class="linenos">574</span></a>			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="GridHandlerGMSH-575"><a href="#GridHandlerGMSH-575"><span class="linenos">575</span></a>				<span class="n">param_to</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span><span class="p">[</span><span class="n">region</span><span class="p">]]</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="GridHandlerGMSH-576"><a href="#GridHandlerGMSH-576"><span class="linenos">576</span></a>			<span class="k">return</span> <span class="n">param_to</span>
</span><span id="GridHandlerGMSH-577"><a href="#GridHandlerGMSH-577"><span class="linenos">577</span></a>		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-578"><a href="#GridHandlerGMSH-578"><span class="linenos">578</span></a>			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-579"><a href="#GridHandlerGMSH-579"><span class="linenos">579</span></a>				<span class="k">return</span> <span class="n">param</span>
</span><span id="GridHandlerGMSH-580"><a href="#GridHandlerGMSH-580"><span class="linenos">580</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-581"><a href="#GridHandlerGMSH-581"><span class="linenos">581</span></a>				<span class="k">return</span> <span class="n">to</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="GridHandlerGMSH-582"><a href="#GridHandlerGMSH-582"><span class="linenos">582</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH-583"><a href="#GridHandlerGMSH-583"><span class="linenos">583</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Size of parameter list does not match neither # of elements nor # of regions.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Handler for reading a Gmsh mesh into DOLFINx and exposing convenient
grid-related utilities (tags, regions, volumes, smoothers).</p>

<p>The constructor loads the mesh, builds tag maps, extracts subdomain and
boundary metadata, computes bounding-box dimensions, derives region-wise
element indices, and constructs nodeelement smoothing operators.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>geometry_name</strong> (str):
Base name (without extension) of the <code>.msh</code> file to read.</li>
<li><strong>grid_folder</strong> (str):
Directory where the mesh file <code>{geometry_name}.msh</code> resides.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>grid_folder</strong> (str):
Mesh directory provided at construction.</li>
<li><strong>geometry_name</strong> (str):
Mesh base name provided at construction.</li>
<li><strong>comm</strong> (MPI.Comm):
MPI communicator (defaults to <code>MPI.COMM_WORLD</code>).</li>
<li><strong>rank</strong> (int):
Rank of the current process.</li>
<li><strong>mesh</strong> (dolfinx.mesh.Mesh):
Loaded DOLFINx mesh.</li>
<li><strong>subdomains</strong> (dolfinx.mesh.MeshTags):
Cell (volume) tags read from the mesh.</li>
<li><strong>boundaries</strong> (dolfinx.mesh.MeshTags):
Facet (surface) tags read from the mesh.</li>
<li><strong>domain_dim</strong> (int):
Topological dimension of the mesh cells.</li>
<li><strong>boundary_dim</strong> (int):
Dimension of boundary entities (<code>domain_dim - 1</code>).</li>
<li><strong>n_elems</strong> (int):
Number of local cells including ghosts.</li>
<li><strong>n_nodes</strong> (int):
Number of local vertices including ghosts.</li>
<li><strong>tags</strong> (dict[int, dict[str, int]]):
Mapping <code>dimension -&gt; {name -&gt; tag_id}</code> parsed from the Gmsh file.</li>
<li><strong>dolfin_tags</strong> (dict):
Alias of <code>tags</code> for convenience.</li>
<li><strong>subdomain_tags</strong> (dict[str, list[int]]):
Placeholder for subdomain-wise cell indices (filled later).</li>
<li><strong>boundary_tags</strong> (dict[str, list[int]]):
Mapping from boundary name to list of exterior facet indices.</li>
<li><strong>Lx, Ly, Lz</strong> (float):
Extents of the mesh bounding box in x, y, z.</li>
<li><strong>region_names</strong> (list[str]):
List of subdomain (region) names.</li>
<li><strong>n_regions</strong> (int):
Number of regions.</li>
<li><strong>region_indices</strong> (dict[str, list[int]]):
Mapping from region name to list of cell indices in that region.</li>
<li><strong>tags_dict</strong> (dict[int, str]):
Reverse mapping <code>{tag_id -&gt; region_name}</code>.</li>
<li><strong>volumes</strong> (numpy.ndarray):
Per-cell volumes, shape <code>(n_elems,)</code>. Created by <code><a href="#GridHandlerGMSH.build_smoother">build_smoother()</a></code>.</li>
<li><strong>stencil</strong> (list[list[int]]):
Node-to-element adjacency (per-node list of incident cell indices).</li>
<li><strong>A_csr</strong> (scipy.sparse.csr_matrix):
Node-to-element averaging weights, shape <code>(n_nodes, n_elems)</code>.</li>
<li><strong>B_csr</strong> (scipy.sparse.csr_matrix):
Element-to-node averaging weights, shape <code>(n_elems, n_nodes)</code>.</li>
<li><strong>smoother</strong> (scipy.sparse.csr_matrix):
Element-wise smoother <code>B_csr @ A_csr</code>, shape <code>(n_elems, n_elems)</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Assumes a tetrahedral volume mesh for volume and centroid calculations.</li>
<li>Counts (<code>n_elems</code>, <code>n_nodes</code>) include local ghosts for parallel runs.</li>
</ul>
</div>


                            <div id="GridHandlerGMSH.__init__" class="classattr">
                                        <input id="GridHandlerGMSH.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GridHandlerGMSH</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geometry_name</span>, </span><span class="param"><span class="n">grid_folder</span></span>)</span>

                <label class="view-source-button" for="GridHandlerGMSH.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.__init__-105"><a href="#GridHandlerGMSH.__init__-105"><span class="linenos">105</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry_name</span><span class="p">,</span> <span class="n">grid_folder</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.__init__-106"><a href="#GridHandlerGMSH.__init__-106"><span class="linenos">106</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">grid_folder</span> <span class="o">=</span> <span class="n">grid_folder</span>
</span><span id="GridHandlerGMSH.__init__-107"><a href="#GridHandlerGMSH.__init__-107"><span class="linenos">107</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">geometry_name</span> <span class="o">=</span> <span class="n">geometry_name</span>
</span><span id="GridHandlerGMSH.__init__-108"><a href="#GridHandlerGMSH.__init__-108"><span class="linenos">108</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
</span><span id="GridHandlerGMSH.__init__-109"><a href="#GridHandlerGMSH.__init__-109"><span class="linenos">109</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span>
</span><span id="GridHandlerGMSH.__init__-110"><a href="#GridHandlerGMSH.__init__-110"><span class="linenos">110</span></a>
</span><span id="GridHandlerGMSH.__init__-111"><a href="#GridHandlerGMSH.__init__-111"><span class="linenos">111</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">load_mesh</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.__init__-112"><a href="#GridHandlerGMSH.__init__-112"><span class="linenos">112</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">build_tags</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.__init__-113"><a href="#GridHandlerGMSH.__init__-113"><span class="linenos">113</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">load_subdomains</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.__init__-114"><a href="#GridHandlerGMSH.__init__-114"><span class="linenos">114</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">load_boundaries</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.__init__-115"><a href="#GridHandlerGMSH.__init__-115"><span class="linenos">115</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">build_box_dimensions</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.__init__-116"><a href="#GridHandlerGMSH.__init__-116"><span class="linenos">116</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__extract_grid_data</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.__init__-117"><a href="#GridHandlerGMSH.__init__-117"><span class="linenos">117</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">build_smoother</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="GridHandlerGMSH.grid_folder" class="classattr">
                                <div class="attr variable">
            <span class="name">grid_folder</span>

        
    </div>
    <a class="headerlink" href="#GridHandlerGMSH.grid_folder"></a>
    
    

                            </div>
                            <div id="GridHandlerGMSH.geometry_name" class="classattr">
                                <div class="attr variable">
            <span class="name">geometry_name</span>

        
    </div>
    <a class="headerlink" href="#GridHandlerGMSH.geometry_name"></a>
    
    

                            </div>
                            <div id="GridHandlerGMSH.comm" class="classattr">
                                <div class="attr variable">
            <span class="name">comm</span>

        
    </div>
    <a class="headerlink" href="#GridHandlerGMSH.comm"></a>
    
    

                            </div>
                            <div id="GridHandlerGMSH.rank" class="classattr">
                                <div class="attr variable">
            <span class="name">rank</span>

        
    </div>
    <a class="headerlink" href="#GridHandlerGMSH.rank"></a>
    
    

                            </div>
                            <div id="GridHandlerGMSH.build_smoother" class="classattr">
                                        <input id="GridHandlerGMSH.build_smoother-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_smoother</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.build_smoother-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.build_smoother"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.build_smoother-202"><a href="#GridHandlerGMSH.build_smoother-202"><span class="linenos">202</span></a>	<span class="k">def</span> <span class="nf">build_smoother</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.build_smoother-203"><a href="#GridHandlerGMSH.build_smoother-203"><span class="linenos">203</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.build_smoother-204"><a href="#GridHandlerGMSH.build_smoother-204"><span class="linenos">204</span></a><span class="sd">        Construct elementnode smoothing operators and their product.</span>
</span><span id="GridHandlerGMSH.build_smoother-205"><a href="#GridHandlerGMSH.build_smoother-205"><span class="linenos">205</span></a>
</span><span id="GridHandlerGMSH.build_smoother-206"><a href="#GridHandlerGMSH.build_smoother-206"><span class="linenos">206</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.build_smoother-207"><a href="#GridHandlerGMSH.build_smoother-207"><span class="linenos">207</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.build_smoother-208"><a href="#GridHandlerGMSH.build_smoother-208"><span class="linenos">208</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.build_smoother-209"><a href="#GridHandlerGMSH.build_smoother-209"><span class="linenos">209</span></a>
</span><span id="GridHandlerGMSH.build_smoother-210"><a href="#GridHandlerGMSH.build_smoother-210"><span class="linenos">210</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.build_smoother-211"><a href="#GridHandlerGMSH.build_smoother-211"><span class="linenos">211</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.build_smoother-212"><a href="#GridHandlerGMSH.build_smoother-212"><span class="linenos">212</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.build_smoother-213"><a href="#GridHandlerGMSH.build_smoother-213"><span class="linenos">213</span></a>
</span><span id="GridHandlerGMSH.build_smoother-214"><a href="#GridHandlerGMSH.build_smoother-214"><span class="linenos">214</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH.build_smoother-215"><a href="#GridHandlerGMSH.build_smoother-215"><span class="linenos">215</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH.build_smoother-216"><a href="#GridHandlerGMSH.build_smoother-216"><span class="linenos">216</span></a><span class="sd">        A_csr : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH.build_smoother-217"><a href="#GridHandlerGMSH.build_smoother-217"><span class="linenos">217</span></a><span class="sd">            Node-to-element weights, shape `(n_nodes, n_elems)`.</span>
</span><span id="GridHandlerGMSH.build_smoother-218"><a href="#GridHandlerGMSH.build_smoother-218"><span class="linenos">218</span></a><span class="sd">        B_csr : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH.build_smoother-219"><a href="#GridHandlerGMSH.build_smoother-219"><span class="linenos">219</span></a><span class="sd">            Element-to-node weights, shape `(n_elems, n_nodes)`.</span>
</span><span id="GridHandlerGMSH.build_smoother-220"><a href="#GridHandlerGMSH.build_smoother-220"><span class="linenos">220</span></a><span class="sd">        smoother : scipy.sparse.csr_matrix</span>
</span><span id="GridHandlerGMSH.build_smoother-221"><a href="#GridHandlerGMSH.build_smoother-221"><span class="linenos">221</span></a><span class="sd">            Product `B_csr @ A_csr`, shape `(n_elems, n_elems)`.</span>
</span><span id="GridHandlerGMSH.build_smoother-222"><a href="#GridHandlerGMSH.build_smoother-222"><span class="linenos">222</span></a>
</span><span id="GridHandlerGMSH.build_smoother-223"><a href="#GridHandlerGMSH.build_smoother-223"><span class="linenos">223</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH.build_smoother-224"><a href="#GridHandlerGMSH.build_smoother-224"><span class="linenos">224</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH.build_smoother-225"><a href="#GridHandlerGMSH.build_smoother-225"><span class="linenos">225</span></a><span class="sd">        - `A_csr[i, e] = vol_e / sum(vol_e&#39; for e&#39; in stencil[i])`.</span>
</span><span id="GridHandlerGMSH.build_smoother-226"><a href="#GridHandlerGMSH.build_smoother-226"><span class="linenos">226</span></a><span class="sd">        - `B_csr[e, i] = 1/4` for tetrahedra (uniform average over the 4 nodes).</span>
</span><span id="GridHandlerGMSH.build_smoother-227"><a href="#GridHandlerGMSH.build_smoother-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.build_smoother-228"><a href="#GridHandlerGMSH.build_smoother-228"><span class="linenos">228</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__compute_volumes</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.build_smoother-229"><a href="#GridHandlerGMSH.build_smoother-229"><span class="linenos">229</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__build_node_elem_stencil</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.build_smoother-230"><a href="#GridHandlerGMSH.build_smoother-230"><span class="linenos">230</span></a>		<span class="n">A_row</span><span class="p">,</span> <span class="n">A_col</span><span class="p">,</span> <span class="n">A_data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH.build_smoother-231"><a href="#GridHandlerGMSH.build_smoother-231"><span class="linenos">231</span></a>		<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.build_smoother-232"><a href="#GridHandlerGMSH.build_smoother-232"><span class="linenos">232</span></a>			<span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stencil</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.build_smoother-233"><a href="#GridHandlerGMSH.build_smoother-233"><span class="linenos">233</span></a>			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
</span><span id="GridHandlerGMSH.build_smoother-234"><a href="#GridHandlerGMSH.build_smoother-234"><span class="linenos">234</span></a>				<span class="n">A_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.build_smoother-235"><a href="#GridHandlerGMSH.build_smoother-235"><span class="linenos">235</span></a>				<span class="n">A_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.build_smoother-236"><a href="#GridHandlerGMSH.build_smoother-236"><span class="linenos">236</span></a>				<span class="n">A_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span><span class="o">/</span><span class="n">vol</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.build_smoother-237"><a href="#GridHandlerGMSH.build_smoother-237"><span class="linenos">237</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">A_csr</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">A_data</span><span class="p">,</span> <span class="p">(</span><span class="n">A_row</span><span class="p">,</span> <span class="n">A_col</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">))</span>
</span><span id="GridHandlerGMSH.build_smoother-238"><a href="#GridHandlerGMSH.build_smoother-238"><span class="linenos">238</span></a>		<span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">connectivity</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.build_smoother-239"><a href="#GridHandlerGMSH.build_smoother-239"><span class="linenos">239</span></a>		<span class="n">B_row</span><span class="p">,</span> <span class="n">B_col</span><span class="p">,</span> <span class="n">B_data</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH.build_smoother-240"><a href="#GridHandlerGMSH.build_smoother-240"><span class="linenos">240</span></a>		<span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.build_smoother-241"><a href="#GridHandlerGMSH.build_smoother-241"><span class="linenos">241</span></a>			<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.build_smoother-242"><a href="#GridHandlerGMSH.build_smoother-242"><span class="linenos">242</span></a>				<span class="n">B_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.build_smoother-243"><a href="#GridHandlerGMSH.build_smoother-243"><span class="linenos">243</span></a>				<span class="n">B_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.build_smoother-244"><a href="#GridHandlerGMSH.build_smoother-244"><span class="linenos">244</span></a>				<span class="n">B_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
</span><span id="GridHandlerGMSH.build_smoother-245"><a href="#GridHandlerGMSH.build_smoother-245"><span class="linenos">245</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B_csr</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">B_data</span><span class="p">,</span> <span class="p">(</span><span class="n">B_row</span><span class="p">,</span> <span class="n">B_col</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">))</span>
</span><span id="GridHandlerGMSH.build_smoother-246"><a href="#GridHandlerGMSH.build_smoother-246"><span class="linenos">246</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">smoother</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B_csr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A_csr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Construct elementnode smoothing operators and their product.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>A_csr : scipy.sparse.csr_matrix
    Node-to-element weights, shape <code>(n_nodes, n_elems)</code>.
B_csr : scipy.sparse.csr_matrix
    Element-to-node weights, shape <code>(n_elems, n_nodes)</code>.
smoother : scipy.sparse.csr_matrix
    Product <code>B_csr @ A_csr</code>, shape <code>(n_elems, n_elems)</code>.</p>

<h6 id="notes">Notes</h6>

<ul>
<li><code>A_csr[i, e] = vol_e / sum(vol_e' for e' in stencil[i])</code>.</li>
<li><code>B_csr[e, i] = 1/4</code> for tetrahedra (uniform average over the 4 nodes).</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.load_mesh" class="classattr">
                                        <input id="GridHandlerGMSH.load_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_mesh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.load_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.load_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.load_mesh-248"><a href="#GridHandlerGMSH.load_mesh-248"><span class="linenos">248</span></a>	<span class="k">def</span> <span class="nf">load_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.load_mesh-249"><a href="#GridHandlerGMSH.load_mesh-249"><span class="linenos">249</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.load_mesh-250"><a href="#GridHandlerGMSH.load_mesh-250"><span class="linenos">250</span></a><span class="sd">        Load mesh and tag metadata from a Gmsh `.msh` file.</span>
</span><span id="GridHandlerGMSH.load_mesh-251"><a href="#GridHandlerGMSH.load_mesh-251"><span class="linenos">251</span></a>
</span><span id="GridHandlerGMSH.load_mesh-252"><a href="#GridHandlerGMSH.load_mesh-252"><span class="linenos">252</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.load_mesh-253"><a href="#GridHandlerGMSH.load_mesh-253"><span class="linenos">253</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.load_mesh-254"><a href="#GridHandlerGMSH.load_mesh-254"><span class="linenos">254</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.load_mesh-255"><a href="#GridHandlerGMSH.load_mesh-255"><span class="linenos">255</span></a>
</span><span id="GridHandlerGMSH.load_mesh-256"><a href="#GridHandlerGMSH.load_mesh-256"><span class="linenos">256</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.load_mesh-257"><a href="#GridHandlerGMSH.load_mesh-257"><span class="linenos">257</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.load_mesh-258"><a href="#GridHandlerGMSH.load_mesh-258"><span class="linenos">258</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.load_mesh-259"><a href="#GridHandlerGMSH.load_mesh-259"><span class="linenos">259</span></a>
</span><span id="GridHandlerGMSH.load_mesh-260"><a href="#GridHandlerGMSH.load_mesh-260"><span class="linenos">260</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH.load_mesh-261"><a href="#GridHandlerGMSH.load_mesh-261"><span class="linenos">261</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH.load_mesh-262"><a href="#GridHandlerGMSH.load_mesh-262"><span class="linenos">262</span></a><span class="sd">        mesh : dolfinx.mesh.Mesh</span>
</span><span id="GridHandlerGMSH.load_mesh-263"><a href="#GridHandlerGMSH.load_mesh-263"><span class="linenos">263</span></a><span class="sd">            Sets `self.mesh`.</span>
</span><span id="GridHandlerGMSH.load_mesh-264"><a href="#GridHandlerGMSH.load_mesh-264"><span class="linenos">264</span></a><span class="sd">        subdomains : dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH.load_mesh-265"><a href="#GridHandlerGMSH.load_mesh-265"><span class="linenos">265</span></a><span class="sd">            Sets `self.subdomains` (cell tags).</span>
</span><span id="GridHandlerGMSH.load_mesh-266"><a href="#GridHandlerGMSH.load_mesh-266"><span class="linenos">266</span></a><span class="sd">        boundaries : dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH.load_mesh-267"><a href="#GridHandlerGMSH.load_mesh-267"><span class="linenos">267</span></a><span class="sd">            Sets `self.boundaries` (facet tags).</span>
</span><span id="GridHandlerGMSH.load_mesh-268"><a href="#GridHandlerGMSH.load_mesh-268"><span class="linenos">268</span></a><span class="sd">        domain_dim : int</span>
</span><span id="GridHandlerGMSH.load_mesh-269"><a href="#GridHandlerGMSH.load_mesh-269"><span class="linenos">269</span></a><span class="sd">            Sets `self.domain_dim` from mesh topology.</span>
</span><span id="GridHandlerGMSH.load_mesh-270"><a href="#GridHandlerGMSH.load_mesh-270"><span class="linenos">270</span></a><span class="sd">        boundary_dim : int</span>
</span><span id="GridHandlerGMSH.load_mesh-271"><a href="#GridHandlerGMSH.load_mesh-271"><span class="linenos">271</span></a><span class="sd">            Sets `self.boundary_dim = domain_dim - 1`.</span>
</span><span id="GridHandlerGMSH.load_mesh-272"><a href="#GridHandlerGMSH.load_mesh-272"><span class="linenos">272</span></a><span class="sd">        n_elems, n_nodes : int</span>
</span><span id="GridHandlerGMSH.load_mesh-273"><a href="#GridHandlerGMSH.load_mesh-273"><span class="linenos">273</span></a><span class="sd">            Sets local counts including ghosts.</span>
</span><span id="GridHandlerGMSH.load_mesh-274"><a href="#GridHandlerGMSH.load_mesh-274"><span class="linenos">274</span></a>
</span><span id="GridHandlerGMSH.load_mesh-275"><a href="#GridHandlerGMSH.load_mesh-275"><span class="linenos">275</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH.load_mesh-276"><a href="#GridHandlerGMSH.load_mesh-276"><span class="linenos">276</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH.load_mesh-277"><a href="#GridHandlerGMSH.load_mesh-277"><span class="linenos">277</span></a><span class="sd">        Uses `gmshio.read_from_msh(os.path.join(grid_folder, f&quot;{geometry_name}.msh&quot;), comm, rank=0)`.</span>
</span><span id="GridHandlerGMSH.load_mesh-278"><a href="#GridHandlerGMSH.load_mesh-278"><span class="linenos">278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.load_mesh-279"><a href="#GridHandlerGMSH.load_mesh-279"><span class="linenos">279</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdomains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span> <span class="o">=</span> <span class="n">gmshio</span><span class="o">.</span><span class="n">read_from_msh</span><span class="p">(</span>
</span><span id="GridHandlerGMSH.load_mesh-280"><a href="#GridHandlerGMSH.load_mesh-280"><span class="linenos">280</span></a>													    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_name</span><span class="si">}</span><span class="s2">.msh&quot;</span><span class="p">),</span>
</span><span id="GridHandlerGMSH.load_mesh-281"><a href="#GridHandlerGMSH.load_mesh-281"><span class="linenos">281</span></a>													    <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span>
</span><span id="GridHandlerGMSH.load_mesh-282"><a href="#GridHandlerGMSH.load_mesh-282"><span class="linenos">282</span></a>													    <span class="n">rank</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GridHandlerGMSH.load_mesh-283"><a href="#GridHandlerGMSH.load_mesh-283"><span class="linenos">283</span></a>													<span class="p">)</span>
</span><span id="GridHandlerGMSH.load_mesh-284"><a href="#GridHandlerGMSH.load_mesh-284"><span class="linenos">284</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">dim</span>
</span><span id="GridHandlerGMSH.load_mesh-285"><a href="#GridHandlerGMSH.load_mesh-285"><span class="linenos">285</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">boundary_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="GridHandlerGMSH.load_mesh-286"><a href="#GridHandlerGMSH.load_mesh-286"><span class="linenos">286</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">)</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">)</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.load_mesh-287"><a href="#GridHandlerGMSH.load_mesh-287"><span class="linenos">287</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load mesh and tag metadata from a Gmsh <code>.msh</code> file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>mesh : dolfinx.mesh.Mesh
    Sets <code>self.mesh</code>.
subdomains : dolfinx.mesh.MeshTags
    Sets <code>self.subdomains</code> (cell tags).
boundaries : dolfinx.mesh.MeshTags
    Sets <code>self.boundaries</code> (facet tags).
domain_dim : int
    Sets <code>self.domain_dim</code> from mesh topology.
boundary_dim : int
    Sets <code>self.boundary_dim = domain_dim - 1</code>.
n_elems, n_nodes : int
    Sets local counts including ghosts.</p>

<h6 id="notes">Notes</h6>

<p>Uses <code>gmshio.read_from_msh(os.path.join(grid_folder, f"{geometry_name}.msh"), comm, rank=0)</code>.</p>
</div>


                            </div>
                            <div id="GridHandlerGMSH.build_tags" class="classattr">
                                        <input id="GridHandlerGMSH.build_tags-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_tags</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.build_tags-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.build_tags"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.build_tags-289"><a href="#GridHandlerGMSH.build_tags-289"><span class="linenos">289</span></a>	<span class="k">def</span> <span class="nf">build_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.build_tags-290"><a href="#GridHandlerGMSH.build_tags-290"><span class="linenos">290</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.build_tags-291"><a href="#GridHandlerGMSH.build_tags-291"><span class="linenos">291</span></a><span class="sd">        Parse Gmsh field data into a dimensionnametag mapping.</span>
</span><span id="GridHandlerGMSH.build_tags-292"><a href="#GridHandlerGMSH.build_tags-292"><span class="linenos">292</span></a>
</span><span id="GridHandlerGMSH.build_tags-293"><a href="#GridHandlerGMSH.build_tags-293"><span class="linenos">293</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.build_tags-294"><a href="#GridHandlerGMSH.build_tags-294"><span class="linenos">294</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.build_tags-295"><a href="#GridHandlerGMSH.build_tags-295"><span class="linenos">295</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.build_tags-296"><a href="#GridHandlerGMSH.build_tags-296"><span class="linenos">296</span></a>
</span><span id="GridHandlerGMSH.build_tags-297"><a href="#GridHandlerGMSH.build_tags-297"><span class="linenos">297</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.build_tags-298"><a href="#GridHandlerGMSH.build_tags-298"><span class="linenos">298</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.build_tags-299"><a href="#GridHandlerGMSH.build_tags-299"><span class="linenos">299</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.build_tags-300"><a href="#GridHandlerGMSH.build_tags-300"><span class="linenos">300</span></a>
</span><span id="GridHandlerGMSH.build_tags-301"><a href="#GridHandlerGMSH.build_tags-301"><span class="linenos">301</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH.build_tags-302"><a href="#GridHandlerGMSH.build_tags-302"><span class="linenos">302</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH.build_tags-303"><a href="#GridHandlerGMSH.build_tags-303"><span class="linenos">303</span></a><span class="sd">        dolfin_tags : dict[int, dict[str, int]]</span>
</span><span id="GridHandlerGMSH.build_tags-304"><a href="#GridHandlerGMSH.build_tags-304"><span class="linenos">304</span></a><span class="sd">            Populates `self.dolfin_tags` with entries for dims 1, 2, 3.</span>
</span><span id="GridHandlerGMSH.build_tags-305"><a href="#GridHandlerGMSH.build_tags-305"><span class="linenos">305</span></a>
</span><span id="GridHandlerGMSH.build_tags-306"><a href="#GridHandlerGMSH.build_tags-306"><span class="linenos">306</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH.build_tags-307"><a href="#GridHandlerGMSH.build_tags-307"><span class="linenos">307</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH.build_tags-308"><a href="#GridHandlerGMSH.build_tags-308"><span class="linenos">308</span></a><span class="sd">        Reads the `.msh` via `meshio.read` to access `field_data`.</span>
</span><span id="GridHandlerGMSH.build_tags-309"><a href="#GridHandlerGMSH.build_tags-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.build_tags-310"><a href="#GridHandlerGMSH.build_tags-310"><span class="linenos">310</span></a>		<span class="n">grid</span> <span class="o">=</span> <span class="n">meshio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry_name</span><span class="o">+</span><span class="s2">&quot;.msh&quot;</span><span class="p">))</span>
</span><span id="GridHandlerGMSH.build_tags-311"><a href="#GridHandlerGMSH.build_tags-311"><span class="linenos">311</span></a>		<span class="c1"># self.tags = {1:{}, 2:{}, 3:{}}</span>
</span><span id="GridHandlerGMSH.build_tags-312"><a href="#GridHandlerGMSH.build_tags-312"><span class="linenos">312</span></a>		<span class="c1"># for key, value in grid.field_data.items():</span>
</span><span id="GridHandlerGMSH.build_tags-313"><a href="#GridHandlerGMSH.build_tags-313"><span class="linenos">313</span></a>		<span class="c1"># 	self.tags[value[1]][key] = value[0]</span>
</span><span id="GridHandlerGMSH.build_tags-314"><a href="#GridHandlerGMSH.build_tags-314"><span class="linenos">314</span></a>		<span class="c1"># self.dolfin_tags = self.tags</span>
</span><span id="GridHandlerGMSH.build_tags-315"><a href="#GridHandlerGMSH.build_tags-315"><span class="linenos">315</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:{},</span> <span class="mi">2</span><span class="p">:{},</span> <span class="mi">3</span><span class="p">:{}}</span>
</span><span id="GridHandlerGMSH.build_tags-316"><a href="#GridHandlerGMSH.build_tags-316"><span class="linenos">316</span></a>		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">field_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GridHandlerGMSH.build_tags-317"><a href="#GridHandlerGMSH.build_tags-317"><span class="linenos">317</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Parse Gmsh field data into a dimensionnametag mapping.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>dolfin_tags : dict[int, dict[str, int]]
    Populates <code>self.dolfin_tags</code> with entries for dims 1, 2, 3.</p>

<h6 id="notes">Notes</h6>

<p>Reads the <code>.msh</code> via <code>meshio.read</code> to access <code>field_data</code>.</p>
</div>


                            </div>
                            <div id="GridHandlerGMSH.load_subdomains" class="classattr">
                                        <input id="GridHandlerGMSH.load_subdomains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_subdomains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.load_subdomains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.load_subdomains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.load_subdomains-319"><a href="#GridHandlerGMSH.load_subdomains-319"><span class="linenos">319</span></a>	<span class="k">def</span> <span class="nf">load_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.load_subdomains-320"><a href="#GridHandlerGMSH.load_subdomains-320"><span class="linenos">320</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.load_subdomains-321"><a href="#GridHandlerGMSH.load_subdomains-321"><span class="linenos">321</span></a><span class="sd">        Initialize container for subdomain cell indices per region name.</span>
</span><span id="GridHandlerGMSH.load_subdomains-322"><a href="#GridHandlerGMSH.load_subdomains-322"><span class="linenos">322</span></a>
</span><span id="GridHandlerGMSH.load_subdomains-323"><a href="#GridHandlerGMSH.load_subdomains-323"><span class="linenos">323</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.load_subdomains-324"><a href="#GridHandlerGMSH.load_subdomains-324"><span class="linenos">324</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.load_subdomains-325"><a href="#GridHandlerGMSH.load_subdomains-325"><span class="linenos">325</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.load_subdomains-326"><a href="#GridHandlerGMSH.load_subdomains-326"><span class="linenos">326</span></a>
</span><span id="GridHandlerGMSH.load_subdomains-327"><a href="#GridHandlerGMSH.load_subdomains-327"><span class="linenos">327</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.load_subdomains-328"><a href="#GridHandlerGMSH.load_subdomains-328"><span class="linenos">328</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.load_subdomains-329"><a href="#GridHandlerGMSH.load_subdomains-329"><span class="linenos">329</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.load_subdomains-330"><a href="#GridHandlerGMSH.load_subdomains-330"><span class="linenos">330</span></a>
</span><span id="GridHandlerGMSH.load_subdomains-331"><a href="#GridHandlerGMSH.load_subdomains-331"><span class="linenos">331</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH.load_subdomains-332"><a href="#GridHandlerGMSH.load_subdomains-332"><span class="linenos">332</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH.load_subdomains-333"><a href="#GridHandlerGMSH.load_subdomains-333"><span class="linenos">333</span></a><span class="sd">        subdomain_tags : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH.load_subdomains-334"><a href="#GridHandlerGMSH.load_subdomains-334"><span class="linenos">334</span></a><span class="sd">            Initializes empty lists keyed by subdomain names.</span>
</span><span id="GridHandlerGMSH.load_subdomains-335"><a href="#GridHandlerGMSH.load_subdomains-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.load_subdomains-336"><a href="#GridHandlerGMSH.load_subdomains-336"><span class="linenos">336</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">subdomain_tags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GridHandlerGMSH.load_subdomains-337"><a href="#GridHandlerGMSH.load_subdomains-337"><span class="linenos">337</span></a>		<span class="k">for</span> <span class="n">subdomain_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subdomain_names</span><span class="p">():</span>
</span><span id="GridHandlerGMSH.load_subdomains-338"><a href="#GridHandlerGMSH.load_subdomains-338"><span class="linenos">338</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">subdomain_tags</span><span class="p">[</span><span class="n">subdomain_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Initialize container for subdomain cell indices per region name.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>subdomain_tags : dict[str, list[int]]
    Initializes empty lists keyed by subdomain names.</p>
</div>


                            </div>
                            <div id="GridHandlerGMSH.load_boundaries" class="classattr">
                                        <input id="GridHandlerGMSH.load_boundaries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_boundaries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.load_boundaries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.load_boundaries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.load_boundaries-341"><a href="#GridHandlerGMSH.load_boundaries-341"><span class="linenos">341</span></a>	<span class="k">def</span> <span class="nf">load_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.load_boundaries-342"><a href="#GridHandlerGMSH.load_boundaries-342"><span class="linenos">342</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.load_boundaries-343"><a href="#GridHandlerGMSH.load_boundaries-343"><span class="linenos">343</span></a><span class="sd">        Build a map from boundary name to exterior facet indices.</span>
</span><span id="GridHandlerGMSH.load_boundaries-344"><a href="#GridHandlerGMSH.load_boundaries-344"><span class="linenos">344</span></a>
</span><span id="GridHandlerGMSH.load_boundaries-345"><a href="#GridHandlerGMSH.load_boundaries-345"><span class="linenos">345</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.load_boundaries-346"><a href="#GridHandlerGMSH.load_boundaries-346"><span class="linenos">346</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.load_boundaries-347"><a href="#GridHandlerGMSH.load_boundaries-347"><span class="linenos">347</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.load_boundaries-348"><a href="#GridHandlerGMSH.load_boundaries-348"><span class="linenos">348</span></a>
</span><span id="GridHandlerGMSH.load_boundaries-349"><a href="#GridHandlerGMSH.load_boundaries-349"><span class="linenos">349</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.load_boundaries-350"><a href="#GridHandlerGMSH.load_boundaries-350"><span class="linenos">350</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.load_boundaries-351"><a href="#GridHandlerGMSH.load_boundaries-351"><span class="linenos">351</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.load_boundaries-352"><a href="#GridHandlerGMSH.load_boundaries-352"><span class="linenos">352</span></a>
</span><span id="GridHandlerGMSH.load_boundaries-353"><a href="#GridHandlerGMSH.load_boundaries-353"><span class="linenos">353</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH.load_boundaries-354"><a href="#GridHandlerGMSH.load_boundaries-354"><span class="linenos">354</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH.load_boundaries-355"><a href="#GridHandlerGMSH.load_boundaries-355"><span class="linenos">355</span></a><span class="sd">        boundary_tags : dict[str, list[int]]</span>
</span><span id="GridHandlerGMSH.load_boundaries-356"><a href="#GridHandlerGMSH.load_boundaries-356"><span class="linenos">356</span></a><span class="sd">            Populates with facet indices for each named boundary.</span>
</span><span id="GridHandlerGMSH.load_boundaries-357"><a href="#GridHandlerGMSH.load_boundaries-357"><span class="linenos">357</span></a>
</span><span id="GridHandlerGMSH.load_boundaries-358"><a href="#GridHandlerGMSH.load_boundaries-358"><span class="linenos">358</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH.load_boundaries-359"><a href="#GridHandlerGMSH.load_boundaries-359"><span class="linenos">359</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH.load_boundaries-360"><a href="#GridHandlerGMSH.load_boundaries-360"><span class="linenos">360</span></a><span class="sd">        Uses `mesh.exterior_facet_indices(self.mesh.topology)` and the facet</span>
</span><span id="GridHandlerGMSH.load_boundaries-361"><a href="#GridHandlerGMSH.load_boundaries-361"><span class="linenos">361</span></a><span class="sd">        tag values in `self.boundaries` to assign names via `self.dolfin_tags[2]`.</span>
</span><span id="GridHandlerGMSH.load_boundaries-362"><a href="#GridHandlerGMSH.load_boundaries-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.load_boundaries-363"><a href="#GridHandlerGMSH.load_boundaries-363"><span class="linenos">363</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GridHandlerGMSH.load_boundaries-364"><a href="#GridHandlerGMSH.load_boundaries-364"><span class="linenos">364</span></a>
</span><span id="GridHandlerGMSH.load_boundaries-365"><a href="#GridHandlerGMSH.load_boundaries-365"><span class="linenos">365</span></a>		<span class="k">for</span> <span class="n">boundary_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_names</span><span class="p">():</span>
</span><span id="GridHandlerGMSH.load_boundaries-366"><a href="#GridHandlerGMSH.load_boundaries-366"><span class="linenos">366</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span><span class="p">[</span><span class="n">boundary_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GridHandlerGMSH.load_boundaries-367"><a href="#GridHandlerGMSH.load_boundaries-367"><span class="linenos">367</span></a>		
</span><span id="GridHandlerGMSH.load_boundaries-368"><a href="#GridHandlerGMSH.load_boundaries-368"><span class="linenos">368</span></a>		<span class="n">tag_to_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">fd</span><span class="p">:</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="GridHandlerGMSH.load_boundaries-369"><a href="#GridHandlerGMSH.load_boundaries-369"><span class="linenos">369</span></a>		<span class="n">boundary_facets</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">exterior_facet_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.load_boundaries-370"><a href="#GridHandlerGMSH.load_boundaries-370"><span class="linenos">370</span></a>		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">facet</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">boundary_facets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.load_boundaries-371"><a href="#GridHandlerGMSH.load_boundaries-371"><span class="linenos">371</span></a>			<span class="n">boundary_name</span> <span class="o">=</span> <span class="n">tag_to_name</span><span class="p">[</span><span class="n">facet</span><span class="p">]</span>
</span><span id="GridHandlerGMSH.load_boundaries-372"><a href="#GridHandlerGMSH.load_boundaries-372"><span class="linenos">372</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span><span class="p">[</span><span class="n">boundary_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Build a map from boundary name to exterior facet indices.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>boundary_tags : dict[str, list[int]]
    Populates with facet indices for each named boundary.</p>

<h6 id="notes">Notes</h6>

<p>Uses <code>mesh.exterior_facet_indices(self.mesh.topology)</code> and the facet
tag values in <code>self.boundaries</code> to assign names via <code>self.dolfin_tags[2]</code>.</p>
</div>


                            </div>
                            <div id="GridHandlerGMSH.build_box_dimensions" class="classattr">
                                        <input id="GridHandlerGMSH.build_box_dimensions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_box_dimensions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.build_box_dimensions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.build_box_dimensions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.build_box_dimensions-375"><a href="#GridHandlerGMSH.build_box_dimensions-375"><span class="linenos">375</span></a>	<span class="k">def</span> <span class="nf">build_box_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-376"><a href="#GridHandlerGMSH.build_box_dimensions-376"><span class="linenos">376</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-377"><a href="#GridHandlerGMSH.build_box_dimensions-377"><span class="linenos">377</span></a><span class="sd">        Compute axis-aligned bounding-box extents (Lx, Ly, Lz).</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-378"><a href="#GridHandlerGMSH.build_box_dimensions-378"><span class="linenos">378</span></a>
</span><span id="GridHandlerGMSH.build_box_dimensions-379"><a href="#GridHandlerGMSH.build_box_dimensions-379"><span class="linenos">379</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-380"><a href="#GridHandlerGMSH.build_box_dimensions-380"><span class="linenos">380</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-381"><a href="#GridHandlerGMSH.build_box_dimensions-381"><span class="linenos">381</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-382"><a href="#GridHandlerGMSH.build_box_dimensions-382"><span class="linenos">382</span></a>
</span><span id="GridHandlerGMSH.build_box_dimensions-383"><a href="#GridHandlerGMSH.build_box_dimensions-383"><span class="linenos">383</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-384"><a href="#GridHandlerGMSH.build_box_dimensions-384"><span class="linenos">384</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-385"><a href="#GridHandlerGMSH.build_box_dimensions-385"><span class="linenos">385</span></a><span class="sd">        None</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-386"><a href="#GridHandlerGMSH.build_box_dimensions-386"><span class="linenos">386</span></a>
</span><span id="GridHandlerGMSH.build_box_dimensions-387"><a href="#GridHandlerGMSH.build_box_dimensions-387"><span class="linenos">387</span></a><span class="sd">        Side Effects</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-388"><a href="#GridHandlerGMSH.build_box_dimensions-388"><span class="linenos">388</span></a><span class="sd">        ------------</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-389"><a href="#GridHandlerGMSH.build_box_dimensions-389"><span class="linenos">389</span></a><span class="sd">        Lx, Ly, Lz : float</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-390"><a href="#GridHandlerGMSH.build_box_dimensions-390"><span class="linenos">390</span></a><span class="sd">            Sets the extents along x, y, z.</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-391"><a href="#GridHandlerGMSH.build_box_dimensions-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-392"><a href="#GridHandlerGMSH.build_box_dimensions-392"><span class="linenos">392</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">Lx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-393"><a href="#GridHandlerGMSH.build_box_dimensions-393"><span class="linenos">393</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">Ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="GridHandlerGMSH.build_box_dimensions-394"><a href="#GridHandlerGMSH.build_box_dimensions-394"><span class="linenos">394</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">Lz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Compute axis-aligned bounding-box extents (Lx, Ly, Lz).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Lx, Ly, Lz : float
    Sets the extents along x, y, z.</p>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_boundaries" class="classattr">
                                        <input id="GridHandlerGMSH.get_boundaries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_boundaries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_boundaries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_boundaries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_boundaries-396"><a href="#GridHandlerGMSH.get_boundaries-396"><span class="linenos">396</span></a>	<span class="k">def</span> <span class="nf">get_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_boundaries-397"><a href="#GridHandlerGMSH.get_boundaries-397"><span class="linenos">397</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundaries-398"><a href="#GridHandlerGMSH.get_boundaries-398"><span class="linenos">398</span></a><span class="sd">        Return the facet `MeshTags` object.</span>
</span><span id="GridHandlerGMSH.get_boundaries-399"><a href="#GridHandlerGMSH.get_boundaries-399"><span class="linenos">399</span></a>
</span><span id="GridHandlerGMSH.get_boundaries-400"><a href="#GridHandlerGMSH.get_boundaries-400"><span class="linenos">400</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_boundaries-401"><a href="#GridHandlerGMSH.get_boundaries-401"><span class="linenos">401</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_boundaries-402"><a href="#GridHandlerGMSH.get_boundaries-402"><span class="linenos">402</span></a><span class="sd">        dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH.get_boundaries-403"><a href="#GridHandlerGMSH.get_boundaries-403"><span class="linenos">403</span></a><span class="sd">            The boundary tags read from the mesh.</span>
</span><span id="GridHandlerGMSH.get_boundaries-404"><a href="#GridHandlerGMSH.get_boundaries-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundaries-405"><a href="#GridHandlerGMSH.get_boundaries-405"><span class="linenos">405</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span>
</span></pre></div>


            <div class="docstring"><p>Return the facet <code>MeshTags</code> object.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dolfinx.mesh.MeshTags</strong>: The boundary tags read from the mesh.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_boundary_tags" class="classattr">
                                        <input id="GridHandlerGMSH.get_boundary_tags-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_boundary_tags</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">BOUNDARY_NAME</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_boundary_tags-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_boundary_tags"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_boundary_tags-407"><a href="#GridHandlerGMSH.get_boundary_tags-407"><span class="linenos">407</span></a>	<span class="k">def</span> <span class="nf">get_boundary_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BOUNDARY_NAME</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-408"><a href="#GridHandlerGMSH.get_boundary_tags-408"><span class="linenos">408</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-409"><a href="#GridHandlerGMSH.get_boundary_tags-409"><span class="linenos">409</span></a><span class="sd">        Get list of exterior facet indices for a named boundary.</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-410"><a href="#GridHandlerGMSH.get_boundary_tags-410"><span class="linenos">410</span></a>
</span><span id="GridHandlerGMSH.get_boundary_tags-411"><a href="#GridHandlerGMSH.get_boundary_tags-411"><span class="linenos">411</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-412"><a href="#GridHandlerGMSH.get_boundary_tags-412"><span class="linenos">412</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-413"><a href="#GridHandlerGMSH.get_boundary_tags-413"><span class="linenos">413</span></a><span class="sd">        BOUNDARY_NAME : str or None</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-414"><a href="#GridHandlerGMSH.get_boundary_tags-414"><span class="linenos">414</span></a><span class="sd">            Boundary name as defined in the Gmsh field data. If `None`,</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-415"><a href="#GridHandlerGMSH.get_boundary_tags-415"><span class="linenos">415</span></a><span class="sd">            returns `None`.</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-416"><a href="#GridHandlerGMSH.get_boundary_tags-416"><span class="linenos">416</span></a>
</span><span id="GridHandlerGMSH.get_boundary_tags-417"><a href="#GridHandlerGMSH.get_boundary_tags-417"><span class="linenos">417</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-418"><a href="#GridHandlerGMSH.get_boundary_tags-418"><span class="linenos">418</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-419"><a href="#GridHandlerGMSH.get_boundary_tags-419"><span class="linenos">419</span></a><span class="sd">        list[int] or None</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-420"><a href="#GridHandlerGMSH.get_boundary_tags-420"><span class="linenos">420</span></a><span class="sd">            Facet indices on the exterior boundary corresponding to the name,</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-421"><a href="#GridHandlerGMSH.get_boundary_tags-421"><span class="linenos">421</span></a><span class="sd">            or `None` if `BOUNDARY_NAME` is `None`.</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-422"><a href="#GridHandlerGMSH.get_boundary_tags-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-423"><a href="#GridHandlerGMSH.get_boundary_tags-423"><span class="linenos">423</span></a>		<span class="k">if</span> <span class="n">BOUNDARY_NAME</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-424"><a href="#GridHandlerGMSH.get_boundary_tags-424"><span class="linenos">424</span></a>			<span class="k">return</span> <span class="kc">None</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-425"><a href="#GridHandlerGMSH.get_boundary_tags-425"><span class="linenos">425</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_boundary_tags-426"><a href="#GridHandlerGMSH.get_boundary_tags-426"><span class="linenos">426</span></a>			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_tags</span><span class="p">[</span><span class="n">BOUNDARY_NAME</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get list of exterior facet indices for a named boundary.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>BOUNDARY_NAME</strong> (str or None):
Boundary name as defined in the Gmsh field data. If <code>None</code>,
returns <code>None</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list[int] or None</strong>: Facet indices on the exterior boundary corresponding to the name,
or <code>None</code> if <code>BOUNDARY_NAME</code> is <code>None</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_boundary_tag" class="classattr">
                                        <input id="GridHandlerGMSH.get_boundary_tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_boundary_tag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">BOUNDARY_NAME</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_boundary_tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_boundary_tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_boundary_tag-428"><a href="#GridHandlerGMSH.get_boundary_tag-428"><span class="linenos">428</span></a>	<span class="k">def</span> <span class="nf">get_boundary_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BOUNDARY_NAME</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-429"><a href="#GridHandlerGMSH.get_boundary_tag-429"><span class="linenos">429</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-430"><a href="#GridHandlerGMSH.get_boundary_tag-430"><span class="linenos">430</span></a><span class="sd">        Get the integer tag ID for a named boundary.</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-431"><a href="#GridHandlerGMSH.get_boundary_tag-431"><span class="linenos">431</span></a>
</span><span id="GridHandlerGMSH.get_boundary_tag-432"><a href="#GridHandlerGMSH.get_boundary_tag-432"><span class="linenos">432</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-433"><a href="#GridHandlerGMSH.get_boundary_tag-433"><span class="linenos">433</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-434"><a href="#GridHandlerGMSH.get_boundary_tag-434"><span class="linenos">434</span></a><span class="sd">        BOUNDARY_NAME : str or None</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-435"><a href="#GridHandlerGMSH.get_boundary_tag-435"><span class="linenos">435</span></a><span class="sd">            Boundary name. If `None`, returns `None`.</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-436"><a href="#GridHandlerGMSH.get_boundary_tag-436"><span class="linenos">436</span></a>
</span><span id="GridHandlerGMSH.get_boundary_tag-437"><a href="#GridHandlerGMSH.get_boundary_tag-437"><span class="linenos">437</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-438"><a href="#GridHandlerGMSH.get_boundary_tag-438"><span class="linenos">438</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-439"><a href="#GridHandlerGMSH.get_boundary_tag-439"><span class="linenos">439</span></a><span class="sd">        int or None</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-440"><a href="#GridHandlerGMSH.get_boundary_tag-440"><span class="linenos">440</span></a><span class="sd">            Integer tag in `self.dolfin_tags[self.boundary_dim]`, or `None`.</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-441"><a href="#GridHandlerGMSH.get_boundary_tag-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-442"><a href="#GridHandlerGMSH.get_boundary_tag-442"><span class="linenos">442</span></a>		<span class="k">if</span> <span class="n">BOUNDARY_NAME</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-443"><a href="#GridHandlerGMSH.get_boundary_tag-443"><span class="linenos">443</span></a>			<span class="k">return</span> <span class="kc">None</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-444"><a href="#GridHandlerGMSH.get_boundary_tag-444"><span class="linenos">444</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-445"><a href="#GridHandlerGMSH.get_boundary_tag-445"><span class="linenos">445</span></a>			<span class="n">tag_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_dim</span><span class="p">][</span><span class="n">BOUNDARY_NAME</span><span class="p">]</span>
</span><span id="GridHandlerGMSH.get_boundary_tag-446"><a href="#GridHandlerGMSH.get_boundary_tag-446"><span class="linenos">446</span></a>			<span class="k">return</span> <span class="n">tag_number</span>
</span></pre></div>


            <div class="docstring"><p>Get the integer tag ID for a named boundary.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>BOUNDARY_NAME</strong> (str or None):
Boundary name. If <code>None</code>, returns <code>None</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int or None</strong>: Integer tag in <code>self.dolfin_tags[self.boundary_dim]</code>, or <code>None</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_boundary_names" class="classattr">
                                        <input id="GridHandlerGMSH.get_boundary_names-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_boundary_names</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_boundary_names-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_boundary_names"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_boundary_names-448"><a href="#GridHandlerGMSH.get_boundary_names-448"><span class="linenos">448</span></a>	<span class="k">def</span> <span class="nf">get_boundary_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_boundary_names-449"><a href="#GridHandlerGMSH.get_boundary_names-449"><span class="linenos">449</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundary_names-450"><a href="#GridHandlerGMSH.get_boundary_names-450"><span class="linenos">450</span></a><span class="sd">        List all boundary names present in the mesh.</span>
</span><span id="GridHandlerGMSH.get_boundary_names-451"><a href="#GridHandlerGMSH.get_boundary_names-451"><span class="linenos">451</span></a>
</span><span id="GridHandlerGMSH.get_boundary_names-452"><a href="#GridHandlerGMSH.get_boundary_names-452"><span class="linenos">452</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_boundary_names-453"><a href="#GridHandlerGMSH.get_boundary_names-453"><span class="linenos">453</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_boundary_names-454"><a href="#GridHandlerGMSH.get_boundary_names-454"><span class="linenos">454</span></a><span class="sd">        list[str]</span>
</span><span id="GridHandlerGMSH.get_boundary_names-455"><a href="#GridHandlerGMSH.get_boundary_names-455"><span class="linenos">455</span></a><span class="sd">            Boundary names from `self.dolfin_tags[self.boundary_dim]`.</span>
</span><span id="GridHandlerGMSH.get_boundary_names-456"><a href="#GridHandlerGMSH.get_boundary_names-456"><span class="linenos">456</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_boundary_names-457"><a href="#GridHandlerGMSH.get_boundary_names-457"><span class="linenos">457</span></a>		<span class="n">boundary_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_dim</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="GridHandlerGMSH.get_boundary_names-458"><a href="#GridHandlerGMSH.get_boundary_names-458"><span class="linenos">458</span></a>		<span class="k">return</span> <span class="n">boundary_names</span>
</span></pre></div>


            <div class="docstring"><p>List all boundary names present in the mesh.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list[str]</strong>: Boundary names from <code>self.dolfin_tags[self.boundary_dim]</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_subdomain_tag" class="classattr">
                                        <input id="GridHandlerGMSH.get_subdomain_tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_subdomain_tag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">DOMAIN_NAME</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_subdomain_tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_subdomain_tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_subdomain_tag-460"><a href="#GridHandlerGMSH.get_subdomain_tag-460"><span class="linenos">460</span></a>	<span class="k">def</span> <span class="nf">get_subdomain_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DOMAIN_NAME</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-461"><a href="#GridHandlerGMSH.get_subdomain_tag-461"><span class="linenos">461</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-462"><a href="#GridHandlerGMSH.get_subdomain_tag-462"><span class="linenos">462</span></a><span class="sd">        Get the integer tag ID for a named subdomain (cell region).</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-463"><a href="#GridHandlerGMSH.get_subdomain_tag-463"><span class="linenos">463</span></a>
</span><span id="GridHandlerGMSH.get_subdomain_tag-464"><a href="#GridHandlerGMSH.get_subdomain_tag-464"><span class="linenos">464</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-465"><a href="#GridHandlerGMSH.get_subdomain_tag-465"><span class="linenos">465</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-466"><a href="#GridHandlerGMSH.get_subdomain_tag-466"><span class="linenos">466</span></a><span class="sd">        DOMAIN_NAME : str</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-467"><a href="#GridHandlerGMSH.get_subdomain_tag-467"><span class="linenos">467</span></a><span class="sd">            Subdomain name.</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-468"><a href="#GridHandlerGMSH.get_subdomain_tag-468"><span class="linenos">468</span></a>
</span><span id="GridHandlerGMSH.get_subdomain_tag-469"><a href="#GridHandlerGMSH.get_subdomain_tag-469"><span class="linenos">469</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-470"><a href="#GridHandlerGMSH.get_subdomain_tag-470"><span class="linenos">470</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-471"><a href="#GridHandlerGMSH.get_subdomain_tag-471"><span class="linenos">471</span></a><span class="sd">        int</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-472"><a href="#GridHandlerGMSH.get_subdomain_tag-472"><span class="linenos">472</span></a><span class="sd">            Integer tag for the subdomain in `self.dolfin_tags[self.domain_dim]`.</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-473"><a href="#GridHandlerGMSH.get_subdomain_tag-473"><span class="linenos">473</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-474"><a href="#GridHandlerGMSH.get_subdomain_tag-474"><span class="linenos">474</span></a>		<span class="n">tag_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">][</span><span class="n">DOMAIN_NAME</span><span class="p">]</span>
</span><span id="GridHandlerGMSH.get_subdomain_tag-475"><a href="#GridHandlerGMSH.get_subdomain_tag-475"><span class="linenos">475</span></a>		<span class="k">return</span> <span class="n">tag_number</span>
</span></pre></div>


            <div class="docstring"><p>Get the integer tag ID for a named subdomain (cell region).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>DOMAIN_NAME</strong> (str):
Subdomain name.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int</strong>: Integer tag for the subdomain in <code>self.dolfin_tags[self.domain_dim]</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_subdomains" class="classattr">
                                        <input id="GridHandlerGMSH.get_subdomains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_subdomains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_subdomains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_subdomains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_subdomains-477"><a href="#GridHandlerGMSH.get_subdomains-477"><span class="linenos">477</span></a>	<span class="k">def</span> <span class="nf">get_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_subdomains-478"><a href="#GridHandlerGMSH.get_subdomains-478"><span class="linenos">478</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_subdomains-479"><a href="#GridHandlerGMSH.get_subdomains-479"><span class="linenos">479</span></a><span class="sd">        Return the cell `MeshTags` object.</span>
</span><span id="GridHandlerGMSH.get_subdomains-480"><a href="#GridHandlerGMSH.get_subdomains-480"><span class="linenos">480</span></a>
</span><span id="GridHandlerGMSH.get_subdomains-481"><a href="#GridHandlerGMSH.get_subdomains-481"><span class="linenos">481</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_subdomains-482"><a href="#GridHandlerGMSH.get_subdomains-482"><span class="linenos">482</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_subdomains-483"><a href="#GridHandlerGMSH.get_subdomains-483"><span class="linenos">483</span></a><span class="sd">        dolfinx.mesh.MeshTags</span>
</span><span id="GridHandlerGMSH.get_subdomains-484"><a href="#GridHandlerGMSH.get_subdomains-484"><span class="linenos">484</span></a><span class="sd">            The subdomain (cell) tags read from the mesh.</span>
</span><span id="GridHandlerGMSH.get_subdomains-485"><a href="#GridHandlerGMSH.get_subdomains-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_subdomains-486"><a href="#GridHandlerGMSH.get_subdomains-486"><span class="linenos">486</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdomains</span>
</span></pre></div>


            <div class="docstring"><p>Return the cell <code>MeshTags</code> object.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dolfinx.mesh.MeshTags</strong>: The subdomain (cell) tags read from the mesh.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_subdomain_names" class="classattr">
                                        <input id="GridHandlerGMSH.get_subdomain_names-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_subdomain_names</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_subdomain_names-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_subdomain_names"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_subdomain_names-488"><a href="#GridHandlerGMSH.get_subdomain_names-488"><span class="linenos">488</span></a>	<span class="k">def</span> <span class="nf">get_subdomain_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-489"><a href="#GridHandlerGMSH.get_subdomain_names-489"><span class="linenos">489</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-490"><a href="#GridHandlerGMSH.get_subdomain_names-490"><span class="linenos">490</span></a><span class="sd">        List all subdomain (region) names present in the mesh.</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-491"><a href="#GridHandlerGMSH.get_subdomain_names-491"><span class="linenos">491</span></a>
</span><span id="GridHandlerGMSH.get_subdomain_names-492"><a href="#GridHandlerGMSH.get_subdomain_names-492"><span class="linenos">492</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-493"><a href="#GridHandlerGMSH.get_subdomain_names-493"><span class="linenos">493</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-494"><a href="#GridHandlerGMSH.get_subdomain_names-494"><span class="linenos">494</span></a><span class="sd">        list[str]</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-495"><a href="#GridHandlerGMSH.get_subdomain_names-495"><span class="linenos">495</span></a><span class="sd">            Subdomain names from `self.dolfin_tags[self.domain_dim]`.</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-496"><a href="#GridHandlerGMSH.get_subdomain_names-496"><span class="linenos">496</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-497"><a href="#GridHandlerGMSH.get_subdomain_names-497"><span class="linenos">497</span></a>		<span class="n">subdomain_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dolfin_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="GridHandlerGMSH.get_subdomain_names-498"><a href="#GridHandlerGMSH.get_subdomain_names-498"><span class="linenos">498</span></a>		<span class="k">return</span> <span class="n">subdomain_names</span>
</span></pre></div>


            <div class="docstring"><p>List all subdomain (region) names present in the mesh.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list[str]</strong>: Subdomain names from <code>self.dolfin_tags[self.domain_dim]</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GridHandlerGMSH.get_parameter" class="classattr">
                                        <input id="GridHandlerGMSH.get_parameter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_parameter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">param</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GridHandlerGMSH.get_parameter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GridHandlerGMSH.get_parameter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GridHandlerGMSH.get_parameter-542"><a href="#GridHandlerGMSH.get_parameter-542"><span class="linenos">542</span></a>	<span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
</span><span id="GridHandlerGMSH.get_parameter-543"><a href="#GridHandlerGMSH.get_parameter-543"><span class="linenos">543</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_parameter-544"><a href="#GridHandlerGMSH.get_parameter-544"><span class="linenos">544</span></a><span class="sd">        Expand a parameter specification to per-element values.</span>
</span><span id="GridHandlerGMSH.get_parameter-545"><a href="#GridHandlerGMSH.get_parameter-545"><span class="linenos">545</span></a>
</span><span id="GridHandlerGMSH.get_parameter-546"><a href="#GridHandlerGMSH.get_parameter-546"><span class="linenos">546</span></a><span class="sd">        Parameters</span>
</span><span id="GridHandlerGMSH.get_parameter-547"><a href="#GridHandlerGMSH.get_parameter-547"><span class="linenos">547</span></a><span class="sd">        ----------</span>
</span><span id="GridHandlerGMSH.get_parameter-548"><a href="#GridHandlerGMSH.get_parameter-548"><span class="linenos">548</span></a><span class="sd">        param : int or float or sequence or torch.Tensor</span>
</span><span id="GridHandlerGMSH.get_parameter-549"><a href="#GridHandlerGMSH.get_parameter-549"><span class="linenos">549</span></a><span class="sd">            - Scalar (`int`/`float`): broadcast to all elements.</span>
</span><span id="GridHandlerGMSH.get_parameter-550"><a href="#GridHandlerGMSH.get_parameter-550"><span class="linenos">550</span></a><span class="sd">            - Sequence of length `n_regions`: values per region in the</span>
</span><span id="GridHandlerGMSH.get_parameter-551"><a href="#GridHandlerGMSH.get_parameter-551"><span class="linenos">551</span></a><span class="sd">              order of `self.region_indices.keys()`.</span>
</span><span id="GridHandlerGMSH.get_parameter-552"><a href="#GridHandlerGMSH.get_parameter-552"><span class="linenos">552</span></a><span class="sd">            - Sequence or tensor of length `n_elems`: per-element values.</span>
</span><span id="GridHandlerGMSH.get_parameter-553"><a href="#GridHandlerGMSH.get_parameter-553"><span class="linenos">553</span></a>
</span><span id="GridHandlerGMSH.get_parameter-554"><a href="#GridHandlerGMSH.get_parameter-554"><span class="linenos">554</span></a><span class="sd">        Returns</span>
</span><span id="GridHandlerGMSH.get_parameter-555"><a href="#GridHandlerGMSH.get_parameter-555"><span class="linenos">555</span></a><span class="sd">        -------</span>
</span><span id="GridHandlerGMSH.get_parameter-556"><a href="#GridHandlerGMSH.get_parameter-556"><span class="linenos">556</span></a><span class="sd">        torch.Tensor</span>
</span><span id="GridHandlerGMSH.get_parameter-557"><a href="#GridHandlerGMSH.get_parameter-557"><span class="linenos">557</span></a><span class="sd">            1D tensor of length `n_elems` with parameter values.</span>
</span><span id="GridHandlerGMSH.get_parameter-558"><a href="#GridHandlerGMSH.get_parameter-558"><span class="linenos">558</span></a>
</span><span id="GridHandlerGMSH.get_parameter-559"><a href="#GridHandlerGMSH.get_parameter-559"><span class="linenos">559</span></a><span class="sd">        Raises</span>
</span><span id="GridHandlerGMSH.get_parameter-560"><a href="#GridHandlerGMSH.get_parameter-560"><span class="linenos">560</span></a><span class="sd">        ------</span>
</span><span id="GridHandlerGMSH.get_parameter-561"><a href="#GridHandlerGMSH.get_parameter-561"><span class="linenos">561</span></a><span class="sd">        Exception</span>
</span><span id="GridHandlerGMSH.get_parameter-562"><a href="#GridHandlerGMSH.get_parameter-562"><span class="linenos">562</span></a><span class="sd">            If `param` length is neither `n_regions` nor `n_elems`.</span>
</span><span id="GridHandlerGMSH.get_parameter-563"><a href="#GridHandlerGMSH.get_parameter-563"><span class="linenos">563</span></a>
</span><span id="GridHandlerGMSH.get_parameter-564"><a href="#GridHandlerGMSH.get_parameter-564"><span class="linenos">564</span></a><span class="sd">        Notes</span>
</span><span id="GridHandlerGMSH.get_parameter-565"><a href="#GridHandlerGMSH.get_parameter-565"><span class="linenos">565</span></a><span class="sd">        -----</span>
</span><span id="GridHandlerGMSH.get_parameter-566"><a href="#GridHandlerGMSH.get_parameter-566"><span class="linenos">566</span></a><span class="sd">        Converts Python sequences to `torch.Tensor` when needed. For the</span>
</span><span id="GridHandlerGMSH.get_parameter-567"><a href="#GridHandlerGMSH.get_parameter-567"><span class="linenos">567</span></a><span class="sd">        region-wise case, elements are filled according to</span>
</span><span id="GridHandlerGMSH.get_parameter-568"><a href="#GridHandlerGMSH.get_parameter-568"><span class="linenos">568</span></a><span class="sd">        `self.region_indices[region]` for each region name.</span>
</span><span id="GridHandlerGMSH.get_parameter-569"><a href="#GridHandlerGMSH.get_parameter-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GridHandlerGMSH.get_parameter-570"><a href="#GridHandlerGMSH.get_parameter-570"><span class="linenos">570</span></a>		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_parameter-571"><a href="#GridHandlerGMSH.get_parameter-571"><span class="linenos">571</span></a>			<span class="k">return</span> <span class="n">to</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">param</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">)])</span>
</span><span id="GridHandlerGMSH.get_parameter-572"><a href="#GridHandlerGMSH.get_parameter-572"><span class="linenos">572</span></a>		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_regions</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_parameter-573"><a href="#GridHandlerGMSH.get_parameter-573"><span class="linenos">573</span></a>			<span class="n">param_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.get_parameter-574"><a href="#GridHandlerGMSH.get_parameter-574"><span class="linenos">574</span></a>			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="GridHandlerGMSH.get_parameter-575"><a href="#GridHandlerGMSH.get_parameter-575"><span class="linenos">575</span></a>				<span class="n">param_to</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">region_indices</span><span class="p">[</span><span class="n">region</span><span class="p">]]</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="GridHandlerGMSH.get_parameter-576"><a href="#GridHandlerGMSH.get_parameter-576"><span class="linenos">576</span></a>			<span class="k">return</span> <span class="n">param_to</span>
</span><span id="GridHandlerGMSH.get_parameter-577"><a href="#GridHandlerGMSH.get_parameter-577"><span class="linenos">577</span></a>		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_parameter-578"><a href="#GridHandlerGMSH.get_parameter-578"><span class="linenos">578</span></a>			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_parameter-579"><a href="#GridHandlerGMSH.get_parameter-579"><span class="linenos">579</span></a>				<span class="k">return</span> <span class="n">param</span>
</span><span id="GridHandlerGMSH.get_parameter-580"><a href="#GridHandlerGMSH.get_parameter-580"><span class="linenos">580</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_parameter-581"><a href="#GridHandlerGMSH.get_parameter-581"><span class="linenos">581</span></a>				<span class="k">return</span> <span class="n">to</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="GridHandlerGMSH.get_parameter-582"><a href="#GridHandlerGMSH.get_parameter-582"><span class="linenos">582</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="GridHandlerGMSH.get_parameter-583"><a href="#GridHandlerGMSH.get_parameter-583"><span class="linenos">583</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Size of parameter list does not match neither # of elements nor # of regions.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Expand a parameter specification to per-element values.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>param</strong> (int or float or sequence or torch.Tensor):
<ul>
<li>Scalar (<code>int</code>/<code>float</code>): broadcast to all elements.</li>
<li>Sequence of length <code>n_regions</code>: values per region in the
order of <code>self.region_indices.keys()</code>.</li>
<li>Sequence or tensor of length <code>n_elems</code>: per-element values.</li>
</ul></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: 1D tensor of length <code>n_elems</code> with parameter values.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Exception</strong>: If <code>param</code> length is neither <code>n_regions</code> nor <code>n_elems</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Converts Python sequences to <code>torch.Tensor</code> when needed. For the
region-wise case, elements are filled according to
<code>self.region_indices[region]</code> for each region name.</p>
</div>


                            </div>
                </section>
                <section id="HeatDiffusion">
                            <input id="HeatDiffusion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HeatDiffusion</span>:

                <label class="view-source-button" for="HeatDiffusion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion-34"><a href="#HeatDiffusion-34"><span class="linenos"> 34</span></a><span class="k">class</span> <span class="nc">HeatDiffusion</span><span class="p">():</span>
</span><span id="HeatDiffusion-35"><a href="#HeatDiffusion-35"><span class="linenos"> 35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-36"><a href="#HeatDiffusion-36"><span class="linenos"> 36</span></a><span class="sd">    Transient heat-diffusion solver on a DOLFINx mesh.</span>
</span><span id="HeatDiffusion-37"><a href="#HeatDiffusion-37"><span class="linenos"> 37</span></a>
</span><span id="HeatDiffusion-38"><a href="#HeatDiffusion-38"><span class="linenos"> 38</span></a><span class="sd">    This class sets up the finite-element spaces, fields, measures, and linear</span>
</span><span id="HeatDiffusion-39"><a href="#HeatDiffusion-39"><span class="linenos"> 39</span></a><span class="sd">    system for the implicit -method (backward Euler when =1). It assembles</span>
</span><span id="HeatDiffusion-40"><a href="#HeatDiffusion-40"><span class="linenos"> 40</span></a><span class="sd">    the bilinear and linear forms, applies time-dependent boundary conditions,</span>
</span><span id="HeatDiffusion-41"><a href="#HeatDiffusion-41"><span class="linenos"> 41</span></a><span class="sd">    and solves for the temperature increment/field at each time step.</span>
</span><span id="HeatDiffusion-42"><a href="#HeatDiffusion-42"><span class="linenos"> 42</span></a>
</span><span id="HeatDiffusion-43"><a href="#HeatDiffusion-43"><span class="linenos"> 43</span></a><span class="sd">    Parameters</span>
</span><span id="HeatDiffusion-44"><a href="#HeatDiffusion-44"><span class="linenos"> 44</span></a><span class="sd">    ----------</span>
</span><span id="HeatDiffusion-45"><a href="#HeatDiffusion-45"><span class="linenos"> 45</span></a><span class="sd">    grid : GridHandlerGMSH</span>
</span><span id="HeatDiffusion-46"><a href="#HeatDiffusion-46"><span class="linenos"> 46</span></a><span class="sd">        Grid/mesh handler providing the DOLFINx mesh and mesh tags</span>
</span><span id="HeatDiffusion-47"><a href="#HeatDiffusion-47"><span class="linenos"> 47</span></a><span class="sd">        (subdomains/boundaries).</span>
</span><span id="HeatDiffusion-48"><a href="#HeatDiffusion-48"><span class="linenos"> 48</span></a>
</span><span id="HeatDiffusion-49"><a href="#HeatDiffusion-49"><span class="linenos"> 49</span></a><span class="sd">    Attributes</span>
</span><span id="HeatDiffusion-50"><a href="#HeatDiffusion-50"><span class="linenos"> 50</span></a><span class="sd">    ----------</span>
</span><span id="HeatDiffusion-51"><a href="#HeatDiffusion-51"><span class="linenos"> 51</span></a><span class="sd">    grid : GridHandlerGMSH</span>
</span><span id="HeatDiffusion-52"><a href="#HeatDiffusion-52"><span class="linenos"> 52</span></a><span class="sd">        Input grid handler.</span>
</span><span id="HeatDiffusion-53"><a href="#HeatDiffusion-53"><span class="linenos"> 53</span></a><span class="sd">    DG0_1 : dolfinx.fem.FunctionSpace</span>
</span><span id="HeatDiffusion-54"><a href="#HeatDiffusion-54"><span class="linenos"> 54</span></a><span class="sd">        Discontinuous Galerkin (degree 0) space for cell-wise material fields.</span>
</span><span id="HeatDiffusion-55"><a href="#HeatDiffusion-55"><span class="linenos"> 55</span></a><span class="sd">    V : dolfinx.fem.FunctionSpace</span>
</span><span id="HeatDiffusion-56"><a href="#HeatDiffusion-56"><span class="linenos"> 56</span></a><span class="sd">        Lagrange (degree 1) space for temperature.</span>
</span><span id="HeatDiffusion-57"><a href="#HeatDiffusion-57"><span class="linenos"> 57</span></a><span class="sd">    n_elems : int</span>
</span><span id="HeatDiffusion-58"><a href="#HeatDiffusion-58"><span class="linenos"> 58</span></a><span class="sd">        Number of (local + ghost) cells in the mesh.</span>
</span><span id="HeatDiffusion-59"><a href="#HeatDiffusion-59"><span class="linenos"> 59</span></a><span class="sd">    n_nodes : int</span>
</span><span id="HeatDiffusion-60"><a href="#HeatDiffusion-60"><span class="linenos"> 60</span></a><span class="sd">        Number of (local + ghost) nodes in the mesh.</span>
</span><span id="HeatDiffusion-61"><a href="#HeatDiffusion-61"><span class="linenos"> 61</span></a><span class="sd">    dt : dolfinx.fem.Constant</span>
</span><span id="HeatDiffusion-62"><a href="#HeatDiffusion-62"><span class="linenos"> 62</span></a><span class="sd">        Time-step parameter (as a scalar Constant on the mesh).</span>
</span><span id="HeatDiffusion-63"><a href="#HeatDiffusion-63"><span class="linenos"> 63</span></a><span class="sd">    dT : ufl.trialfunctions.TrialFunction</span>
</span><span id="HeatDiffusion-64"><a href="#HeatDiffusion-64"><span class="linenos"> 64</span></a><span class="sd">        Trial function in space `V` (temperature increment).</span>
</span><span id="HeatDiffusion-65"><a href="#HeatDiffusion-65"><span class="linenos"> 65</span></a><span class="sd">    T_ : ufl.testfunctions.TestFunction</span>
</span><span id="HeatDiffusion-66"><a href="#HeatDiffusion-66"><span class="linenos"> 66</span></a><span class="sd">        Test function in space `V`.</span>
</span><span id="HeatDiffusion-67"><a href="#HeatDiffusion-67"><span class="linenos"> 67</span></a><span class="sd">    ds, dx : ufl.Measure</span>
</span><span id="HeatDiffusion-68"><a href="#HeatDiffusion-68"><span class="linenos"> 68</span></a><span class="sd">        Boundary and volume measures with subdomain data.</span>
</span><span id="HeatDiffusion-69"><a href="#HeatDiffusion-69"><span class="linenos"> 69</span></a><span class="sd">    k, rho, cp : dolfinx.fem.Function</span>
</span><span id="HeatDiffusion-70"><a href="#HeatDiffusion-70"><span class="linenos"> 70</span></a><span class="sd">        Cell-wise material properties (DG0_1): conductivity, density, heat capacity.</span>
</span><span id="HeatDiffusion-71"><a href="#HeatDiffusion-71"><span class="linenos"> 71</span></a><span class="sd">    T_old, T, X : dolfinx.fem.Function</span>
</span><span id="HeatDiffusion-72"><a href="#HeatDiffusion-72"><span class="linenos"> 72</span></a><span class="sd">        Temperature at previous step, current temperature, and solver vector</span>
</span><span id="HeatDiffusion-73"><a href="#HeatDiffusion-73"><span class="linenos"> 73</span></a><span class="sd">        (all in `V`).</span>
</span><span id="HeatDiffusion-74"><a href="#HeatDiffusion-74"><span class="linenos"> 74</span></a><span class="sd">    mat : Material</span>
</span><span id="HeatDiffusion-75"><a href="#HeatDiffusion-75"><span class="linenos"> 75</span></a><span class="sd">        Material properties container (set via :meth:`set_material`).</span>
</span><span id="HeatDiffusion-76"><a href="#HeatDiffusion-76"><span class="linenos"> 76</span></a><span class="sd">    solver : petsc4py.PETSc.KSP</span>
</span><span id="HeatDiffusion-77"><a href="#HeatDiffusion-77"><span class="linenos"> 77</span></a><span class="sd">        Linear solver (set via :meth:`set_solver`).</span>
</span><span id="HeatDiffusion-78"><a href="#HeatDiffusion-78"><span class="linenos"> 78</span></a><span class="sd">    bc : BcHandler</span>
</span><span id="HeatDiffusion-79"><a href="#HeatDiffusion-79"><span class="linenos"> 79</span></a><span class="sd">        Boundary-condition handler (set via :meth:`set_boundary_conditions`).</span>
</span><span id="HeatDiffusion-80"><a href="#HeatDiffusion-80"><span class="linenos"> 80</span></a>
</span><span id="HeatDiffusion-81"><a href="#HeatDiffusion-81"><span class="linenos"> 81</span></a><span class="sd">    Notes</span>
</span><span id="HeatDiffusion-82"><a href="#HeatDiffusion-82"><span class="linenos"> 82</span></a><span class="sd">    -----</span>
</span><span id="HeatDiffusion-83"><a href="#HeatDiffusion-83"><span class="linenos"> 83</span></a><span class="sd">    - Voigt/tensor conventions are irrelevant here; only scalar temperature is solved.</span>
</span><span id="HeatDiffusion-84"><a href="#HeatDiffusion-84"><span class="linenos"> 84</span></a><span class="sd">    - The class expects that a solver (:class:`PETSc.KSP`), a material</span>
</span><span id="HeatDiffusion-85"><a href="#HeatDiffusion-85"><span class="linenos"> 85</span></a><span class="sd">      (:class:`Material`), and a BC handler (:class:`BcHandler`) are set</span>
</span><span id="HeatDiffusion-86"><a href="#HeatDiffusion-86"><span class="linenos"> 86</span></a><span class="sd">      before calling :meth:`solve`.</span>
</span><span id="HeatDiffusion-87"><a href="#HeatDiffusion-87"><span class="linenos"> 87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-88"><a href="#HeatDiffusion-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">GridHandlerGMSH</span><span class="p">):</span>
</span><span id="HeatDiffusion-89"><a href="#HeatDiffusion-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
</span><span id="HeatDiffusion-90"><a href="#HeatDiffusion-90"><span class="linenos"> 90</span></a>
</span><span id="HeatDiffusion-91"><a href="#HeatDiffusion-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_function_spaces</span><span class="p">()</span>
</span><span id="HeatDiffusion-92"><a href="#HeatDiffusion-92"><span class="linenos"> 92</span></a>
</span><span id="HeatDiffusion-93"><a href="#HeatDiffusion-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="HeatDiffusion-94"><a href="#HeatDiffusion-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="HeatDiffusion-95"><a href="#HeatDiffusion-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="HeatDiffusion-96"><a href="#HeatDiffusion-96"><span class="linenos"> 96</span></a>
</span><span id="HeatDiffusion-97"><a href="#HeatDiffusion-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_trial_test_functions</span><span class="p">()</span>
</span><span id="HeatDiffusion-98"><a href="#HeatDiffusion-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_ds_dx</span><span class="p">()</span>
</span><span id="HeatDiffusion-99"><a href="#HeatDiffusion-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_fenicsx_fields</span><span class="p">()</span>
</span><span id="HeatDiffusion-100"><a href="#HeatDiffusion-100"><span class="linenos">100</span></a>        <span class="c1"># self.create_pytorch_fields()</span>
</span><span id="HeatDiffusion-101"><a href="#HeatDiffusion-101"><span class="linenos">101</span></a>
</span><span id="HeatDiffusion-102"><a href="#HeatDiffusion-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">set_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">Material</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-103"><a href="#HeatDiffusion-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-104"><a href="#HeatDiffusion-104"><span class="linenos">104</span></a><span class="sd">        Attach material properties and initialize FE fields.</span>
</span><span id="HeatDiffusion-105"><a href="#HeatDiffusion-105"><span class="linenos">105</span></a>
</span><span id="HeatDiffusion-106"><a href="#HeatDiffusion-106"><span class="linenos">106</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion-107"><a href="#HeatDiffusion-107"><span class="linenos">107</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion-108"><a href="#HeatDiffusion-108"><span class="linenos">108</span></a><span class="sd">        material : Material</span>
</span><span id="HeatDiffusion-109"><a href="#HeatDiffusion-109"><span class="linenos">109</span></a><span class="sd">            Container with per-element tensors/vectors (`k`, `density`, `cp`).</span>
</span><span id="HeatDiffusion-110"><a href="#HeatDiffusion-110"><span class="linenos">110</span></a>
</span><span id="HeatDiffusion-111"><a href="#HeatDiffusion-111"><span class="linenos">111</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-112"><a href="#HeatDiffusion-112"><span class="linenos">112</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-113"><a href="#HeatDiffusion-113"><span class="linenos">113</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-114"><a href="#HeatDiffusion-114"><span class="linenos">114</span></a>
</span><span id="HeatDiffusion-115"><a href="#HeatDiffusion-115"><span class="linenos">115</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-116"><a href="#HeatDiffusion-116"><span class="linenos">116</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-117"><a href="#HeatDiffusion-117"><span class="linenos">117</span></a><span class="sd">        Calls :meth:`initialize` to copy material arrays into FE functions.</span>
</span><span id="HeatDiffusion-118"><a href="#HeatDiffusion-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-119"><a href="#HeatDiffusion-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">material</span>
</span><span id="HeatDiffusion-120"><a href="#HeatDiffusion-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="HeatDiffusion-121"><a href="#HeatDiffusion-121"><span class="linenos">121</span></a>
</span><span id="HeatDiffusion-122"><a href="#HeatDiffusion-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">KSP</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-123"><a href="#HeatDiffusion-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-124"><a href="#HeatDiffusion-124"><span class="linenos">124</span></a><span class="sd">        Set the PETSc linear solver.</span>
</span><span id="HeatDiffusion-125"><a href="#HeatDiffusion-125"><span class="linenos">125</span></a>
</span><span id="HeatDiffusion-126"><a href="#HeatDiffusion-126"><span class="linenos">126</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion-127"><a href="#HeatDiffusion-127"><span class="linenos">127</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion-128"><a href="#HeatDiffusion-128"><span class="linenos">128</span></a><span class="sd">        solver : petsc4py.PETSc.KSP</span>
</span><span id="HeatDiffusion-129"><a href="#HeatDiffusion-129"><span class="linenos">129</span></a><span class="sd">            Configured Krylov solver (e.g., with preconditioner and tolerances).</span>
</span><span id="HeatDiffusion-130"><a href="#HeatDiffusion-130"><span class="linenos">130</span></a>
</span><span id="HeatDiffusion-131"><a href="#HeatDiffusion-131"><span class="linenos">131</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-132"><a href="#HeatDiffusion-132"><span class="linenos">132</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-133"><a href="#HeatDiffusion-133"><span class="linenos">133</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-134"><a href="#HeatDiffusion-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-135"><a href="#HeatDiffusion-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span><span id="HeatDiffusion-136"><a href="#HeatDiffusion-136"><span class="linenos">136</span></a>
</span><span id="HeatDiffusion-137"><a href="#HeatDiffusion-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">set_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">BcHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-138"><a href="#HeatDiffusion-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-139"><a href="#HeatDiffusion-139"><span class="linenos">139</span></a><span class="sd">        Set the boundary-condition handler.</span>
</span><span id="HeatDiffusion-140"><a href="#HeatDiffusion-140"><span class="linenos">140</span></a>
</span><span id="HeatDiffusion-141"><a href="#HeatDiffusion-141"><span class="linenos">141</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion-142"><a href="#HeatDiffusion-142"><span class="linenos">142</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion-143"><a href="#HeatDiffusion-143"><span class="linenos">143</span></a><span class="sd">        bc : BcHandler</span>
</span><span id="HeatDiffusion-144"><a href="#HeatDiffusion-144"><span class="linenos">144</span></a><span class="sd">            Boundary-condition manager providing Dirichlet, Neumann, and Robin</span>
</span><span id="HeatDiffusion-145"><a href="#HeatDiffusion-145"><span class="linenos">145</span></a><span class="sd">            contributions and update routines.</span>
</span><span id="HeatDiffusion-146"><a href="#HeatDiffusion-146"><span class="linenos">146</span></a>
</span><span id="HeatDiffusion-147"><a href="#HeatDiffusion-147"><span class="linenos">147</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-148"><a href="#HeatDiffusion-148"><span class="linenos">148</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-149"><a href="#HeatDiffusion-149"><span class="linenos">149</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-150"><a href="#HeatDiffusion-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-151"><a href="#HeatDiffusion-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span>
</span><span id="HeatDiffusion-152"><a href="#HeatDiffusion-152"><span class="linenos">152</span></a>
</span><span id="HeatDiffusion-153"><a href="#HeatDiffusion-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">create_trial_test_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-154"><a href="#HeatDiffusion-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-155"><a href="#HeatDiffusion-155"><span class="linenos">155</span></a><span class="sd">        Create trial and test functions in `V`.</span>
</span><span id="HeatDiffusion-156"><a href="#HeatDiffusion-156"><span class="linenos">156</span></a>
</span><span id="HeatDiffusion-157"><a href="#HeatDiffusion-157"><span class="linenos">157</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-158"><a href="#HeatDiffusion-158"><span class="linenos">158</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-159"><a href="#HeatDiffusion-159"><span class="linenos">159</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-160"><a href="#HeatDiffusion-160"><span class="linenos">160</span></a>
</span><span id="HeatDiffusion-161"><a href="#HeatDiffusion-161"><span class="linenos">161</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-162"><a href="#HeatDiffusion-162"><span class="linenos">162</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-163"><a href="#HeatDiffusion-163"><span class="linenos">163</span></a><span class="sd">        Defines :attr:`dT` and :attr:`T_` as UFL trial/test functions.</span>
</span><span id="HeatDiffusion-164"><a href="#HeatDiffusion-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-165"><a href="#HeatDiffusion-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dT</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion-166"><a href="#HeatDiffusion-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion-167"><a href="#HeatDiffusion-167"><span class="linenos">167</span></a>
</span><span id="HeatDiffusion-168"><a href="#HeatDiffusion-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">create_function_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-169"><a href="#HeatDiffusion-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-170"><a href="#HeatDiffusion-170"><span class="linenos">170</span></a><span class="sd">        Build function spaces for materials (DG0) and temperature (P1).</span>
</span><span id="HeatDiffusion-171"><a href="#HeatDiffusion-171"><span class="linenos">171</span></a>
</span><span id="HeatDiffusion-172"><a href="#HeatDiffusion-172"><span class="linenos">172</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-173"><a href="#HeatDiffusion-173"><span class="linenos">173</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-174"><a href="#HeatDiffusion-174"><span class="linenos">174</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-175"><a href="#HeatDiffusion-175"><span class="linenos">175</span></a>
</span><span id="HeatDiffusion-176"><a href="#HeatDiffusion-176"><span class="linenos">176</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-177"><a href="#HeatDiffusion-177"><span class="linenos">177</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-178"><a href="#HeatDiffusion-178"><span class="linenos">178</span></a><span class="sd">        Defines :attr:`DG0_1` and :attr:`V`.</span>
</span><span id="HeatDiffusion-179"><a href="#HeatDiffusion-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-180"><a href="#HeatDiffusion-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="HeatDiffusion-181"><a href="#HeatDiffusion-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="HeatDiffusion-182"><a href="#HeatDiffusion-182"><span class="linenos">182</span></a>
</span><span id="HeatDiffusion-183"><a href="#HeatDiffusion-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">create_ds_dx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-184"><a href="#HeatDiffusion-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-185"><a href="#HeatDiffusion-185"><span class="linenos">185</span></a><span class="sd">        Create UFL measures with subdomain data for integration.</span>
</span><span id="HeatDiffusion-186"><a href="#HeatDiffusion-186"><span class="linenos">186</span></a>
</span><span id="HeatDiffusion-187"><a href="#HeatDiffusion-187"><span class="linenos">187</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-188"><a href="#HeatDiffusion-188"><span class="linenos">188</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-189"><a href="#HeatDiffusion-189"><span class="linenos">189</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-190"><a href="#HeatDiffusion-190"><span class="linenos">190</span></a>
</span><span id="HeatDiffusion-191"><a href="#HeatDiffusion-191"><span class="linenos">191</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-192"><a href="#HeatDiffusion-192"><span class="linenos">192</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-193"><a href="#HeatDiffusion-193"><span class="linenos">193</span></a><span class="sd">        Defines :attr:`ds` for boundary integrals and :attr:`dx` for domain integrals,</span>
</span><span id="HeatDiffusion-194"><a href="#HeatDiffusion-194"><span class="linenos">194</span></a><span class="sd">        using mesh tags from :attr:`grid`.</span>
</span><span id="HeatDiffusion-195"><a href="#HeatDiffusion-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-196"><a href="#HeatDiffusion-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_boundaries</span><span class="p">())</span>
</span><span id="HeatDiffusion-197"><a href="#HeatDiffusion-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_subdomains</span><span class="p">())</span>
</span><span id="HeatDiffusion-198"><a href="#HeatDiffusion-198"><span class="linenos">198</span></a>
</span><span id="HeatDiffusion-199"><a href="#HeatDiffusion-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">create_fenicsx_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-200"><a href="#HeatDiffusion-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-201"><a href="#HeatDiffusion-201"><span class="linenos">201</span></a><span class="sd">        Allocate DOLFINx Functions for material and temperature fields.</span>
</span><span id="HeatDiffusion-202"><a href="#HeatDiffusion-202"><span class="linenos">202</span></a>
</span><span id="HeatDiffusion-203"><a href="#HeatDiffusion-203"><span class="linenos">203</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-204"><a href="#HeatDiffusion-204"><span class="linenos">204</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-205"><a href="#HeatDiffusion-205"><span class="linenos">205</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-206"><a href="#HeatDiffusion-206"><span class="linenos">206</span></a>
</span><span id="HeatDiffusion-207"><a href="#HeatDiffusion-207"><span class="linenos">207</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-208"><a href="#HeatDiffusion-208"><span class="linenos">208</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-209"><a href="#HeatDiffusion-209"><span class="linenos">209</span></a><span class="sd">        Creates :attr:`k`, :attr:`rho`, :attr:`cp` in `DG0_1` and</span>
</span><span id="HeatDiffusion-210"><a href="#HeatDiffusion-210"><span class="linenos">210</span></a><span class="sd">        :attr:`T_old`, :attr:`T`, :attr:`X` in `V`.</span>
</span><span id="HeatDiffusion-211"><a href="#HeatDiffusion-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-212"><a href="#HeatDiffusion-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion-213"><a href="#HeatDiffusion-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion-214"><a href="#HeatDiffusion-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion-215"><a href="#HeatDiffusion-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_old</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion-216"><a href="#HeatDiffusion-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion-217"><a href="#HeatDiffusion-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion-218"><a href="#HeatDiffusion-218"><span class="linenos">218</span></a>
</span><span id="HeatDiffusion-219"><a href="#HeatDiffusion-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-220"><a href="#HeatDiffusion-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-221"><a href="#HeatDiffusion-221"><span class="linenos">221</span></a><span class="sd">        Copy material arrays into FE functions (`k`, `rho`, `cp`).</span>
</span><span id="HeatDiffusion-222"><a href="#HeatDiffusion-222"><span class="linenos">222</span></a>
</span><span id="HeatDiffusion-223"><a href="#HeatDiffusion-223"><span class="linenos">223</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-224"><a href="#HeatDiffusion-224"><span class="linenos">224</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-225"><a href="#HeatDiffusion-225"><span class="linenos">225</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-226"><a href="#HeatDiffusion-226"><span class="linenos">226</span></a>
</span><span id="HeatDiffusion-227"><a href="#HeatDiffusion-227"><span class="linenos">227</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-228"><a href="#HeatDiffusion-228"><span class="linenos">228</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-229"><a href="#HeatDiffusion-229"><span class="linenos">229</span></a><span class="sd">        Writes into `self.k.x.array`, `self.rho.x.array`, and `self.cp.x.array`</span>
</span><span id="HeatDiffusion-230"><a href="#HeatDiffusion-230"><span class="linenos">230</span></a><span class="sd">        from the arrays stored in :attr:`mat`.</span>
</span><span id="HeatDiffusion-231"><a href="#HeatDiffusion-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-232"><a href="#HeatDiffusion-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">k</span>
</span><span id="HeatDiffusion-233"><a href="#HeatDiffusion-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">density</span>
</span><span id="HeatDiffusion-234"><a href="#HeatDiffusion-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">cp</span>
</span><span id="HeatDiffusion-235"><a href="#HeatDiffusion-235"><span class="linenos">235</span></a>
</span><span id="HeatDiffusion-236"><a href="#HeatDiffusion-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-237"><a href="#HeatDiffusion-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-238"><a href="#HeatDiffusion-238"><span class="linenos">238</span></a><span class="sd">        Assign the solver vector `X` to the temperature field `T`.</span>
</span><span id="HeatDiffusion-239"><a href="#HeatDiffusion-239"><span class="linenos">239</span></a>
</span><span id="HeatDiffusion-240"><a href="#HeatDiffusion-240"><span class="linenos">240</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-241"><a href="#HeatDiffusion-241"><span class="linenos">241</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-242"><a href="#HeatDiffusion-242"><span class="linenos">242</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-243"><a href="#HeatDiffusion-243"><span class="linenos">243</span></a>
</span><span id="HeatDiffusion-244"><a href="#HeatDiffusion-244"><span class="linenos">244</span></a><span class="sd">        Notes</span>
</span><span id="HeatDiffusion-245"><a href="#HeatDiffusion-245"><span class="linenos">245</span></a><span class="sd">        -----</span>
</span><span id="HeatDiffusion-246"><a href="#HeatDiffusion-246"><span class="linenos">246</span></a><span class="sd">        This sets `self.T = self.X` (rebinds the reference), rather than copying</span>
</span><span id="HeatDiffusion-247"><a href="#HeatDiffusion-247"><span class="linenos">247</span></a><span class="sd">        underlying arrays. If you need a deep copy, copy `self.X.x.array` into</span>
</span><span id="HeatDiffusion-248"><a href="#HeatDiffusion-248"><span class="linenos">248</span></a><span class="sd">        `self.T.x.array`.</span>
</span><span id="HeatDiffusion-249"><a href="#HeatDiffusion-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-250"><a href="#HeatDiffusion-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
</span><span id="HeatDiffusion-251"><a href="#HeatDiffusion-251"><span class="linenos">251</span></a>
</span><span id="HeatDiffusion-252"><a href="#HeatDiffusion-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">update_T_old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-253"><a href="#HeatDiffusion-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-254"><a href="#HeatDiffusion-254"><span class="linenos">254</span></a><span class="sd">        Copy the current temperature into the `T_old` storage.</span>
</span><span id="HeatDiffusion-255"><a href="#HeatDiffusion-255"><span class="linenos">255</span></a>
</span><span id="HeatDiffusion-256"><a href="#HeatDiffusion-256"><span class="linenos">256</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-257"><a href="#HeatDiffusion-257"><span class="linenos">257</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-258"><a href="#HeatDiffusion-258"><span class="linenos">258</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-259"><a href="#HeatDiffusion-259"><span class="linenos">259</span></a>
</span><span id="HeatDiffusion-260"><a href="#HeatDiffusion-260"><span class="linenos">260</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-261"><a href="#HeatDiffusion-261"><span class="linenos">261</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-262"><a href="#HeatDiffusion-262"><span class="linenos">262</span></a><span class="sd">        Overwrites `self.T_old.x.array` with `self.T.x.array`.</span>
</span><span id="HeatDiffusion-263"><a href="#HeatDiffusion-263"><span class="linenos">263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-264"><a href="#HeatDiffusion-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_old</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span>
</span><span id="HeatDiffusion-265"><a href="#HeatDiffusion-265"><span class="linenos">265</span></a>
</span><span id="HeatDiffusion-266"><a href="#HeatDiffusion-266"><span class="linenos">266</span></a>    <span class="k">def</span> <span class="nf">set_initial_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T_field</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-267"><a href="#HeatDiffusion-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-268"><a href="#HeatDiffusion-268"><span class="linenos">268</span></a><span class="sd">        Initialize both current and previous temperature fields.</span>
</span><span id="HeatDiffusion-269"><a href="#HeatDiffusion-269"><span class="linenos">269</span></a>
</span><span id="HeatDiffusion-270"><a href="#HeatDiffusion-270"><span class="linenos">270</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion-271"><a href="#HeatDiffusion-271"><span class="linenos">271</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion-272"><a href="#HeatDiffusion-272"><span class="linenos">272</span></a><span class="sd">        T_field : torch.Tensor</span>
</span><span id="HeatDiffusion-273"><a href="#HeatDiffusion-273"><span class="linenos">273</span></a><span class="sd">            Temperature values for all nodal DOFs (shape `(n_nodes,)` or compatible).</span>
</span><span id="HeatDiffusion-274"><a href="#HeatDiffusion-274"><span class="linenos">274</span></a>
</span><span id="HeatDiffusion-275"><a href="#HeatDiffusion-275"><span class="linenos">275</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-276"><a href="#HeatDiffusion-276"><span class="linenos">276</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-277"><a href="#HeatDiffusion-277"><span class="linenos">277</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-278"><a href="#HeatDiffusion-278"><span class="linenos">278</span></a>
</span><span id="HeatDiffusion-279"><a href="#HeatDiffusion-279"><span class="linenos">279</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion-280"><a href="#HeatDiffusion-280"><span class="linenos">280</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion-281"><a href="#HeatDiffusion-281"><span class="linenos">281</span></a><span class="sd">        Writes into `self.T_old.x.array` and `self.T.x.array`.</span>
</span><span id="HeatDiffusion-282"><a href="#HeatDiffusion-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-283"><a href="#HeatDiffusion-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_old</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">T_field</span>
</span><span id="HeatDiffusion-284"><a href="#HeatDiffusion-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">T_field</span>
</span><span id="HeatDiffusion-285"><a href="#HeatDiffusion-285"><span class="linenos">285</span></a>
</span><span id="HeatDiffusion-286"><a href="#HeatDiffusion-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">get_T_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-287"><a href="#HeatDiffusion-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-288"><a href="#HeatDiffusion-288"><span class="linenos">288</span></a><span class="sd">        Project the nodal temperature to DG0 and return as a torch tensor.</span>
</span><span id="HeatDiffusion-289"><a href="#HeatDiffusion-289"><span class="linenos">289</span></a>
</span><span id="HeatDiffusion-290"><a href="#HeatDiffusion-290"><span class="linenos">290</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-291"><a href="#HeatDiffusion-291"><span class="linenos">291</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-292"><a href="#HeatDiffusion-292"><span class="linenos">292</span></a><span class="sd">        torch.Tensor</span>
</span><span id="HeatDiffusion-293"><a href="#HeatDiffusion-293"><span class="linenos">293</span></a><span class="sd">            Cell-wise constant temperature values of length `n_elems`.</span>
</span><span id="HeatDiffusion-294"><a href="#HeatDiffusion-294"><span class="linenos">294</span></a>
</span><span id="HeatDiffusion-295"><a href="#HeatDiffusion-295"><span class="linenos">295</span></a><span class="sd">        Notes</span>
</span><span id="HeatDiffusion-296"><a href="#HeatDiffusion-296"><span class="linenos">296</span></a><span class="sd">        -----</span>
</span><span id="HeatDiffusion-297"><a href="#HeatDiffusion-297"><span class="linenos">297</span></a><span class="sd">        Uses :func:`Utils.project` to project `T` onto `DG0_1` and</span>
</span><span id="HeatDiffusion-298"><a href="#HeatDiffusion-298"><span class="linenos">298</span></a><span class="sd">        :func:`Utils.numpy2torch` to convert to a Torch tensor.</span>
</span><span id="HeatDiffusion-299"><a href="#HeatDiffusion-299"><span class="linenos">299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-300"><a href="#HeatDiffusion-300"><span class="linenos">300</span></a>        <span class="n">T_elems</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion-301"><a href="#HeatDiffusion-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="n">T_elems</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="HeatDiffusion-302"><a href="#HeatDiffusion-302"><span class="linenos">302</span></a>
</span><span id="HeatDiffusion-303"><a href="#HeatDiffusion-303"><span class="linenos">303</span></a>
</span><span id="HeatDiffusion-304"><a href="#HeatDiffusion-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion-305"><a href="#HeatDiffusion-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-306"><a href="#HeatDiffusion-306"><span class="linenos">306</span></a><span class="sd">        Assemble and solve one implicit time step.</span>
</span><span id="HeatDiffusion-307"><a href="#HeatDiffusion-307"><span class="linenos">307</span></a>
</span><span id="HeatDiffusion-308"><a href="#HeatDiffusion-308"><span class="linenos">308</span></a><span class="sd">        The method:</span>
</span><span id="HeatDiffusion-309"><a href="#HeatDiffusion-309"><span class="linenos">309</span></a><span class="sd">        1. Update boundary conditions at time ``t`` via :class:`BcHandler`.</span>
</span><span id="HeatDiffusion-310"><a href="#HeatDiffusion-310"><span class="linenos">310</span></a><span class="sd">        2. Set the time-step constant ``dt``.</span>
</span><span id="HeatDiffusion-311"><a href="#HeatDiffusion-311"><span class="linenos">311</span></a><span class="sd">        3. Assemble the bilinear form :math:`(\\rho c_p / \\Delta t) (dT, T_) + (k \\nabla dT, \\nabla T_)` plus Robin terms.</span>
</span><span id="HeatDiffusion-312"><a href="#HeatDiffusion-312"><span class="linenos">312</span></a><span class="sd">        4. Assemble the right-hand side :math:`(\\rho c_p / \\Delta t) (T_{old}, T_)` plus Neumann and Robin terms.</span>
</span><span id="HeatDiffusion-313"><a href="#HeatDiffusion-313"><span class="linenos">313</span></a><span class="sd">        5. Apply Dirichlet BCs, solve the linear system for :attr:`X`, and update :attr:`T` and :attr:`T_old`.</span>
</span><span id="HeatDiffusion-314"><a href="#HeatDiffusion-314"><span class="linenos">314</span></a>
</span><span id="HeatDiffusion-315"><a href="#HeatDiffusion-315"><span class="linenos">315</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion-316"><a href="#HeatDiffusion-316"><span class="linenos">316</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion-317"><a href="#HeatDiffusion-317"><span class="linenos">317</span></a><span class="sd">        t : float</span>
</span><span id="HeatDiffusion-318"><a href="#HeatDiffusion-318"><span class="linenos">318</span></a><span class="sd">            Current time at which boundary conditions are evaluated.</span>
</span><span id="HeatDiffusion-319"><a href="#HeatDiffusion-319"><span class="linenos">319</span></a><span class="sd">        dt : float</span>
</span><span id="HeatDiffusion-320"><a href="#HeatDiffusion-320"><span class="linenos">320</span></a><span class="sd">            Time-step size to advance.</span>
</span><span id="HeatDiffusion-321"><a href="#HeatDiffusion-321"><span class="linenos">321</span></a>
</span><span id="HeatDiffusion-322"><a href="#HeatDiffusion-322"><span class="linenos">322</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion-323"><a href="#HeatDiffusion-323"><span class="linenos">323</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion-324"><a href="#HeatDiffusion-324"><span class="linenos">324</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion-325"><a href="#HeatDiffusion-325"><span class="linenos">325</span></a>
</span><span id="HeatDiffusion-326"><a href="#HeatDiffusion-326"><span class="linenos">326</span></a><span class="sd">        Raises</span>
</span><span id="HeatDiffusion-327"><a href="#HeatDiffusion-327"><span class="linenos">327</span></a><span class="sd">        ------</span>
</span><span id="HeatDiffusion-328"><a href="#HeatDiffusion-328"><span class="linenos">328</span></a><span class="sd">        AttributeError</span>
</span><span id="HeatDiffusion-329"><a href="#HeatDiffusion-329"><span class="linenos">329</span></a><span class="sd">            If solver, BC handler, or material fields are not set.</span>
</span><span id="HeatDiffusion-330"><a href="#HeatDiffusion-330"><span class="linenos">330</span></a>
</span><span id="HeatDiffusion-331"><a href="#HeatDiffusion-331"><span class="linenos">331</span></a><span class="sd">        Notes</span>
</span><span id="HeatDiffusion-332"><a href="#HeatDiffusion-332"><span class="linenos">332</span></a><span class="sd">        -----</span>
</span><span id="HeatDiffusion-333"><a href="#HeatDiffusion-333"><span class="linenos">333</span></a><span class="sd">        - The linear system is solved via the user-provided :class:`PETSc.KSP`.</span>
</span><span id="HeatDiffusion-334"><a href="#HeatDiffusion-334"><span class="linenos">334</span></a><span class="sd">        - Dirichlet conditions are enforced strongly; Neumann/Robin are added</span>
</span><span id="HeatDiffusion-335"><a href="#HeatDiffusion-335"><span class="linenos">335</span></a><span class="sd">          to the forms via the handler lists.</span>
</span><span id="HeatDiffusion-336"><a href="#HeatDiffusion-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion-337"><a href="#HeatDiffusion-337"><span class="linenos">337</span></a>        <span class="c1"># Update boundary conditions</span>
</span><span id="HeatDiffusion-338"><a href="#HeatDiffusion-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_bcs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="HeatDiffusion-339"><a href="#HeatDiffusion-339"><span class="linenos">339</span></a>
</span><span id="HeatDiffusion-340"><a href="#HeatDiffusion-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">dt</span>
</span><span id="HeatDiffusion-341"><a href="#HeatDiffusion-341"><span class="linenos">341</span></a>
</span><span id="HeatDiffusion-342"><a href="#HeatDiffusion-342"><span class="linenos">342</span></a>        <span class="c1"># Build bilinear form</span>
</span><span id="HeatDiffusion-343"><a href="#HeatDiffusion-343"><span class="linenos">343</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dT</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="n">ufl</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dT</span><span class="p">),</span> <span class="n">ufl</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_</span><span class="p">)))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="HeatDiffusion-344"><a href="#HeatDiffusion-344"><span class="linenos">344</span></a>        <span class="n">a</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">robin_bcs_a</span><span class="p">)</span>
</span><span id="HeatDiffusion-345"><a href="#HeatDiffusion-345"><span class="linenos">345</span></a>        <span class="n">bilinear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="HeatDiffusion-346"><a href="#HeatDiffusion-346"><span class="linenos">346</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">assemble_matrix</span><span class="p">(</span><span class="n">bilinear_form</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="HeatDiffusion-347"><a href="#HeatDiffusion-347"><span class="linenos">347</span></a>        <span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</span><span id="HeatDiffusion-348"><a href="#HeatDiffusion-348"><span class="linenos">348</span></a>
</span><span id="HeatDiffusion-349"><a href="#HeatDiffusion-349"><span class="linenos">349</span></a>        <span class="c1"># Build linear form</span>
</span><span id="HeatDiffusion-350"><a href="#HeatDiffusion-350"><span class="linenos">350</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_old</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">neumann_bcs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">robin_bcs_b</span><span class="p">)</span>
</span><span id="HeatDiffusion-351"><a href="#HeatDiffusion-351"><span class="linenos">351</span></a>        <span class="n">linear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</span><span id="HeatDiffusion-352"><a href="#HeatDiffusion-352"><span class="linenos">352</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">assemble_vector</span><span class="p">(</span><span class="n">linear_form</span><span class="p">)</span>
</span><span id="HeatDiffusion-353"><a href="#HeatDiffusion-353"><span class="linenos">353</span></a>        <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">apply_lifting</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">bilinear_form</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">])</span>
</span><span id="HeatDiffusion-354"><a href="#HeatDiffusion-354"><span class="linenos">354</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">ADD_VALUES</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">)</span>
</span><span id="HeatDiffusion-355"><a href="#HeatDiffusion-355"><span class="linenos">355</span></a>        <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">set_bc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="HeatDiffusion-356"><a href="#HeatDiffusion-356"><span class="linenos">356</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
</span><span id="HeatDiffusion-357"><a href="#HeatDiffusion-357"><span class="linenos">357</span></a>
</span><span id="HeatDiffusion-358"><a href="#HeatDiffusion-358"><span class="linenos">358</span></a>        <span class="c1"># Solve linear system</span>
</span><span id="HeatDiffusion-359"><a href="#HeatDiffusion-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="HeatDiffusion-360"><a href="#HeatDiffusion-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">petsc_vec</span><span class="p">)</span>
</span><span id="HeatDiffusion-361"><a href="#HeatDiffusion-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">scatter_forward</span><span class="p">()</span>
</span><span id="HeatDiffusion-362"><a href="#HeatDiffusion-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_solution</span><span class="p">()</span>
</span><span id="HeatDiffusion-363"><a href="#HeatDiffusion-363"><span class="linenos">363</span></a>
</span><span id="HeatDiffusion-364"><a href="#HeatDiffusion-364"><span class="linenos">364</span></a>        <span class="c1"># Update old temperature field</span>
</span><span id="HeatDiffusion-365"><a href="#HeatDiffusion-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_T_old</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Transient heat-diffusion solver on a DOLFINx mesh.</p>

<p>This class sets up the finite-element spaces, fields, measures, and linear
system for the implicit -method (backward Euler when =1). It assembles
the bilinear and linear forms, applies time-dependent boundary conditions,
and solves for the temperature increment/field at each time step.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>grid</strong> (GridHandlerGMSH):
Grid/mesh handler providing the DOLFINx mesh and mesh tags
(subdomains/boundaries).</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>grid</strong> (GridHandlerGMSH):
Input grid handler.</li>
<li><strong>DG0_1</strong> (dolfinx.fem.FunctionSpace):
Discontinuous Galerkin (degree 0) space for cell-wise material fields.</li>
<li><strong>V</strong> (dolfinx.fem.FunctionSpace):
Lagrange (degree 1) space for temperature.</li>
<li><strong>n_elems</strong> (int):
Number of (local + ghost) cells in the mesh.</li>
<li><strong>n_nodes</strong> (int):
Number of (local + ghost) nodes in the mesh.</li>
<li><strong>dt</strong> (dolfinx.fem.Constant):
Time-step parameter (as a scalar Constant on the mesh).</li>
<li><strong>dT</strong> (ufl.trialfunctions.TrialFunction):
Trial function in space <code>V</code> (temperature increment).</li>
<li><strong>T_</strong> (ufl.testfunctions.TestFunction):
Test function in space <code>V</code>.</li>
<li><strong>ds, dx</strong> (ufl.Measure):
Boundary and volume measures with subdomain data.</li>
<li><strong>k, rho, cp</strong> (dolfinx.fem.Function):
Cell-wise material properties (DG0_1): conductivity, density, heat capacity.</li>
<li><strong>T_old, T, X</strong> (dolfinx.fem.Function):
Temperature at previous step, current temperature, and solver vector
(all in <code>V</code>).</li>
<li><strong>mat</strong> (Material):
Material properties container (set via <code><a href="#HeatDiffusion.set_material">set_material()</a></code>).</li>
<li><strong>solver</strong> (petsc4py.PETSc.KSP):
Linear solver (set via <code><a href="#HeatDiffusion.set_solver">set_solver()</a></code>).</li>
<li><strong>bc</strong> (BcHandler):
Boundary-condition handler (set via <code><a href="#HeatDiffusion.set_boundary_conditions">set_boundary_conditions()</a></code>).</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Voigt/tensor conventions are irrelevant here; only scalar temperature is solved.</li>
<li>The class expects that a solver (<code>PETSc.KSP</code>), a material
(<code><a href="#Material">Material</a></code>), and a BC handler (<code>BcHandler</code>) are set
before calling <code><a href="#HeatDiffusion.solve">solve()</a></code>.</li>
</ul>
</div>


                            <div id="HeatDiffusion.__init__" class="classattr">
                                        <input id="HeatDiffusion.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HeatDiffusion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">grid</span><span class="p">:</span> <span class="n"><a href="#GridHandlerGMSH">GridHandlerGMSH</a></span></span>)</span>

                <label class="view-source-button" for="HeatDiffusion.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.__init__-88"><a href="#HeatDiffusion.__init__-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">GridHandlerGMSH</span><span class="p">):</span>
</span><span id="HeatDiffusion.__init__-89"><a href="#HeatDiffusion.__init__-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
</span><span id="HeatDiffusion.__init__-90"><a href="#HeatDiffusion.__init__-90"><span class="linenos"> 90</span></a>
</span><span id="HeatDiffusion.__init__-91"><a href="#HeatDiffusion.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_function_spaces</span><span class="p">()</span>
</span><span id="HeatDiffusion.__init__-92"><a href="#HeatDiffusion.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="HeatDiffusion.__init__-93"><a href="#HeatDiffusion.__init__-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="HeatDiffusion.__init__-94"><a href="#HeatDiffusion.__init__-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="HeatDiffusion.__init__-95"><a href="#HeatDiffusion.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="HeatDiffusion.__init__-96"><a href="#HeatDiffusion.__init__-96"><span class="linenos"> 96</span></a>
</span><span id="HeatDiffusion.__init__-97"><a href="#HeatDiffusion.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_trial_test_functions</span><span class="p">()</span>
</span><span id="HeatDiffusion.__init__-98"><a href="#HeatDiffusion.__init__-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_ds_dx</span><span class="p">()</span>
</span><span id="HeatDiffusion.__init__-99"><a href="#HeatDiffusion.__init__-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_fenicsx_fields</span><span class="p">()</span>
</span><span id="HeatDiffusion.__init__-100"><a href="#HeatDiffusion.__init__-100"><span class="linenos">100</span></a>        <span class="c1"># self.create_pytorch_fields()</span>
</span></pre></div>


    

                            </div>
                            <div id="HeatDiffusion.grid" class="classattr">
                                <div class="attr variable">
            <span class="name">grid</span>

        
    </div>
    <a class="headerlink" href="#HeatDiffusion.grid"></a>
    
    

                            </div>
                            <div id="HeatDiffusion.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#HeatDiffusion.n_elems"></a>
    
    

                            </div>
                            <div id="HeatDiffusion.n_nodes" class="classattr">
                                <div class="attr variable">
            <span class="name">n_nodes</span>

        
    </div>
    <a class="headerlink" href="#HeatDiffusion.n_nodes"></a>
    
    

                            </div>
                            <div id="HeatDiffusion.dt" class="classattr">
                                <div class="attr variable">
            <span class="name">dt</span>

        
    </div>
    <a class="headerlink" href="#HeatDiffusion.dt"></a>
    
    

                            </div>
                            <div id="HeatDiffusion.set_material" class="classattr">
                                        <input id="HeatDiffusion.set_material-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_material</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">material</span><span class="p">:</span> <span class="n"><a href="#Material">Material</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.set_material-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.set_material"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.set_material-102"><a href="#HeatDiffusion.set_material-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">set_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">Material</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.set_material-103"><a href="#HeatDiffusion.set_material-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_material-104"><a href="#HeatDiffusion.set_material-104"><span class="linenos">104</span></a><span class="sd">        Attach material properties and initialize FE fields.</span>
</span><span id="HeatDiffusion.set_material-105"><a href="#HeatDiffusion.set_material-105"><span class="linenos">105</span></a>
</span><span id="HeatDiffusion.set_material-106"><a href="#HeatDiffusion.set_material-106"><span class="linenos">106</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion.set_material-107"><a href="#HeatDiffusion.set_material-107"><span class="linenos">107</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion.set_material-108"><a href="#HeatDiffusion.set_material-108"><span class="linenos">108</span></a><span class="sd">        material : Material</span>
</span><span id="HeatDiffusion.set_material-109"><a href="#HeatDiffusion.set_material-109"><span class="linenos">109</span></a><span class="sd">            Container with per-element tensors/vectors (`k`, `density`, `cp`).</span>
</span><span id="HeatDiffusion.set_material-110"><a href="#HeatDiffusion.set_material-110"><span class="linenos">110</span></a>
</span><span id="HeatDiffusion.set_material-111"><a href="#HeatDiffusion.set_material-111"><span class="linenos">111</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.set_material-112"><a href="#HeatDiffusion.set_material-112"><span class="linenos">112</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.set_material-113"><a href="#HeatDiffusion.set_material-113"><span class="linenos">113</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.set_material-114"><a href="#HeatDiffusion.set_material-114"><span class="linenos">114</span></a>
</span><span id="HeatDiffusion.set_material-115"><a href="#HeatDiffusion.set_material-115"><span class="linenos">115</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.set_material-116"><a href="#HeatDiffusion.set_material-116"><span class="linenos">116</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.set_material-117"><a href="#HeatDiffusion.set_material-117"><span class="linenos">117</span></a><span class="sd">        Calls :meth:`initialize` to copy material arrays into FE functions.</span>
</span><span id="HeatDiffusion.set_material-118"><a href="#HeatDiffusion.set_material-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_material-119"><a href="#HeatDiffusion.set_material-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">material</span>
</span><span id="HeatDiffusion.set_material-120"><a href="#HeatDiffusion.set_material-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Attach material properties and initialize FE fields.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>material</strong> (Material):
Container with per-element tensors/vectors (<code>k</code>, <code>density</code>, <code>cp</code>).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Calls <code><a href="#HeatDiffusion.initialize">initialize()</a></code> to copy material arrays into FE functions.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.set_solver" class="classattr">
                                        <input id="HeatDiffusion.set_solver-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_solver</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">solver</span><span class="p">:</span> <span class="n">petsc4py</span><span class="o">.</span><span class="n">PETSc</span><span class="o">.</span><span class="n">KSP</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.set_solver-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.set_solver"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.set_solver-122"><a href="#HeatDiffusion.set_solver-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">KSP</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.set_solver-123"><a href="#HeatDiffusion.set_solver-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_solver-124"><a href="#HeatDiffusion.set_solver-124"><span class="linenos">124</span></a><span class="sd">        Set the PETSc linear solver.</span>
</span><span id="HeatDiffusion.set_solver-125"><a href="#HeatDiffusion.set_solver-125"><span class="linenos">125</span></a>
</span><span id="HeatDiffusion.set_solver-126"><a href="#HeatDiffusion.set_solver-126"><span class="linenos">126</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion.set_solver-127"><a href="#HeatDiffusion.set_solver-127"><span class="linenos">127</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion.set_solver-128"><a href="#HeatDiffusion.set_solver-128"><span class="linenos">128</span></a><span class="sd">        solver : petsc4py.PETSc.KSP</span>
</span><span id="HeatDiffusion.set_solver-129"><a href="#HeatDiffusion.set_solver-129"><span class="linenos">129</span></a><span class="sd">            Configured Krylov solver (e.g., with preconditioner and tolerances).</span>
</span><span id="HeatDiffusion.set_solver-130"><a href="#HeatDiffusion.set_solver-130"><span class="linenos">130</span></a>
</span><span id="HeatDiffusion.set_solver-131"><a href="#HeatDiffusion.set_solver-131"><span class="linenos">131</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.set_solver-132"><a href="#HeatDiffusion.set_solver-132"><span class="linenos">132</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.set_solver-133"><a href="#HeatDiffusion.set_solver-133"><span class="linenos">133</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.set_solver-134"><a href="#HeatDiffusion.set_solver-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_solver-135"><a href="#HeatDiffusion.set_solver-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span></pre></div>


            <div class="docstring"><p>Set the PETSc linear solver.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>solver</strong> (petsc4py.PETSc.KSP):
Configured Krylov solver (e.g., with preconditioner and tolerances).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="HeatDiffusion.set_boundary_conditions" class="classattr">
                                        <input id="HeatDiffusion.set_boundary_conditions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_boundary_conditions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">bc</span><span class="p">:</span> <span class="n"><a href="safeincave/HeatBC.html#BcHandler">safeincave.HeatBC.BcHandler</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.set_boundary_conditions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.set_boundary_conditions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.set_boundary_conditions-137"><a href="#HeatDiffusion.set_boundary_conditions-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">set_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">BcHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.set_boundary_conditions-138"><a href="#HeatDiffusion.set_boundary_conditions-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_boundary_conditions-139"><a href="#HeatDiffusion.set_boundary_conditions-139"><span class="linenos">139</span></a><span class="sd">        Set the boundary-condition handler.</span>
</span><span id="HeatDiffusion.set_boundary_conditions-140"><a href="#HeatDiffusion.set_boundary_conditions-140"><span class="linenos">140</span></a>
</span><span id="HeatDiffusion.set_boundary_conditions-141"><a href="#HeatDiffusion.set_boundary_conditions-141"><span class="linenos">141</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion.set_boundary_conditions-142"><a href="#HeatDiffusion.set_boundary_conditions-142"><span class="linenos">142</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion.set_boundary_conditions-143"><a href="#HeatDiffusion.set_boundary_conditions-143"><span class="linenos">143</span></a><span class="sd">        bc : BcHandler</span>
</span><span id="HeatDiffusion.set_boundary_conditions-144"><a href="#HeatDiffusion.set_boundary_conditions-144"><span class="linenos">144</span></a><span class="sd">            Boundary-condition manager providing Dirichlet, Neumann, and Robin</span>
</span><span id="HeatDiffusion.set_boundary_conditions-145"><a href="#HeatDiffusion.set_boundary_conditions-145"><span class="linenos">145</span></a><span class="sd">            contributions and update routines.</span>
</span><span id="HeatDiffusion.set_boundary_conditions-146"><a href="#HeatDiffusion.set_boundary_conditions-146"><span class="linenos">146</span></a>
</span><span id="HeatDiffusion.set_boundary_conditions-147"><a href="#HeatDiffusion.set_boundary_conditions-147"><span class="linenos">147</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.set_boundary_conditions-148"><a href="#HeatDiffusion.set_boundary_conditions-148"><span class="linenos">148</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.set_boundary_conditions-149"><a href="#HeatDiffusion.set_boundary_conditions-149"><span class="linenos">149</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.set_boundary_conditions-150"><a href="#HeatDiffusion.set_boundary_conditions-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_boundary_conditions-151"><a href="#HeatDiffusion.set_boundary_conditions-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span>
</span></pre></div>


            <div class="docstring"><p>Set the boundary-condition handler.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>bc</strong> (BcHandler):
Boundary-condition manager providing Dirichlet, Neumann, and Robin
contributions and update routines.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="HeatDiffusion.create_trial_test_functions" class="classattr">
                                        <input id="HeatDiffusion.create_trial_test_functions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_trial_test_functions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.create_trial_test_functions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.create_trial_test_functions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.create_trial_test_functions-153"><a href="#HeatDiffusion.create_trial_test_functions-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">create_trial_test_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.create_trial_test_functions-154"><a href="#HeatDiffusion.create_trial_test_functions-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_trial_test_functions-155"><a href="#HeatDiffusion.create_trial_test_functions-155"><span class="linenos">155</span></a><span class="sd">        Create trial and test functions in `V`.</span>
</span><span id="HeatDiffusion.create_trial_test_functions-156"><a href="#HeatDiffusion.create_trial_test_functions-156"><span class="linenos">156</span></a>
</span><span id="HeatDiffusion.create_trial_test_functions-157"><a href="#HeatDiffusion.create_trial_test_functions-157"><span class="linenos">157</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.create_trial_test_functions-158"><a href="#HeatDiffusion.create_trial_test_functions-158"><span class="linenos">158</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.create_trial_test_functions-159"><a href="#HeatDiffusion.create_trial_test_functions-159"><span class="linenos">159</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.create_trial_test_functions-160"><a href="#HeatDiffusion.create_trial_test_functions-160"><span class="linenos">160</span></a>
</span><span id="HeatDiffusion.create_trial_test_functions-161"><a href="#HeatDiffusion.create_trial_test_functions-161"><span class="linenos">161</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.create_trial_test_functions-162"><a href="#HeatDiffusion.create_trial_test_functions-162"><span class="linenos">162</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.create_trial_test_functions-163"><a href="#HeatDiffusion.create_trial_test_functions-163"><span class="linenos">163</span></a><span class="sd">        Defines :attr:`dT` and :attr:`T_` as UFL trial/test functions.</span>
</span><span id="HeatDiffusion.create_trial_test_functions-164"><a href="#HeatDiffusion.create_trial_test_functions-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_trial_test_functions-165"><a href="#HeatDiffusion.create_trial_test_functions-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dT</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion.create_trial_test_functions-166"><a href="#HeatDiffusion.create_trial_test_functions-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create trial and test functions in <code>V</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>dT</code> and <code>T_</code> as UFL trial/test functions.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.create_function_spaces" class="classattr">
                                        <input id="HeatDiffusion.create_function_spaces-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_function_spaces</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.create_function_spaces-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.create_function_spaces"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.create_function_spaces-168"><a href="#HeatDiffusion.create_function_spaces-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">create_function_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.create_function_spaces-169"><a href="#HeatDiffusion.create_function_spaces-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_function_spaces-170"><a href="#HeatDiffusion.create_function_spaces-170"><span class="linenos">170</span></a><span class="sd">        Build function spaces for materials (DG0) and temperature (P1).</span>
</span><span id="HeatDiffusion.create_function_spaces-171"><a href="#HeatDiffusion.create_function_spaces-171"><span class="linenos">171</span></a>
</span><span id="HeatDiffusion.create_function_spaces-172"><a href="#HeatDiffusion.create_function_spaces-172"><span class="linenos">172</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.create_function_spaces-173"><a href="#HeatDiffusion.create_function_spaces-173"><span class="linenos">173</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.create_function_spaces-174"><a href="#HeatDiffusion.create_function_spaces-174"><span class="linenos">174</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.create_function_spaces-175"><a href="#HeatDiffusion.create_function_spaces-175"><span class="linenos">175</span></a>
</span><span id="HeatDiffusion.create_function_spaces-176"><a href="#HeatDiffusion.create_function_spaces-176"><span class="linenos">176</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.create_function_spaces-177"><a href="#HeatDiffusion.create_function_spaces-177"><span class="linenos">177</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.create_function_spaces-178"><a href="#HeatDiffusion.create_function_spaces-178"><span class="linenos">178</span></a><span class="sd">        Defines :attr:`DG0_1` and :attr:`V`.</span>
</span><span id="HeatDiffusion.create_function_spaces-179"><a href="#HeatDiffusion.create_function_spaces-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_function_spaces-180"><a href="#HeatDiffusion.create_function_spaces-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="HeatDiffusion.create_function_spaces-181"><a href="#HeatDiffusion.create_function_spaces-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Build function spaces for materials (DG0) and temperature (P1).</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>DG0_1</code> and <code>V</code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.create_ds_dx" class="classattr">
                                        <input id="HeatDiffusion.create_ds_dx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_ds_dx</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.create_ds_dx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.create_ds_dx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.create_ds_dx-183"><a href="#HeatDiffusion.create_ds_dx-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">create_ds_dx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.create_ds_dx-184"><a href="#HeatDiffusion.create_ds_dx-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_ds_dx-185"><a href="#HeatDiffusion.create_ds_dx-185"><span class="linenos">185</span></a><span class="sd">        Create UFL measures with subdomain data for integration.</span>
</span><span id="HeatDiffusion.create_ds_dx-186"><a href="#HeatDiffusion.create_ds_dx-186"><span class="linenos">186</span></a>
</span><span id="HeatDiffusion.create_ds_dx-187"><a href="#HeatDiffusion.create_ds_dx-187"><span class="linenos">187</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.create_ds_dx-188"><a href="#HeatDiffusion.create_ds_dx-188"><span class="linenos">188</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.create_ds_dx-189"><a href="#HeatDiffusion.create_ds_dx-189"><span class="linenos">189</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.create_ds_dx-190"><a href="#HeatDiffusion.create_ds_dx-190"><span class="linenos">190</span></a>
</span><span id="HeatDiffusion.create_ds_dx-191"><a href="#HeatDiffusion.create_ds_dx-191"><span class="linenos">191</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.create_ds_dx-192"><a href="#HeatDiffusion.create_ds_dx-192"><span class="linenos">192</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.create_ds_dx-193"><a href="#HeatDiffusion.create_ds_dx-193"><span class="linenos">193</span></a><span class="sd">        Defines :attr:`ds` for boundary integrals and :attr:`dx` for domain integrals,</span>
</span><span id="HeatDiffusion.create_ds_dx-194"><a href="#HeatDiffusion.create_ds_dx-194"><span class="linenos">194</span></a><span class="sd">        using mesh tags from :attr:`grid`.</span>
</span><span id="HeatDiffusion.create_ds_dx-195"><a href="#HeatDiffusion.create_ds_dx-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_ds_dx-196"><a href="#HeatDiffusion.create_ds_dx-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_boundaries</span><span class="p">())</span>
</span><span id="HeatDiffusion.create_ds_dx-197"><a href="#HeatDiffusion.create_ds_dx-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_subdomains</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Create UFL measures with subdomain data for integration.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>ds</code> for boundary integrals and <code>dx</code> for domain integrals,
using mesh tags from <code><a href="#HeatDiffusion.grid">grid</a></code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.create_fenicsx_fields" class="classattr">
                                        <input id="HeatDiffusion.create_fenicsx_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_fenicsx_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.create_fenicsx_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.create_fenicsx_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.create_fenicsx_fields-199"><a href="#HeatDiffusion.create_fenicsx_fields-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">create_fenicsx_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-200"><a href="#HeatDiffusion.create_fenicsx_fields-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-201"><a href="#HeatDiffusion.create_fenicsx_fields-201"><span class="linenos">201</span></a><span class="sd">        Allocate DOLFINx Functions for material and temperature fields.</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-202"><a href="#HeatDiffusion.create_fenicsx_fields-202"><span class="linenos">202</span></a>
</span><span id="HeatDiffusion.create_fenicsx_fields-203"><a href="#HeatDiffusion.create_fenicsx_fields-203"><span class="linenos">203</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-204"><a href="#HeatDiffusion.create_fenicsx_fields-204"><span class="linenos">204</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-205"><a href="#HeatDiffusion.create_fenicsx_fields-205"><span class="linenos">205</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-206"><a href="#HeatDiffusion.create_fenicsx_fields-206"><span class="linenos">206</span></a>
</span><span id="HeatDiffusion.create_fenicsx_fields-207"><a href="#HeatDiffusion.create_fenicsx_fields-207"><span class="linenos">207</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-208"><a href="#HeatDiffusion.create_fenicsx_fields-208"><span class="linenos">208</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-209"><a href="#HeatDiffusion.create_fenicsx_fields-209"><span class="linenos">209</span></a><span class="sd">        Creates :attr:`k`, :attr:`rho`, :attr:`cp` in `DG0_1` and</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-210"><a href="#HeatDiffusion.create_fenicsx_fields-210"><span class="linenos">210</span></a><span class="sd">        :attr:`T_old`, :attr:`T`, :attr:`X` in `V`.</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-211"><a href="#HeatDiffusion.create_fenicsx_fields-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-212"><a href="#HeatDiffusion.create_fenicsx_fields-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-213"><a href="#HeatDiffusion.create_fenicsx_fields-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-214"><a href="#HeatDiffusion.create_fenicsx_fields-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-215"><a href="#HeatDiffusion.create_fenicsx_fields-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_old</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-216"><a href="#HeatDiffusion.create_fenicsx_fields-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="HeatDiffusion.create_fenicsx_fields-217"><a href="#HeatDiffusion.create_fenicsx_fields-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Allocate DOLFINx Functions for material and temperature fields.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Creates <code>k</code>, <code>rho</code>, <code>cp</code> in <code>DG0_1</code> and
<code>T_old</code>, <code>T</code>, <code>X</code> in <code>V</code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.initialize" class="classattr">
                                        <input id="HeatDiffusion.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.initialize-219"><a href="#HeatDiffusion.initialize-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.initialize-220"><a href="#HeatDiffusion.initialize-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.initialize-221"><a href="#HeatDiffusion.initialize-221"><span class="linenos">221</span></a><span class="sd">        Copy material arrays into FE functions (`k`, `rho`, `cp`).</span>
</span><span id="HeatDiffusion.initialize-222"><a href="#HeatDiffusion.initialize-222"><span class="linenos">222</span></a>
</span><span id="HeatDiffusion.initialize-223"><a href="#HeatDiffusion.initialize-223"><span class="linenos">223</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.initialize-224"><a href="#HeatDiffusion.initialize-224"><span class="linenos">224</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.initialize-225"><a href="#HeatDiffusion.initialize-225"><span class="linenos">225</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.initialize-226"><a href="#HeatDiffusion.initialize-226"><span class="linenos">226</span></a>
</span><span id="HeatDiffusion.initialize-227"><a href="#HeatDiffusion.initialize-227"><span class="linenos">227</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.initialize-228"><a href="#HeatDiffusion.initialize-228"><span class="linenos">228</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.initialize-229"><a href="#HeatDiffusion.initialize-229"><span class="linenos">229</span></a><span class="sd">        Writes into `self.k.x.array`, `self.rho.x.array`, and `self.cp.x.array`</span>
</span><span id="HeatDiffusion.initialize-230"><a href="#HeatDiffusion.initialize-230"><span class="linenos">230</span></a><span class="sd">        from the arrays stored in :attr:`mat`.</span>
</span><span id="HeatDiffusion.initialize-231"><a href="#HeatDiffusion.initialize-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.initialize-232"><a href="#HeatDiffusion.initialize-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">k</span>
</span><span id="HeatDiffusion.initialize-233"><a href="#HeatDiffusion.initialize-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">density</span>
</span><span id="HeatDiffusion.initialize-234"><a href="#HeatDiffusion.initialize-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">cp</span>
</span></pre></div>


            <div class="docstring"><p>Copy material arrays into FE functions (<code>k</code>, <code>rho</code>, <code>cp</code>).</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Writes into <code>self.k.x.array</code>, <code>self.rho.x.array</code>, and <code>self.cp.x.array</code>
from the arrays stored in <code>mat</code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.split_solution" class="classattr">
                                        <input id="HeatDiffusion.split_solution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_solution</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.split_solution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.split_solution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.split_solution-236"><a href="#HeatDiffusion.split_solution-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.split_solution-237"><a href="#HeatDiffusion.split_solution-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.split_solution-238"><a href="#HeatDiffusion.split_solution-238"><span class="linenos">238</span></a><span class="sd">        Assign the solver vector `X` to the temperature field `T`.</span>
</span><span id="HeatDiffusion.split_solution-239"><a href="#HeatDiffusion.split_solution-239"><span class="linenos">239</span></a>
</span><span id="HeatDiffusion.split_solution-240"><a href="#HeatDiffusion.split_solution-240"><span class="linenos">240</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.split_solution-241"><a href="#HeatDiffusion.split_solution-241"><span class="linenos">241</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.split_solution-242"><a href="#HeatDiffusion.split_solution-242"><span class="linenos">242</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.split_solution-243"><a href="#HeatDiffusion.split_solution-243"><span class="linenos">243</span></a>
</span><span id="HeatDiffusion.split_solution-244"><a href="#HeatDiffusion.split_solution-244"><span class="linenos">244</span></a><span class="sd">        Notes</span>
</span><span id="HeatDiffusion.split_solution-245"><a href="#HeatDiffusion.split_solution-245"><span class="linenos">245</span></a><span class="sd">        -----</span>
</span><span id="HeatDiffusion.split_solution-246"><a href="#HeatDiffusion.split_solution-246"><span class="linenos">246</span></a><span class="sd">        This sets `self.T = self.X` (rebinds the reference), rather than copying</span>
</span><span id="HeatDiffusion.split_solution-247"><a href="#HeatDiffusion.split_solution-247"><span class="linenos">247</span></a><span class="sd">        underlying arrays. If you need a deep copy, copy `self.X.x.array` into</span>
</span><span id="HeatDiffusion.split_solution-248"><a href="#HeatDiffusion.split_solution-248"><span class="linenos">248</span></a><span class="sd">        `self.T.x.array`.</span>
</span><span id="HeatDiffusion.split_solution-249"><a href="#HeatDiffusion.split_solution-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.split_solution-250"><a href="#HeatDiffusion.split_solution-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
</span></pre></div>


            <div class="docstring"><p>Assign the solver vector <code>X</code> to the temperature field <code>T</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>This sets <code>self.T = self.X</code> (rebinds the reference), rather than copying
underlying arrays. If you need a deep copy, copy <code>self.X.x.array</code> into
<code>self.T.x.array</code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.update_T_old" class="classattr">
                                        <input id="HeatDiffusion.update_T_old-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_T_old</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.update_T_old-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.update_T_old"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.update_T_old-252"><a href="#HeatDiffusion.update_T_old-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">update_T_old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.update_T_old-253"><a href="#HeatDiffusion.update_T_old-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.update_T_old-254"><a href="#HeatDiffusion.update_T_old-254"><span class="linenos">254</span></a><span class="sd">        Copy the current temperature into the `T_old` storage.</span>
</span><span id="HeatDiffusion.update_T_old-255"><a href="#HeatDiffusion.update_T_old-255"><span class="linenos">255</span></a>
</span><span id="HeatDiffusion.update_T_old-256"><a href="#HeatDiffusion.update_T_old-256"><span class="linenos">256</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.update_T_old-257"><a href="#HeatDiffusion.update_T_old-257"><span class="linenos">257</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.update_T_old-258"><a href="#HeatDiffusion.update_T_old-258"><span class="linenos">258</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.update_T_old-259"><a href="#HeatDiffusion.update_T_old-259"><span class="linenos">259</span></a>
</span><span id="HeatDiffusion.update_T_old-260"><a href="#HeatDiffusion.update_T_old-260"><span class="linenos">260</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.update_T_old-261"><a href="#HeatDiffusion.update_T_old-261"><span class="linenos">261</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.update_T_old-262"><a href="#HeatDiffusion.update_T_old-262"><span class="linenos">262</span></a><span class="sd">        Overwrites `self.T_old.x.array` with `self.T.x.array`.</span>
</span><span id="HeatDiffusion.update_T_old-263"><a href="#HeatDiffusion.update_T_old-263"><span class="linenos">263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.update_T_old-264"><a href="#HeatDiffusion.update_T_old-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_old</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span>
</span></pre></div>


            <div class="docstring"><p>Copy the current temperature into the <code>T_old</code> storage.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Overwrites <code>self.T_old.x.array</code> with <code>self.T.x.array</code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.set_initial_T" class="classattr">
                                        <input id="HeatDiffusion.set_initial_T-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_initial_T</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">T_field</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.set_initial_T-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.set_initial_T"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.set_initial_T-266"><a href="#HeatDiffusion.set_initial_T-266"><span class="linenos">266</span></a>    <span class="k">def</span> <span class="nf">set_initial_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T_field</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.set_initial_T-267"><a href="#HeatDiffusion.set_initial_T-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_initial_T-268"><a href="#HeatDiffusion.set_initial_T-268"><span class="linenos">268</span></a><span class="sd">        Initialize both current and previous temperature fields.</span>
</span><span id="HeatDiffusion.set_initial_T-269"><a href="#HeatDiffusion.set_initial_T-269"><span class="linenos">269</span></a>
</span><span id="HeatDiffusion.set_initial_T-270"><a href="#HeatDiffusion.set_initial_T-270"><span class="linenos">270</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion.set_initial_T-271"><a href="#HeatDiffusion.set_initial_T-271"><span class="linenos">271</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion.set_initial_T-272"><a href="#HeatDiffusion.set_initial_T-272"><span class="linenos">272</span></a><span class="sd">        T_field : torch.Tensor</span>
</span><span id="HeatDiffusion.set_initial_T-273"><a href="#HeatDiffusion.set_initial_T-273"><span class="linenos">273</span></a><span class="sd">            Temperature values for all nodal DOFs (shape `(n_nodes,)` or compatible).</span>
</span><span id="HeatDiffusion.set_initial_T-274"><a href="#HeatDiffusion.set_initial_T-274"><span class="linenos">274</span></a>
</span><span id="HeatDiffusion.set_initial_T-275"><a href="#HeatDiffusion.set_initial_T-275"><span class="linenos">275</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.set_initial_T-276"><a href="#HeatDiffusion.set_initial_T-276"><span class="linenos">276</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.set_initial_T-277"><a href="#HeatDiffusion.set_initial_T-277"><span class="linenos">277</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.set_initial_T-278"><a href="#HeatDiffusion.set_initial_T-278"><span class="linenos">278</span></a>
</span><span id="HeatDiffusion.set_initial_T-279"><a href="#HeatDiffusion.set_initial_T-279"><span class="linenos">279</span></a><span class="sd">        Side Effects</span>
</span><span id="HeatDiffusion.set_initial_T-280"><a href="#HeatDiffusion.set_initial_T-280"><span class="linenos">280</span></a><span class="sd">        ------------</span>
</span><span id="HeatDiffusion.set_initial_T-281"><a href="#HeatDiffusion.set_initial_T-281"><span class="linenos">281</span></a><span class="sd">        Writes into `self.T_old.x.array` and `self.T.x.array`.</span>
</span><span id="HeatDiffusion.set_initial_T-282"><a href="#HeatDiffusion.set_initial_T-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.set_initial_T-283"><a href="#HeatDiffusion.set_initial_T-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_old</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">T_field</span>
</span><span id="HeatDiffusion.set_initial_T-284"><a href="#HeatDiffusion.set_initial_T-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">T_field</span>
</span></pre></div>


            <div class="docstring"><p>Initialize both current and previous temperature fields.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>T_field</strong> (torch.Tensor):
Temperature values for all nodal DOFs (shape <code>(n_nodes,)</code> or compatible).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Writes into <code>self.T_old.x.array</code> and <code>self.T.x.array</code>.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.get_T_elems" class="classattr">
                                        <input id="HeatDiffusion.get_T_elems-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_T_elems</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.get_T_elems-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.get_T_elems"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.get_T_elems-286"><a href="#HeatDiffusion.get_T_elems-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">get_T_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.get_T_elems-287"><a href="#HeatDiffusion.get_T_elems-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.get_T_elems-288"><a href="#HeatDiffusion.get_T_elems-288"><span class="linenos">288</span></a><span class="sd">        Project the nodal temperature to DG0 and return as a torch tensor.</span>
</span><span id="HeatDiffusion.get_T_elems-289"><a href="#HeatDiffusion.get_T_elems-289"><span class="linenos">289</span></a>
</span><span id="HeatDiffusion.get_T_elems-290"><a href="#HeatDiffusion.get_T_elems-290"><span class="linenos">290</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.get_T_elems-291"><a href="#HeatDiffusion.get_T_elems-291"><span class="linenos">291</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.get_T_elems-292"><a href="#HeatDiffusion.get_T_elems-292"><span class="linenos">292</span></a><span class="sd">        torch.Tensor</span>
</span><span id="HeatDiffusion.get_T_elems-293"><a href="#HeatDiffusion.get_T_elems-293"><span class="linenos">293</span></a><span class="sd">            Cell-wise constant temperature values of length `n_elems`.</span>
</span><span id="HeatDiffusion.get_T_elems-294"><a href="#HeatDiffusion.get_T_elems-294"><span class="linenos">294</span></a>
</span><span id="HeatDiffusion.get_T_elems-295"><a href="#HeatDiffusion.get_T_elems-295"><span class="linenos">295</span></a><span class="sd">        Notes</span>
</span><span id="HeatDiffusion.get_T_elems-296"><a href="#HeatDiffusion.get_T_elems-296"><span class="linenos">296</span></a><span class="sd">        -----</span>
</span><span id="HeatDiffusion.get_T_elems-297"><a href="#HeatDiffusion.get_T_elems-297"><span class="linenos">297</span></a><span class="sd">        Uses :func:`Utils.project` to project `T` onto `DG0_1` and</span>
</span><span id="HeatDiffusion.get_T_elems-298"><a href="#HeatDiffusion.get_T_elems-298"><span class="linenos">298</span></a><span class="sd">        :func:`Utils.numpy2torch` to convert to a Torch tensor.</span>
</span><span id="HeatDiffusion.get_T_elems-299"><a href="#HeatDiffusion.get_T_elems-299"><span class="linenos">299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.get_T_elems-300"><a href="#HeatDiffusion.get_T_elems-300"><span class="linenos">300</span></a>        <span class="n">T_elems</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="HeatDiffusion.get_T_elems-301"><a href="#HeatDiffusion.get_T_elems-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="n">T_elems</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Project the nodal temperature to DG0 and return as a torch tensor.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Cell-wise constant temperature values of length <code><a href="#HeatDiffusion.n_elems">n_elems</a></code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Uses <code>Utils.project()</code> to project <code>T</code> onto <code>DG0_1</code> and
<code>Utils.numpy2torch()</code> to convert to a Torch tensor.</p>
</div>


                            </div>
                            <div id="HeatDiffusion.solve" class="classattr">
                                        <input id="HeatDiffusion.solve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">solve</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="HeatDiffusion.solve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HeatDiffusion.solve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HeatDiffusion.solve-304"><a href="#HeatDiffusion.solve-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HeatDiffusion.solve-305"><a href="#HeatDiffusion.solve-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.solve-306"><a href="#HeatDiffusion.solve-306"><span class="linenos">306</span></a><span class="sd">        Assemble and solve one implicit time step.</span>
</span><span id="HeatDiffusion.solve-307"><a href="#HeatDiffusion.solve-307"><span class="linenos">307</span></a>
</span><span id="HeatDiffusion.solve-308"><a href="#HeatDiffusion.solve-308"><span class="linenos">308</span></a><span class="sd">        The method:</span>
</span><span id="HeatDiffusion.solve-309"><a href="#HeatDiffusion.solve-309"><span class="linenos">309</span></a><span class="sd">        1. Update boundary conditions at time ``t`` via :class:`BcHandler`.</span>
</span><span id="HeatDiffusion.solve-310"><a href="#HeatDiffusion.solve-310"><span class="linenos">310</span></a><span class="sd">        2. Set the time-step constant ``dt``.</span>
</span><span id="HeatDiffusion.solve-311"><a href="#HeatDiffusion.solve-311"><span class="linenos">311</span></a><span class="sd">        3. Assemble the bilinear form :math:`(\\rho c_p / \\Delta t) (dT, T_) + (k \\nabla dT, \\nabla T_)` plus Robin terms.</span>
</span><span id="HeatDiffusion.solve-312"><a href="#HeatDiffusion.solve-312"><span class="linenos">312</span></a><span class="sd">        4. Assemble the right-hand side :math:`(\\rho c_p / \\Delta t) (T_{old}, T_)` plus Neumann and Robin terms.</span>
</span><span id="HeatDiffusion.solve-313"><a href="#HeatDiffusion.solve-313"><span class="linenos">313</span></a><span class="sd">        5. Apply Dirichlet BCs, solve the linear system for :attr:`X`, and update :attr:`T` and :attr:`T_old`.</span>
</span><span id="HeatDiffusion.solve-314"><a href="#HeatDiffusion.solve-314"><span class="linenos">314</span></a>
</span><span id="HeatDiffusion.solve-315"><a href="#HeatDiffusion.solve-315"><span class="linenos">315</span></a><span class="sd">        Parameters</span>
</span><span id="HeatDiffusion.solve-316"><a href="#HeatDiffusion.solve-316"><span class="linenos">316</span></a><span class="sd">        ----------</span>
</span><span id="HeatDiffusion.solve-317"><a href="#HeatDiffusion.solve-317"><span class="linenos">317</span></a><span class="sd">        t : float</span>
</span><span id="HeatDiffusion.solve-318"><a href="#HeatDiffusion.solve-318"><span class="linenos">318</span></a><span class="sd">            Current time at which boundary conditions are evaluated.</span>
</span><span id="HeatDiffusion.solve-319"><a href="#HeatDiffusion.solve-319"><span class="linenos">319</span></a><span class="sd">        dt : float</span>
</span><span id="HeatDiffusion.solve-320"><a href="#HeatDiffusion.solve-320"><span class="linenos">320</span></a><span class="sd">            Time-step size to advance.</span>
</span><span id="HeatDiffusion.solve-321"><a href="#HeatDiffusion.solve-321"><span class="linenos">321</span></a>
</span><span id="HeatDiffusion.solve-322"><a href="#HeatDiffusion.solve-322"><span class="linenos">322</span></a><span class="sd">        Returns</span>
</span><span id="HeatDiffusion.solve-323"><a href="#HeatDiffusion.solve-323"><span class="linenos">323</span></a><span class="sd">        -------</span>
</span><span id="HeatDiffusion.solve-324"><a href="#HeatDiffusion.solve-324"><span class="linenos">324</span></a><span class="sd">        None</span>
</span><span id="HeatDiffusion.solve-325"><a href="#HeatDiffusion.solve-325"><span class="linenos">325</span></a>
</span><span id="HeatDiffusion.solve-326"><a href="#HeatDiffusion.solve-326"><span class="linenos">326</span></a><span class="sd">        Raises</span>
</span><span id="HeatDiffusion.solve-327"><a href="#HeatDiffusion.solve-327"><span class="linenos">327</span></a><span class="sd">        ------</span>
</span><span id="HeatDiffusion.solve-328"><a href="#HeatDiffusion.solve-328"><span class="linenos">328</span></a><span class="sd">        AttributeError</span>
</span><span id="HeatDiffusion.solve-329"><a href="#HeatDiffusion.solve-329"><span class="linenos">329</span></a><span class="sd">            If solver, BC handler, or material fields are not set.</span>
</span><span id="HeatDiffusion.solve-330"><a href="#HeatDiffusion.solve-330"><span class="linenos">330</span></a>
</span><span id="HeatDiffusion.solve-331"><a href="#HeatDiffusion.solve-331"><span class="linenos">331</span></a><span class="sd">        Notes</span>
</span><span id="HeatDiffusion.solve-332"><a href="#HeatDiffusion.solve-332"><span class="linenos">332</span></a><span class="sd">        -----</span>
</span><span id="HeatDiffusion.solve-333"><a href="#HeatDiffusion.solve-333"><span class="linenos">333</span></a><span class="sd">        - The linear system is solved via the user-provided :class:`PETSc.KSP`.</span>
</span><span id="HeatDiffusion.solve-334"><a href="#HeatDiffusion.solve-334"><span class="linenos">334</span></a><span class="sd">        - Dirichlet conditions are enforced strongly; Neumann/Robin are added</span>
</span><span id="HeatDiffusion.solve-335"><a href="#HeatDiffusion.solve-335"><span class="linenos">335</span></a><span class="sd">          to the forms via the handler lists.</span>
</span><span id="HeatDiffusion.solve-336"><a href="#HeatDiffusion.solve-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HeatDiffusion.solve-337"><a href="#HeatDiffusion.solve-337"><span class="linenos">337</span></a>        <span class="c1"># Update boundary conditions</span>
</span><span id="HeatDiffusion.solve-338"><a href="#HeatDiffusion.solve-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_bcs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-339"><a href="#HeatDiffusion.solve-339"><span class="linenos">339</span></a>
</span><span id="HeatDiffusion.solve-340"><a href="#HeatDiffusion.solve-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">dt</span>
</span><span id="HeatDiffusion.solve-341"><a href="#HeatDiffusion.solve-341"><span class="linenos">341</span></a>
</span><span id="HeatDiffusion.solve-342"><a href="#HeatDiffusion.solve-342"><span class="linenos">342</span></a>        <span class="c1"># Build bilinear form</span>
</span><span id="HeatDiffusion.solve-343"><a href="#HeatDiffusion.solve-343"><span class="linenos">343</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dT</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">*</span><span class="n">ufl</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dT</span><span class="p">),</span> <span class="n">ufl</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_</span><span class="p">)))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="HeatDiffusion.solve-344"><a href="#HeatDiffusion.solve-344"><span class="linenos">344</span></a>        <span class="n">a</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">robin_bcs_a</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-345"><a href="#HeatDiffusion.solve-345"><span class="linenos">345</span></a>        <span class="n">bilinear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-346"><a href="#HeatDiffusion.solve-346"><span class="linenos">346</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">assemble_matrix</span><span class="p">(</span><span class="n">bilinear_form</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-347"><a href="#HeatDiffusion.solve-347"><span class="linenos">347</span></a>        <span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</span><span id="HeatDiffusion.solve-348"><a href="#HeatDiffusion.solve-348"><span class="linenos">348</span></a>
</span><span id="HeatDiffusion.solve-349"><a href="#HeatDiffusion.solve-349"><span class="linenos">349</span></a>        <span class="c1"># Build linear form</span>
</span><span id="HeatDiffusion.solve-350"><a href="#HeatDiffusion.solve-350"><span class="linenos">350</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_old</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T_</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">neumann_bcs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">robin_bcs_b</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-351"><a href="#HeatDiffusion.solve-351"><span class="linenos">351</span></a>        <span class="n">linear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-352"><a href="#HeatDiffusion.solve-352"><span class="linenos">352</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">assemble_vector</span><span class="p">(</span><span class="n">linear_form</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-353"><a href="#HeatDiffusion.solve-353"><span class="linenos">353</span></a>        <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">apply_lifting</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">bilinear_form</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">])</span>
</span><span id="HeatDiffusion.solve-354"><a href="#HeatDiffusion.solve-354"><span class="linenos">354</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">ADD_VALUES</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-355"><a href="#HeatDiffusion.solve-355"><span class="linenos">355</span></a>        <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">set_bc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-356"><a href="#HeatDiffusion.solve-356"><span class="linenos">356</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-357"><a href="#HeatDiffusion.solve-357"><span class="linenos">357</span></a>
</span><span id="HeatDiffusion.solve-358"><a href="#HeatDiffusion.solve-358"><span class="linenos">358</span></a>        <span class="c1"># Solve linear system</span>
</span><span id="HeatDiffusion.solve-359"><a href="#HeatDiffusion.solve-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-360"><a href="#HeatDiffusion.solve-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">petsc_vec</span><span class="p">)</span>
</span><span id="HeatDiffusion.solve-361"><a href="#HeatDiffusion.solve-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">scatter_forward</span><span class="p">()</span>
</span><span id="HeatDiffusion.solve-362"><a href="#HeatDiffusion.solve-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_solution</span><span class="p">()</span>
</span><span id="HeatDiffusion.solve-363"><a href="#HeatDiffusion.solve-363"><span class="linenos">363</span></a>
</span><span id="HeatDiffusion.solve-364"><a href="#HeatDiffusion.solve-364"><span class="linenos">364</span></a>        <span class="c1"># Update old temperature field</span>
</span><span id="HeatDiffusion.solve-365"><a href="#HeatDiffusion.solve-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_T_old</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Assemble and solve one implicit time step.</p>

<p>The method:</p>

<ol>
<li>Update boundary conditions at time <code>t</code> via <code>BcHandler</code>.</li>
<li>Set the time-step constant <code><a href="#HeatDiffusion.dt">dt</a></code>.</li>
<li>Assemble the bilinear form \( (\rho c_p / \Delta t) (dT, T_) + (k \nabla dT, \nabla T_) \) plus Robin terms.</li>
<li>Assemble the right-hand side \( (\rho c_p / \Delta t) (T_{old}, T_) \) plus Neumann and Robin terms.</li>
<li>Apply Dirichlet BCs, solve the linear system for <code>X</code>, and update <code>T</code> and <code>T_old</code>.</li>
</ol>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>t</strong> (float):
Current time at which boundary conditions are evaluated.</li>
<li><strong>dt</strong> (float):
Time-step size to advance.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>AttributeError</strong>: If solver, BC handler, or material fields are not set.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The linear system is solved via the user-provided <code>PETSc.KSP</code>.</li>
<li>Dirichlet conditions are enforced strongly; Neumann/Robin are added
to the forms via the handler lists.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="LinearMomentumBase">
                            <input id="LinearMomentumBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LinearMomentumBase</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="LinearMomentumBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase-37"><a href="#LinearMomentumBase-37"><span class="linenos"> 37</span></a><span class="k">class</span> <span class="nc">LinearMomentumBase</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="LinearMomentumBase-38"><a href="#LinearMomentumBase-38"><span class="linenos"> 38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-39"><a href="#LinearMomentumBase-39"><span class="linenos"> 39</span></a><span class="sd">    Abstract base for a thermo-(visco)elastic linear momentum solver on a DOLFINx mesh.</span>
</span><span id="LinearMomentumBase-40"><a href="#LinearMomentumBase-40"><span class="linenos"> 40</span></a>
</span><span id="LinearMomentumBase-41"><a href="#LinearMomentumBase-41"><span class="linenos"> 41</span></a><span class="sd">    Sets up common FE spaces, measures, and fields; provides utilities for</span>
</span><span id="LinearMomentumBase-42"><a href="#LinearMomentumBase-42"><span class="linenos"> 42</span></a><span class="sd">    assembling body forces, computing invariants, and coordinating inelastic</span>
</span><span id="LinearMomentumBase-43"><a href="#LinearMomentumBase-43"><span class="linenos"> 43</span></a><span class="sd">    elements via the `Material` container. Concrete subclasses supply the</span>
</span><span id="LinearMomentumBase-44"><a href="#LinearMomentumBase-44"><span class="linenos"> 44</span></a><span class="sd">    variational forms and solve routines.</span>
</span><span id="LinearMomentumBase-45"><a href="#LinearMomentumBase-45"><span class="linenos"> 45</span></a>
</span><span id="LinearMomentumBase-46"><a href="#LinearMomentumBase-46"><span class="linenos"> 46</span></a><span class="sd">    Parameters</span>
</span><span id="LinearMomentumBase-47"><a href="#LinearMomentumBase-47"><span class="linenos"> 47</span></a><span class="sd">    ----------</span>
</span><span id="LinearMomentumBase-48"><a href="#LinearMomentumBase-48"><span class="linenos"> 48</span></a><span class="sd">    grid : GridHandlerGMSH</span>
</span><span id="LinearMomentumBase-49"><a href="#LinearMomentumBase-49"><span class="linenos"> 49</span></a><span class="sd">        Mesh/grid handler that provides the DOLFINx mesh and meshtags.</span>
</span><span id="LinearMomentumBase-50"><a href="#LinearMomentumBase-50"><span class="linenos"> 50</span></a><span class="sd">    theta : float</span>
</span><span id="LinearMomentumBase-51"><a href="#LinearMomentumBase-51"><span class="linenos"> 51</span></a><span class="sd">        Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</span>
</span><span id="LinearMomentumBase-52"><a href="#LinearMomentumBase-52"><span class="linenos"> 52</span></a>
</span><span id="LinearMomentumBase-53"><a href="#LinearMomentumBase-53"><span class="linenos"> 53</span></a><span class="sd">    Attributes</span>
</span><span id="LinearMomentumBase-54"><a href="#LinearMomentumBase-54"><span class="linenos"> 54</span></a><span class="sd">    ----------</span>
</span><span id="LinearMomentumBase-55"><a href="#LinearMomentumBase-55"><span class="linenos"> 55</span></a><span class="sd">    grid : GridHandlerGMSH</span>
</span><span id="LinearMomentumBase-56"><a href="#LinearMomentumBase-56"><span class="linenos"> 56</span></a><span class="sd">        Input grid handler.</span>
</span><span id="LinearMomentumBase-57"><a href="#LinearMomentumBase-57"><span class="linenos"> 57</span></a><span class="sd">    theta : float</span>
</span><span id="LinearMomentumBase-58"><a href="#LinearMomentumBase-58"><span class="linenos"> 58</span></a><span class="sd">        Time integration parameter.</span>
</span><span id="LinearMomentumBase-59"><a href="#LinearMomentumBase-59"><span class="linenos"> 59</span></a><span class="sd">    DG0_1, CG1_1 : dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentumBase-60"><a href="#LinearMomentumBase-60"><span class="linenos"> 60</span></a><span class="sd">        Scalar DG0 (per element) and CG1 (per node) spaces.</span>
</span><span id="LinearMomentumBase-61"><a href="#LinearMomentumBase-61"><span class="linenos"> 61</span></a><span class="sd">    CG1_3x1 : dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentumBase-62"><a href="#LinearMomentumBase-62"><span class="linenos"> 62</span></a><span class="sd">        Vector CG1 space of size equal to the spatial dimension.</span>
</span><span id="LinearMomentumBase-63"><a href="#LinearMomentumBase-63"><span class="linenos"> 63</span></a><span class="sd">    DG0_3x3, DG0_6x6 : dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentumBase-64"><a href="#LinearMomentumBase-64"><span class="linenos"> 64</span></a><span class="sd">        Tensor DG0 spaces for 33 and 66 (Voigt) fields.</span>
</span><span id="LinearMomentumBase-65"><a href="#LinearMomentumBase-65"><span class="linenos"> 65</span></a><span class="sd">    n_elems : int</span>
</span><span id="LinearMomentumBase-66"><a href="#LinearMomentumBase-66"><span class="linenos"> 66</span></a><span class="sd">        Number of local+ghost elements.</span>
</span><span id="LinearMomentumBase-67"><a href="#LinearMomentumBase-67"><span class="linenos"> 67</span></a><span class="sd">    n_nodes : int</span>
</span><span id="LinearMomentumBase-68"><a href="#LinearMomentumBase-68"><span class="linenos"> 68</span></a><span class="sd">        Number of local+ghost nodes.</span>
</span><span id="LinearMomentumBase-69"><a href="#LinearMomentumBase-69"><span class="linenos"> 69</span></a><span class="sd">    u : dolfinx.fem.Function</span>
</span><span id="LinearMomentumBase-70"><a href="#LinearMomentumBase-70"><span class="linenos"> 70</span></a><span class="sd">        Displacement field (vector).</span>
</span><span id="LinearMomentumBase-71"><a href="#LinearMomentumBase-71"><span class="linenos"> 71</span></a><span class="sd">    sig, eps_tot : dolfinx.fem.Function</span>
</span><span id="LinearMomentumBase-72"><a href="#LinearMomentumBase-72"><span class="linenos"> 72</span></a><span class="sd">        Stress and total strain (DG0 33 tensors).</span>
</span><span id="LinearMomentumBase-73"><a href="#LinearMomentumBase-73"><span class="linenos"> 73</span></a><span class="sd">    q_nodes, q_elems, p_nodes, p_elems : dolfinx.fem.Function</span>
</span><span id="LinearMomentumBase-74"><a href="#LinearMomentumBase-74"><span class="linenos"> 74</span></a><span class="sd">        Von Mises magnitude and pressure in node/element spaces.</span>
</span><span id="LinearMomentumBase-75"><a href="#LinearMomentumBase-75"><span class="linenos"> 75</span></a><span class="sd">    Temp, T0 : torch.Tensor</span>
</span><span id="LinearMomentumBase-76"><a href="#LinearMomentumBase-76"><span class="linenos"> 76</span></a><span class="sd">        Current and reference temperatures per element, shape ``(n_elems,)``.</span>
</span><span id="LinearMomentumBase-77"><a href="#LinearMomentumBase-77"><span class="linenos"> 77</span></a><span class="sd">    normal : ufl.core.expr.Expr</span>
</span><span id="LinearMomentumBase-78"><a href="#LinearMomentumBase-78"><span class="linenos"> 78</span></a><span class="sd">        Test-function-weighted outward normal used for Neumann terms.</span>
</span><span id="LinearMomentumBase-79"><a href="#LinearMomentumBase-79"><span class="linenos"> 79</span></a><span class="sd">    ds, dx : ufl.Measure</span>
</span><span id="LinearMomentumBase-80"><a href="#LinearMomentumBase-80"><span class="linenos"> 80</span></a><span class="sd">        Boundary and domain measures with subdomain data.</span>
</span><span id="LinearMomentumBase-81"><a href="#LinearMomentumBase-81"><span class="linenos"> 81</span></a><span class="sd">    X : dolfinx.fem.Function</span>
</span><span id="LinearMomentumBase-82"><a href="#LinearMomentumBase-82"><span class="linenos"> 82</span></a><span class="sd">        Solution vector (same space as :meth:`get_uV()`).</span>
</span><span id="LinearMomentumBase-83"><a href="#LinearMomentumBase-83"><span class="linenos"> 83</span></a><span class="sd">    mat : Material</span>
</span><span id="LinearMomentumBase-84"><a href="#LinearMomentumBase-84"><span class="linenos"> 84</span></a><span class="sd">        Material container (set via :meth:`set_material`).</span>
</span><span id="LinearMomentumBase-85"><a href="#LinearMomentumBase-85"><span class="linenos"> 85</span></a><span class="sd">    solver : petsc4py.PETSc.KSP</span>
</span><span id="LinearMomentumBase-86"><a href="#LinearMomentumBase-86"><span class="linenos"> 86</span></a><span class="sd">        PETSc linear solver (set via :meth:`set_solver`).</span>
</span><span id="LinearMomentumBase-87"><a href="#LinearMomentumBase-87"><span class="linenos"> 87</span></a><span class="sd">    bc : BcHandler</span>
</span><span id="LinearMomentumBase-88"><a href="#LinearMomentumBase-88"><span class="linenos"> 88</span></a><span class="sd">        Boundary-condition handler (set via :meth:`set_boundary_conditions`).</span>
</span><span id="LinearMomentumBase-89"><a href="#LinearMomentumBase-89"><span class="linenos"> 89</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-90"><a href="#LinearMomentumBase-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">GridHandlerGMSH</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="LinearMomentumBase-91"><a href="#LinearMomentumBase-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
</span><span id="LinearMomentumBase-92"><a href="#LinearMomentumBase-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
</span><span id="LinearMomentumBase-93"><a href="#LinearMomentumBase-93"><span class="linenos"> 93</span></a>
</span><span id="LinearMomentumBase-94"><a href="#LinearMomentumBase-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_function_spaces</span><span class="p">()</span>
</span><span id="LinearMomentumBase-95"><a href="#LinearMomentumBase-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_ds_dx</span><span class="p">()</span>
</span><span id="LinearMomentumBase-96"><a href="#LinearMomentumBase-96"><span class="linenos"> 96</span></a>
</span><span id="LinearMomentumBase-97"><a href="#LinearMomentumBase-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="LinearMomentumBase-98"><a href="#LinearMomentumBase-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">size_local</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span><span class="o">.</span><span class="n">dofmap</span><span class="o">.</span><span class="n">index_map</span><span class="o">.</span><span class="n">ghosts</span><span class="p">)</span>
</span><span id="LinearMomentumBase-99"><a href="#LinearMomentumBase-99"><span class="linenos"> 99</span></a>
</span><span id="LinearMomentumBase-100"><a href="#LinearMomentumBase-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">commom_fields</span><span class="p">()</span>
</span><span id="LinearMomentumBase-101"><a href="#LinearMomentumBase-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_fenicsx_fields</span><span class="p">()</span>
</span><span id="LinearMomentumBase-102"><a href="#LinearMomentumBase-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_pytorch_fields</span><span class="p">()</span>
</span><span id="LinearMomentumBase-103"><a href="#LinearMomentumBase-103"><span class="linenos">103</span></a>
</span><span id="LinearMomentumBase-104"><a href="#LinearMomentumBase-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">commom_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-105"><a href="#LinearMomentumBase-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-106"><a href="#LinearMomentumBase-106"><span class="linenos">106</span></a><span class="sd">        Allocate common storage for temperature, stresses, and strains.</span>
</span><span id="LinearMomentumBase-107"><a href="#LinearMomentumBase-107"><span class="linenos">107</span></a>
</span><span id="LinearMomentumBase-108"><a href="#LinearMomentumBase-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-109"><a href="#LinearMomentumBase-109"><span class="linenos">109</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-110"><a href="#LinearMomentumBase-110"><span class="linenos">110</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-111"><a href="#LinearMomentumBase-111"><span class="linenos">111</span></a>
</span><span id="LinearMomentumBase-112"><a href="#LinearMomentumBase-112"><span class="linenos">112</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-113"><a href="#LinearMomentumBase-113"><span class="linenos">113</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-114"><a href="#LinearMomentumBase-114"><span class="linenos">114</span></a><span class="sd">        Initializes tensors/functions:</span>
</span><span id="LinearMomentumBase-115"><a href="#LinearMomentumBase-115"><span class="linenos">115</span></a><span class="sd">        `T0`, `Temp`, `sig`, `eps_tot`, `u`, `q_elems`, `q_nodes`, `p_elems`, `p_nodes`.</span>
</span><span id="LinearMomentumBase-116"><a href="#LinearMomentumBase-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-117"><a href="#LinearMomentumBase-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase-118"><a href="#LinearMomentumBase-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase-119"><a href="#LinearMomentumBase-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentumBase-120"><a href="#LinearMomentumBase-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_tot</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentumBase-121"><a href="#LinearMomentumBase-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_3x1</span><span class="p">)</span>
</span><span id="LinearMomentumBase-122"><a href="#LinearMomentumBase-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_elems</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase-123"><a href="#LinearMomentumBase-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_nodes</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase-124"><a href="#LinearMomentumBase-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_elems</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase-125"><a href="#LinearMomentumBase-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_nodes</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase-126"><a href="#LinearMomentumBase-126"><span class="linenos">126</span></a>
</span><span id="LinearMomentumBase-127"><a href="#LinearMomentumBase-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">set_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">Material</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-128"><a href="#LinearMomentumBase-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-129"><a href="#LinearMomentumBase-129"><span class="linenos">129</span></a><span class="sd">        Attach a material model and initialize FE fields from it.</span>
</span><span id="LinearMomentumBase-130"><a href="#LinearMomentumBase-130"><span class="linenos">130</span></a>
</span><span id="LinearMomentumBase-131"><a href="#LinearMomentumBase-131"><span class="linenos">131</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-132"><a href="#LinearMomentumBase-132"><span class="linenos">132</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-133"><a href="#LinearMomentumBase-133"><span class="linenos">133</span></a><span class="sd">        material : Material</span>
</span><span id="LinearMomentumBase-134"><a href="#LinearMomentumBase-134"><span class="linenos">134</span></a><span class="sd">            Material container with elastic and non-elastic elements.</span>
</span><span id="LinearMomentumBase-135"><a href="#LinearMomentumBase-135"><span class="linenos">135</span></a>
</span><span id="LinearMomentumBase-136"><a href="#LinearMomentumBase-136"><span class="linenos">136</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-137"><a href="#LinearMomentumBase-137"><span class="linenos">137</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-138"><a href="#LinearMomentumBase-138"><span class="linenos">138</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-139"><a href="#LinearMomentumBase-139"><span class="linenos">139</span></a>
</span><span id="LinearMomentumBase-140"><a href="#LinearMomentumBase-140"><span class="linenos">140</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-141"><a href="#LinearMomentumBase-141"><span class="linenos">141</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-142"><a href="#LinearMomentumBase-142"><span class="linenos">142</span></a><span class="sd">        Calls :meth:`initialize`.</span>
</span><span id="LinearMomentumBase-143"><a href="#LinearMomentumBase-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-144"><a href="#LinearMomentumBase-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">material</span>
</span><span id="LinearMomentumBase-145"><a href="#LinearMomentumBase-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="LinearMomentumBase-146"><a href="#LinearMomentumBase-146"><span class="linenos">146</span></a>
</span><span id="LinearMomentumBase-147"><a href="#LinearMomentumBase-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">set_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-148"><a href="#LinearMomentumBase-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-149"><a href="#LinearMomentumBase-149"><span class="linenos">149</span></a><span class="sd">        Set the current element-wise temperature.</span>
</span><span id="LinearMomentumBase-150"><a href="#LinearMomentumBase-150"><span class="linenos">150</span></a>
</span><span id="LinearMomentumBase-151"><a href="#LinearMomentumBase-151"><span class="linenos">151</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-152"><a href="#LinearMomentumBase-152"><span class="linenos">152</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-153"><a href="#LinearMomentumBase-153"><span class="linenos">153</span></a><span class="sd">        T : torch.Tensor</span>
</span><span id="LinearMomentumBase-154"><a href="#LinearMomentumBase-154"><span class="linenos">154</span></a><span class="sd">            Temperature per element, shape ``(n_elems,)``.</span>
</span><span id="LinearMomentumBase-155"><a href="#LinearMomentumBase-155"><span class="linenos">155</span></a>
</span><span id="LinearMomentumBase-156"><a href="#LinearMomentumBase-156"><span class="linenos">156</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-157"><a href="#LinearMomentumBase-157"><span class="linenos">157</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-158"><a href="#LinearMomentumBase-158"><span class="linenos">158</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-159"><a href="#LinearMomentumBase-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-160"><a href="#LinearMomentumBase-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span> <span class="o">=</span> <span class="n">T</span>
</span><span id="LinearMomentumBase-161"><a href="#LinearMomentumBase-161"><span class="linenos">161</span></a>
</span><span id="LinearMomentumBase-162"><a href="#LinearMomentumBase-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">set_T0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T0</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-163"><a href="#LinearMomentumBase-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-164"><a href="#LinearMomentumBase-164"><span class="linenos">164</span></a><span class="sd">        Set the reference element-wise temperature.</span>
</span><span id="LinearMomentumBase-165"><a href="#LinearMomentumBase-165"><span class="linenos">165</span></a>
</span><span id="LinearMomentumBase-166"><a href="#LinearMomentumBase-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-167"><a href="#LinearMomentumBase-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-168"><a href="#LinearMomentumBase-168"><span class="linenos">168</span></a><span class="sd">        T0 : torch.Tensor</span>
</span><span id="LinearMomentumBase-169"><a href="#LinearMomentumBase-169"><span class="linenos">169</span></a><span class="sd">            Reference temperature per element, shape ``(n_elems,)``.</span>
</span><span id="LinearMomentumBase-170"><a href="#LinearMomentumBase-170"><span class="linenos">170</span></a>
</span><span id="LinearMomentumBase-171"><a href="#LinearMomentumBase-171"><span class="linenos">171</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-172"><a href="#LinearMomentumBase-172"><span class="linenos">172</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-173"><a href="#LinearMomentumBase-173"><span class="linenos">173</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-174"><a href="#LinearMomentumBase-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-175"><a href="#LinearMomentumBase-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">T0</span>
</span><span id="LinearMomentumBase-176"><a href="#LinearMomentumBase-176"><span class="linenos">176</span></a>
</span><span id="LinearMomentumBase-177"><a href="#LinearMomentumBase-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">KSP</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-178"><a href="#LinearMomentumBase-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-179"><a href="#LinearMomentumBase-179"><span class="linenos">179</span></a><span class="sd">        Set the PETSc linear solver.</span>
</span><span id="LinearMomentumBase-180"><a href="#LinearMomentumBase-180"><span class="linenos">180</span></a>
</span><span id="LinearMomentumBase-181"><a href="#LinearMomentumBase-181"><span class="linenos">181</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-182"><a href="#LinearMomentumBase-182"><span class="linenos">182</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-183"><a href="#LinearMomentumBase-183"><span class="linenos">183</span></a><span class="sd">        solver : petsc4py.PETSc.KSP</span>
</span><span id="LinearMomentumBase-184"><a href="#LinearMomentumBase-184"><span class="linenos">184</span></a><span class="sd">            Preconfigured Krylov solver.</span>
</span><span id="LinearMomentumBase-185"><a href="#LinearMomentumBase-185"><span class="linenos">185</span></a>
</span><span id="LinearMomentumBase-186"><a href="#LinearMomentumBase-186"><span class="linenos">186</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-187"><a href="#LinearMomentumBase-187"><span class="linenos">187</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-188"><a href="#LinearMomentumBase-188"><span class="linenos">188</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-189"><a href="#LinearMomentumBase-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-190"><a href="#LinearMomentumBase-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span><span id="LinearMomentumBase-191"><a href="#LinearMomentumBase-191"><span class="linenos">191</span></a>
</span><span id="LinearMomentumBase-192"><a href="#LinearMomentumBase-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">set_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">BcHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-193"><a href="#LinearMomentumBase-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-194"><a href="#LinearMomentumBase-194"><span class="linenos">194</span></a><span class="sd">        Set the boundary-condition handler.</span>
</span><span id="LinearMomentumBase-195"><a href="#LinearMomentumBase-195"><span class="linenos">195</span></a>
</span><span id="LinearMomentumBase-196"><a href="#LinearMomentumBase-196"><span class="linenos">196</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-197"><a href="#LinearMomentumBase-197"><span class="linenos">197</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-198"><a href="#LinearMomentumBase-198"><span class="linenos">198</span></a><span class="sd">        bc : BcHandler</span>
</span><span id="LinearMomentumBase-199"><a href="#LinearMomentumBase-199"><span class="linenos">199</span></a><span class="sd">            Handler providing Dirichlet/Neumann terms and updates.</span>
</span><span id="LinearMomentumBase-200"><a href="#LinearMomentumBase-200"><span class="linenos">200</span></a>
</span><span id="LinearMomentumBase-201"><a href="#LinearMomentumBase-201"><span class="linenos">201</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-202"><a href="#LinearMomentumBase-202"><span class="linenos">202</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-203"><a href="#LinearMomentumBase-203"><span class="linenos">203</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-204"><a href="#LinearMomentumBase-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-205"><a href="#LinearMomentumBase-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span>
</span><span id="LinearMomentumBase-206"><a href="#LinearMomentumBase-206"><span class="linenos">206</span></a>
</span><span id="LinearMomentumBase-207"><a href="#LinearMomentumBase-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">create_function_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-208"><a href="#LinearMomentumBase-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-209"><a href="#LinearMomentumBase-209"><span class="linenos">209</span></a><span class="sd">        Create function spaces used by the formulation.</span>
</span><span id="LinearMomentumBase-210"><a href="#LinearMomentumBase-210"><span class="linenos">210</span></a>
</span><span id="LinearMomentumBase-211"><a href="#LinearMomentumBase-211"><span class="linenos">211</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-212"><a href="#LinearMomentumBase-212"><span class="linenos">212</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-213"><a href="#LinearMomentumBase-213"><span class="linenos">213</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-214"><a href="#LinearMomentumBase-214"><span class="linenos">214</span></a>
</span><span id="LinearMomentumBase-215"><a href="#LinearMomentumBase-215"><span class="linenos">215</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-216"><a href="#LinearMomentumBase-216"><span class="linenos">216</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-217"><a href="#LinearMomentumBase-217"><span class="linenos">217</span></a><span class="sd">        Defines :attr:`CG1_3x1`, :attr:`DG0_1`, :attr:`CG1_1`,</span>
</span><span id="LinearMomentumBase-218"><a href="#LinearMomentumBase-218"><span class="linenos">218</span></a><span class="sd">        :attr:`DG0_3x3`, and :attr:`DG0_6x6`.</span>
</span><span id="LinearMomentumBase-219"><a href="#LinearMomentumBase-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-220"><a href="#LinearMomentumBase-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CG1_3x1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">,</span> <span class="p">)))</span>
</span><span id="LinearMomentumBase-221"><a href="#LinearMomentumBase-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="LinearMomentumBase-222"><a href="#LinearMomentumBase-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="LinearMomentumBase-223"><a href="#LinearMomentumBase-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase-224"><a href="#LinearMomentumBase-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_6x6</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</span><span id="LinearMomentumBase-225"><a href="#LinearMomentumBase-225"><span class="linenos">225</span></a>
</span><span id="LinearMomentumBase-226"><a href="#LinearMomentumBase-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">create_ds_dx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-227"><a href="#LinearMomentumBase-227"><span class="linenos">227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-228"><a href="#LinearMomentumBase-228"><span class="linenos">228</span></a><span class="sd">        Create boundary and domain measures with subdomain data.</span>
</span><span id="LinearMomentumBase-229"><a href="#LinearMomentumBase-229"><span class="linenos">229</span></a>
</span><span id="LinearMomentumBase-230"><a href="#LinearMomentumBase-230"><span class="linenos">230</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-231"><a href="#LinearMomentumBase-231"><span class="linenos">231</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-232"><a href="#LinearMomentumBase-232"><span class="linenos">232</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-233"><a href="#LinearMomentumBase-233"><span class="linenos">233</span></a>
</span><span id="LinearMomentumBase-234"><a href="#LinearMomentumBase-234"><span class="linenos">234</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-235"><a href="#LinearMomentumBase-235"><span class="linenos">235</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-236"><a href="#LinearMomentumBase-236"><span class="linenos">236</span></a><span class="sd">        Defines :attr:`ds` and :attr:`dx` from grid meshtags.</span>
</span><span id="LinearMomentumBase-237"><a href="#LinearMomentumBase-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-238"><a href="#LinearMomentumBase-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_boundaries</span><span class="p">())</span>
</span><span id="LinearMomentumBase-239"><a href="#LinearMomentumBase-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_subdomains</span><span class="p">())</span>
</span><span id="LinearMomentumBase-240"><a href="#LinearMomentumBase-240"><span class="linenos">240</span></a>
</span><span id="LinearMomentumBase-241"><a href="#LinearMomentumBase-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">create_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-242"><a href="#LinearMomentumBase-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-243"><a href="#LinearMomentumBase-243"><span class="linenos">243</span></a><span class="sd">        Create a test-function-weighted outward normal for surface terms.</span>
</span><span id="LinearMomentumBase-244"><a href="#LinearMomentumBase-244"><span class="linenos">244</span></a>
</span><span id="LinearMomentumBase-245"><a href="#LinearMomentumBase-245"><span class="linenos">245</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-246"><a href="#LinearMomentumBase-246"><span class="linenos">246</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-247"><a href="#LinearMomentumBase-247"><span class="linenos">247</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-248"><a href="#LinearMomentumBase-248"><span class="linenos">248</span></a>
</span><span id="LinearMomentumBase-249"><a href="#LinearMomentumBase-249"><span class="linenos">249</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-250"><a href="#LinearMomentumBase-250"><span class="linenos">250</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-251"><a href="#LinearMomentumBase-251"><span class="linenos">251</span></a><span class="sd">        Defines :attr:`normal` as ``dot(FacetNormal(mesh), self.u_)``.</span>
</span><span id="LinearMomentumBase-252"><a href="#LinearMomentumBase-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-253"><a href="#LinearMomentumBase-253"><span class="linenos">253</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">FacetNormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="LinearMomentumBase-254"><a href="#LinearMomentumBase-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">)</span>
</span><span id="LinearMomentumBase-255"><a href="#LinearMomentumBase-255"><span class="linenos">255</span></a>
</span><span id="LinearMomentumBase-256"><a href="#LinearMomentumBase-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">build_body_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-257"><a href="#LinearMomentumBase-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-258"><a href="#LinearMomentumBase-258"><span class="linenos">258</span></a><span class="sd">        Build the body-force linear form ``  g  u_ dx``.</span>
</span><span id="LinearMomentumBase-259"><a href="#LinearMomentumBase-259"><span class="linenos">259</span></a>
</span><span id="LinearMomentumBase-260"><a href="#LinearMomentumBase-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-261"><a href="#LinearMomentumBase-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-262"><a href="#LinearMomentumBase-262"><span class="linenos">262</span></a><span class="sd">        g : list of float</span>
</span><span id="LinearMomentumBase-263"><a href="#LinearMomentumBase-263"><span class="linenos">263</span></a><span class="sd">            Gravity/body acceleration vector components.</span>
</span><span id="LinearMomentumBase-264"><a href="#LinearMomentumBase-264"><span class="linenos">264</span></a>
</span><span id="LinearMomentumBase-265"><a href="#LinearMomentumBase-265"><span class="linenos">265</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-266"><a href="#LinearMomentumBase-266"><span class="linenos">266</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-267"><a href="#LinearMomentumBase-267"><span class="linenos">267</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-268"><a href="#LinearMomentumBase-268"><span class="linenos">268</span></a>
</span><span id="LinearMomentumBase-269"><a href="#LinearMomentumBase-269"><span class="linenos">269</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-270"><a href="#LinearMomentumBase-270"><span class="linenos">270</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-271"><a href="#LinearMomentumBase-271"><span class="linenos">271</span></a><span class="sd">        Defines :attr:`b_body` as a UFL form for the right-hand side.</span>
</span><span id="LinearMomentumBase-272"><a href="#LinearMomentumBase-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-273"><a href="#LinearMomentumBase-273"><span class="linenos">273</span></a>        <span class="n">density</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase-274"><a href="#LinearMomentumBase-274"><span class="linenos">274</span></a>        <span class="n">density</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">density</span>
</span><span id="LinearMomentumBase-275"><a href="#LinearMomentumBase-275"><span class="linenos">275</span></a>        <span class="n">body_force</span> <span class="o">=</span> <span class="n">density</span><span class="o">*</span><span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">do</span><span class="o">.</span><span class="n">default_scalar_type</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">g</span><span class="p">)))</span>
</span><span id="LinearMomentumBase-276"><a href="#LinearMomentumBase-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">b_body</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">body_force</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentumBase-277"><a href="#LinearMomentumBase-277"><span class="linenos">277</span></a>
</span><span id="LinearMomentumBase-278"><a href="#LinearMomentumBase-278"><span class="linenos">278</span></a>	<span class="c1"># def compute_q_nodes(self) -&gt; do.fem.Function:</span>
</span><span id="LinearMomentumBase-279"><a href="#LinearMomentumBase-279"><span class="linenos">279</span></a>	<span class="c1"># 	dev = self.sig - (1/3)*ufl.tr(self.sig)*ufl.Identity(3)</span>
</span><span id="LinearMomentumBase-280"><a href="#LinearMomentumBase-280"><span class="linenos">280</span></a>	<span class="c1"># 	q_form = ufl.sqrt((3/2)*ufl.inner(dev, dev))</span>
</span><span id="LinearMomentumBase-281"><a href="#LinearMomentumBase-281"><span class="linenos">281</span></a>	<span class="c1"># 	self.q_nodes = project(q_form, self.CG1_1)</span>
</span><span id="LinearMomentumBase-282"><a href="#LinearMomentumBase-282"><span class="linenos">282</span></a>
</span><span id="LinearMomentumBase-283"><a href="#LinearMomentumBase-283"><span class="linenos">283</span></a>	<span class="c1"># def compute_q_elems(self) -&gt; do.fem.Function:</span>
</span><span id="LinearMomentumBase-284"><a href="#LinearMomentumBase-284"><span class="linenos">284</span></a>	<span class="c1"># 	dev = self.sig - (1/3)*ufl.tr(self.sig)*ufl.Identity(3)</span>
</span><span id="LinearMomentumBase-285"><a href="#LinearMomentumBase-285"><span class="linenos">285</span></a>	<span class="c1"># 	q_form = ufl.sqrt((3/2)*ufl.inner(dev, dev))</span>
</span><span id="LinearMomentumBase-286"><a href="#LinearMomentumBase-286"><span class="linenos">286</span></a>	<span class="c1"># 	self.q_elems = project(q_form, self.DG0_1)</span>
</span><span id="LinearMomentumBase-287"><a href="#LinearMomentumBase-287"><span class="linenos">287</span></a>
</span><span id="LinearMomentumBase-288"><a href="#LinearMomentumBase-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">compute_q_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-289"><a href="#LinearMomentumBase-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-290"><a href="#LinearMomentumBase-290"><span class="linenos">290</span></a><span class="sd">        Compute von Mises equivalent stress and smooth it to nodes.</span>
</span><span id="LinearMomentumBase-291"><a href="#LinearMomentumBase-291"><span class="linenos">291</span></a>
</span><span id="LinearMomentumBase-292"><a href="#LinearMomentumBase-292"><span class="linenos">292</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-293"><a href="#LinearMomentumBase-293"><span class="linenos">293</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-294"><a href="#LinearMomentumBase-294"><span class="linenos">294</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-295"><a href="#LinearMomentumBase-295"><span class="linenos">295</span></a>
</span><span id="LinearMomentumBase-296"><a href="#LinearMomentumBase-296"><span class="linenos">296</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-297"><a href="#LinearMomentumBase-297"><span class="linenos">297</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-298"><a href="#LinearMomentumBase-298"><span class="linenos">298</span></a><span class="sd">        Sets :attr:`q_nodes` by applying a node-element averaging matrix</span>
</span><span id="LinearMomentumBase-299"><a href="#LinearMomentumBase-299"><span class="linenos">299</span></a><span class="sd">        (:attr:`grid.A_csr`) to the element-wise von Mises values.</span>
</span><span id="LinearMomentumBase-300"><a href="#LinearMomentumBase-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-301"><a href="#LinearMomentumBase-301"><span class="linenos">301</span></a>        <span class="n">stress</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase-302"><a href="#LinearMomentumBase-302"><span class="linenos">302</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LinearMomentumBase-303"><a href="#LinearMomentumBase-303"><span class="linenos">303</span></a>        <span class="n">I2</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span id="LinearMomentumBase-304"><a href="#LinearMomentumBase-304"><span class="linenos">304</span></a>        <span class="n">J2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">I2</span>
</span><span id="LinearMomentumBase-305"><a href="#LinearMomentumBase-305"><span class="linenos">305</span></a>        <span class="n">q_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">J2</span><span class="p">)</span>
</span><span id="LinearMomentumBase-306"><a href="#LinearMomentumBase-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_nodes</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">A_csr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q_to</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="LinearMomentumBase-307"><a href="#LinearMomentumBase-307"><span class="linenos">307</span></a>
</span><span id="LinearMomentumBase-308"><a href="#LinearMomentumBase-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">compute_q_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-309"><a href="#LinearMomentumBase-309"><span class="linenos">309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-310"><a href="#LinearMomentumBase-310"><span class="linenos">310</span></a><span class="sd">        Compute von Mises equivalent stress and smooth it to elements.</span>
</span><span id="LinearMomentumBase-311"><a href="#LinearMomentumBase-311"><span class="linenos">311</span></a>
</span><span id="LinearMomentumBase-312"><a href="#LinearMomentumBase-312"><span class="linenos">312</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-313"><a href="#LinearMomentumBase-313"><span class="linenos">313</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-314"><a href="#LinearMomentumBase-314"><span class="linenos">314</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-315"><a href="#LinearMomentumBase-315"><span class="linenos">315</span></a>
</span><span id="LinearMomentumBase-316"><a href="#LinearMomentumBase-316"><span class="linenos">316</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-317"><a href="#LinearMomentumBase-317"><span class="linenos">317</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-318"><a href="#LinearMomentumBase-318"><span class="linenos">318</span></a><span class="sd">        Sets :attr:`q_elems` by applying :attr:`grid.smoother` to nodal values.</span>
</span><span id="LinearMomentumBase-319"><a href="#LinearMomentumBase-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-320"><a href="#LinearMomentumBase-320"><span class="linenos">320</span></a>        <span class="n">stress</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase-321"><a href="#LinearMomentumBase-321"><span class="linenos">321</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LinearMomentumBase-322"><a href="#LinearMomentumBase-322"><span class="linenos">322</span></a>        <span class="n">I2</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span id="LinearMomentumBase-323"><a href="#LinearMomentumBase-323"><span class="linenos">323</span></a>        <span class="n">J2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">I2</span>
</span><span id="LinearMomentumBase-324"><a href="#LinearMomentumBase-324"><span class="linenos">324</span></a>        <span class="n">q_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">J2</span><span class="p">)</span>
</span><span id="LinearMomentumBase-325"><a href="#LinearMomentumBase-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_elems</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">smoother</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q_to</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="LinearMomentumBase-326"><a href="#LinearMomentumBase-326"><span class="linenos">326</span></a>
</span><span id="LinearMomentumBase-327"><a href="#LinearMomentumBase-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">compute_total_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentumBase-328"><a href="#LinearMomentumBase-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-329"><a href="#LinearMomentumBase-329"><span class="linenos">329</span></a><span class="sd">        Project total small-strain tensor to DG0 and return as torch.</span>
</span><span id="LinearMomentumBase-330"><a href="#LinearMomentumBase-330"><span class="linenos">330</span></a>
</span><span id="LinearMomentumBase-331"><a href="#LinearMomentumBase-331"><span class="linenos">331</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-332"><a href="#LinearMomentumBase-332"><span class="linenos">332</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-333"><a href="#LinearMomentumBase-333"><span class="linenos">333</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase-334"><a href="#LinearMomentumBase-334"><span class="linenos">334</span></a><span class="sd">            Total strain per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-335"><a href="#LinearMomentumBase-335"><span class="linenos">335</span></a>
</span><span id="LinearMomentumBase-336"><a href="#LinearMomentumBase-336"><span class="linenos">336</span></a><span class="sd">        Notes</span>
</span><span id="LinearMomentumBase-337"><a href="#LinearMomentumBase-337"><span class="linenos">337</span></a><span class="sd">        -----</span>
</span><span id="LinearMomentumBase-338"><a href="#LinearMomentumBase-338"><span class="linenos">338</span></a><span class="sd">        Uses :func:`project` on ``(u)``.</span>
</span><span id="LinearMomentumBase-339"><a href="#LinearMomentumBase-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-340"><a href="#LinearMomentumBase-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_tot</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentumBase-341"><a href="#LinearMomentumBase-341"><span class="linenos">341</span></a>        <span class="n">eps_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_tot</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase-342"><a href="#LinearMomentumBase-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="n">eps_to</span>
</span><span id="LinearMomentumBase-343"><a href="#LinearMomentumBase-343"><span class="linenos">343</span></a>
</span><span id="LinearMomentumBase-344"><a href="#LinearMomentumBase-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">compute_eps_th</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentumBase-345"><a href="#LinearMomentumBase-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-346"><a href="#LinearMomentumBase-346"><span class="linenos">346</span></a><span class="sd">        Compute element-wise thermal strain by aggregating thermoelastic elements.</span>
</span><span id="LinearMomentumBase-347"><a href="#LinearMomentumBase-347"><span class="linenos">347</span></a>
</span><span id="LinearMomentumBase-348"><a href="#LinearMomentumBase-348"><span class="linenos">348</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-349"><a href="#LinearMomentumBase-349"><span class="linenos">349</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-350"><a href="#LinearMomentumBase-350"><span class="linenos">350</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase-351"><a href="#LinearMomentumBase-351"><span class="linenos">351</span></a><span class="sd">            Thermal strain per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-352"><a href="#LinearMomentumBase-352"><span class="linenos">352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-353"><a href="#LinearMomentumBase-353"><span class="linenos">353</span></a>        <span class="n">eps_th</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase-354"><a href="#LinearMomentumBase-354"><span class="linenos">354</span></a>        <span class="n">deltaT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span>
</span><span id="LinearMomentumBase-355"><a href="#LinearMomentumBase-355"><span class="linenos">355</span></a>        <span class="k">for</span> <span class="n">elem_th</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_th</span><span class="p">:</span>
</span><span id="LinearMomentumBase-356"><a href="#LinearMomentumBase-356"><span class="linenos">356</span></a>        	<span class="n">elem_th</span><span class="o">.</span><span class="n">compute_eps_th</span><span class="p">(</span><span class="n">deltaT</span><span class="p">)</span>
</span><span id="LinearMomentumBase-357"><a href="#LinearMomentumBase-357"><span class="linenos">357</span></a>        	<span class="n">eps_th</span> <span class="o">+=</span> <span class="n">elem_th</span><span class="o">.</span><span class="n">eps_th</span>
</span><span id="LinearMomentumBase-358"><a href="#LinearMomentumBase-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="n">eps_th</span>
</span><span id="LinearMomentumBase-359"><a href="#LinearMomentumBase-359"><span class="linenos">359</span></a>
</span><span id="LinearMomentumBase-360"><a href="#LinearMomentumBase-360"><span class="linenos">360</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentumBase-361"><a href="#LinearMomentumBase-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-362"><a href="#LinearMomentumBase-362"><span class="linenos">362</span></a><span class="sd">        Compute predictor of non-elastic strain at the previous iteration k.</span>
</span><span id="LinearMomentumBase-363"><a href="#LinearMomentumBase-363"><span class="linenos">363</span></a>
</span><span id="LinearMomentumBase-364"><a href="#LinearMomentumBase-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-365"><a href="#LinearMomentumBase-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-366"><a href="#LinearMomentumBase-366"><span class="linenos">366</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase-367"><a href="#LinearMomentumBase-367"><span class="linenos">367</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase-368"><a href="#LinearMomentumBase-368"><span class="linenos">368</span></a>
</span><span id="LinearMomentumBase-369"><a href="#LinearMomentumBase-369"><span class="linenos">369</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-370"><a href="#LinearMomentumBase-370"><span class="linenos">370</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-371"><a href="#LinearMomentumBase-371"><span class="linenos">371</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase-372"><a href="#LinearMomentumBase-372"><span class="linenos">372</span></a><span class="sd">            Predicted non-elastic strain per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-373"><a href="#LinearMomentumBase-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-374"><a href="#LinearMomentumBase-374"><span class="linenos">374</span></a>        <span class="n">eps_ne_k</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase-375"><a href="#LinearMomentumBase-375"><span class="linenos">375</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase-376"><a href="#LinearMomentumBase-376"><span class="linenos">376</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_eps_ne_k</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))</span>
</span><span id="LinearMomentumBase-377"><a href="#LinearMomentumBase-377"><span class="linenos">377</span></a>        	<span class="n">eps_ne_k</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">eps_ne_k</span>
</span><span id="LinearMomentumBase-378"><a href="#LinearMomentumBase-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">eps_ne_k</span>
</span><span id="LinearMomentumBase-379"><a href="#LinearMomentumBase-379"><span class="linenos">379</span></a>
</span><span id="LinearMomentumBase-380"><a href="#LinearMomentumBase-380"><span class="linenos">380</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-381"><a href="#LinearMomentumBase-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-382"><a href="#LinearMomentumBase-382"><span class="linenos">382</span></a><span class="sd">        Update non-elastic strain rate for all non-elastic elements.</span>
</span><span id="LinearMomentumBase-383"><a href="#LinearMomentumBase-383"><span class="linenos">383</span></a>
</span><span id="LinearMomentumBase-384"><a href="#LinearMomentumBase-384"><span class="linenos">384</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-385"><a href="#LinearMomentumBase-385"><span class="linenos">385</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-386"><a href="#LinearMomentumBase-386"><span class="linenos">386</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="LinearMomentumBase-387"><a href="#LinearMomentumBase-387"><span class="linenos">387</span></a><span class="sd">            Stress per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-388"><a href="#LinearMomentumBase-388"><span class="linenos">388</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase-389"><a href="#LinearMomentumBase-389"><span class="linenos">389</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase-390"><a href="#LinearMomentumBase-390"><span class="linenos">390</span></a>
</span><span id="LinearMomentumBase-391"><a href="#LinearMomentumBase-391"><span class="linenos">391</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-392"><a href="#LinearMomentumBase-392"><span class="linenos">392</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-393"><a href="#LinearMomentumBase-393"><span class="linenos">393</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-394"><a href="#LinearMomentumBase-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-395"><a href="#LinearMomentumBase-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase-396"><a href="#LinearMomentumBase-396"><span class="linenos">396</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="LinearMomentumBase-397"><a href="#LinearMomentumBase-397"><span class="linenos">397</span></a>
</span><span id="LinearMomentumBase-398"><a href="#LinearMomentumBase-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_rate_old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-399"><a href="#LinearMomentumBase-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-400"><a href="#LinearMomentumBase-400"><span class="linenos">400</span></a><span class="sd">        Update non-elastic strain rate from the previous time step old.</span>
</span><span id="LinearMomentumBase-401"><a href="#LinearMomentumBase-401"><span class="linenos">401</span></a>
</span><span id="LinearMomentumBase-402"><a href="#LinearMomentumBase-402"><span class="linenos">402</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-403"><a href="#LinearMomentumBase-403"><span class="linenos">403</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-404"><a href="#LinearMomentumBase-404"><span class="linenos">404</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-405"><a href="#LinearMomentumBase-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-406"><a href="#LinearMomentumBase-406"><span class="linenos">406</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase-407"><a href="#LinearMomentumBase-407"><span class="linenos">407</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="LinearMomentumBase-408"><a href="#LinearMomentumBase-408"><span class="linenos">408</span></a>
</span><span id="LinearMomentumBase-409"><a href="#LinearMomentumBase-409"><span class="linenos">409</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-410"><a href="#LinearMomentumBase-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-411"><a href="#LinearMomentumBase-411"><span class="linenos">411</span></a><span class="sd">        Update non-elastic strain tensor from the previous time step old.</span>
</span><span id="LinearMomentumBase-412"><a href="#LinearMomentumBase-412"><span class="linenos">412</span></a>
</span><span id="LinearMomentumBase-413"><a href="#LinearMomentumBase-413"><span class="linenos">413</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-414"><a href="#LinearMomentumBase-414"><span class="linenos">414</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-415"><a href="#LinearMomentumBase-415"><span class="linenos">415</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="LinearMomentumBase-416"><a href="#LinearMomentumBase-416"><span class="linenos">416</span></a><span class="sd">            Stress at current iteration k+1, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-417"><a href="#LinearMomentumBase-417"><span class="linenos">417</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase-418"><a href="#LinearMomentumBase-418"><span class="linenos">418</span></a><span class="sd">            Stress from previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-419"><a href="#LinearMomentumBase-419"><span class="linenos">419</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase-420"><a href="#LinearMomentumBase-420"><span class="linenos">420</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase-421"><a href="#LinearMomentumBase-421"><span class="linenos">421</span></a>
</span><span id="LinearMomentumBase-422"><a href="#LinearMomentumBase-422"><span class="linenos">422</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-423"><a href="#LinearMomentumBase-423"><span class="linenos">423</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-424"><a href="#LinearMomentumBase-424"><span class="linenos">424</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-425"><a href="#LinearMomentumBase-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-426"><a href="#LinearMomentumBase-426"><span class="linenos">426</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase-427"><a href="#LinearMomentumBase-427"><span class="linenos">427</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">update_eps_ne_old</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))</span>
</span><span id="LinearMomentumBase-428"><a href="#LinearMomentumBase-428"><span class="linenos">428</span></a>
</span><span id="LinearMomentumBase-429"><a href="#LinearMomentumBase-429"><span class="linenos">429</span></a>    <span class="k">def</span> <span class="nf">increment_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-430"><a href="#LinearMomentumBase-430"><span class="linenos">430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-431"><a href="#LinearMomentumBase-431"><span class="linenos">431</span></a><span class="sd">        Increment material internal variables (e.g., hardening).</span>
</span><span id="LinearMomentumBase-432"><a href="#LinearMomentumBase-432"><span class="linenos">432</span></a>
</span><span id="LinearMomentumBase-433"><a href="#LinearMomentumBase-433"><span class="linenos">433</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-434"><a href="#LinearMomentumBase-434"><span class="linenos">434</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-435"><a href="#LinearMomentumBase-435"><span class="linenos">435</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="LinearMomentumBase-436"><a href="#LinearMomentumBase-436"><span class="linenos">436</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase-437"><a href="#LinearMomentumBase-437"><span class="linenos">437</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase-438"><a href="#LinearMomentumBase-438"><span class="linenos">438</span></a>
</span><span id="LinearMomentumBase-439"><a href="#LinearMomentumBase-439"><span class="linenos">439</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-440"><a href="#LinearMomentumBase-440"><span class="linenos">440</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-441"><a href="#LinearMomentumBase-441"><span class="linenos">441</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-442"><a href="#LinearMomentumBase-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-443"><a href="#LinearMomentumBase-443"><span class="linenos">443</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase-444"><a href="#LinearMomentumBase-444"><span class="linenos">444</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">increment_internal_variables</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="LinearMomentumBase-445"><a href="#LinearMomentumBase-445"><span class="linenos">445</span></a>
</span><span id="LinearMomentumBase-446"><a href="#LinearMomentumBase-446"><span class="linenos">446</span></a>    <span class="k">def</span> <span class="nf">update_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-447"><a href="#LinearMomentumBase-447"><span class="linenos">447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-448"><a href="#LinearMomentumBase-448"><span class="linenos">448</span></a><span class="sd">        Commit internal variables at the end of a time step.</span>
</span><span id="LinearMomentumBase-449"><a href="#LinearMomentumBase-449"><span class="linenos">449</span></a>
</span><span id="LinearMomentumBase-450"><a href="#LinearMomentumBase-450"><span class="linenos">450</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-451"><a href="#LinearMomentumBase-451"><span class="linenos">451</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-452"><a href="#LinearMomentumBase-452"><span class="linenos">452</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-453"><a href="#LinearMomentumBase-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-454"><a href="#LinearMomentumBase-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase-455"><a href="#LinearMomentumBase-455"><span class="linenos">455</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">update_internal_variables</span><span class="p">()</span>
</span><span id="LinearMomentumBase-456"><a href="#LinearMomentumBase-456"><span class="linenos">456</span></a>
</span><span id="LinearMomentumBase-457"><a href="#LinearMomentumBase-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">create_solution_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-458"><a href="#LinearMomentumBase-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-459"><a href="#LinearMomentumBase-459"><span class="linenos">459</span></a><span class="sd">        Allocate the solution function `X` in the primary space.</span>
</span><span id="LinearMomentumBase-460"><a href="#LinearMomentumBase-460"><span class="linenos">460</span></a>
</span><span id="LinearMomentumBase-461"><a href="#LinearMomentumBase-461"><span class="linenos">461</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-462"><a href="#LinearMomentumBase-462"><span class="linenos">462</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-463"><a href="#LinearMomentumBase-463"><span class="linenos">463</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-464"><a href="#LinearMomentumBase-464"><span class="linenos">464</span></a>
</span><span id="LinearMomentumBase-465"><a href="#LinearMomentumBase-465"><span class="linenos">465</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase-466"><a href="#LinearMomentumBase-466"><span class="linenos">466</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase-467"><a href="#LinearMomentumBase-467"><span class="linenos">467</span></a><span class="sd">        Sets :attr:`X` as a `dolfinx.fem.Function(self.V)`.</span>
</span><span id="LinearMomentumBase-468"><a href="#LinearMomentumBase-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-469"><a href="#LinearMomentumBase-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="LinearMomentumBase-470"><a href="#LinearMomentumBase-470"><span class="linenos">470</span></a>
</span><span id="LinearMomentumBase-471"><a href="#LinearMomentumBase-471"><span class="linenos">471</span></a>    <span class="k">def</span> <span class="nf">run_after_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-472"><a href="#LinearMomentumBase-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-473"><a href="#LinearMomentumBase-473"><span class="linenos">473</span></a><span class="sd">        Optional hook called after each linear solve.</span>
</span><span id="LinearMomentumBase-474"><a href="#LinearMomentumBase-474"><span class="linenos">474</span></a>
</span><span id="LinearMomentumBase-475"><a href="#LinearMomentumBase-475"><span class="linenos">475</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-476"><a href="#LinearMomentumBase-476"><span class="linenos">476</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-477"><a href="#LinearMomentumBase-477"><span class="linenos">477</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-478"><a href="#LinearMomentumBase-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-479"><a href="#LinearMomentumBase-479"><span class="linenos">479</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-480"><a href="#LinearMomentumBase-480"><span class="linenos">480</span></a>
</span><span id="LinearMomentumBase-481"><a href="#LinearMomentumBase-481"><span class="linenos">481</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-482"><a href="#LinearMomentumBase-482"><span class="linenos">482</span></a>    <span class="k">def</span> <span class="nf">compute_CT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase-483"><a href="#LinearMomentumBase-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-484"><a href="#LinearMomentumBase-484"><span class="linenos">484</span></a><span class="sd">        Build the consistent tangent operator (per element).</span>
</span><span id="LinearMomentumBase-485"><a href="#LinearMomentumBase-485"><span class="linenos">485</span></a>
</span><span id="LinearMomentumBase-486"><a href="#LinearMomentumBase-486"><span class="linenos">486</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-487"><a href="#LinearMomentumBase-487"><span class="linenos">487</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-488"><a href="#LinearMomentumBase-488"><span class="linenos">488</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase-489"><a href="#LinearMomentumBase-489"><span class="linenos">489</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase-490"><a href="#LinearMomentumBase-490"><span class="linenos">490</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase-491"><a href="#LinearMomentumBase-491"><span class="linenos">491</span></a><span class="sd">            Stress from previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-492"><a href="#LinearMomentumBase-492"><span class="linenos">492</span></a>
</span><span id="LinearMomentumBase-493"><a href="#LinearMomentumBase-493"><span class="linenos">493</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-494"><a href="#LinearMomentumBase-494"><span class="linenos">494</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-495"><a href="#LinearMomentumBase-495"><span class="linenos">495</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-496"><a href="#LinearMomentumBase-496"><span class="linenos">496</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-497"><a href="#LinearMomentumBase-497"><span class="linenos">497</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-498"><a href="#LinearMomentumBase-498"><span class="linenos">498</span></a>
</span><span id="LinearMomentumBase-499"><a href="#LinearMomentumBase-499"><span class="linenos">499</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-500"><a href="#LinearMomentumBase-500"><span class="linenos">500</span></a>    <span class="k">def</span> <span class="nf">compute_eps_rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">eps_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase-501"><a href="#LinearMomentumBase-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-502"><a href="#LinearMomentumBase-502"><span class="linenos">502</span></a><span class="sd">        Compute the right-hand-side strain term used in the linear form.</span>
</span><span id="LinearMomentumBase-503"><a href="#LinearMomentumBase-503"><span class="linenos">503</span></a>
</span><span id="LinearMomentumBase-504"><a href="#LinearMomentumBase-504"><span class="linenos">504</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-505"><a href="#LinearMomentumBase-505"><span class="linenos">505</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-506"><a href="#LinearMomentumBase-506"><span class="linenos">506</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase-507"><a href="#LinearMomentumBase-507"><span class="linenos">507</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase-508"><a href="#LinearMomentumBase-508"><span class="linenos">508</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase-509"><a href="#LinearMomentumBase-509"><span class="linenos">509</span></a><span class="sd">            Intermediate stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-510"><a href="#LinearMomentumBase-510"><span class="linenos">510</span></a><span class="sd">        eps_k : torch.Tensor</span>
</span><span id="LinearMomentumBase-511"><a href="#LinearMomentumBase-511"><span class="linenos">511</span></a><span class="sd">            Optional strain input for schemes that need it.</span>
</span><span id="LinearMomentumBase-512"><a href="#LinearMomentumBase-512"><span class="linenos">512</span></a>
</span><span id="LinearMomentumBase-513"><a href="#LinearMomentumBase-513"><span class="linenos">513</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-514"><a href="#LinearMomentumBase-514"><span class="linenos">514</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-515"><a href="#LinearMomentumBase-515"><span class="linenos">515</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-516"><a href="#LinearMomentumBase-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-517"><a href="#LinearMomentumBase-517"><span class="linenos">517</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-518"><a href="#LinearMomentumBase-518"><span class="linenos">518</span></a>
</span><span id="LinearMomentumBase-519"><a href="#LinearMomentumBase-519"><span class="linenos">519</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-520"><a href="#LinearMomentumBase-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">compute_elastic_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_e</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase-521"><a href="#LinearMomentumBase-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-522"><a href="#LinearMomentumBase-522"><span class="linenos">522</span></a><span class="sd">        Compute elastic stress from elastic strain using `C`.</span>
</span><span id="LinearMomentumBase-523"><a href="#LinearMomentumBase-523"><span class="linenos">523</span></a>
</span><span id="LinearMomentumBase-524"><a href="#LinearMomentumBase-524"><span class="linenos">524</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-525"><a href="#LinearMomentumBase-525"><span class="linenos">525</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-526"><a href="#LinearMomentumBase-526"><span class="linenos">526</span></a><span class="sd">        eps_e : torch.Tensor</span>
</span><span id="LinearMomentumBase-527"><a href="#LinearMomentumBase-527"><span class="linenos">527</span></a><span class="sd">            Elastic strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-528"><a href="#LinearMomentumBase-528"><span class="linenos">528</span></a>
</span><span id="LinearMomentumBase-529"><a href="#LinearMomentumBase-529"><span class="linenos">529</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-530"><a href="#LinearMomentumBase-530"><span class="linenos">530</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-531"><a href="#LinearMomentumBase-531"><span class="linenos">531</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase-532"><a href="#LinearMomentumBase-532"><span class="linenos">532</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-533"><a href="#LinearMomentumBase-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-534"><a href="#LinearMomentumBase-534"><span class="linenos">534</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-535"><a href="#LinearMomentumBase-535"><span class="linenos">535</span></a>
</span><span id="LinearMomentumBase-536"><a href="#LinearMomentumBase-536"><span class="linenos">536</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-537"><a href="#LinearMomentumBase-537"><span class="linenos">537</span></a>    <span class="k">def</span> <span class="nf">compute_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_tot</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">eps_rhs</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase-538"><a href="#LinearMomentumBase-538"><span class="linenos">538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-539"><a href="#LinearMomentumBase-539"><span class="linenos">539</span></a><span class="sd">        Compute stress from total strain and RHS strain (and optionally pressure).</span>
</span><span id="LinearMomentumBase-540"><a href="#LinearMomentumBase-540"><span class="linenos">540</span></a>
</span><span id="LinearMomentumBase-541"><a href="#LinearMomentumBase-541"><span class="linenos">541</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase-542"><a href="#LinearMomentumBase-542"><span class="linenos">542</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase-543"><a href="#LinearMomentumBase-543"><span class="linenos">543</span></a><span class="sd">        eps_tot : torch.Tensor</span>
</span><span id="LinearMomentumBase-544"><a href="#LinearMomentumBase-544"><span class="linenos">544</span></a><span class="sd">            Total strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-545"><a href="#LinearMomentumBase-545"><span class="linenos">545</span></a><span class="sd">        eps_rhs : torch.Tensor</span>
</span><span id="LinearMomentumBase-546"><a href="#LinearMomentumBase-546"><span class="linenos">546</span></a><span class="sd">            RHS strain term, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-547"><a href="#LinearMomentumBase-547"><span class="linenos">547</span></a><span class="sd">        p : torch.Tensor</span>
</span><span id="LinearMomentumBase-548"><a href="#LinearMomentumBase-548"><span class="linenos">548</span></a><span class="sd">            Optional pressure term.</span>
</span><span id="LinearMomentumBase-549"><a href="#LinearMomentumBase-549"><span class="linenos">549</span></a>
</span><span id="LinearMomentumBase-550"><a href="#LinearMomentumBase-550"><span class="linenos">550</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-551"><a href="#LinearMomentumBase-551"><span class="linenos">551</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-552"><a href="#LinearMomentumBase-552"><span class="linenos">552</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase-553"><a href="#LinearMomentumBase-553"><span class="linenos">553</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase-554"><a href="#LinearMomentumBase-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-555"><a href="#LinearMomentumBase-555"><span class="linenos">555</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-556"><a href="#LinearMomentumBase-556"><span class="linenos">556</span></a>
</span><span id="LinearMomentumBase-557"><a href="#LinearMomentumBase-557"><span class="linenos">557</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-558"><a href="#LinearMomentumBase-558"><span class="linenos">558</span></a>    <span class="k">def</span> <span class="nf">create_fenicsx_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-559"><a href="#LinearMomentumBase-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-560"><a href="#LinearMomentumBase-560"><span class="linenos">560</span></a><span class="sd">        Create FE functions specific to the concrete formulation.</span>
</span><span id="LinearMomentumBase-561"><a href="#LinearMomentumBase-561"><span class="linenos">561</span></a>
</span><span id="LinearMomentumBase-562"><a href="#LinearMomentumBase-562"><span class="linenos">562</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-563"><a href="#LinearMomentumBase-563"><span class="linenos">563</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-564"><a href="#LinearMomentumBase-564"><span class="linenos">564</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-565"><a href="#LinearMomentumBase-565"><span class="linenos">565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-566"><a href="#LinearMomentumBase-566"><span class="linenos">566</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-567"><a href="#LinearMomentumBase-567"><span class="linenos">567</span></a>
</span><span id="LinearMomentumBase-568"><a href="#LinearMomentumBase-568"><span class="linenos">568</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-569"><a href="#LinearMomentumBase-569"><span class="linenos">569</span></a>    <span class="k">def</span> <span class="nf">create_pytorch_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-570"><a href="#LinearMomentumBase-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-571"><a href="#LinearMomentumBase-571"><span class="linenos">571</span></a><span class="sd">        Create torch tensors specific to the concrete formulation.</span>
</span><span id="LinearMomentumBase-572"><a href="#LinearMomentumBase-572"><span class="linenos">572</span></a>
</span><span id="LinearMomentumBase-573"><a href="#LinearMomentumBase-573"><span class="linenos">573</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-574"><a href="#LinearMomentumBase-574"><span class="linenos">574</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-575"><a href="#LinearMomentumBase-575"><span class="linenos">575</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-576"><a href="#LinearMomentumBase-576"><span class="linenos">576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-577"><a href="#LinearMomentumBase-577"><span class="linenos">577</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-578"><a href="#LinearMomentumBase-578"><span class="linenos">578</span></a>
</span><span id="LinearMomentumBase-579"><a href="#LinearMomentumBase-579"><span class="linenos">579</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-580"><a href="#LinearMomentumBase-580"><span class="linenos">580</span></a>    <span class="k">def</span> <span class="nf">create_trial_test_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-581"><a href="#LinearMomentumBase-581"><span class="linenos">581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-582"><a href="#LinearMomentumBase-582"><span class="linenos">582</span></a><span class="sd">        Create UFL trial and test functions in the primary space.</span>
</span><span id="LinearMomentumBase-583"><a href="#LinearMomentumBase-583"><span class="linenos">583</span></a>
</span><span id="LinearMomentumBase-584"><a href="#LinearMomentumBase-584"><span class="linenos">584</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-585"><a href="#LinearMomentumBase-585"><span class="linenos">585</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-586"><a href="#LinearMomentumBase-586"><span class="linenos">586</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-587"><a href="#LinearMomentumBase-587"><span class="linenos">587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-588"><a href="#LinearMomentumBase-588"><span class="linenos">588</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-589"><a href="#LinearMomentumBase-589"><span class="linenos">589</span></a>
</span><span id="LinearMomentumBase-590"><a href="#LinearMomentumBase-590"><span class="linenos">590</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-591"><a href="#LinearMomentumBase-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">get_uV</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">:</span>
</span><span id="LinearMomentumBase-592"><a href="#LinearMomentumBase-592"><span class="linenos">592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-593"><a href="#LinearMomentumBase-593"><span class="linenos">593</span></a><span class="sd">        Return the primary function space for displacements.</span>
</span><span id="LinearMomentumBase-594"><a href="#LinearMomentumBase-594"><span class="linenos">594</span></a>
</span><span id="LinearMomentumBase-595"><a href="#LinearMomentumBase-595"><span class="linenos">595</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-596"><a href="#LinearMomentumBase-596"><span class="linenos">596</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-597"><a href="#LinearMomentumBase-597"><span class="linenos">597</span></a><span class="sd">        dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentumBase-598"><a href="#LinearMomentumBase-598"><span class="linenos">598</span></a><span class="sd">            Vector function space used for `u`.</span>
</span><span id="LinearMomentumBase-599"><a href="#LinearMomentumBase-599"><span class="linenos">599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-600"><a href="#LinearMomentumBase-600"><span class="linenos">600</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-601"><a href="#LinearMomentumBase-601"><span class="linenos">601</span></a>
</span><span id="LinearMomentumBase-602"><a href="#LinearMomentumBase-602"><span class="linenos">602</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-603"><a href="#LinearMomentumBase-603"><span class="linenos">603</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-604"><a href="#LinearMomentumBase-604"><span class="linenos">604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-605"><a href="#LinearMomentumBase-605"><span class="linenos">605</span></a><span class="sd">        Initialize FE fields from the material container.</span>
</span><span id="LinearMomentumBase-606"><a href="#LinearMomentumBase-606"><span class="linenos">606</span></a>
</span><span id="LinearMomentumBase-607"><a href="#LinearMomentumBase-607"><span class="linenos">607</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-608"><a href="#LinearMomentumBase-608"><span class="linenos">608</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-609"><a href="#LinearMomentumBase-609"><span class="linenos">609</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-610"><a href="#LinearMomentumBase-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-611"><a href="#LinearMomentumBase-611"><span class="linenos">611</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-612"><a href="#LinearMomentumBase-612"><span class="linenos">612</span></a>
</span><span id="LinearMomentumBase-613"><a href="#LinearMomentumBase-613"><span class="linenos">613</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-614"><a href="#LinearMomentumBase-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-615"><a href="#LinearMomentumBase-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-616"><a href="#LinearMomentumBase-616"><span class="linenos">616</span></a><span class="sd">        Assign the computed solution `X` to the primary field (e.g., `u`).</span>
</span><span id="LinearMomentumBase-617"><a href="#LinearMomentumBase-617"><span class="linenos">617</span></a>
</span><span id="LinearMomentumBase-618"><a href="#LinearMomentumBase-618"><span class="linenos">618</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-619"><a href="#LinearMomentumBase-619"><span class="linenos">619</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-620"><a href="#LinearMomentumBase-620"><span class="linenos">620</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-621"><a href="#LinearMomentumBase-621"><span class="linenos">621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-622"><a href="#LinearMomentumBase-622"><span class="linenos">622</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-623"><a href="#LinearMomentumBase-623"><span class="linenos">623</span></a>
</span><span id="LinearMomentumBase-624"><a href="#LinearMomentumBase-624"><span class="linenos">624</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-625"><a href="#LinearMomentumBase-625"><span class="linenos">625</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-626"><a href="#LinearMomentumBase-626"><span class="linenos">626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-627"><a href="#LinearMomentumBase-627"><span class="linenos">627</span></a><span class="sd">        Duplicate abstract declaration (kept for API compatibility).</span>
</span><span id="LinearMomentumBase-628"><a href="#LinearMomentumBase-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-629"><a href="#LinearMomentumBase-629"><span class="linenos">629</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-630"><a href="#LinearMomentumBase-630"><span class="linenos">630</span></a>
</span><span id="LinearMomentumBase-631"><a href="#LinearMomentumBase-631"><span class="linenos">631</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-632"><a href="#LinearMomentumBase-632"><span class="linenos">632</span></a>    <span class="k">def</span> <span class="nf">compute_p_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-633"><a href="#LinearMomentumBase-633"><span class="linenos">633</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-634"><a href="#LinearMomentumBase-634"><span class="linenos">634</span></a><span class="sd">        Compute nodal pressure (mean stress) from the stress field.</span>
</span><span id="LinearMomentumBase-635"><a href="#LinearMomentumBase-635"><span class="linenos">635</span></a>
</span><span id="LinearMomentumBase-636"><a href="#LinearMomentumBase-636"><span class="linenos">636</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-637"><a href="#LinearMomentumBase-637"><span class="linenos">637</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-638"><a href="#LinearMomentumBase-638"><span class="linenos">638</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-639"><a href="#LinearMomentumBase-639"><span class="linenos">639</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-640"><a href="#LinearMomentumBase-640"><span class="linenos">640</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-641"><a href="#LinearMomentumBase-641"><span class="linenos">641</span></a>
</span><span id="LinearMomentumBase-642"><a href="#LinearMomentumBase-642"><span class="linenos">642</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-643"><a href="#LinearMomentumBase-643"><span class="linenos">643</span></a>    <span class="k">def</span> <span class="nf">solve_elastic_response</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-644"><a href="#LinearMomentumBase-644"><span class="linenos">644</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-645"><a href="#LinearMomentumBase-645"><span class="linenos">645</span></a><span class="sd">        Solve the purely elastic problem (e.g., for initialization).</span>
</span><span id="LinearMomentumBase-646"><a href="#LinearMomentumBase-646"><span class="linenos">646</span></a>
</span><span id="LinearMomentumBase-647"><a href="#LinearMomentumBase-647"><span class="linenos">647</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-648"><a href="#LinearMomentumBase-648"><span class="linenos">648</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-649"><a href="#LinearMomentumBase-649"><span class="linenos">649</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-650"><a href="#LinearMomentumBase-650"><span class="linenos">650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-651"><a href="#LinearMomentumBase-651"><span class="linenos">651</span></a>        <span class="k">pass</span>
</span><span id="LinearMomentumBase-652"><a href="#LinearMomentumBase-652"><span class="linenos">652</span></a>
</span><span id="LinearMomentumBase-653"><a href="#LinearMomentumBase-653"><span class="linenos">653</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase-654"><a href="#LinearMomentumBase-654"><span class="linenos">654</span></a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase-655"><a href="#LinearMomentumBase-655"><span class="linenos">655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-656"><a href="#LinearMomentumBase-656"><span class="linenos">656</span></a><span class="sd">        Assemble and solve one step of the inelastic problem.</span>
</span><span id="LinearMomentumBase-657"><a href="#LinearMomentumBase-657"><span class="linenos">657</span></a>
</span><span id="LinearMomentumBase-658"><a href="#LinearMomentumBase-658"><span class="linenos">658</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase-659"><a href="#LinearMomentumBase-659"><span class="linenos">659</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase-660"><a href="#LinearMomentumBase-660"><span class="linenos">660</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase-661"><a href="#LinearMomentumBase-661"><span class="linenos">661</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase-662"><a href="#LinearMomentumBase-662"><span class="linenos">662</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base for a thermo-(visco)elastic linear momentum solver on a DOLFINx mesh.</p>

<p>Sets up common FE spaces, measures, and fields; provides utilities for
assembling body forces, computing invariants, and coordinating inelastic
elements via the <code><a href="#Material">Material</a></code> container. Concrete subclasses supply the
variational forms and solve routines.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>grid</strong> (GridHandlerGMSH):
Mesh/grid handler that provides the DOLFINx mesh and meshtags.</li>
<li><strong>theta</strong> (float):
Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>grid</strong> (GridHandlerGMSH):
Input grid handler.</li>
<li><strong>theta</strong> (float):
Time integration parameter.</li>
<li><strong>DG0_1, CG1_1</strong> (dolfinx.fem.FunctionSpace):
Scalar DG0 (per element) and CG1 (per node) spaces.</li>
<li><strong>CG1_3x1</strong> (dolfinx.fem.FunctionSpace):
Vector CG1 space of size equal to the spatial dimension.</li>
<li><strong>DG0_3x3, DG0_6x6</strong> (dolfinx.fem.FunctionSpace):
Tensor DG0 spaces for 33 and 66 (Voigt) fields.</li>
<li><strong>n_elems</strong> (int):
Number of local+ghost elements.</li>
<li><strong>n_nodes</strong> (int):
Number of local+ghost nodes.</li>
<li><strong>u</strong> (dolfinx.fem.Function):
Displacement field (vector).</li>
<li><strong>sig, eps_tot</strong> (dolfinx.fem.Function):
Stress and total strain (DG0 33 tensors).</li>
<li><strong>q_nodes, q_elems, p_nodes, p_elems</strong> (dolfinx.fem.Function):
Von Mises magnitude and pressure in node/element spaces.</li>
<li><strong>Temp, T0</strong> (torch.Tensor):
Current and reference temperatures per element, shape <code>(n_elems,)</code>.</li>
<li><strong>normal</strong> (ufl.core.expr.Expr):
Test-function-weighted outward normal used for Neumann terms.</li>
<li><strong>ds, dx</strong> (ufl.Measure):
Boundary and domain measures with subdomain data.</li>
<li><strong>X</strong> (dolfinx.fem.Function):
Solution vector (same space as <code>get_uV()()</code>).</li>
<li><strong>mat</strong> (Material):
Material container (set via <code><a href="#LinearMomentumBase.set_material">set_material()</a></code>).</li>
<li><strong>solver</strong> (petsc4py.PETSc.KSP):
PETSc linear solver (set via <code><a href="#LinearMomentumBase.set_solver">set_solver()</a></code>).</li>
<li><strong>bc</strong> (BcHandler):
Boundary-condition handler (set via <code><a href="#LinearMomentumBase.set_boundary_conditions">set_boundary_conditions()</a></code>).</li>
</ul>
</div>


                            <div id="LinearMomentumBase.grid" class="classattr">
                                <div class="attr variable">
            <span class="name">grid</span>

        
    </div>
    <a class="headerlink" href="#LinearMomentumBase.grid"></a>
    
    

                            </div>
                            <div id="LinearMomentumBase.theta" class="classattr">
                                <div class="attr variable">
            <span class="name">theta</span>

        
    </div>
    <a class="headerlink" href="#LinearMomentumBase.theta"></a>
    
    

                            </div>
                            <div id="LinearMomentumBase.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#LinearMomentumBase.n_elems"></a>
    
    

                            </div>
                            <div id="LinearMomentumBase.n_nodes" class="classattr">
                                <div class="attr variable">
            <span class="name">n_nodes</span>

        
    </div>
    <a class="headerlink" href="#LinearMomentumBase.n_nodes"></a>
    
    

                            </div>
                            <div id="LinearMomentumBase.commom_fields" class="classattr">
                                        <input id="LinearMomentumBase.commom_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">commom_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.commom_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.commom_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.commom_fields-104"><a href="#LinearMomentumBase.commom_fields-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">commom_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.commom_fields-105"><a href="#LinearMomentumBase.commom_fields-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.commom_fields-106"><a href="#LinearMomentumBase.commom_fields-106"><span class="linenos">106</span></a><span class="sd">        Allocate common storage for temperature, stresses, and strains.</span>
</span><span id="LinearMomentumBase.commom_fields-107"><a href="#LinearMomentumBase.commom_fields-107"><span class="linenos">107</span></a>
</span><span id="LinearMomentumBase.commom_fields-108"><a href="#LinearMomentumBase.commom_fields-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.commom_fields-109"><a href="#LinearMomentumBase.commom_fields-109"><span class="linenos">109</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.commom_fields-110"><a href="#LinearMomentumBase.commom_fields-110"><span class="linenos">110</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.commom_fields-111"><a href="#LinearMomentumBase.commom_fields-111"><span class="linenos">111</span></a>
</span><span id="LinearMomentumBase.commom_fields-112"><a href="#LinearMomentumBase.commom_fields-112"><span class="linenos">112</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.commom_fields-113"><a href="#LinearMomentumBase.commom_fields-113"><span class="linenos">113</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.commom_fields-114"><a href="#LinearMomentumBase.commom_fields-114"><span class="linenos">114</span></a><span class="sd">        Initializes tensors/functions:</span>
</span><span id="LinearMomentumBase.commom_fields-115"><a href="#LinearMomentumBase.commom_fields-115"><span class="linenos">115</span></a><span class="sd">        `T0`, `Temp`, `sig`, `eps_tot`, `u`, `q_elems`, `q_nodes`, `p_elems`, `p_nodes`.</span>
</span><span id="LinearMomentumBase.commom_fields-116"><a href="#LinearMomentumBase.commom_fields-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.commom_fields-117"><a href="#LinearMomentumBase.commom_fields-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-118"><a href="#LinearMomentumBase.commom_fields-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-119"><a href="#LinearMomentumBase.commom_fields-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-120"><a href="#LinearMomentumBase.commom_fields-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_tot</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-121"><a href="#LinearMomentumBase.commom_fields-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_3x1</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-122"><a href="#LinearMomentumBase.commom_fields-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_elems</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-123"><a href="#LinearMomentumBase.commom_fields-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_nodes</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-124"><a href="#LinearMomentumBase.commom_fields-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_elems</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase.commom_fields-125"><a href="#LinearMomentumBase.commom_fields-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_nodes</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Allocate common storage for temperature, stresses, and strains.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Initializes tensors/functions:
<code>T0</code>, <code>Temp</code>, <code>sig</code>, <code>eps_tot</code>, <code>u</code>, <code>q_elems</code>, <code>q_nodes</code>, <code>p_elems</code>, <code>p_nodes</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.set_material" class="classattr">
                                        <input id="LinearMomentumBase.set_material-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_material</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">material</span><span class="p">:</span> <span class="n"><a href="#Material">Material</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.set_material-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.set_material"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.set_material-127"><a href="#LinearMomentumBase.set_material-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">set_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">Material</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.set_material-128"><a href="#LinearMomentumBase.set_material-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_material-129"><a href="#LinearMomentumBase.set_material-129"><span class="linenos">129</span></a><span class="sd">        Attach a material model and initialize FE fields from it.</span>
</span><span id="LinearMomentumBase.set_material-130"><a href="#LinearMomentumBase.set_material-130"><span class="linenos">130</span></a>
</span><span id="LinearMomentumBase.set_material-131"><a href="#LinearMomentumBase.set_material-131"><span class="linenos">131</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.set_material-132"><a href="#LinearMomentumBase.set_material-132"><span class="linenos">132</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.set_material-133"><a href="#LinearMomentumBase.set_material-133"><span class="linenos">133</span></a><span class="sd">        material : Material</span>
</span><span id="LinearMomentumBase.set_material-134"><a href="#LinearMomentumBase.set_material-134"><span class="linenos">134</span></a><span class="sd">            Material container with elastic and non-elastic elements.</span>
</span><span id="LinearMomentumBase.set_material-135"><a href="#LinearMomentumBase.set_material-135"><span class="linenos">135</span></a>
</span><span id="LinearMomentumBase.set_material-136"><a href="#LinearMomentumBase.set_material-136"><span class="linenos">136</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.set_material-137"><a href="#LinearMomentumBase.set_material-137"><span class="linenos">137</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.set_material-138"><a href="#LinearMomentumBase.set_material-138"><span class="linenos">138</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.set_material-139"><a href="#LinearMomentumBase.set_material-139"><span class="linenos">139</span></a>
</span><span id="LinearMomentumBase.set_material-140"><a href="#LinearMomentumBase.set_material-140"><span class="linenos">140</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.set_material-141"><a href="#LinearMomentumBase.set_material-141"><span class="linenos">141</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.set_material-142"><a href="#LinearMomentumBase.set_material-142"><span class="linenos">142</span></a><span class="sd">        Calls :meth:`initialize`.</span>
</span><span id="LinearMomentumBase.set_material-143"><a href="#LinearMomentumBase.set_material-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_material-144"><a href="#LinearMomentumBase.set_material-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">material</span>
</span><span id="LinearMomentumBase.set_material-145"><a href="#LinearMomentumBase.set_material-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Attach a material model and initialize FE fields from it.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>material</strong> (Material):
Material container with elastic and non-elastic elements.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Calls <code><a href="#LinearMomentumBase.initialize">initialize()</a></code>.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.set_T" class="classattr">
                                        <input id="LinearMomentumBase.set_T-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_T</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">T</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.set_T-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.set_T"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.set_T-147"><a href="#LinearMomentumBase.set_T-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">set_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.set_T-148"><a href="#LinearMomentumBase.set_T-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_T-149"><a href="#LinearMomentumBase.set_T-149"><span class="linenos">149</span></a><span class="sd">        Set the current element-wise temperature.</span>
</span><span id="LinearMomentumBase.set_T-150"><a href="#LinearMomentumBase.set_T-150"><span class="linenos">150</span></a>
</span><span id="LinearMomentumBase.set_T-151"><a href="#LinearMomentumBase.set_T-151"><span class="linenos">151</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.set_T-152"><a href="#LinearMomentumBase.set_T-152"><span class="linenos">152</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.set_T-153"><a href="#LinearMomentumBase.set_T-153"><span class="linenos">153</span></a><span class="sd">        T : torch.Tensor</span>
</span><span id="LinearMomentumBase.set_T-154"><a href="#LinearMomentumBase.set_T-154"><span class="linenos">154</span></a><span class="sd">            Temperature per element, shape ``(n_elems,)``.</span>
</span><span id="LinearMomentumBase.set_T-155"><a href="#LinearMomentumBase.set_T-155"><span class="linenos">155</span></a>
</span><span id="LinearMomentumBase.set_T-156"><a href="#LinearMomentumBase.set_T-156"><span class="linenos">156</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.set_T-157"><a href="#LinearMomentumBase.set_T-157"><span class="linenos">157</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.set_T-158"><a href="#LinearMomentumBase.set_T-158"><span class="linenos">158</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.set_T-159"><a href="#LinearMomentumBase.set_T-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_T-160"><a href="#LinearMomentumBase.set_T-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span> <span class="o">=</span> <span class="n">T</span>
</span></pre></div>


            <div class="docstring"><p>Set the current element-wise temperature.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>T</strong> (torch.Tensor):
Temperature per element, shape <code>(n_elems,)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.set_T0" class="classattr">
                                        <input id="LinearMomentumBase.set_T0-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_T0</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">T0</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.set_T0-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.set_T0"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.set_T0-162"><a href="#LinearMomentumBase.set_T0-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">set_T0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T0</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.set_T0-163"><a href="#LinearMomentumBase.set_T0-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_T0-164"><a href="#LinearMomentumBase.set_T0-164"><span class="linenos">164</span></a><span class="sd">        Set the reference element-wise temperature.</span>
</span><span id="LinearMomentumBase.set_T0-165"><a href="#LinearMomentumBase.set_T0-165"><span class="linenos">165</span></a>
</span><span id="LinearMomentumBase.set_T0-166"><a href="#LinearMomentumBase.set_T0-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.set_T0-167"><a href="#LinearMomentumBase.set_T0-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.set_T0-168"><a href="#LinearMomentumBase.set_T0-168"><span class="linenos">168</span></a><span class="sd">        T0 : torch.Tensor</span>
</span><span id="LinearMomentumBase.set_T0-169"><a href="#LinearMomentumBase.set_T0-169"><span class="linenos">169</span></a><span class="sd">            Reference temperature per element, shape ``(n_elems,)``.</span>
</span><span id="LinearMomentumBase.set_T0-170"><a href="#LinearMomentumBase.set_T0-170"><span class="linenos">170</span></a>
</span><span id="LinearMomentumBase.set_T0-171"><a href="#LinearMomentumBase.set_T0-171"><span class="linenos">171</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.set_T0-172"><a href="#LinearMomentumBase.set_T0-172"><span class="linenos">172</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.set_T0-173"><a href="#LinearMomentumBase.set_T0-173"><span class="linenos">173</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.set_T0-174"><a href="#LinearMomentumBase.set_T0-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_T0-175"><a href="#LinearMomentumBase.set_T0-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">T0</span>
</span></pre></div>


            <div class="docstring"><p>Set the reference element-wise temperature.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>T0</strong> (torch.Tensor):
Reference temperature per element, shape <code>(n_elems,)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.set_solver" class="classattr">
                                        <input id="LinearMomentumBase.set_solver-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_solver</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">solver</span><span class="p">:</span> <span class="n">petsc4py</span><span class="o">.</span><span class="n">PETSc</span><span class="o">.</span><span class="n">KSP</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.set_solver-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.set_solver"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.set_solver-177"><a href="#LinearMomentumBase.set_solver-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">KSP</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.set_solver-178"><a href="#LinearMomentumBase.set_solver-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_solver-179"><a href="#LinearMomentumBase.set_solver-179"><span class="linenos">179</span></a><span class="sd">        Set the PETSc linear solver.</span>
</span><span id="LinearMomentumBase.set_solver-180"><a href="#LinearMomentumBase.set_solver-180"><span class="linenos">180</span></a>
</span><span id="LinearMomentumBase.set_solver-181"><a href="#LinearMomentumBase.set_solver-181"><span class="linenos">181</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.set_solver-182"><a href="#LinearMomentumBase.set_solver-182"><span class="linenos">182</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.set_solver-183"><a href="#LinearMomentumBase.set_solver-183"><span class="linenos">183</span></a><span class="sd">        solver : petsc4py.PETSc.KSP</span>
</span><span id="LinearMomentumBase.set_solver-184"><a href="#LinearMomentumBase.set_solver-184"><span class="linenos">184</span></a><span class="sd">            Preconfigured Krylov solver.</span>
</span><span id="LinearMomentumBase.set_solver-185"><a href="#LinearMomentumBase.set_solver-185"><span class="linenos">185</span></a>
</span><span id="LinearMomentumBase.set_solver-186"><a href="#LinearMomentumBase.set_solver-186"><span class="linenos">186</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.set_solver-187"><a href="#LinearMomentumBase.set_solver-187"><span class="linenos">187</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.set_solver-188"><a href="#LinearMomentumBase.set_solver-188"><span class="linenos">188</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.set_solver-189"><a href="#LinearMomentumBase.set_solver-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_solver-190"><a href="#LinearMomentumBase.set_solver-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
</span></pre></div>


            <div class="docstring"><p>Set the PETSc linear solver.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>solver</strong> (petsc4py.PETSc.KSP):
Preconfigured Krylov solver.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.set_boundary_conditions" class="classattr">
                                        <input id="LinearMomentumBase.set_boundary_conditions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_boundary_conditions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">bc</span><span class="p">:</span> <span class="s1">&#39;BcHandler&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.set_boundary_conditions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.set_boundary_conditions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.set_boundary_conditions-192"><a href="#LinearMomentumBase.set_boundary_conditions-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">set_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">BcHandler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-193"><a href="#LinearMomentumBase.set_boundary_conditions-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-194"><a href="#LinearMomentumBase.set_boundary_conditions-194"><span class="linenos">194</span></a><span class="sd">        Set the boundary-condition handler.</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-195"><a href="#LinearMomentumBase.set_boundary_conditions-195"><span class="linenos">195</span></a>
</span><span id="LinearMomentumBase.set_boundary_conditions-196"><a href="#LinearMomentumBase.set_boundary_conditions-196"><span class="linenos">196</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-197"><a href="#LinearMomentumBase.set_boundary_conditions-197"><span class="linenos">197</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-198"><a href="#LinearMomentumBase.set_boundary_conditions-198"><span class="linenos">198</span></a><span class="sd">        bc : BcHandler</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-199"><a href="#LinearMomentumBase.set_boundary_conditions-199"><span class="linenos">199</span></a><span class="sd">            Handler providing Dirichlet/Neumann terms and updates.</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-200"><a href="#LinearMomentumBase.set_boundary_conditions-200"><span class="linenos">200</span></a>
</span><span id="LinearMomentumBase.set_boundary_conditions-201"><a href="#LinearMomentumBase.set_boundary_conditions-201"><span class="linenos">201</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-202"><a href="#LinearMomentumBase.set_boundary_conditions-202"><span class="linenos">202</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-203"><a href="#LinearMomentumBase.set_boundary_conditions-203"><span class="linenos">203</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-204"><a href="#LinearMomentumBase.set_boundary_conditions-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.set_boundary_conditions-205"><a href="#LinearMomentumBase.set_boundary_conditions-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span>
</span></pre></div>


            <div class="docstring"><p>Set the boundary-condition handler.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>bc</strong> (BcHandler):
Handler providing Dirichlet/Neumann terms and updates.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_function_spaces" class="classattr">
                                        <input id="LinearMomentumBase.create_function_spaces-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_function_spaces</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_function_spaces-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_function_spaces"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_function_spaces-207"><a href="#LinearMomentumBase.create_function_spaces-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">create_function_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_function_spaces-208"><a href="#LinearMomentumBase.create_function_spaces-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_function_spaces-209"><a href="#LinearMomentumBase.create_function_spaces-209"><span class="linenos">209</span></a><span class="sd">        Create function spaces used by the formulation.</span>
</span><span id="LinearMomentumBase.create_function_spaces-210"><a href="#LinearMomentumBase.create_function_spaces-210"><span class="linenos">210</span></a>
</span><span id="LinearMomentumBase.create_function_spaces-211"><a href="#LinearMomentumBase.create_function_spaces-211"><span class="linenos">211</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_function_spaces-212"><a href="#LinearMomentumBase.create_function_spaces-212"><span class="linenos">212</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_function_spaces-213"><a href="#LinearMomentumBase.create_function_spaces-213"><span class="linenos">213</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_function_spaces-214"><a href="#LinearMomentumBase.create_function_spaces-214"><span class="linenos">214</span></a>
</span><span id="LinearMomentumBase.create_function_spaces-215"><a href="#LinearMomentumBase.create_function_spaces-215"><span class="linenos">215</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.create_function_spaces-216"><a href="#LinearMomentumBase.create_function_spaces-216"><span class="linenos">216</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.create_function_spaces-217"><a href="#LinearMomentumBase.create_function_spaces-217"><span class="linenos">217</span></a><span class="sd">        Defines :attr:`CG1_3x1`, :attr:`DG0_1`, :attr:`CG1_1`,</span>
</span><span id="LinearMomentumBase.create_function_spaces-218"><a href="#LinearMomentumBase.create_function_spaces-218"><span class="linenos">218</span></a><span class="sd">        :attr:`DG0_3x3`, and :attr:`DG0_6x6`.</span>
</span><span id="LinearMomentumBase.create_function_spaces-219"><a href="#LinearMomentumBase.create_function_spaces-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_function_spaces-220"><a href="#LinearMomentumBase.create_function_spaces-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CG1_3x1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">domain_dim</span><span class="p">,</span> <span class="p">)))</span>
</span><span id="LinearMomentumBase.create_function_spaces-221"><a href="#LinearMomentumBase.create_function_spaces-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="LinearMomentumBase.create_function_spaces-222"><a href="#LinearMomentumBase.create_function_spaces-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CG1_1</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="LinearMomentumBase.create_function_spaces-223"><a href="#LinearMomentumBase.create_function_spaces-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase.create_function_spaces-224"><a href="#LinearMomentumBase.create_function_spaces-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DG0_6x6</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Create function spaces used by the formulation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>CG1_3x1</code>, <code>DG0_1</code>, <code>CG1_1</code>,
<code>DG0_3x3</code>, and <code>DG0_6x6</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_ds_dx" class="classattr">
                                        <input id="LinearMomentumBase.create_ds_dx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_ds_dx</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_ds_dx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_ds_dx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_ds_dx-226"><a href="#LinearMomentumBase.create_ds_dx-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">create_ds_dx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_ds_dx-227"><a href="#LinearMomentumBase.create_ds_dx-227"><span class="linenos">227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_ds_dx-228"><a href="#LinearMomentumBase.create_ds_dx-228"><span class="linenos">228</span></a><span class="sd">        Create boundary and domain measures with subdomain data.</span>
</span><span id="LinearMomentumBase.create_ds_dx-229"><a href="#LinearMomentumBase.create_ds_dx-229"><span class="linenos">229</span></a>
</span><span id="LinearMomentumBase.create_ds_dx-230"><a href="#LinearMomentumBase.create_ds_dx-230"><span class="linenos">230</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_ds_dx-231"><a href="#LinearMomentumBase.create_ds_dx-231"><span class="linenos">231</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_ds_dx-232"><a href="#LinearMomentumBase.create_ds_dx-232"><span class="linenos">232</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_ds_dx-233"><a href="#LinearMomentumBase.create_ds_dx-233"><span class="linenos">233</span></a>
</span><span id="LinearMomentumBase.create_ds_dx-234"><a href="#LinearMomentumBase.create_ds_dx-234"><span class="linenos">234</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.create_ds_dx-235"><a href="#LinearMomentumBase.create_ds_dx-235"><span class="linenos">235</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.create_ds_dx-236"><a href="#LinearMomentumBase.create_ds_dx-236"><span class="linenos">236</span></a><span class="sd">        Defines :attr:`ds` and :attr:`dx` from grid meshtags.</span>
</span><span id="LinearMomentumBase.create_ds_dx-237"><a href="#LinearMomentumBase.create_ds_dx-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_ds_dx-238"><a href="#LinearMomentumBase.create_ds_dx-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_boundaries</span><span class="p">())</span>
</span><span id="LinearMomentumBase.create_ds_dx-239"><a href="#LinearMomentumBase.create_ds_dx-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_subdomains</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Create boundary and domain measures with subdomain data.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>ds</code> and <code>dx</code> from grid meshtags.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_normal" class="classattr">
                                        <input id="LinearMomentumBase.create_normal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_normal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_normal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_normal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_normal-241"><a href="#LinearMomentumBase.create_normal-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">create_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_normal-242"><a href="#LinearMomentumBase.create_normal-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_normal-243"><a href="#LinearMomentumBase.create_normal-243"><span class="linenos">243</span></a><span class="sd">        Create a test-function-weighted outward normal for surface terms.</span>
</span><span id="LinearMomentumBase.create_normal-244"><a href="#LinearMomentumBase.create_normal-244"><span class="linenos">244</span></a>
</span><span id="LinearMomentumBase.create_normal-245"><a href="#LinearMomentumBase.create_normal-245"><span class="linenos">245</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_normal-246"><a href="#LinearMomentumBase.create_normal-246"><span class="linenos">246</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_normal-247"><a href="#LinearMomentumBase.create_normal-247"><span class="linenos">247</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_normal-248"><a href="#LinearMomentumBase.create_normal-248"><span class="linenos">248</span></a>
</span><span id="LinearMomentumBase.create_normal-249"><a href="#LinearMomentumBase.create_normal-249"><span class="linenos">249</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.create_normal-250"><a href="#LinearMomentumBase.create_normal-250"><span class="linenos">250</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.create_normal-251"><a href="#LinearMomentumBase.create_normal-251"><span class="linenos">251</span></a><span class="sd">        Defines :attr:`normal` as ``dot(FacetNormal(mesh), self.u_)``.</span>
</span><span id="LinearMomentumBase.create_normal-252"><a href="#LinearMomentumBase.create_normal-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_normal-253"><a href="#LinearMomentumBase.create_normal-253"><span class="linenos">253</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">FacetNormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="LinearMomentumBase.create_normal-254"><a href="#LinearMomentumBase.create_normal-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a test-function-weighted outward normal for surface terms.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>normal</code> as <code>dot(FacetNormal(mesh), self.u_)</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.build_body_force" class="classattr">
                                        <input id="LinearMomentumBase.build_body_force-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_body_force</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">g</span><span class="p">:</span> <span class="nb">list</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.build_body_force-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.build_body_force"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.build_body_force-256"><a href="#LinearMomentumBase.build_body_force-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">build_body_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.build_body_force-257"><a href="#LinearMomentumBase.build_body_force-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.build_body_force-258"><a href="#LinearMomentumBase.build_body_force-258"><span class="linenos">258</span></a><span class="sd">        Build the body-force linear form ``  g  u_ dx``.</span>
</span><span id="LinearMomentumBase.build_body_force-259"><a href="#LinearMomentumBase.build_body_force-259"><span class="linenos">259</span></a>
</span><span id="LinearMomentumBase.build_body_force-260"><a href="#LinearMomentumBase.build_body_force-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.build_body_force-261"><a href="#LinearMomentumBase.build_body_force-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.build_body_force-262"><a href="#LinearMomentumBase.build_body_force-262"><span class="linenos">262</span></a><span class="sd">        g : list of float</span>
</span><span id="LinearMomentumBase.build_body_force-263"><a href="#LinearMomentumBase.build_body_force-263"><span class="linenos">263</span></a><span class="sd">            Gravity/body acceleration vector components.</span>
</span><span id="LinearMomentumBase.build_body_force-264"><a href="#LinearMomentumBase.build_body_force-264"><span class="linenos">264</span></a>
</span><span id="LinearMomentumBase.build_body_force-265"><a href="#LinearMomentumBase.build_body_force-265"><span class="linenos">265</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.build_body_force-266"><a href="#LinearMomentumBase.build_body_force-266"><span class="linenos">266</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.build_body_force-267"><a href="#LinearMomentumBase.build_body_force-267"><span class="linenos">267</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.build_body_force-268"><a href="#LinearMomentumBase.build_body_force-268"><span class="linenos">268</span></a>
</span><span id="LinearMomentumBase.build_body_force-269"><a href="#LinearMomentumBase.build_body_force-269"><span class="linenos">269</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.build_body_force-270"><a href="#LinearMomentumBase.build_body_force-270"><span class="linenos">270</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.build_body_force-271"><a href="#LinearMomentumBase.build_body_force-271"><span class="linenos">271</span></a><span class="sd">        Defines :attr:`b_body` as a UFL form for the right-hand side.</span>
</span><span id="LinearMomentumBase.build_body_force-272"><a href="#LinearMomentumBase.build_body_force-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.build_body_force-273"><a href="#LinearMomentumBase.build_body_force-273"><span class="linenos">273</span></a>        <span class="n">density</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_1</span><span class="p">)</span>
</span><span id="LinearMomentumBase.build_body_force-274"><a href="#LinearMomentumBase.build_body_force-274"><span class="linenos">274</span></a>        <span class="n">density</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">density</span>
</span><span id="LinearMomentumBase.build_body_force-275"><a href="#LinearMomentumBase.build_body_force-275"><span class="linenos">275</span></a>        <span class="n">body_force</span> <span class="o">=</span> <span class="n">density</span><span class="o">*</span><span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">do</span><span class="o">.</span><span class="n">default_scalar_type</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">g</span><span class="p">)))</span>
</span><span id="LinearMomentumBase.build_body_force-276"><a href="#LinearMomentumBase.build_body_force-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">b_body</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">body_force</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span></pre></div>


            <div class="docstring"><p>Build the body-force linear form <code>  g  u_ dx</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>g</strong> (list of float):
Gravity/body acceleration vector components.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>b_body</code> as a UFL form for the right-hand side.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_q_nodes" class="classattr">
                                        <input id="LinearMomentumBase.compute_q_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_q_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_q_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_q_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_q_nodes-288"><a href="#LinearMomentumBase.compute_q_nodes-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">compute_q_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_q_nodes-289"><a href="#LinearMomentumBase.compute_q_nodes-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_q_nodes-290"><a href="#LinearMomentumBase.compute_q_nodes-290"><span class="linenos">290</span></a><span class="sd">        Compute von Mises equivalent stress and smooth it to nodes.</span>
</span><span id="LinearMomentumBase.compute_q_nodes-291"><a href="#LinearMomentumBase.compute_q_nodes-291"><span class="linenos">291</span></a>
</span><span id="LinearMomentumBase.compute_q_nodes-292"><a href="#LinearMomentumBase.compute_q_nodes-292"><span class="linenos">292</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_q_nodes-293"><a href="#LinearMomentumBase.compute_q_nodes-293"><span class="linenos">293</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_q_nodes-294"><a href="#LinearMomentumBase.compute_q_nodes-294"><span class="linenos">294</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.compute_q_nodes-295"><a href="#LinearMomentumBase.compute_q_nodes-295"><span class="linenos">295</span></a>
</span><span id="LinearMomentumBase.compute_q_nodes-296"><a href="#LinearMomentumBase.compute_q_nodes-296"><span class="linenos">296</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.compute_q_nodes-297"><a href="#LinearMomentumBase.compute_q_nodes-297"><span class="linenos">297</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.compute_q_nodes-298"><a href="#LinearMomentumBase.compute_q_nodes-298"><span class="linenos">298</span></a><span class="sd">        Sets :attr:`q_nodes` by applying a node-element averaging matrix</span>
</span><span id="LinearMomentumBase.compute_q_nodes-299"><a href="#LinearMomentumBase.compute_q_nodes-299"><span class="linenos">299</span></a><span class="sd">        (:attr:`grid.A_csr`) to the element-wise von Mises values.</span>
</span><span id="LinearMomentumBase.compute_q_nodes-300"><a href="#LinearMomentumBase.compute_q_nodes-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_q_nodes-301"><a href="#LinearMomentumBase.compute_q_nodes-301"><span class="linenos">301</span></a>        <span class="n">stress</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase.compute_q_nodes-302"><a href="#LinearMomentumBase.compute_q_nodes-302"><span class="linenos">302</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LinearMomentumBase.compute_q_nodes-303"><a href="#LinearMomentumBase.compute_q_nodes-303"><span class="linenos">303</span></a>        <span class="n">I2</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span id="LinearMomentumBase.compute_q_nodes-304"><a href="#LinearMomentumBase.compute_q_nodes-304"><span class="linenos">304</span></a>        <span class="n">J2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">I2</span>
</span><span id="LinearMomentumBase.compute_q_nodes-305"><a href="#LinearMomentumBase.compute_q_nodes-305"><span class="linenos">305</span></a>        <span class="n">q_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">J2</span><span class="p">)</span>
</span><span id="LinearMomentumBase.compute_q_nodes-306"><a href="#LinearMomentumBase.compute_q_nodes-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_nodes</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">A_csr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q_to</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Compute von Mises equivalent stress and smooth it to nodes.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>q_nodes</code> by applying a node-element averaging matrix
(<code>grid.A_csr</code>) to the element-wise von Mises values.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_q_elems" class="classattr">
                                        <input id="LinearMomentumBase.compute_q_elems-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_q_elems</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_q_elems-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_q_elems"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_q_elems-308"><a href="#LinearMomentumBase.compute_q_elems-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">compute_q_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_q_elems-309"><a href="#LinearMomentumBase.compute_q_elems-309"><span class="linenos">309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_q_elems-310"><a href="#LinearMomentumBase.compute_q_elems-310"><span class="linenos">310</span></a><span class="sd">        Compute von Mises equivalent stress and smooth it to elements.</span>
</span><span id="LinearMomentumBase.compute_q_elems-311"><a href="#LinearMomentumBase.compute_q_elems-311"><span class="linenos">311</span></a>
</span><span id="LinearMomentumBase.compute_q_elems-312"><a href="#LinearMomentumBase.compute_q_elems-312"><span class="linenos">312</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_q_elems-313"><a href="#LinearMomentumBase.compute_q_elems-313"><span class="linenos">313</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_q_elems-314"><a href="#LinearMomentumBase.compute_q_elems-314"><span class="linenos">314</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.compute_q_elems-315"><a href="#LinearMomentumBase.compute_q_elems-315"><span class="linenos">315</span></a>
</span><span id="LinearMomentumBase.compute_q_elems-316"><a href="#LinearMomentumBase.compute_q_elems-316"><span class="linenos">316</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.compute_q_elems-317"><a href="#LinearMomentumBase.compute_q_elems-317"><span class="linenos">317</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.compute_q_elems-318"><a href="#LinearMomentumBase.compute_q_elems-318"><span class="linenos">318</span></a><span class="sd">        Sets :attr:`q_elems` by applying :attr:`grid.smoother` to nodal values.</span>
</span><span id="LinearMomentumBase.compute_q_elems-319"><a href="#LinearMomentumBase.compute_q_elems-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_q_elems-320"><a href="#LinearMomentumBase.compute_q_elems-320"><span class="linenos">320</span></a>        <span class="n">stress</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase.compute_q_elems-321"><a href="#LinearMomentumBase.compute_q_elems-321"><span class="linenos">321</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LinearMomentumBase.compute_q_elems-322"><a href="#LinearMomentumBase.compute_q_elems-322"><span class="linenos">322</span></a>        <span class="n">I2</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span id="LinearMomentumBase.compute_q_elems-323"><a href="#LinearMomentumBase.compute_q_elems-323"><span class="linenos">323</span></a>        <span class="n">J2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">I2</span>
</span><span id="LinearMomentumBase.compute_q_elems-324"><a href="#LinearMomentumBase.compute_q_elems-324"><span class="linenos">324</span></a>        <span class="n">q_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">J2</span><span class="p">)</span>
</span><span id="LinearMomentumBase.compute_q_elems-325"><a href="#LinearMomentumBase.compute_q_elems-325"><span class="linenos">325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q_elems</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">smoother</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q_to</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Compute von Mises equivalent stress and smooth it to elements.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>q_elems</code> by applying <code>grid.smoother</code> to nodal values.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_total_strain" class="classattr">
                                        <input id="LinearMomentumBase.compute_total_strain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_total_strain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_total_strain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_total_strain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_total_strain-327"><a href="#LinearMomentumBase.compute_total_strain-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">compute_total_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_total_strain-328"><a href="#LinearMomentumBase.compute_total_strain-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_total_strain-329"><a href="#LinearMomentumBase.compute_total_strain-329"><span class="linenos">329</span></a><span class="sd">        Project total small-strain tensor to DG0 and return as torch.</span>
</span><span id="LinearMomentumBase.compute_total_strain-330"><a href="#LinearMomentumBase.compute_total_strain-330"><span class="linenos">330</span></a>
</span><span id="LinearMomentumBase.compute_total_strain-331"><a href="#LinearMomentumBase.compute_total_strain-331"><span class="linenos">331</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_total_strain-332"><a href="#LinearMomentumBase.compute_total_strain-332"><span class="linenos">332</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_total_strain-333"><a href="#LinearMomentumBase.compute_total_strain-333"><span class="linenos">333</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_total_strain-334"><a href="#LinearMomentumBase.compute_total_strain-334"><span class="linenos">334</span></a><span class="sd">            Total strain per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_total_strain-335"><a href="#LinearMomentumBase.compute_total_strain-335"><span class="linenos">335</span></a>
</span><span id="LinearMomentumBase.compute_total_strain-336"><a href="#LinearMomentumBase.compute_total_strain-336"><span class="linenos">336</span></a><span class="sd">        Notes</span>
</span><span id="LinearMomentumBase.compute_total_strain-337"><a href="#LinearMomentumBase.compute_total_strain-337"><span class="linenos">337</span></a><span class="sd">        -----</span>
</span><span id="LinearMomentumBase.compute_total_strain-338"><a href="#LinearMomentumBase.compute_total_strain-338"><span class="linenos">338</span></a><span class="sd">        Uses :func:`project` on ``(u)``.</span>
</span><span id="LinearMomentumBase.compute_total_strain-339"><a href="#LinearMomentumBase.compute_total_strain-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_total_strain-340"><a href="#LinearMomentumBase.compute_total_strain-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_tot</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentumBase.compute_total_strain-341"><a href="#LinearMomentumBase.compute_total_strain-341"><span class="linenos">341</span></a>        <span class="n">eps_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_tot</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentumBase.compute_total_strain-342"><a href="#LinearMomentumBase.compute_total_strain-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="n">eps_to</span>
</span></pre></div>


            <div class="docstring"><p>Project total small-strain tensor to DG0 and return as torch.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Total strain per element, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Uses <code>project()</code> on <code>(u)</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_eps_th" class="classattr">
                                        <input id="LinearMomentumBase.compute_eps_th-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_th</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_eps_th-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_eps_th"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_eps_th-344"><a href="#LinearMomentumBase.compute_eps_th-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">compute_eps_th</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_eps_th-345"><a href="#LinearMomentumBase.compute_eps_th-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_th-346"><a href="#LinearMomentumBase.compute_eps_th-346"><span class="linenos">346</span></a><span class="sd">        Compute element-wise thermal strain by aggregating thermoelastic elements.</span>
</span><span id="LinearMomentumBase.compute_eps_th-347"><a href="#LinearMomentumBase.compute_eps_th-347"><span class="linenos">347</span></a>
</span><span id="LinearMomentumBase.compute_eps_th-348"><a href="#LinearMomentumBase.compute_eps_th-348"><span class="linenos">348</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_eps_th-349"><a href="#LinearMomentumBase.compute_eps_th-349"><span class="linenos">349</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_eps_th-350"><a href="#LinearMomentumBase.compute_eps_th-350"><span class="linenos">350</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_eps_th-351"><a href="#LinearMomentumBase.compute_eps_th-351"><span class="linenos">351</span></a><span class="sd">            Thermal strain per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_eps_th-352"><a href="#LinearMomentumBase.compute_eps_th-352"><span class="linenos">352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_th-353"><a href="#LinearMomentumBase.compute_eps_th-353"><span class="linenos">353</span></a>        <span class="n">eps_th</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase.compute_eps_th-354"><a href="#LinearMomentumBase.compute_eps_th-354"><span class="linenos">354</span></a>        <span class="n">deltaT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T0</span>
</span><span id="LinearMomentumBase.compute_eps_th-355"><a href="#LinearMomentumBase.compute_eps_th-355"><span class="linenos">355</span></a>        <span class="k">for</span> <span class="n">elem_th</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_th</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_eps_th-356"><a href="#LinearMomentumBase.compute_eps_th-356"><span class="linenos">356</span></a>        	<span class="n">elem_th</span><span class="o">.</span><span class="n">compute_eps_th</span><span class="p">(</span><span class="n">deltaT</span><span class="p">)</span>
</span><span id="LinearMomentumBase.compute_eps_th-357"><a href="#LinearMomentumBase.compute_eps_th-357"><span class="linenos">357</span></a>        	<span class="n">eps_th</span> <span class="o">+=</span> <span class="n">elem_th</span><span class="o">.</span><span class="n">eps_th</span>
</span><span id="LinearMomentumBase.compute_eps_th-358"><a href="#LinearMomentumBase.compute_eps_th-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="n">eps_th</span>
</span></pre></div>


            <div class="docstring"><p>Compute element-wise thermal strain by aggregating thermoelastic elements.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Thermal strain per element, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_eps_ne_k" class="classattr">
                                        <input id="LinearMomentumBase.compute_eps_ne_k-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_ne_k</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_eps_ne_k-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_eps_ne_k"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_eps_ne_k-360"><a href="#LinearMomentumBase.compute_eps_ne_k-360"><span class="linenos">360</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-361"><a href="#LinearMomentumBase.compute_eps_ne_k-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-362"><a href="#LinearMomentumBase.compute_eps_ne_k-362"><span class="linenos">362</span></a><span class="sd">        Compute predictor of non-elastic strain at the previous iteration k.</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-363"><a href="#LinearMomentumBase.compute_eps_ne_k-363"><span class="linenos">363</span></a>
</span><span id="LinearMomentumBase.compute_eps_ne_k-364"><a href="#LinearMomentumBase.compute_eps_ne_k-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-365"><a href="#LinearMomentumBase.compute_eps_ne_k-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-366"><a href="#LinearMomentumBase.compute_eps_ne_k-366"><span class="linenos">366</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-367"><a href="#LinearMomentumBase.compute_eps_ne_k-367"><span class="linenos">367</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-368"><a href="#LinearMomentumBase.compute_eps_ne_k-368"><span class="linenos">368</span></a>
</span><span id="LinearMomentumBase.compute_eps_ne_k-369"><a href="#LinearMomentumBase.compute_eps_ne_k-369"><span class="linenos">369</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-370"><a href="#LinearMomentumBase.compute_eps_ne_k-370"><span class="linenos">370</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-371"><a href="#LinearMomentumBase.compute_eps_ne_k-371"><span class="linenos">371</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-372"><a href="#LinearMomentumBase.compute_eps_ne_k-372"><span class="linenos">372</span></a><span class="sd">            Predicted non-elastic strain per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-373"><a href="#LinearMomentumBase.compute_eps_ne_k-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-374"><a href="#LinearMomentumBase.compute_eps_ne_k-374"><span class="linenos">374</span></a>        <span class="n">eps_ne_k</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-375"><a href="#LinearMomentumBase.compute_eps_ne_k-375"><span class="linenos">375</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-376"><a href="#LinearMomentumBase.compute_eps_ne_k-376"><span class="linenos">376</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_eps_ne_k</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-377"><a href="#LinearMomentumBase.compute_eps_ne_k-377"><span class="linenos">377</span></a>        	<span class="n">eps_ne_k</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">eps_ne_k</span>
</span><span id="LinearMomentumBase.compute_eps_ne_k-378"><a href="#LinearMomentumBase.compute_eps_ne_k-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">eps_ne_k</span>
</span></pre></div>


            <div class="docstring"><p>Compute predictor of non-elastic strain at the previous iteration k.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time-step size.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Predicted non-elastic strain per element, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_eps_ne_rate" class="classattr">
                                        <input id="LinearMomentumBase.compute_eps_ne_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_ne_rate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_eps_ne_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_eps_ne_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_eps_ne_rate-380"><a href="#LinearMomentumBase.compute_eps_ne_rate-380"><span class="linenos">380</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-381"><a href="#LinearMomentumBase.compute_eps_ne_rate-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-382"><a href="#LinearMomentumBase.compute_eps_ne_rate-382"><span class="linenos">382</span></a><span class="sd">        Update non-elastic strain rate for all non-elastic elements.</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-383"><a href="#LinearMomentumBase.compute_eps_ne_rate-383"><span class="linenos">383</span></a>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-384"><a href="#LinearMomentumBase.compute_eps_ne_rate-384"><span class="linenos">384</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-385"><a href="#LinearMomentumBase.compute_eps_ne_rate-385"><span class="linenos">385</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-386"><a href="#LinearMomentumBase.compute_eps_ne_rate-386"><span class="linenos">386</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-387"><a href="#LinearMomentumBase.compute_eps_ne_rate-387"><span class="linenos">387</span></a><span class="sd">            Stress per element, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-388"><a href="#LinearMomentumBase.compute_eps_ne_rate-388"><span class="linenos">388</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-389"><a href="#LinearMomentumBase.compute_eps_ne_rate-389"><span class="linenos">389</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-390"><a href="#LinearMomentumBase.compute_eps_ne_rate-390"><span class="linenos">390</span></a>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-391"><a href="#LinearMomentumBase.compute_eps_ne_rate-391"><span class="linenos">391</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-392"><a href="#LinearMomentumBase.compute_eps_ne_rate-392"><span class="linenos">392</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-393"><a href="#LinearMomentumBase.compute_eps_ne_rate-393"><span class="linenos">393</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-394"><a href="#LinearMomentumBase.compute_eps_ne_rate-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-395"><a href="#LinearMomentumBase.compute_eps_ne_rate-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_eps_ne_rate-396"><a href="#LinearMomentumBase.compute_eps_ne_rate-396"><span class="linenos">396</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Update non-elastic strain rate for all non-elastic elements.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>dt</strong> (float):
Time-step size.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.update_eps_ne_rate_old" class="classattr">
                                        <input id="LinearMomentumBase.update_eps_ne_rate_old-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_eps_ne_rate_old</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.update_eps_ne_rate_old-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.update_eps_ne_rate_old"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.update_eps_ne_rate_old-398"><a href="#LinearMomentumBase.update_eps_ne_rate_old-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_rate_old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-399"><a href="#LinearMomentumBase.update_eps_ne_rate_old-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-400"><a href="#LinearMomentumBase.update_eps_ne_rate_old-400"><span class="linenos">400</span></a><span class="sd">        Update non-elastic strain rate from the previous time step old.</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-401"><a href="#LinearMomentumBase.update_eps_ne_rate_old-401"><span class="linenos">401</span></a>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-402"><a href="#LinearMomentumBase.update_eps_ne_rate_old-402"><span class="linenos">402</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-403"><a href="#LinearMomentumBase.update_eps_ne_rate_old-403"><span class="linenos">403</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-404"><a href="#LinearMomentumBase.update_eps_ne_rate_old-404"><span class="linenos">404</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-405"><a href="#LinearMomentumBase.update_eps_ne_rate_old-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-406"><a href="#LinearMomentumBase.update_eps_ne_rate_old-406"><span class="linenos">406</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase.update_eps_ne_rate_old-407"><a href="#LinearMomentumBase.update_eps_ne_rate_old-407"><span class="linenos">407</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Update non-elastic strain rate from the previous time step old.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.update_eps_ne_old" class="classattr">
                                        <input id="LinearMomentumBase.update_eps_ne_old-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_eps_ne_old</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.update_eps_ne_old-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.update_eps_ne_old"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.update_eps_ne_old-409"><a href="#LinearMomentumBase.update_eps_ne_old-409"><span class="linenos">409</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-410"><a href="#LinearMomentumBase.update_eps_ne_old-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-411"><a href="#LinearMomentumBase.update_eps_ne_old-411"><span class="linenos">411</span></a><span class="sd">        Update non-elastic strain tensor from the previous time step old.</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-412"><a href="#LinearMomentumBase.update_eps_ne_old-412"><span class="linenos">412</span></a>
</span><span id="LinearMomentumBase.update_eps_ne_old-413"><a href="#LinearMomentumBase.update_eps_ne_old-413"><span class="linenos">413</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-414"><a href="#LinearMomentumBase.update_eps_ne_old-414"><span class="linenos">414</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-415"><a href="#LinearMomentumBase.update_eps_ne_old-415"><span class="linenos">415</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-416"><a href="#LinearMomentumBase.update_eps_ne_old-416"><span class="linenos">416</span></a><span class="sd">            Stress at current iteration k+1, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-417"><a href="#LinearMomentumBase.update_eps_ne_old-417"><span class="linenos">417</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-418"><a href="#LinearMomentumBase.update_eps_ne_old-418"><span class="linenos">418</span></a><span class="sd">            Stress from previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-419"><a href="#LinearMomentumBase.update_eps_ne_old-419"><span class="linenos">419</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-420"><a href="#LinearMomentumBase.update_eps_ne_old-420"><span class="linenos">420</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-421"><a href="#LinearMomentumBase.update_eps_ne_old-421"><span class="linenos">421</span></a>
</span><span id="LinearMomentumBase.update_eps_ne_old-422"><a href="#LinearMomentumBase.update_eps_ne_old-422"><span class="linenos">422</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-423"><a href="#LinearMomentumBase.update_eps_ne_old-423"><span class="linenos">423</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-424"><a href="#LinearMomentumBase.update_eps_ne_old-424"><span class="linenos">424</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-425"><a href="#LinearMomentumBase.update_eps_ne_old-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-426"><a href="#LinearMomentumBase.update_eps_ne_old-426"><span class="linenos">426</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase.update_eps_ne_old-427"><a href="#LinearMomentumBase.update_eps_ne_old-427"><span class="linenos">427</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">update_eps_ne_old</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Update non-elastic strain tensor from the previous time step old.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress at current iteration k+1, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>stress_k</strong> (torch.Tensor):
Stress from previous iteration k, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>dt</strong> (float):
Time-step size.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.increment_internal_variables" class="classattr">
                                        <input id="LinearMomentumBase.increment_internal_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">increment_internal_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.increment_internal_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.increment_internal_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.increment_internal_variables-429"><a href="#LinearMomentumBase.increment_internal_variables-429"><span class="linenos">429</span></a>    <span class="k">def</span> <span class="nf">increment_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.increment_internal_variables-430"><a href="#LinearMomentumBase.increment_internal_variables-430"><span class="linenos">430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.increment_internal_variables-431"><a href="#LinearMomentumBase.increment_internal_variables-431"><span class="linenos">431</span></a><span class="sd">        Increment material internal variables (e.g., hardening).</span>
</span><span id="LinearMomentumBase.increment_internal_variables-432"><a href="#LinearMomentumBase.increment_internal_variables-432"><span class="linenos">432</span></a>
</span><span id="LinearMomentumBase.increment_internal_variables-433"><a href="#LinearMomentumBase.increment_internal_variables-433"><span class="linenos">433</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.increment_internal_variables-434"><a href="#LinearMomentumBase.increment_internal_variables-434"><span class="linenos">434</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.increment_internal_variables-435"><a href="#LinearMomentumBase.increment_internal_variables-435"><span class="linenos">435</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="LinearMomentumBase.increment_internal_variables-436"><a href="#LinearMomentumBase.increment_internal_variables-436"><span class="linenos">436</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase.increment_internal_variables-437"><a href="#LinearMomentumBase.increment_internal_variables-437"><span class="linenos">437</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase.increment_internal_variables-438"><a href="#LinearMomentumBase.increment_internal_variables-438"><span class="linenos">438</span></a>
</span><span id="LinearMomentumBase.increment_internal_variables-439"><a href="#LinearMomentumBase.increment_internal_variables-439"><span class="linenos">439</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.increment_internal_variables-440"><a href="#LinearMomentumBase.increment_internal_variables-440"><span class="linenos">440</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.increment_internal_variables-441"><a href="#LinearMomentumBase.increment_internal_variables-441"><span class="linenos">441</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.increment_internal_variables-442"><a href="#LinearMomentumBase.increment_internal_variables-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.increment_internal_variables-443"><a href="#LinearMomentumBase.increment_internal_variables-443"><span class="linenos">443</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase.increment_internal_variables-444"><a href="#LinearMomentumBase.increment_internal_variables-444"><span class="linenos">444</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">increment_internal_variables</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Increment material internal variables (e.g., hardening).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>stress</strong> (torch.Tensor):</p></li>
<li><p><strong>stress_k</strong> (torch.Tensor):</p></li>
<li><p><strong>dt</strong> (float):</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.update_internal_variables" class="classattr">
                                        <input id="LinearMomentumBase.update_internal_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_internal_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.update_internal_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.update_internal_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.update_internal_variables-446"><a href="#LinearMomentumBase.update_internal_variables-446"><span class="linenos">446</span></a>    <span class="k">def</span> <span class="nf">update_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.update_internal_variables-447"><a href="#LinearMomentumBase.update_internal_variables-447"><span class="linenos">447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.update_internal_variables-448"><a href="#LinearMomentumBase.update_internal_variables-448"><span class="linenos">448</span></a><span class="sd">        Commit internal variables at the end of a time step.</span>
</span><span id="LinearMomentumBase.update_internal_variables-449"><a href="#LinearMomentumBase.update_internal_variables-449"><span class="linenos">449</span></a>
</span><span id="LinearMomentumBase.update_internal_variables-450"><a href="#LinearMomentumBase.update_internal_variables-450"><span class="linenos">450</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.update_internal_variables-451"><a href="#LinearMomentumBase.update_internal_variables-451"><span class="linenos">451</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.update_internal_variables-452"><a href="#LinearMomentumBase.update_internal_variables-452"><span class="linenos">452</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.update_internal_variables-453"><a href="#LinearMomentumBase.update_internal_variables-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.update_internal_variables-454"><a href="#LinearMomentumBase.update_internal_variables-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="LinearMomentumBase.update_internal_variables-455"><a href="#LinearMomentumBase.update_internal_variables-455"><span class="linenos">455</span></a>        	<span class="n">elem_ne</span><span class="o">.</span><span class="n">update_internal_variables</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Commit internal variables at the end of a time step.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_solution_vector" class="classattr">
                                        <input id="LinearMomentumBase.create_solution_vector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_solution_vector</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_solution_vector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_solution_vector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_solution_vector-457"><a href="#LinearMomentumBase.create_solution_vector-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">create_solution_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_solution_vector-458"><a href="#LinearMomentumBase.create_solution_vector-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_solution_vector-459"><a href="#LinearMomentumBase.create_solution_vector-459"><span class="linenos">459</span></a><span class="sd">        Allocate the solution function `X` in the primary space.</span>
</span><span id="LinearMomentumBase.create_solution_vector-460"><a href="#LinearMomentumBase.create_solution_vector-460"><span class="linenos">460</span></a>
</span><span id="LinearMomentumBase.create_solution_vector-461"><a href="#LinearMomentumBase.create_solution_vector-461"><span class="linenos">461</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_solution_vector-462"><a href="#LinearMomentumBase.create_solution_vector-462"><span class="linenos">462</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_solution_vector-463"><a href="#LinearMomentumBase.create_solution_vector-463"><span class="linenos">463</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_solution_vector-464"><a href="#LinearMomentumBase.create_solution_vector-464"><span class="linenos">464</span></a>
</span><span id="LinearMomentumBase.create_solution_vector-465"><a href="#LinearMomentumBase.create_solution_vector-465"><span class="linenos">465</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentumBase.create_solution_vector-466"><a href="#LinearMomentumBase.create_solution_vector-466"><span class="linenos">466</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentumBase.create_solution_vector-467"><a href="#LinearMomentumBase.create_solution_vector-467"><span class="linenos">467</span></a><span class="sd">        Sets :attr:`X` as a `dolfinx.fem.Function(self.V)`.</span>
</span><span id="LinearMomentumBase.create_solution_vector-468"><a href="#LinearMomentumBase.create_solution_vector-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_solution_vector-469"><a href="#LinearMomentumBase.create_solution_vector-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Allocate the solution function <code>X</code> in the primary space.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>X</code> as a <code>dolfinx.fem.Function(self.V)</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.run_after_solve" class="classattr">
                                        <input id="LinearMomentumBase.run_after_solve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_after_solve</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.run_after_solve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.run_after_solve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.run_after_solve-471"><a href="#LinearMomentumBase.run_after_solve-471"><span class="linenos">471</span></a>    <span class="k">def</span> <span class="nf">run_after_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.run_after_solve-472"><a href="#LinearMomentumBase.run_after_solve-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.run_after_solve-473"><a href="#LinearMomentumBase.run_after_solve-473"><span class="linenos">473</span></a><span class="sd">        Optional hook called after each linear solve.</span>
</span><span id="LinearMomentumBase.run_after_solve-474"><a href="#LinearMomentumBase.run_after_solve-474"><span class="linenos">474</span></a>
</span><span id="LinearMomentumBase.run_after_solve-475"><a href="#LinearMomentumBase.run_after_solve-475"><span class="linenos">475</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.run_after_solve-476"><a href="#LinearMomentumBase.run_after_solve-476"><span class="linenos">476</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.run_after_solve-477"><a href="#LinearMomentumBase.run_after_solve-477"><span class="linenos">477</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.run_after_solve-478"><a href="#LinearMomentumBase.run_after_solve-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.run_after_solve-479"><a href="#LinearMomentumBase.run_after_solve-479"><span class="linenos">479</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Optional hook called after each linear solve.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_CT" class="classattr">
                                        <input id="LinearMomentumBase.compute_CT-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute_CT</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_CT-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_CT"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_CT-481"><a href="#LinearMomentumBase.compute_CT-481"><span class="linenos">481</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.compute_CT-482"><a href="#LinearMomentumBase.compute_CT-482"><span class="linenos">482</span></a>    <span class="k">def</span> <span class="nf">compute_CT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase.compute_CT-483"><a href="#LinearMomentumBase.compute_CT-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_CT-484"><a href="#LinearMomentumBase.compute_CT-484"><span class="linenos">484</span></a><span class="sd">        Build the consistent tangent operator (per element).</span>
</span><span id="LinearMomentumBase.compute_CT-485"><a href="#LinearMomentumBase.compute_CT-485"><span class="linenos">485</span></a>
</span><span id="LinearMomentumBase.compute_CT-486"><a href="#LinearMomentumBase.compute_CT-486"><span class="linenos">486</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.compute_CT-487"><a href="#LinearMomentumBase.compute_CT-487"><span class="linenos">487</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.compute_CT-488"><a href="#LinearMomentumBase.compute_CT-488"><span class="linenos">488</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase.compute_CT-489"><a href="#LinearMomentumBase.compute_CT-489"><span class="linenos">489</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase.compute_CT-490"><a href="#LinearMomentumBase.compute_CT-490"><span class="linenos">490</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_CT-491"><a href="#LinearMomentumBase.compute_CT-491"><span class="linenos">491</span></a><span class="sd">            Stress from previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_CT-492"><a href="#LinearMomentumBase.compute_CT-492"><span class="linenos">492</span></a>
</span><span id="LinearMomentumBase.compute_CT-493"><a href="#LinearMomentumBase.compute_CT-493"><span class="linenos">493</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_CT-494"><a href="#LinearMomentumBase.compute_CT-494"><span class="linenos">494</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_CT-495"><a href="#LinearMomentumBase.compute_CT-495"><span class="linenos">495</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.compute_CT-496"><a href="#LinearMomentumBase.compute_CT-496"><span class="linenos">496</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_CT-497"><a href="#LinearMomentumBase.compute_CT-497"><span class="linenos">497</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Build the consistent tangent operator (per element).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time-step size.</li>
<li><strong>stress_k</strong> (torch.Tensor):
Stress from previous iteration k, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_eps_rhs" class="classattr">
                                        <input id="LinearMomentumBase.compute_eps_rhs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute_eps_rhs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">eps_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_eps_rhs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_eps_rhs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_eps_rhs-499"><a href="#LinearMomentumBase.compute_eps_rhs-499"><span class="linenos">499</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-500"><a href="#LinearMomentumBase.compute_eps_rhs-500"><span class="linenos">500</span></a>    <span class="k">def</span> <span class="nf">compute_eps_rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">eps_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-501"><a href="#LinearMomentumBase.compute_eps_rhs-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-502"><a href="#LinearMomentumBase.compute_eps_rhs-502"><span class="linenos">502</span></a><span class="sd">        Compute the right-hand-side strain term used in the linear form.</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-503"><a href="#LinearMomentumBase.compute_eps_rhs-503"><span class="linenos">503</span></a>
</span><span id="LinearMomentumBase.compute_eps_rhs-504"><a href="#LinearMomentumBase.compute_eps_rhs-504"><span class="linenos">504</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-505"><a href="#LinearMomentumBase.compute_eps_rhs-505"><span class="linenos">505</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-506"><a href="#LinearMomentumBase.compute_eps_rhs-506"><span class="linenos">506</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-507"><a href="#LinearMomentumBase.compute_eps_rhs-507"><span class="linenos">507</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-508"><a href="#LinearMomentumBase.compute_eps_rhs-508"><span class="linenos">508</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-509"><a href="#LinearMomentumBase.compute_eps_rhs-509"><span class="linenos">509</span></a><span class="sd">            Intermediate stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-510"><a href="#LinearMomentumBase.compute_eps_rhs-510"><span class="linenos">510</span></a><span class="sd">        eps_k : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-511"><a href="#LinearMomentumBase.compute_eps_rhs-511"><span class="linenos">511</span></a><span class="sd">            Optional strain input for schemes that need it.</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-512"><a href="#LinearMomentumBase.compute_eps_rhs-512"><span class="linenos">512</span></a>
</span><span id="LinearMomentumBase.compute_eps_rhs-513"><a href="#LinearMomentumBase.compute_eps_rhs-513"><span class="linenos">513</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-514"><a href="#LinearMomentumBase.compute_eps_rhs-514"><span class="linenos">514</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-515"><a href="#LinearMomentumBase.compute_eps_rhs-515"><span class="linenos">515</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-516"><a href="#LinearMomentumBase.compute_eps_rhs-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_eps_rhs-517"><a href="#LinearMomentumBase.compute_eps_rhs-517"><span class="linenos">517</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Compute the right-hand-side strain term used in the linear form.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time-step size.</li>
<li><strong>stress_k</strong> (torch.Tensor):
Intermediate stress, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>eps_k</strong> (torch.Tensor):
Optional strain input for schemes that need it.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_elastic_stress" class="classattr">
                                        <input id="LinearMomentumBase.compute_elastic_stress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute_elastic_stress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">eps_e</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_elastic_stress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_elastic_stress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_elastic_stress-519"><a href="#LinearMomentumBase.compute_elastic_stress-519"><span class="linenos">519</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-520"><a href="#LinearMomentumBase.compute_elastic_stress-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">compute_elastic_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_e</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-521"><a href="#LinearMomentumBase.compute_elastic_stress-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-522"><a href="#LinearMomentumBase.compute_elastic_stress-522"><span class="linenos">522</span></a><span class="sd">        Compute elastic stress from elastic strain using `C`.</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-523"><a href="#LinearMomentumBase.compute_elastic_stress-523"><span class="linenos">523</span></a>
</span><span id="LinearMomentumBase.compute_elastic_stress-524"><a href="#LinearMomentumBase.compute_elastic_stress-524"><span class="linenos">524</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-525"><a href="#LinearMomentumBase.compute_elastic_stress-525"><span class="linenos">525</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-526"><a href="#LinearMomentumBase.compute_elastic_stress-526"><span class="linenos">526</span></a><span class="sd">        eps_e : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-527"><a href="#LinearMomentumBase.compute_elastic_stress-527"><span class="linenos">527</span></a><span class="sd">            Elastic strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-528"><a href="#LinearMomentumBase.compute_elastic_stress-528"><span class="linenos">528</span></a>
</span><span id="LinearMomentumBase.compute_elastic_stress-529"><a href="#LinearMomentumBase.compute_elastic_stress-529"><span class="linenos">529</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-530"><a href="#LinearMomentumBase.compute_elastic_stress-530"><span class="linenos">530</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-531"><a href="#LinearMomentumBase.compute_elastic_stress-531"><span class="linenos">531</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-532"><a href="#LinearMomentumBase.compute_elastic_stress-532"><span class="linenos">532</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-533"><a href="#LinearMomentumBase.compute_elastic_stress-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_elastic_stress-534"><a href="#LinearMomentumBase.compute_elastic_stress-534"><span class="linenos">534</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Compute elastic stress from elastic strain using <code>C</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps_e</strong> (torch.Tensor):
Elastic strain, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Stress, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_stress" class="classattr">
                                        <input id="LinearMomentumBase.compute_stress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute_stress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">eps_tot</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">eps_rhs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">p</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_stress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_stress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_stress-536"><a href="#LinearMomentumBase.compute_stress-536"><span class="linenos">536</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.compute_stress-537"><a href="#LinearMomentumBase.compute_stress-537"><span class="linenos">537</span></a>    <span class="k">def</span> <span class="nf">compute_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_tot</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">eps_rhs</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="LinearMomentumBase.compute_stress-538"><a href="#LinearMomentumBase.compute_stress-538"><span class="linenos">538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_stress-539"><a href="#LinearMomentumBase.compute_stress-539"><span class="linenos">539</span></a><span class="sd">        Compute stress from total strain and RHS strain (and optionally pressure).</span>
</span><span id="LinearMomentumBase.compute_stress-540"><a href="#LinearMomentumBase.compute_stress-540"><span class="linenos">540</span></a>
</span><span id="LinearMomentumBase.compute_stress-541"><a href="#LinearMomentumBase.compute_stress-541"><span class="linenos">541</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentumBase.compute_stress-542"><a href="#LinearMomentumBase.compute_stress-542"><span class="linenos">542</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentumBase.compute_stress-543"><a href="#LinearMomentumBase.compute_stress-543"><span class="linenos">543</span></a><span class="sd">        eps_tot : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_stress-544"><a href="#LinearMomentumBase.compute_stress-544"><span class="linenos">544</span></a><span class="sd">            Total strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_stress-545"><a href="#LinearMomentumBase.compute_stress-545"><span class="linenos">545</span></a><span class="sd">        eps_rhs : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_stress-546"><a href="#LinearMomentumBase.compute_stress-546"><span class="linenos">546</span></a><span class="sd">            RHS strain term, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_stress-547"><a href="#LinearMomentumBase.compute_stress-547"><span class="linenos">547</span></a><span class="sd">        p : torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_stress-548"><a href="#LinearMomentumBase.compute_stress-548"><span class="linenos">548</span></a><span class="sd">            Optional pressure term.</span>
</span><span id="LinearMomentumBase.compute_stress-549"><a href="#LinearMomentumBase.compute_stress-549"><span class="linenos">549</span></a>
</span><span id="LinearMomentumBase.compute_stress-550"><a href="#LinearMomentumBase.compute_stress-550"><span class="linenos">550</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_stress-551"><a href="#LinearMomentumBase.compute_stress-551"><span class="linenos">551</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_stress-552"><a href="#LinearMomentumBase.compute_stress-552"><span class="linenos">552</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentumBase.compute_stress-553"><a href="#LinearMomentumBase.compute_stress-553"><span class="linenos">553</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentumBase.compute_stress-554"><a href="#LinearMomentumBase.compute_stress-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_stress-555"><a href="#LinearMomentumBase.compute_stress-555"><span class="linenos">555</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Compute stress from total strain and RHS strain (and optionally pressure).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps_tot</strong> (torch.Tensor):
Total strain, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>eps_rhs</strong> (torch.Tensor):
RHS strain term, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>p</strong> (torch.Tensor):
Optional pressure term.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Stress, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_fenicsx_fields" class="classattr">
                                        <input id="LinearMomentumBase.create_fenicsx_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">create_fenicsx_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_fenicsx_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_fenicsx_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_fenicsx_fields-557"><a href="#LinearMomentumBase.create_fenicsx_fields-557"><span class="linenos">557</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-558"><a href="#LinearMomentumBase.create_fenicsx_fields-558"><span class="linenos">558</span></a>    <span class="k">def</span> <span class="nf">create_fenicsx_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-559"><a href="#LinearMomentumBase.create_fenicsx_fields-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-560"><a href="#LinearMomentumBase.create_fenicsx_fields-560"><span class="linenos">560</span></a><span class="sd">        Create FE functions specific to the concrete formulation.</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-561"><a href="#LinearMomentumBase.create_fenicsx_fields-561"><span class="linenos">561</span></a>
</span><span id="LinearMomentumBase.create_fenicsx_fields-562"><a href="#LinearMomentumBase.create_fenicsx_fields-562"><span class="linenos">562</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-563"><a href="#LinearMomentumBase.create_fenicsx_fields-563"><span class="linenos">563</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-564"><a href="#LinearMomentumBase.create_fenicsx_fields-564"><span class="linenos">564</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-565"><a href="#LinearMomentumBase.create_fenicsx_fields-565"><span class="linenos">565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_fenicsx_fields-566"><a href="#LinearMomentumBase.create_fenicsx_fields-566"><span class="linenos">566</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Create FE functions specific to the concrete formulation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_pytorch_fields" class="classattr">
                                        <input id="LinearMomentumBase.create_pytorch_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">create_pytorch_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_pytorch_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_pytorch_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_pytorch_fields-568"><a href="#LinearMomentumBase.create_pytorch_fields-568"><span class="linenos">568</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-569"><a href="#LinearMomentumBase.create_pytorch_fields-569"><span class="linenos">569</span></a>    <span class="k">def</span> <span class="nf">create_pytorch_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-570"><a href="#LinearMomentumBase.create_pytorch_fields-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-571"><a href="#LinearMomentumBase.create_pytorch_fields-571"><span class="linenos">571</span></a><span class="sd">        Create torch tensors specific to the concrete formulation.</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-572"><a href="#LinearMomentumBase.create_pytorch_fields-572"><span class="linenos">572</span></a>
</span><span id="LinearMomentumBase.create_pytorch_fields-573"><a href="#LinearMomentumBase.create_pytorch_fields-573"><span class="linenos">573</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-574"><a href="#LinearMomentumBase.create_pytorch_fields-574"><span class="linenos">574</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-575"><a href="#LinearMomentumBase.create_pytorch_fields-575"><span class="linenos">575</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-576"><a href="#LinearMomentumBase.create_pytorch_fields-576"><span class="linenos">576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_pytorch_fields-577"><a href="#LinearMomentumBase.create_pytorch_fields-577"><span class="linenos">577</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Create torch tensors specific to the concrete formulation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.create_trial_test_functions" class="classattr">
                                        <input id="LinearMomentumBase.create_trial_test_functions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">create_trial_test_functions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.create_trial_test_functions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.create_trial_test_functions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.create_trial_test_functions-579"><a href="#LinearMomentumBase.create_trial_test_functions-579"><span class="linenos">579</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-580"><a href="#LinearMomentumBase.create_trial_test_functions-580"><span class="linenos">580</span></a>    <span class="k">def</span> <span class="nf">create_trial_test_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-581"><a href="#LinearMomentumBase.create_trial_test_functions-581"><span class="linenos">581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-582"><a href="#LinearMomentumBase.create_trial_test_functions-582"><span class="linenos">582</span></a><span class="sd">        Create UFL trial and test functions in the primary space.</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-583"><a href="#LinearMomentumBase.create_trial_test_functions-583"><span class="linenos">583</span></a>
</span><span id="LinearMomentumBase.create_trial_test_functions-584"><a href="#LinearMomentumBase.create_trial_test_functions-584"><span class="linenos">584</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-585"><a href="#LinearMomentumBase.create_trial_test_functions-585"><span class="linenos">585</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-586"><a href="#LinearMomentumBase.create_trial_test_functions-586"><span class="linenos">586</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-587"><a href="#LinearMomentumBase.create_trial_test_functions-587"><span class="linenos">587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.create_trial_test_functions-588"><a href="#LinearMomentumBase.create_trial_test_functions-588"><span class="linenos">588</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Create UFL trial and test functions in the primary space.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.get_uV" class="classattr">
                                        <input id="LinearMomentumBase.get_uV-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">get_uV</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">dolfinx</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">FunctionSpace</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.get_uV-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.get_uV"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.get_uV-590"><a href="#LinearMomentumBase.get_uV-590"><span class="linenos">590</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.get_uV-591"><a href="#LinearMomentumBase.get_uV-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">get_uV</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">:</span>
</span><span id="LinearMomentumBase.get_uV-592"><a href="#LinearMomentumBase.get_uV-592"><span class="linenos">592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.get_uV-593"><a href="#LinearMomentumBase.get_uV-593"><span class="linenos">593</span></a><span class="sd">        Return the primary function space for displacements.</span>
</span><span id="LinearMomentumBase.get_uV-594"><a href="#LinearMomentumBase.get_uV-594"><span class="linenos">594</span></a>
</span><span id="LinearMomentumBase.get_uV-595"><a href="#LinearMomentumBase.get_uV-595"><span class="linenos">595</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.get_uV-596"><a href="#LinearMomentumBase.get_uV-596"><span class="linenos">596</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.get_uV-597"><a href="#LinearMomentumBase.get_uV-597"><span class="linenos">597</span></a><span class="sd">        dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentumBase.get_uV-598"><a href="#LinearMomentumBase.get_uV-598"><span class="linenos">598</span></a><span class="sd">            Vector function space used for `u`.</span>
</span><span id="LinearMomentumBase.get_uV-599"><a href="#LinearMomentumBase.get_uV-599"><span class="linenos">599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.get_uV-600"><a href="#LinearMomentumBase.get_uV-600"><span class="linenos">600</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Return the primary function space for displacements.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dolfinx.fem.FunctionSpace</strong>: Vector function space used for <code>u</code>.</li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.initialize" class="classattr">
                                        <input id="LinearMomentumBase.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.initialize-602"><a href="#LinearMomentumBase.initialize-602"><span class="linenos">602</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.initialize-603"><a href="#LinearMomentumBase.initialize-603"><span class="linenos">603</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.initialize-604"><a href="#LinearMomentumBase.initialize-604"><span class="linenos">604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.initialize-605"><a href="#LinearMomentumBase.initialize-605"><span class="linenos">605</span></a><span class="sd">        Initialize FE fields from the material container.</span>
</span><span id="LinearMomentumBase.initialize-606"><a href="#LinearMomentumBase.initialize-606"><span class="linenos">606</span></a>
</span><span id="LinearMomentumBase.initialize-607"><a href="#LinearMomentumBase.initialize-607"><span class="linenos">607</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.initialize-608"><a href="#LinearMomentumBase.initialize-608"><span class="linenos">608</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.initialize-609"><a href="#LinearMomentumBase.initialize-609"><span class="linenos">609</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.initialize-610"><a href="#LinearMomentumBase.initialize-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.initialize-611"><a href="#LinearMomentumBase.initialize-611"><span class="linenos">611</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Initialize FE fields from the material container.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.split_solution" class="classattr">
                                        <input id="LinearMomentumBase.split_solution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">split_solution</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.split_solution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.split_solution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.split_solution-624"><a href="#LinearMomentumBase.split_solution-624"><span class="linenos">624</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.split_solution-625"><a href="#LinearMomentumBase.split_solution-625"><span class="linenos">625</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.split_solution-626"><a href="#LinearMomentumBase.split_solution-626"><span class="linenos">626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.split_solution-627"><a href="#LinearMomentumBase.split_solution-627"><span class="linenos">627</span></a><span class="sd">        Duplicate abstract declaration (kept for API compatibility).</span>
</span><span id="LinearMomentumBase.split_solution-628"><a href="#LinearMomentumBase.split_solution-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.split_solution-629"><a href="#LinearMomentumBase.split_solution-629"><span class="linenos">629</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Duplicate abstract declaration (kept for API compatibility).</p>
</div>


                            </div>
                            <div id="LinearMomentumBase.compute_p_nodes" class="classattr">
                                        <input id="LinearMomentumBase.compute_p_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute_p_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.compute_p_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.compute_p_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.compute_p_nodes-631"><a href="#LinearMomentumBase.compute_p_nodes-631"><span class="linenos">631</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.compute_p_nodes-632"><a href="#LinearMomentumBase.compute_p_nodes-632"><span class="linenos">632</span></a>    <span class="k">def</span> <span class="nf">compute_p_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.compute_p_nodes-633"><a href="#LinearMomentumBase.compute_p_nodes-633"><span class="linenos">633</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_p_nodes-634"><a href="#LinearMomentumBase.compute_p_nodes-634"><span class="linenos">634</span></a><span class="sd">        Compute nodal pressure (mean stress) from the stress field.</span>
</span><span id="LinearMomentumBase.compute_p_nodes-635"><a href="#LinearMomentumBase.compute_p_nodes-635"><span class="linenos">635</span></a>
</span><span id="LinearMomentumBase.compute_p_nodes-636"><a href="#LinearMomentumBase.compute_p_nodes-636"><span class="linenos">636</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.compute_p_nodes-637"><a href="#LinearMomentumBase.compute_p_nodes-637"><span class="linenos">637</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.compute_p_nodes-638"><a href="#LinearMomentumBase.compute_p_nodes-638"><span class="linenos">638</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.compute_p_nodes-639"><a href="#LinearMomentumBase.compute_p_nodes-639"><span class="linenos">639</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.compute_p_nodes-640"><a href="#LinearMomentumBase.compute_p_nodes-640"><span class="linenos">640</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Compute nodal pressure (mean stress) from the stress field.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.solve_elastic_response" class="classattr">
                                        <input id="LinearMomentumBase.solve_elastic_response-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">solve_elastic_response</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.solve_elastic_response-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.solve_elastic_response"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.solve_elastic_response-642"><a href="#LinearMomentumBase.solve_elastic_response-642"><span class="linenos">642</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.solve_elastic_response-643"><a href="#LinearMomentumBase.solve_elastic_response-643"><span class="linenos">643</span></a>    <span class="k">def</span> <span class="nf">solve_elastic_response</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.solve_elastic_response-644"><a href="#LinearMomentumBase.solve_elastic_response-644"><span class="linenos">644</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.solve_elastic_response-645"><a href="#LinearMomentumBase.solve_elastic_response-645"><span class="linenos">645</span></a><span class="sd">        Solve the purely elastic problem (e.g., for initialization).</span>
</span><span id="LinearMomentumBase.solve_elastic_response-646"><a href="#LinearMomentumBase.solve_elastic_response-646"><span class="linenos">646</span></a>
</span><span id="LinearMomentumBase.solve_elastic_response-647"><a href="#LinearMomentumBase.solve_elastic_response-647"><span class="linenos">647</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.solve_elastic_response-648"><a href="#LinearMomentumBase.solve_elastic_response-648"><span class="linenos">648</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.solve_elastic_response-649"><a href="#LinearMomentumBase.solve_elastic_response-649"><span class="linenos">649</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.solve_elastic_response-650"><a href="#LinearMomentumBase.solve_elastic_response-650"><span class="linenos">650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.solve_elastic_response-651"><a href="#LinearMomentumBase.solve_elastic_response-651"><span class="linenos">651</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Solve the purely elastic problem (e.g., for initialization).</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentumBase.solve" class="classattr">
                                        <input id="LinearMomentumBase.solve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">solve</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentumBase.solve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentumBase.solve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentumBase.solve-653"><a href="#LinearMomentumBase.solve-653"><span class="linenos">653</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="LinearMomentumBase.solve-654"><a href="#LinearMomentumBase.solve-654"><span class="linenos">654</span></a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentumBase.solve-655"><a href="#LinearMomentumBase.solve-655"><span class="linenos">655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.solve-656"><a href="#LinearMomentumBase.solve-656"><span class="linenos">656</span></a><span class="sd">        Assemble and solve one step of the inelastic problem.</span>
</span><span id="LinearMomentumBase.solve-657"><a href="#LinearMomentumBase.solve-657"><span class="linenos">657</span></a>
</span><span id="LinearMomentumBase.solve-658"><a href="#LinearMomentumBase.solve-658"><span class="linenos">658</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentumBase.solve-659"><a href="#LinearMomentumBase.solve-659"><span class="linenos">659</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentumBase.solve-660"><a href="#LinearMomentumBase.solve-660"><span class="linenos">660</span></a><span class="sd">        None</span>
</span><span id="LinearMomentumBase.solve-661"><a href="#LinearMomentumBase.solve-661"><span class="linenos">661</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentumBase.solve-662"><a href="#LinearMomentumBase.solve-662"><span class="linenos">662</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Assemble and solve one step of the inelastic problem.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                </section>
                <section id="LinearMomentum">
                            <input id="LinearMomentum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LinearMomentum</span><wbr>(<span class="base"><a href="#LinearMomentumBase">safeincave.LinearMomentumBase</a></span>):

                <label class="view-source-button" for="LinearMomentum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum-668"><a href="#LinearMomentum-668"><span class="linenos">668</span></a><span class="k">class</span> <span class="nc">LinearMomentum</span><span class="p">(</span><span class="n">LinearMomentumBase</span><span class="p">):</span>
</span><span id="LinearMomentum-669"><a href="#LinearMomentum-669"><span class="linenos">669</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-670"><a href="#LinearMomentum-670"><span class="linenos">670</span></a><span class="sd">    Linear momentum formulation with thermo-(visco)elastic tangent.</span>
</span><span id="LinearMomentum-671"><a href="#LinearMomentum-671"><span class="linenos">671</span></a>
</span><span id="LinearMomentum-672"><a href="#LinearMomentum-672"><span class="linenos">672</span></a><span class="sd">    Implements the concrete FE fields, consistent tangent assembly, right-hand</span>
</span><span id="LinearMomentum-673"><a href="#LinearMomentum-673"><span class="linenos">673</span></a><span class="sd">    side strain, and linear solves for both elastic and inelastic steps.</span>
</span><span id="LinearMomentum-674"><a href="#LinearMomentum-674"><span class="linenos">674</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-675"><a href="#LinearMomentum-675"><span class="linenos">675</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">GridHandlerGMSH</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="LinearMomentum-676"><a href="#LinearMomentum-676"><span class="linenos">676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-677"><a href="#LinearMomentum-677"><span class="linenos">677</span></a><span class="sd">        Initialize spaces, measures, fields, and solution vector.</span>
</span><span id="LinearMomentum-678"><a href="#LinearMomentum-678"><span class="linenos">678</span></a>
</span><span id="LinearMomentum-679"><a href="#LinearMomentum-679"><span class="linenos">679</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum-680"><a href="#LinearMomentum-680"><span class="linenos">680</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum-681"><a href="#LinearMomentum-681"><span class="linenos">681</span></a><span class="sd">        grid : GridHandlerGMSH</span>
</span><span id="LinearMomentum-682"><a href="#LinearMomentum-682"><span class="linenos">682</span></a><span class="sd">        theta : float</span>
</span><span id="LinearMomentum-683"><a href="#LinearMomentum-683"><span class="linenos">683</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-684"><a href="#LinearMomentum-684"><span class="linenos">684</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="LinearMomentum-685"><a href="#LinearMomentum-685"><span class="linenos">685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CG1_3x1</span>
</span><span id="LinearMomentum-686"><a href="#LinearMomentum-686"><span class="linenos">686</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_trial_test_functions</span><span class="p">()</span>
</span><span id="LinearMomentum-687"><a href="#LinearMomentum-687"><span class="linenos">687</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_normal</span><span class="p">()</span>
</span><span id="LinearMomentum-688"><a href="#LinearMomentum-688"><span class="linenos">688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_solution_vector</span><span class="p">()</span>
</span><span id="LinearMomentum-689"><a href="#LinearMomentum-689"><span class="linenos">689</span></a>
</span><span id="LinearMomentum-690"><a href="#LinearMomentum-690"><span class="linenos">690</span></a>    <span class="k">def</span> <span class="nf">create_fenicsx_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-691"><a href="#LinearMomentum-691"><span class="linenos">691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-692"><a href="#LinearMomentum-692"><span class="linenos">692</span></a><span class="sd">        Allocate FE functions specific to this formulation.</span>
</span><span id="LinearMomentum-693"><a href="#LinearMomentum-693"><span class="linenos">693</span></a>
</span><span id="LinearMomentum-694"><a href="#LinearMomentum-694"><span class="linenos">694</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-695"><a href="#LinearMomentum-695"><span class="linenos">695</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-696"><a href="#LinearMomentum-696"><span class="linenos">696</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-697"><a href="#LinearMomentum-697"><span class="linenos">697</span></a>
</span><span id="LinearMomentum-698"><a href="#LinearMomentum-698"><span class="linenos">698</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-699"><a href="#LinearMomentum-699"><span class="linenos">699</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-700"><a href="#LinearMomentum-700"><span class="linenos">700</span></a><span class="sd">        Creates :attr:`C`, :attr:`CT` (DG0 66 tangents), and :attr:`eps_rhs`</span>
</span><span id="LinearMomentum-701"><a href="#LinearMomentum-701"><span class="linenos">701</span></a><span class="sd">        (DG0 33 RHS strain).</span>
</span><span id="LinearMomentum-702"><a href="#LinearMomentum-702"><span class="linenos">702</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-703"><a href="#LinearMomentum-703"><span class="linenos">703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_6x6</span><span class="p">)</span>
</span><span id="LinearMomentum-704"><a href="#LinearMomentum-704"><span class="linenos">704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CT</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_6x6</span><span class="p">)</span>
</span><span id="LinearMomentum-705"><a href="#LinearMomentum-705"><span class="linenos">705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span><span id="LinearMomentum-706"><a href="#LinearMomentum-706"><span class="linenos">706</span></a>
</span><span id="LinearMomentum-707"><a href="#LinearMomentum-707"><span class="linenos">707</span></a>    <span class="k">def</span> <span class="nf">create_pytorch_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-708"><a href="#LinearMomentum-708"><span class="linenos">708</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-709"><a href="#LinearMomentum-709"><span class="linenos">709</span></a><span class="sd">        Allocate torch tensors specific to this formulation.</span>
</span><span id="LinearMomentum-710"><a href="#LinearMomentum-710"><span class="linenos">710</span></a>
</span><span id="LinearMomentum-711"><a href="#LinearMomentum-711"><span class="linenos">711</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-712"><a href="#LinearMomentum-712"><span class="linenos">712</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-713"><a href="#LinearMomentum-713"><span class="linenos">713</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-714"><a href="#LinearMomentum-714"><span class="linenos">714</span></a>
</span><span id="LinearMomentum-715"><a href="#LinearMomentum-715"><span class="linenos">715</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-716"><a href="#LinearMomentum-716"><span class="linenos">716</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-717"><a href="#LinearMomentum-717"><span class="linenos">717</span></a><span class="sd">        Creates :attr:`eps_rhs_to` with shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-718"><a href="#LinearMomentum-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-719"><a href="#LinearMomentum-719"><span class="linenos">719</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="LinearMomentum-720"><a href="#LinearMomentum-720"><span class="linenos">720</span></a>
</span><span id="LinearMomentum-721"><a href="#LinearMomentum-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">create_trial_test_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-722"><a href="#LinearMomentum-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-723"><a href="#LinearMomentum-723"><span class="linenos">723</span></a><span class="sd">        Create UFL trial/test functions for displacement.</span>
</span><span id="LinearMomentum-724"><a href="#LinearMomentum-724"><span class="linenos">724</span></a>
</span><span id="LinearMomentum-725"><a href="#LinearMomentum-725"><span class="linenos">725</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-726"><a href="#LinearMomentum-726"><span class="linenos">726</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-727"><a href="#LinearMomentum-727"><span class="linenos">727</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-728"><a href="#LinearMomentum-728"><span class="linenos">728</span></a>
</span><span id="LinearMomentum-729"><a href="#LinearMomentum-729"><span class="linenos">729</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-730"><a href="#LinearMomentum-730"><span class="linenos">730</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-731"><a href="#LinearMomentum-731"><span class="linenos">731</span></a><span class="sd">        Defines :attr:`du` (trial) and :attr:`u_` (test) in :attr:`V`.</span>
</span><span id="LinearMomentum-732"><a href="#LinearMomentum-732"><span class="linenos">732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-733"><a href="#LinearMomentum-733"><span class="linenos">733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="LinearMomentum-734"><a href="#LinearMomentum-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u_</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="LinearMomentum-735"><a href="#LinearMomentum-735"><span class="linenos">735</span></a>
</span><span id="LinearMomentum-736"><a href="#LinearMomentum-736"><span class="linenos">736</span></a>    <span class="k">def</span> <span class="nf">get_uV</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">:</span>
</span><span id="LinearMomentum-737"><a href="#LinearMomentum-737"><span class="linenos">737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-738"><a href="#LinearMomentum-738"><span class="linenos">738</span></a><span class="sd">        Return the primary displacement function space.</span>
</span><span id="LinearMomentum-739"><a href="#LinearMomentum-739"><span class="linenos">739</span></a>
</span><span id="LinearMomentum-740"><a href="#LinearMomentum-740"><span class="linenos">740</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-741"><a href="#LinearMomentum-741"><span class="linenos">741</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-742"><a href="#LinearMomentum-742"><span class="linenos">742</span></a><span class="sd">        dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentum-743"><a href="#LinearMomentum-743"><span class="linenos">743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-744"><a href="#LinearMomentum-744"><span class="linenos">744</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
</span><span id="LinearMomentum-745"><a href="#LinearMomentum-745"><span class="linenos">745</span></a>
</span><span id="LinearMomentum-746"><a href="#LinearMomentum-746"><span class="linenos">746</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-747"><a href="#LinearMomentum-747"><span class="linenos">747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-748"><a href="#LinearMomentum-748"><span class="linenos">748</span></a><span class="sd">        Initialize elastic tangent from the material container.</span>
</span><span id="LinearMomentum-749"><a href="#LinearMomentum-749"><span class="linenos">749</span></a>
</span><span id="LinearMomentum-750"><a href="#LinearMomentum-750"><span class="linenos">750</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-751"><a href="#LinearMomentum-751"><span class="linenos">751</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-752"><a href="#LinearMomentum-752"><span class="linenos">752</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-753"><a href="#LinearMomentum-753"><span class="linenos">753</span></a>
</span><span id="LinearMomentum-754"><a href="#LinearMomentum-754"><span class="linenos">754</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-755"><a href="#LinearMomentum-755"><span class="linenos">755</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-756"><a href="#LinearMomentum-756"><span class="linenos">756</span></a><span class="sd">        Flattens and copies `mat.C` into :attr:`C`.</span>
</span><span id="LinearMomentum-757"><a href="#LinearMomentum-757"><span class="linenos">757</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-758"><a href="#LinearMomentum-758"><span class="linenos">758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span><span id="LinearMomentum-759"><a href="#LinearMomentum-759"><span class="linenos">759</span></a>
</span><span id="LinearMomentum-760"><a href="#LinearMomentum-760"><span class="linenos">760</span></a>    <span class="k">def</span> <span class="nf">compute_CT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-761"><a href="#LinearMomentum-761"><span class="linenos">761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-762"><a href="#LinearMomentum-762"><span class="linenos">762</span></a><span class="sd">        Assemble consistent tangent operator `CT` for the current step.</span>
</span><span id="LinearMomentum-763"><a href="#LinearMomentum-763"><span class="linenos">763</span></a>
</span><span id="LinearMomentum-764"><a href="#LinearMomentum-764"><span class="linenos">764</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum-765"><a href="#LinearMomentum-765"><span class="linenos">765</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum-766"><a href="#LinearMomentum-766"><span class="linenos">766</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentum-767"><a href="#LinearMomentum-767"><span class="linenos">767</span></a><span class="sd">            Stress from previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-768"><a href="#LinearMomentum-768"><span class="linenos">768</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentum-769"><a href="#LinearMomentum-769"><span class="linenos">769</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentum-770"><a href="#LinearMomentum-770"><span class="linenos">770</span></a>
</span><span id="LinearMomentum-771"><a href="#LinearMomentum-771"><span class="linenos">771</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-772"><a href="#LinearMomentum-772"><span class="linenos">772</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-773"><a href="#LinearMomentum-773"><span class="linenos">773</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-774"><a href="#LinearMomentum-774"><span class="linenos">774</span></a>
</span><span id="LinearMomentum-775"><a href="#LinearMomentum-775"><span class="linenos">775</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-776"><a href="#LinearMomentum-776"><span class="linenos">776</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-777"><a href="#LinearMomentum-777"><span class="linenos">777</span></a><span class="sd">        Updates material operators (`G`, `B`, `CT`) and copies to FE field :attr:`CT`.</span>
</span><span id="LinearMomentum-778"><a href="#LinearMomentum-778"><span class="linenos">778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-779"><a href="#LinearMomentum-779"><span class="linenos">779</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">compute_G_B</span><span class="p">(</span><span class="n">stress_k</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">)</span>
</span><span id="LinearMomentum-780"><a href="#LinearMomentum-780"><span class="linenos">780</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">compute_CT</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="LinearMomentum-781"><a href="#LinearMomentum-781"><span class="linenos">781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CT</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">CT</span><span class="p">)</span>
</span><span id="LinearMomentum-782"><a href="#LinearMomentum-782"><span class="linenos">782</span></a>
</span><span id="LinearMomentum-783"><a href="#LinearMomentum-783"><span class="linenos">783</span></a>    <span class="k">def</span> <span class="nf">compute_elastic_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_e</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentum-784"><a href="#LinearMomentum-784"><span class="linenos">784</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-785"><a href="#LinearMomentum-785"><span class="linenos">785</span></a><span class="sd">        Compute elastic Cauchy stress using the elastic stiffness `C`.</span>
</span><span id="LinearMomentum-786"><a href="#LinearMomentum-786"><span class="linenos">786</span></a>
</span><span id="LinearMomentum-787"><a href="#LinearMomentum-787"><span class="linenos">787</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum-788"><a href="#LinearMomentum-788"><span class="linenos">788</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum-789"><a href="#LinearMomentum-789"><span class="linenos">789</span></a><span class="sd">        eps_e : torch.Tensor</span>
</span><span id="LinearMomentum-790"><a href="#LinearMomentum-790"><span class="linenos">790</span></a><span class="sd">            Elastic strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-791"><a href="#LinearMomentum-791"><span class="linenos">791</span></a>
</span><span id="LinearMomentum-792"><a href="#LinearMomentum-792"><span class="linenos">792</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-793"><a href="#LinearMomentum-793"><span class="linenos">793</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-794"><a href="#LinearMomentum-794"><span class="linenos">794</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentum-795"><a href="#LinearMomentum-795"><span class="linenos">795</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-796"><a href="#LinearMomentum-796"><span class="linenos">796</span></a>
</span><span id="LinearMomentum-797"><a href="#LinearMomentum-797"><span class="linenos">797</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-798"><a href="#LinearMomentum-798"><span class="linenos">798</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-799"><a href="#LinearMomentum-799"><span class="linenos">799</span></a><span class="sd">        Copies the stress into :attr:`sig`.</span>
</span><span id="LinearMomentum-800"><a href="#LinearMomentum-800"><span class="linenos">800</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-801"><a href="#LinearMomentum-801"><span class="linenos">801</span></a>        <span class="n">stress_to</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">eps_e</span><span class="p">)</span>
</span><span id="LinearMomentum-802"><a href="#LinearMomentum-802"><span class="linenos">802</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">stress_to</span><span class="p">)</span>
</span><span id="LinearMomentum-803"><a href="#LinearMomentum-803"><span class="linenos">803</span></a>        <span class="k">return</span> <span class="n">stress_to</span>
</span><span id="LinearMomentum-804"><a href="#LinearMomentum-804"><span class="linenos">804</span></a>
</span><span id="LinearMomentum-805"><a href="#LinearMomentum-805"><span class="linenos">805</span></a>    <span class="k">def</span> <span class="nf">compute_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_tot_to</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentum-806"><a href="#LinearMomentum-806"><span class="linenos">806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-807"><a href="#LinearMomentum-807"><span class="linenos">807</span></a><span class="sd">        Compute stress using the consistent tangent and RHS strain.</span>
</span><span id="LinearMomentum-808"><a href="#LinearMomentum-808"><span class="linenos">808</span></a>
</span><span id="LinearMomentum-809"><a href="#LinearMomentum-809"><span class="linenos">809</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum-810"><a href="#LinearMomentum-810"><span class="linenos">810</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum-811"><a href="#LinearMomentum-811"><span class="linenos">811</span></a><span class="sd">        eps_tot_to : torch.Tensor</span>
</span><span id="LinearMomentum-812"><a href="#LinearMomentum-812"><span class="linenos">812</span></a><span class="sd">            Total strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-813"><a href="#LinearMomentum-813"><span class="linenos">813</span></a><span class="sd">        *_</span>
</span><span id="LinearMomentum-814"><a href="#LinearMomentum-814"><span class="linenos">814</span></a><span class="sd">            Unused extra arguments (kept for signature compatibility).</span>
</span><span id="LinearMomentum-815"><a href="#LinearMomentum-815"><span class="linenos">815</span></a>
</span><span id="LinearMomentum-816"><a href="#LinearMomentum-816"><span class="linenos">816</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-817"><a href="#LinearMomentum-817"><span class="linenos">817</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-818"><a href="#LinearMomentum-818"><span class="linenos">818</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentum-819"><a href="#LinearMomentum-819"><span class="linenos">819</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-820"><a href="#LinearMomentum-820"><span class="linenos">820</span></a>
</span><span id="LinearMomentum-821"><a href="#LinearMomentum-821"><span class="linenos">821</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-822"><a href="#LinearMomentum-822"><span class="linenos">822</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-823"><a href="#LinearMomentum-823"><span class="linenos">823</span></a><span class="sd">        Copies the stress into :attr:`sig`.</span>
</span><span id="LinearMomentum-824"><a href="#LinearMomentum-824"><span class="linenos">824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-825"><a href="#LinearMomentum-825"><span class="linenos">825</span></a>        <span class="n">stress_to</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">CT</span><span class="p">,</span> <span class="n">eps_tot_to</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span><span class="p">)</span>
</span><span id="LinearMomentum-826"><a href="#LinearMomentum-826"><span class="linenos">826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">stress_to</span><span class="p">)</span>
</span><span id="LinearMomentum-827"><a href="#LinearMomentum-827"><span class="linenos">827</span></a>        <span class="k">return</span> <span class="n">stress_to</span>
</span><span id="LinearMomentum-828"><a href="#LinearMomentum-828"><span class="linenos">828</span></a>
</span><span id="LinearMomentum-829"><a href="#LinearMomentum-829"><span class="linenos">829</span></a>    <span class="k">def</span> <span class="nf">compute_eps_rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-830"><a href="#LinearMomentum-830"><span class="linenos">830</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-831"><a href="#LinearMomentum-831"><span class="linenos">831</span></a><span class="sd">        Compute the right-hand-side strain term for the variational form.</span>
</span><span id="LinearMomentum-832"><a href="#LinearMomentum-832"><span class="linenos">832</span></a>
</span><span id="LinearMomentum-833"><a href="#LinearMomentum-833"><span class="linenos">833</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum-834"><a href="#LinearMomentum-834"><span class="linenos">834</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum-835"><a href="#LinearMomentum-835"><span class="linenos">835</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentum-836"><a href="#LinearMomentum-836"><span class="linenos">836</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentum-837"><a href="#LinearMomentum-837"><span class="linenos">837</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentum-838"><a href="#LinearMomentum-838"><span class="linenos">838</span></a><span class="sd">            Intermediate stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-839"><a href="#LinearMomentum-839"><span class="linenos">839</span></a>
</span><span id="LinearMomentum-840"><a href="#LinearMomentum-840"><span class="linenos">840</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-841"><a href="#LinearMomentum-841"><span class="linenos">841</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-842"><a href="#LinearMomentum-842"><span class="linenos">842</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-843"><a href="#LinearMomentum-843"><span class="linenos">843</span></a>
</span><span id="LinearMomentum-844"><a href="#LinearMomentum-844"><span class="linenos">844</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-845"><a href="#LinearMomentum-845"><span class="linenos">845</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-846"><a href="#LinearMomentum-846"><span class="linenos">846</span></a><span class="sd">        Sets :attr:`eps_rhs_to` (torch) and :attr:`eps_rhs` (FE field).</span>
</span><span id="LinearMomentum-847"><a href="#LinearMomentum-847"><span class="linenos">847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-848"><a href="#LinearMomentum-848"><span class="linenos">848</span></a>        <span class="n">eps_ne_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_k</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span id="LinearMomentum-849"><a href="#LinearMomentum-849"><span class="linenos">849</span></a>        <span class="n">eps_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_th</span><span class="p">()</span>
</span><span id="LinearMomentum-850"><a href="#LinearMomentum-850"><span class="linenos">850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span> <span class="o">=</span> <span class="n">eps_ne_k</span> <span class="o">+</span> <span class="n">eps_th</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">B</span> <span class="o">+</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">))</span>
</span><span id="LinearMomentum-851"><a href="#LinearMomentum-851"><span class="linenos">851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span><span class="p">)</span>
</span><span id="LinearMomentum-852"><a href="#LinearMomentum-852"><span class="linenos">852</span></a>
</span><span id="LinearMomentum-853"><a href="#LinearMomentum-853"><span class="linenos">853</span></a>    <span class="k">def</span> <span class="nf">solve_elastic_response</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-854"><a href="#LinearMomentum-854"><span class="linenos">854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-855"><a href="#LinearMomentum-855"><span class="linenos">855</span></a><span class="sd">        Solve the purely elastic boundary-value problem.</span>
</span><span id="LinearMomentum-856"><a href="#LinearMomentum-856"><span class="linenos">856</span></a>
</span><span id="LinearMomentum-857"><a href="#LinearMomentum-857"><span class="linenos">857</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-858"><a href="#LinearMomentum-858"><span class="linenos">858</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-859"><a href="#LinearMomentum-859"><span class="linenos">859</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-860"><a href="#LinearMomentum-860"><span class="linenos">860</span></a>
</span><span id="LinearMomentum-861"><a href="#LinearMomentum-861"><span class="linenos">861</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-862"><a href="#LinearMomentum-862"><span class="linenos">862</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-863"><a href="#LinearMomentum-863"><span class="linenos">863</span></a><span class="sd">        - Assembles and solves the linear system with :math:`C`.</span>
</span><span id="LinearMomentum-864"><a href="#LinearMomentum-864"><span class="linenos">864</span></a><span class="sd">        - Updates :attr:`X` and calls :meth:`split_solution`.</span>
</span><span id="LinearMomentum-865"><a href="#LinearMomentum-865"><span class="linenos">865</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-866"><a href="#LinearMomentum-866"><span class="linenos">866</span></a>        <span class="c1"># Build bilinear form</span>
</span><span id="LinearMomentum-867"><a href="#LinearMomentum-867"><span class="linenos">867</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dotdot_ufl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)),</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentum-868"><a href="#LinearMomentum-868"><span class="linenos">868</span></a>        <span class="n">bilinear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="LinearMomentum-869"><a href="#LinearMomentum-869"><span class="linenos">869</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">assemble_matrix</span><span class="p">(</span><span class="n">bilinear_form</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum-870"><a href="#LinearMomentum-870"><span class="linenos">870</span></a>        <span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</span><span id="LinearMomentum-871"><a href="#LinearMomentum-871"><span class="linenos">871</span></a>
</span><span id="LinearMomentum-872"><a href="#LinearMomentum-872"><span class="linenos">872</span></a>        <span class="c1"># Build linear form</span>
</span><span id="LinearMomentum-873"><a href="#LinearMomentum-873"><span class="linenos">873</span></a>        <span class="n">linear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_body</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">neumann_bcs</span><span class="p">))</span>
</span><span id="LinearMomentum-874"><a href="#LinearMomentum-874"><span class="linenos">874</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">fem_petsc</span><span class="o">.</span><span class="n">assemble_vector</span><span class="p">(</span><span class="n">linear_form</span><span class="p">)</span>
</span><span id="LinearMomentum-875"><a href="#LinearMomentum-875"><span class="linenos">875</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">apply_lifting</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">bilinear_form</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">])</span>
</span><span id="LinearMomentum-876"><a href="#LinearMomentum-876"><span class="linenos">876</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">ADD_VALUES</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">)</span>
</span><span id="LinearMomentum-877"><a href="#LinearMomentum-877"><span class="linenos">877</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">set_bc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum-878"><a href="#LinearMomentum-878"><span class="linenos">878</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
</span><span id="LinearMomentum-879"><a href="#LinearMomentum-879"><span class="linenos">879</span></a>
</span><span id="LinearMomentum-880"><a href="#LinearMomentum-880"><span class="linenos">880</span></a>        <span class="c1"># Solve linear system</span>
</span><span id="LinearMomentum-881"><a href="#LinearMomentum-881"><span class="linenos">881</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="LinearMomentum-882"><a href="#LinearMomentum-882"><span class="linenos">882</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">petsc_vec</span><span class="p">)</span>
</span><span id="LinearMomentum-883"><a href="#LinearMomentum-883"><span class="linenos">883</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">scatter_forward</span><span class="p">()</span>
</span><span id="LinearMomentum-884"><a href="#LinearMomentum-884"><span class="linenos">884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_solution</span><span class="p">()</span>
</span><span id="LinearMomentum-885"><a href="#LinearMomentum-885"><span class="linenos">885</span></a>
</span><span id="LinearMomentum-886"><a href="#LinearMomentum-886"><span class="linenos">886</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-887"><a href="#LinearMomentum-887"><span class="linenos">887</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-888"><a href="#LinearMomentum-888"><span class="linenos">888</span></a><span class="sd">        Assign displacement solution `X` to the primary field `u`.</span>
</span><span id="LinearMomentum-889"><a href="#LinearMomentum-889"><span class="linenos">889</span></a>
</span><span id="LinearMomentum-890"><a href="#LinearMomentum-890"><span class="linenos">890</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-891"><a href="#LinearMomentum-891"><span class="linenos">891</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-892"><a href="#LinearMomentum-892"><span class="linenos">892</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-893"><a href="#LinearMomentum-893"><span class="linenos">893</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-894"><a href="#LinearMomentum-894"><span class="linenos">894</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
</span><span id="LinearMomentum-895"><a href="#LinearMomentum-895"><span class="linenos">895</span></a>
</span><span id="LinearMomentum-896"><a href="#LinearMomentum-896"><span class="linenos">896</span></a>	<span class="c1"># def compute_p_nodes(self) -&gt; do.fem.Function:</span>
</span><span id="LinearMomentum-897"><a href="#LinearMomentum-897"><span class="linenos">897</span></a>	<span class="c1"># 	self.p_nodes = project(ufl.tr(self.sig)/3, self.CG1_1)</span>
</span><span id="LinearMomentum-898"><a href="#LinearMomentum-898"><span class="linenos">898</span></a>
</span><span id="LinearMomentum-899"><a href="#LinearMomentum-899"><span class="linenos">899</span></a>	<span class="c1"># def compute_p_elems(self) -&gt; do.fem.Function:</span>
</span><span id="LinearMomentum-900"><a href="#LinearMomentum-900"><span class="linenos">900</span></a>	<span class="c1"># 	# self.p_elems = project(ufl.tr(self.sig)/3, self.DG0_1)</span>
</span><span id="LinearMomentum-901"><a href="#LinearMomentum-901"><span class="linenos">901</span></a>	<span class="c1"># 	stress_to = numpy2torch(self.sig.x.array.reshape((self.n_elems, 3, 3)))</span>
</span><span id="LinearMomentum-902"><a href="#LinearMomentum-902"><span class="linenos">902</span></a>	<span class="c1"># 	p_to = to.einsum(&quot;kii-&gt;k&quot;, stress_to)</span>
</span><span id="LinearMomentum-903"><a href="#LinearMomentum-903"><span class="linenos">903</span></a>	<span class="c1"># 	self.p_elems.x.array[:] = to.flatten(p_to)</span>
</span><span id="LinearMomentum-904"><a href="#LinearMomentum-904"><span class="linenos">904</span></a>
</span><span id="LinearMomentum-905"><a href="#LinearMomentum-905"><span class="linenos">905</span></a>    <span class="k">def</span> <span class="nf">compute_p_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-906"><a href="#LinearMomentum-906"><span class="linenos">906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-907"><a href="#LinearMomentum-907"><span class="linenos">907</span></a><span class="sd">        Compute nodal pressure ``p = tr()/3`` via node-element averaging.</span>
</span><span id="LinearMomentum-908"><a href="#LinearMomentum-908"><span class="linenos">908</span></a>
</span><span id="LinearMomentum-909"><a href="#LinearMomentum-909"><span class="linenos">909</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-910"><a href="#LinearMomentum-910"><span class="linenos">910</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-911"><a href="#LinearMomentum-911"><span class="linenos">911</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-912"><a href="#LinearMomentum-912"><span class="linenos">912</span></a>
</span><span id="LinearMomentum-913"><a href="#LinearMomentum-913"><span class="linenos">913</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-914"><a href="#LinearMomentum-914"><span class="linenos">914</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-915"><a href="#LinearMomentum-915"><span class="linenos">915</span></a><span class="sd">        Writes to :attr:`p_nodes`.</span>
</span><span id="LinearMomentum-916"><a href="#LinearMomentum-916"><span class="linenos">916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-917"><a href="#LinearMomentum-917"><span class="linenos">917</span></a>        <span class="n">stress</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentum-918"><a href="#LinearMomentum-918"><span class="linenos">918</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LinearMomentum-919"><a href="#LinearMomentum-919"><span class="linenos">919</span></a>        <span class="n">p_to</span> <span class="o">=</span> <span class="n">I1</span><span class="o">/</span><span class="mi">3</span>
</span><span id="LinearMomentum-920"><a href="#LinearMomentum-920"><span class="linenos">920</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_nodes</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">A_csr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p_to</span><span class="p">)</span>
</span><span id="LinearMomentum-921"><a href="#LinearMomentum-921"><span class="linenos">921</span></a>
</span><span id="LinearMomentum-922"><a href="#LinearMomentum-922"><span class="linenos">922</span></a>    <span class="k">def</span> <span class="nf">compute_p_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-923"><a href="#LinearMomentum-923"><span class="linenos">923</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-924"><a href="#LinearMomentum-924"><span class="linenos">924</span></a><span class="sd">        Compute element pressure by smoothing the nodal trace of stress.</span>
</span><span id="LinearMomentum-925"><a href="#LinearMomentum-925"><span class="linenos">925</span></a>
</span><span id="LinearMomentum-926"><a href="#LinearMomentum-926"><span class="linenos">926</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-927"><a href="#LinearMomentum-927"><span class="linenos">927</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-928"><a href="#LinearMomentum-928"><span class="linenos">928</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-929"><a href="#LinearMomentum-929"><span class="linenos">929</span></a>
</span><span id="LinearMomentum-930"><a href="#LinearMomentum-930"><span class="linenos">930</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-931"><a href="#LinearMomentum-931"><span class="linenos">931</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-932"><a href="#LinearMomentum-932"><span class="linenos">932</span></a><span class="sd">        Writes to :attr:`p_elems`.</span>
</span><span id="LinearMomentum-933"><a href="#LinearMomentum-933"><span class="linenos">933</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-934"><a href="#LinearMomentum-934"><span class="linenos">934</span></a>        <span class="n">stress_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentum-935"><a href="#LinearMomentum-935"><span class="linenos">935</span></a>        <span class="n">p_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;kii-&gt;k&quot;</span><span class="p">,</span> <span class="n">stress_to</span><span class="p">)</span>
</span><span id="LinearMomentum-936"><a href="#LinearMomentum-936"><span class="linenos">936</span></a>        <span class="n">p_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">smoother</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p_to</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="LinearMomentum-937"><a href="#LinearMomentum-937"><span class="linenos">937</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_elems</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">p_to</span>
</span><span id="LinearMomentum-938"><a href="#LinearMomentum-938"><span class="linenos">938</span></a>
</span><span id="LinearMomentum-939"><a href="#LinearMomentum-939"><span class="linenos">939</span></a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum-940"><a href="#LinearMomentum-940"><span class="linenos">940</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum-941"><a href="#LinearMomentum-941"><span class="linenos">941</span></a><span class="sd">        Assemble and solve one implicit time step for the inelastic problem.</span>
</span><span id="LinearMomentum-942"><a href="#LinearMomentum-942"><span class="linenos">942</span></a>
</span><span id="LinearMomentum-943"><a href="#LinearMomentum-943"><span class="linenos">943</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum-944"><a href="#LinearMomentum-944"><span class="linenos">944</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum-945"><a href="#LinearMomentum-945"><span class="linenos">945</span></a><span class="sd">        stress_k_to : torch.Tensor</span>
</span><span id="LinearMomentum-946"><a href="#LinearMomentum-946"><span class="linenos">946</span></a><span class="sd">            Stress at previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum-947"><a href="#LinearMomentum-947"><span class="linenos">947</span></a><span class="sd">        t : float</span>
</span><span id="LinearMomentum-948"><a href="#LinearMomentum-948"><span class="linenos">948</span></a><span class="sd">            Current time (used by BC handler externally).</span>
</span><span id="LinearMomentum-949"><a href="#LinearMomentum-949"><span class="linenos">949</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentum-950"><a href="#LinearMomentum-950"><span class="linenos">950</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentum-951"><a href="#LinearMomentum-951"><span class="linenos">951</span></a>
</span><span id="LinearMomentum-952"><a href="#LinearMomentum-952"><span class="linenos">952</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum-953"><a href="#LinearMomentum-953"><span class="linenos">953</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum-954"><a href="#LinearMomentum-954"><span class="linenos">954</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum-955"><a href="#LinearMomentum-955"><span class="linenos">955</span></a>
</span><span id="LinearMomentum-956"><a href="#LinearMomentum-956"><span class="linenos">956</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum-957"><a href="#LinearMomentum-957"><span class="linenos">957</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum-958"><a href="#LinearMomentum-958"><span class="linenos">958</span></a><span class="sd">        - Builds `CT` and `eps_rhs`, assembles and solves the linear system.</span>
</span><span id="LinearMomentum-959"><a href="#LinearMomentum-959"><span class="linenos">959</span></a><span class="sd">        - Updates :attr:`X`, calls :meth:`split_solution`, then :meth:`run_after_solve`.</span>
</span><span id="LinearMomentum-960"><a href="#LinearMomentum-960"><span class="linenos">960</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum-961"><a href="#LinearMomentum-961"><span class="linenos">961</span></a>
</span><span id="LinearMomentum-962"><a href="#LinearMomentum-962"><span class="linenos">962</span></a>        <span class="c1"># Compute consistent tangent matrix</span>
</span><span id="LinearMomentum-963"><a href="#LinearMomentum-963"><span class="linenos">963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_CT</span><span class="p">(</span><span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="LinearMomentum-964"><a href="#LinearMomentum-964"><span class="linenos">964</span></a>
</span><span id="LinearMomentum-965"><a href="#LinearMomentum-965"><span class="linenos">965</span></a>        <span class="c1"># Compute right-hand side epsilon</span>
</span><span id="LinearMomentum-966"><a href="#LinearMomentum-966"><span class="linenos">966</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_rhs</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">)</span>
</span><span id="LinearMomentum-967"><a href="#LinearMomentum-967"><span class="linenos">967</span></a>
</span><span id="LinearMomentum-968"><a href="#LinearMomentum-968"><span class="linenos">968</span></a>        <span class="c1"># Build bilinear form</span>
</span><span id="LinearMomentum-969"><a href="#LinearMomentum-969"><span class="linenos">969</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dotdot_ufl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CT</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)),</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentum-970"><a href="#LinearMomentum-970"><span class="linenos">970</span></a>        <span class="n">bilinear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="LinearMomentum-971"><a href="#LinearMomentum-971"><span class="linenos">971</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">fem_petsc</span><span class="o">.</span><span class="n">assemble_matrix</span><span class="p">(</span><span class="n">bilinear_form</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum-972"><a href="#LinearMomentum-972"><span class="linenos">972</span></a>        <span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</span><span id="LinearMomentum-973"><a href="#LinearMomentum-973"><span class="linenos">973</span></a>
</span><span id="LinearMomentum-974"><a href="#LinearMomentum-974"><span class="linenos">974</span></a>        <span class="c1"># Build linear form</span>
</span><span id="LinearMomentum-975"><a href="#LinearMomentum-975"><span class="linenos">975</span></a>        <span class="n">b_rhs</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dotdot_ufl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs</span><span class="p">),</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentum-976"><a href="#LinearMomentum-976"><span class="linenos">976</span></a>        <span class="n">linear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_body</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">neumann_bcs</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_rhs</span><span class="p">)</span>
</span><span id="LinearMomentum-977"><a href="#LinearMomentum-977"><span class="linenos">977</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">fem_petsc</span><span class="o">.</span><span class="n">assemble_vector</span><span class="p">(</span><span class="n">linear_form</span><span class="p">)</span>
</span><span id="LinearMomentum-978"><a href="#LinearMomentum-978"><span class="linenos">978</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">apply_lifting</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">bilinear_form</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">])</span>
</span><span id="LinearMomentum-979"><a href="#LinearMomentum-979"><span class="linenos">979</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">ADD_VALUES</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">)</span>
</span><span id="LinearMomentum-980"><a href="#LinearMomentum-980"><span class="linenos">980</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">set_bc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum-981"><a href="#LinearMomentum-981"><span class="linenos">981</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
</span><span id="LinearMomentum-982"><a href="#LinearMomentum-982"><span class="linenos">982</span></a>
</span><span id="LinearMomentum-983"><a href="#LinearMomentum-983"><span class="linenos">983</span></a>        <span class="c1"># Solve linear system</span>
</span><span id="LinearMomentum-984"><a href="#LinearMomentum-984"><span class="linenos">984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="LinearMomentum-985"><a href="#LinearMomentum-985"><span class="linenos">985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">petsc_vec</span><span class="p">)</span>
</span><span id="LinearMomentum-986"><a href="#LinearMomentum-986"><span class="linenos">986</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">scatter_forward</span><span class="p">()</span>
</span><span id="LinearMomentum-987"><a href="#LinearMomentum-987"><span class="linenos">987</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_solution</span><span class="p">()</span>
</span><span id="LinearMomentum-988"><a href="#LinearMomentum-988"><span class="linenos">988</span></a>
</span><span id="LinearMomentum-989"><a href="#LinearMomentum-989"><span class="linenos">989</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_after_solve</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Linear momentum formulation with thermo-(visco)elastic tangent.</p>

<p>Implements the concrete FE fields, consistent tangent assembly, right-hand
side strain, and linear solves for both elastic and inelastic steps.</p>
</div>


                            <div id="LinearMomentum.__init__" class="classattr">
                                        <input id="LinearMomentum.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LinearMomentum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">grid</span><span class="p">:</span> <span class="n"><a href="#GridHandlerGMSH">GridHandlerGMSH</a></span>, </span><span class="param"><span class="n">theta</span><span class="p">:</span> <span class="nb">float</span></span>)</span>

                <label class="view-source-button" for="LinearMomentum.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.__init__-675"><a href="#LinearMomentum.__init__-675"><span class="linenos">675</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">GridHandlerGMSH</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="LinearMomentum.__init__-676"><a href="#LinearMomentum.__init__-676"><span class="linenos">676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.__init__-677"><a href="#LinearMomentum.__init__-677"><span class="linenos">677</span></a><span class="sd">        Initialize spaces, measures, fields, and solution vector.</span>
</span><span id="LinearMomentum.__init__-678"><a href="#LinearMomentum.__init__-678"><span class="linenos">678</span></a>
</span><span id="LinearMomentum.__init__-679"><a href="#LinearMomentum.__init__-679"><span class="linenos">679</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum.__init__-680"><a href="#LinearMomentum.__init__-680"><span class="linenos">680</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum.__init__-681"><a href="#LinearMomentum.__init__-681"><span class="linenos">681</span></a><span class="sd">        grid : GridHandlerGMSH</span>
</span><span id="LinearMomentum.__init__-682"><a href="#LinearMomentum.__init__-682"><span class="linenos">682</span></a><span class="sd">        theta : float</span>
</span><span id="LinearMomentum.__init__-683"><a href="#LinearMomentum.__init__-683"><span class="linenos">683</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.__init__-684"><a href="#LinearMomentum.__init__-684"><span class="linenos">684</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="LinearMomentum.__init__-685"><a href="#LinearMomentum.__init__-685"><span class="linenos">685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CG1_3x1</span>
</span><span id="LinearMomentum.__init__-686"><a href="#LinearMomentum.__init__-686"><span class="linenos">686</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_trial_test_functions</span><span class="p">()</span>
</span><span id="LinearMomentum.__init__-687"><a href="#LinearMomentum.__init__-687"><span class="linenos">687</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_normal</span><span class="p">()</span>
</span><span id="LinearMomentum.__init__-688"><a href="#LinearMomentum.__init__-688"><span class="linenos">688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_solution_vector</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize spaces, measures, fields, and solution vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>grid</strong> (GridHandlerGMSH):</p></li>
<li><p><strong>theta</strong> (float):</p></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentum.V" class="classattr">
                                <div class="attr variable">
            <span class="name">V</span>

        
    </div>
    <a class="headerlink" href="#LinearMomentum.V"></a>
    
    

                            </div>
                            <div id="LinearMomentum.create_fenicsx_fields" class="classattr">
                                        <input id="LinearMomentum.create_fenicsx_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_fenicsx_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.create_fenicsx_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.create_fenicsx_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.create_fenicsx_fields-690"><a href="#LinearMomentum.create_fenicsx_fields-690"><span class="linenos">690</span></a>    <span class="k">def</span> <span class="nf">create_fenicsx_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.create_fenicsx_fields-691"><a href="#LinearMomentum.create_fenicsx_fields-691"><span class="linenos">691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.create_fenicsx_fields-692"><a href="#LinearMomentum.create_fenicsx_fields-692"><span class="linenos">692</span></a><span class="sd">        Allocate FE functions specific to this formulation.</span>
</span><span id="LinearMomentum.create_fenicsx_fields-693"><a href="#LinearMomentum.create_fenicsx_fields-693"><span class="linenos">693</span></a>
</span><span id="LinearMomentum.create_fenicsx_fields-694"><a href="#LinearMomentum.create_fenicsx_fields-694"><span class="linenos">694</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.create_fenicsx_fields-695"><a href="#LinearMomentum.create_fenicsx_fields-695"><span class="linenos">695</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.create_fenicsx_fields-696"><a href="#LinearMomentum.create_fenicsx_fields-696"><span class="linenos">696</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.create_fenicsx_fields-697"><a href="#LinearMomentum.create_fenicsx_fields-697"><span class="linenos">697</span></a>
</span><span id="LinearMomentum.create_fenicsx_fields-698"><a href="#LinearMomentum.create_fenicsx_fields-698"><span class="linenos">698</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.create_fenicsx_fields-699"><a href="#LinearMomentum.create_fenicsx_fields-699"><span class="linenos">699</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.create_fenicsx_fields-700"><a href="#LinearMomentum.create_fenicsx_fields-700"><span class="linenos">700</span></a><span class="sd">        Creates :attr:`C`, :attr:`CT` (DG0 66 tangents), and :attr:`eps_rhs`</span>
</span><span id="LinearMomentum.create_fenicsx_fields-701"><a href="#LinearMomentum.create_fenicsx_fields-701"><span class="linenos">701</span></a><span class="sd">        (DG0 33 RHS strain).</span>
</span><span id="LinearMomentum.create_fenicsx_fields-702"><a href="#LinearMomentum.create_fenicsx_fields-702"><span class="linenos">702</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.create_fenicsx_fields-703"><a href="#LinearMomentum.create_fenicsx_fields-703"><span class="linenos">703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_6x6</span><span class="p">)</span>
</span><span id="LinearMomentum.create_fenicsx_fields-704"><a href="#LinearMomentum.create_fenicsx_fields-704"><span class="linenos">704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CT</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_6x6</span><span class="p">)</span>
</span><span id="LinearMomentum.create_fenicsx_fields-705"><a href="#LinearMomentum.create_fenicsx_fields-705"><span class="linenos">705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DG0_3x3</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Allocate FE functions specific to this formulation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Creates <code>C</code>, <code>CT</code> (DG0 66 tangents), and <code>eps_rhs</code>
(DG0 33 RHS strain).</p>
</div>


                            </div>
                            <div id="LinearMomentum.create_pytorch_fields" class="classattr">
                                        <input id="LinearMomentum.create_pytorch_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_pytorch_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.create_pytorch_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.create_pytorch_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.create_pytorch_fields-707"><a href="#LinearMomentum.create_pytorch_fields-707"><span class="linenos">707</span></a>    <span class="k">def</span> <span class="nf">create_pytorch_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.create_pytorch_fields-708"><a href="#LinearMomentum.create_pytorch_fields-708"><span class="linenos">708</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.create_pytorch_fields-709"><a href="#LinearMomentum.create_pytorch_fields-709"><span class="linenos">709</span></a><span class="sd">        Allocate torch tensors specific to this formulation.</span>
</span><span id="LinearMomentum.create_pytorch_fields-710"><a href="#LinearMomentum.create_pytorch_fields-710"><span class="linenos">710</span></a>
</span><span id="LinearMomentum.create_pytorch_fields-711"><a href="#LinearMomentum.create_pytorch_fields-711"><span class="linenos">711</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.create_pytorch_fields-712"><a href="#LinearMomentum.create_pytorch_fields-712"><span class="linenos">712</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.create_pytorch_fields-713"><a href="#LinearMomentum.create_pytorch_fields-713"><span class="linenos">713</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.create_pytorch_fields-714"><a href="#LinearMomentum.create_pytorch_fields-714"><span class="linenos">714</span></a>
</span><span id="LinearMomentum.create_pytorch_fields-715"><a href="#LinearMomentum.create_pytorch_fields-715"><span class="linenos">715</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.create_pytorch_fields-716"><a href="#LinearMomentum.create_pytorch_fields-716"><span class="linenos">716</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.create_pytorch_fields-717"><a href="#LinearMomentum.create_pytorch_fields-717"><span class="linenos">717</span></a><span class="sd">        Creates :attr:`eps_rhs_to` with shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.create_pytorch_fields-718"><a href="#LinearMomentum.create_pytorch_fields-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.create_pytorch_fields-719"><a href="#LinearMomentum.create_pytorch_fields-719"><span class="linenos">719</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Allocate torch tensors specific to this formulation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Creates <code>eps_rhs_to</code> with shape <code>(n_elems, 3, 3)</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.create_trial_test_functions" class="classattr">
                                        <input id="LinearMomentum.create_trial_test_functions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_trial_test_functions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.create_trial_test_functions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.create_trial_test_functions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.create_trial_test_functions-721"><a href="#LinearMomentum.create_trial_test_functions-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">create_trial_test_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.create_trial_test_functions-722"><a href="#LinearMomentum.create_trial_test_functions-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.create_trial_test_functions-723"><a href="#LinearMomentum.create_trial_test_functions-723"><span class="linenos">723</span></a><span class="sd">        Create UFL trial/test functions for displacement.</span>
</span><span id="LinearMomentum.create_trial_test_functions-724"><a href="#LinearMomentum.create_trial_test_functions-724"><span class="linenos">724</span></a>
</span><span id="LinearMomentum.create_trial_test_functions-725"><a href="#LinearMomentum.create_trial_test_functions-725"><span class="linenos">725</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.create_trial_test_functions-726"><a href="#LinearMomentum.create_trial_test_functions-726"><span class="linenos">726</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.create_trial_test_functions-727"><a href="#LinearMomentum.create_trial_test_functions-727"><span class="linenos">727</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.create_trial_test_functions-728"><a href="#LinearMomentum.create_trial_test_functions-728"><span class="linenos">728</span></a>
</span><span id="LinearMomentum.create_trial_test_functions-729"><a href="#LinearMomentum.create_trial_test_functions-729"><span class="linenos">729</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.create_trial_test_functions-730"><a href="#LinearMomentum.create_trial_test_functions-730"><span class="linenos">730</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.create_trial_test_functions-731"><a href="#LinearMomentum.create_trial_test_functions-731"><span class="linenos">731</span></a><span class="sd">        Defines :attr:`du` (trial) and :attr:`u_` (test) in :attr:`V`.</span>
</span><span id="LinearMomentum.create_trial_test_functions-732"><a href="#LinearMomentum.create_trial_test_functions-732"><span class="linenos">732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.create_trial_test_functions-733"><a href="#LinearMomentum.create_trial_test_functions-733"><span class="linenos">733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span><span id="LinearMomentum.create_trial_test_functions-734"><a href="#LinearMomentum.create_trial_test_functions-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u_</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create UFL trial/test functions for displacement.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Defines <code>du</code> (trial) and <code>u_</code> (test) in <code><a href="#LinearMomentum.V">V</a></code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.get_uV" class="classattr">
                                        <input id="LinearMomentum.get_uV-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_uV</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">dolfinx</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">FunctionSpace</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.get_uV-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.get_uV"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.get_uV-736"><a href="#LinearMomentum.get_uV-736"><span class="linenos">736</span></a>    <span class="k">def</span> <span class="nf">get_uV</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">:</span>
</span><span id="LinearMomentum.get_uV-737"><a href="#LinearMomentum.get_uV-737"><span class="linenos">737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.get_uV-738"><a href="#LinearMomentum.get_uV-738"><span class="linenos">738</span></a><span class="sd">        Return the primary displacement function space.</span>
</span><span id="LinearMomentum.get_uV-739"><a href="#LinearMomentum.get_uV-739"><span class="linenos">739</span></a>
</span><span id="LinearMomentum.get_uV-740"><a href="#LinearMomentum.get_uV-740"><span class="linenos">740</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.get_uV-741"><a href="#LinearMomentum.get_uV-741"><span class="linenos">741</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.get_uV-742"><a href="#LinearMomentum.get_uV-742"><span class="linenos">742</span></a><span class="sd">        dolfinx.fem.FunctionSpace</span>
</span><span id="LinearMomentum.get_uV-743"><a href="#LinearMomentum.get_uV-743"><span class="linenos">743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.get_uV-744"><a href="#LinearMomentum.get_uV-744"><span class="linenos">744</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
</span></pre></div>


            <div class="docstring"><p>Return the primary displacement function space.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dolfinx.fem.FunctionSpace</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentum.initialize" class="classattr">
                                        <input id="LinearMomentum.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.initialize-746"><a href="#LinearMomentum.initialize-746"><span class="linenos">746</span></a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.initialize-747"><a href="#LinearMomentum.initialize-747"><span class="linenos">747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.initialize-748"><a href="#LinearMomentum.initialize-748"><span class="linenos">748</span></a><span class="sd">        Initialize elastic tangent from the material container.</span>
</span><span id="LinearMomentum.initialize-749"><a href="#LinearMomentum.initialize-749"><span class="linenos">749</span></a>
</span><span id="LinearMomentum.initialize-750"><a href="#LinearMomentum.initialize-750"><span class="linenos">750</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.initialize-751"><a href="#LinearMomentum.initialize-751"><span class="linenos">751</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.initialize-752"><a href="#LinearMomentum.initialize-752"><span class="linenos">752</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.initialize-753"><a href="#LinearMomentum.initialize-753"><span class="linenos">753</span></a>
</span><span id="LinearMomentum.initialize-754"><a href="#LinearMomentum.initialize-754"><span class="linenos">754</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.initialize-755"><a href="#LinearMomentum.initialize-755"><span class="linenos">755</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.initialize-756"><a href="#LinearMomentum.initialize-756"><span class="linenos">756</span></a><span class="sd">        Flattens and copies `mat.C` into :attr:`C`.</span>
</span><span id="LinearMomentum.initialize-757"><a href="#LinearMomentum.initialize-757"><span class="linenos">757</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.initialize-758"><a href="#LinearMomentum.initialize-758"><span class="linenos">758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize elastic tangent from the material container.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Flattens and copies <code>mat.C</code> into <code>C</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.compute_CT" class="classattr">
                                        <input id="LinearMomentum.compute_CT-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_CT</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.compute_CT-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.compute_CT"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.compute_CT-760"><a href="#LinearMomentum.compute_CT-760"><span class="linenos">760</span></a>    <span class="k">def</span> <span class="nf">compute_CT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.compute_CT-761"><a href="#LinearMomentum.compute_CT-761"><span class="linenos">761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_CT-762"><a href="#LinearMomentum.compute_CT-762"><span class="linenos">762</span></a><span class="sd">        Assemble consistent tangent operator `CT` for the current step.</span>
</span><span id="LinearMomentum.compute_CT-763"><a href="#LinearMomentum.compute_CT-763"><span class="linenos">763</span></a>
</span><span id="LinearMomentum.compute_CT-764"><a href="#LinearMomentum.compute_CT-764"><span class="linenos">764</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum.compute_CT-765"><a href="#LinearMomentum.compute_CT-765"><span class="linenos">765</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum.compute_CT-766"><a href="#LinearMomentum.compute_CT-766"><span class="linenos">766</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentum.compute_CT-767"><a href="#LinearMomentum.compute_CT-767"><span class="linenos">767</span></a><span class="sd">            Stress from previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.compute_CT-768"><a href="#LinearMomentum.compute_CT-768"><span class="linenos">768</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentum.compute_CT-769"><a href="#LinearMomentum.compute_CT-769"><span class="linenos">769</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentum.compute_CT-770"><a href="#LinearMomentum.compute_CT-770"><span class="linenos">770</span></a>
</span><span id="LinearMomentum.compute_CT-771"><a href="#LinearMomentum.compute_CT-771"><span class="linenos">771</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.compute_CT-772"><a href="#LinearMomentum.compute_CT-772"><span class="linenos">772</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.compute_CT-773"><a href="#LinearMomentum.compute_CT-773"><span class="linenos">773</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.compute_CT-774"><a href="#LinearMomentum.compute_CT-774"><span class="linenos">774</span></a>
</span><span id="LinearMomentum.compute_CT-775"><a href="#LinearMomentum.compute_CT-775"><span class="linenos">775</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.compute_CT-776"><a href="#LinearMomentum.compute_CT-776"><span class="linenos">776</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.compute_CT-777"><a href="#LinearMomentum.compute_CT-777"><span class="linenos">777</span></a><span class="sd">        Updates material operators (`G`, `B`, `CT`) and copies to FE field :attr:`CT`.</span>
</span><span id="LinearMomentum.compute_CT-778"><a href="#LinearMomentum.compute_CT-778"><span class="linenos">778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_CT-779"><a href="#LinearMomentum.compute_CT-779"><span class="linenos">779</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">compute_G_B</span><span class="p">(</span><span class="n">stress_k</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_CT-780"><a href="#LinearMomentum.compute_CT-780"><span class="linenos">780</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">compute_CT</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_CT-781"><a href="#LinearMomentum.compute_CT-781"><span class="linenos">781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CT</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">CT</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Assemble consistent tangent operator <code>CT</code> for the current step.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress_k</strong> (torch.Tensor):
Stress from previous iteration k, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>dt</strong> (float):
Time-step size.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Updates material operators (<code>G</code>, <code>B</code>, <code>CT</code>) and copies to FE field <code>CT</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.compute_elastic_stress" class="classattr">
                                        <input id="LinearMomentum.compute_elastic_stress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_elastic_stress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">eps_e</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.compute_elastic_stress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.compute_elastic_stress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.compute_elastic_stress-783"><a href="#LinearMomentum.compute_elastic_stress-783"><span class="linenos">783</span></a>    <span class="k">def</span> <span class="nf">compute_elastic_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_e</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentum.compute_elastic_stress-784"><a href="#LinearMomentum.compute_elastic_stress-784"><span class="linenos">784</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_elastic_stress-785"><a href="#LinearMomentum.compute_elastic_stress-785"><span class="linenos">785</span></a><span class="sd">        Compute elastic Cauchy stress using the elastic stiffness `C`.</span>
</span><span id="LinearMomentum.compute_elastic_stress-786"><a href="#LinearMomentum.compute_elastic_stress-786"><span class="linenos">786</span></a>
</span><span id="LinearMomentum.compute_elastic_stress-787"><a href="#LinearMomentum.compute_elastic_stress-787"><span class="linenos">787</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum.compute_elastic_stress-788"><a href="#LinearMomentum.compute_elastic_stress-788"><span class="linenos">788</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum.compute_elastic_stress-789"><a href="#LinearMomentum.compute_elastic_stress-789"><span class="linenos">789</span></a><span class="sd">        eps_e : torch.Tensor</span>
</span><span id="LinearMomentum.compute_elastic_stress-790"><a href="#LinearMomentum.compute_elastic_stress-790"><span class="linenos">790</span></a><span class="sd">            Elastic strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.compute_elastic_stress-791"><a href="#LinearMomentum.compute_elastic_stress-791"><span class="linenos">791</span></a>
</span><span id="LinearMomentum.compute_elastic_stress-792"><a href="#LinearMomentum.compute_elastic_stress-792"><span class="linenos">792</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.compute_elastic_stress-793"><a href="#LinearMomentum.compute_elastic_stress-793"><span class="linenos">793</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.compute_elastic_stress-794"><a href="#LinearMomentum.compute_elastic_stress-794"><span class="linenos">794</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentum.compute_elastic_stress-795"><a href="#LinearMomentum.compute_elastic_stress-795"><span class="linenos">795</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.compute_elastic_stress-796"><a href="#LinearMomentum.compute_elastic_stress-796"><span class="linenos">796</span></a>
</span><span id="LinearMomentum.compute_elastic_stress-797"><a href="#LinearMomentum.compute_elastic_stress-797"><span class="linenos">797</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.compute_elastic_stress-798"><a href="#LinearMomentum.compute_elastic_stress-798"><span class="linenos">798</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.compute_elastic_stress-799"><a href="#LinearMomentum.compute_elastic_stress-799"><span class="linenos">799</span></a><span class="sd">        Copies the stress into :attr:`sig`.</span>
</span><span id="LinearMomentum.compute_elastic_stress-800"><a href="#LinearMomentum.compute_elastic_stress-800"><span class="linenos">800</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_elastic_stress-801"><a href="#LinearMomentum.compute_elastic_stress-801"><span class="linenos">801</span></a>        <span class="n">stress_to</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">eps_e</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_elastic_stress-802"><a href="#LinearMomentum.compute_elastic_stress-802"><span class="linenos">802</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">stress_to</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_elastic_stress-803"><a href="#LinearMomentum.compute_elastic_stress-803"><span class="linenos">803</span></a>        <span class="k">return</span> <span class="n">stress_to</span>
</span></pre></div>


            <div class="docstring"><p>Compute elastic Cauchy stress using the elastic stiffness <code>C</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps_e</strong> (torch.Tensor):
Elastic strain, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Stress, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Copies the stress into <code>sig</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.compute_stress" class="classattr">
                                        <input id="LinearMomentum.compute_stress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_stress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">eps_tot_to</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.compute_stress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.compute_stress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.compute_stress-805"><a href="#LinearMomentum.compute_stress-805"><span class="linenos">805</span></a>    <span class="k">def</span> <span class="nf">compute_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_tot_to</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="LinearMomentum.compute_stress-806"><a href="#LinearMomentum.compute_stress-806"><span class="linenos">806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_stress-807"><a href="#LinearMomentum.compute_stress-807"><span class="linenos">807</span></a><span class="sd">        Compute stress using the consistent tangent and RHS strain.</span>
</span><span id="LinearMomentum.compute_stress-808"><a href="#LinearMomentum.compute_stress-808"><span class="linenos">808</span></a>
</span><span id="LinearMomentum.compute_stress-809"><a href="#LinearMomentum.compute_stress-809"><span class="linenos">809</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum.compute_stress-810"><a href="#LinearMomentum.compute_stress-810"><span class="linenos">810</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum.compute_stress-811"><a href="#LinearMomentum.compute_stress-811"><span class="linenos">811</span></a><span class="sd">        eps_tot_to : torch.Tensor</span>
</span><span id="LinearMomentum.compute_stress-812"><a href="#LinearMomentum.compute_stress-812"><span class="linenos">812</span></a><span class="sd">            Total strain, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.compute_stress-813"><a href="#LinearMomentum.compute_stress-813"><span class="linenos">813</span></a><span class="sd">        *_</span>
</span><span id="LinearMomentum.compute_stress-814"><a href="#LinearMomentum.compute_stress-814"><span class="linenos">814</span></a><span class="sd">            Unused extra arguments (kept for signature compatibility).</span>
</span><span id="LinearMomentum.compute_stress-815"><a href="#LinearMomentum.compute_stress-815"><span class="linenos">815</span></a>
</span><span id="LinearMomentum.compute_stress-816"><a href="#LinearMomentum.compute_stress-816"><span class="linenos">816</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.compute_stress-817"><a href="#LinearMomentum.compute_stress-817"><span class="linenos">817</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.compute_stress-818"><a href="#LinearMomentum.compute_stress-818"><span class="linenos">818</span></a><span class="sd">        torch.Tensor</span>
</span><span id="LinearMomentum.compute_stress-819"><a href="#LinearMomentum.compute_stress-819"><span class="linenos">819</span></a><span class="sd">            Stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.compute_stress-820"><a href="#LinearMomentum.compute_stress-820"><span class="linenos">820</span></a>
</span><span id="LinearMomentum.compute_stress-821"><a href="#LinearMomentum.compute_stress-821"><span class="linenos">821</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.compute_stress-822"><a href="#LinearMomentum.compute_stress-822"><span class="linenos">822</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.compute_stress-823"><a href="#LinearMomentum.compute_stress-823"><span class="linenos">823</span></a><span class="sd">        Copies the stress into :attr:`sig`.</span>
</span><span id="LinearMomentum.compute_stress-824"><a href="#LinearMomentum.compute_stress-824"><span class="linenos">824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_stress-825"><a href="#LinearMomentum.compute_stress-825"><span class="linenos">825</span></a>        <span class="n">stress_to</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">CT</span><span class="p">,</span> <span class="n">eps_tot_to</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_stress-826"><a href="#LinearMomentum.compute_stress-826"><span class="linenos">826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">stress_to</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_stress-827"><a href="#LinearMomentum.compute_stress-827"><span class="linenos">827</span></a>        <span class="k">return</span> <span class="n">stress_to</span>
</span></pre></div>


            <div class="docstring"><p>Compute stress using the consistent tangent and RHS strain.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps_tot_to</strong> (torch.Tensor):
Total strain, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>*_</strong>: Unused extra arguments (kept for signature compatibility).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Stress, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Copies the stress into <code>sig</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.compute_eps_rhs" class="classattr">
                                        <input id="LinearMomentum.compute_eps_rhs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_rhs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.compute_eps_rhs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.compute_eps_rhs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.compute_eps_rhs-829"><a href="#LinearMomentum.compute_eps_rhs-829"><span class="linenos">829</span></a>    <span class="k">def</span> <span class="nf">compute_eps_rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.compute_eps_rhs-830"><a href="#LinearMomentum.compute_eps_rhs-830"><span class="linenos">830</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_eps_rhs-831"><a href="#LinearMomentum.compute_eps_rhs-831"><span class="linenos">831</span></a><span class="sd">        Compute the right-hand-side strain term for the variational form.</span>
</span><span id="LinearMomentum.compute_eps_rhs-832"><a href="#LinearMomentum.compute_eps_rhs-832"><span class="linenos">832</span></a>
</span><span id="LinearMomentum.compute_eps_rhs-833"><a href="#LinearMomentum.compute_eps_rhs-833"><span class="linenos">833</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum.compute_eps_rhs-834"><a href="#LinearMomentum.compute_eps_rhs-834"><span class="linenos">834</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum.compute_eps_rhs-835"><a href="#LinearMomentum.compute_eps_rhs-835"><span class="linenos">835</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentum.compute_eps_rhs-836"><a href="#LinearMomentum.compute_eps_rhs-836"><span class="linenos">836</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentum.compute_eps_rhs-837"><a href="#LinearMomentum.compute_eps_rhs-837"><span class="linenos">837</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="LinearMomentum.compute_eps_rhs-838"><a href="#LinearMomentum.compute_eps_rhs-838"><span class="linenos">838</span></a><span class="sd">            Intermediate stress, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.compute_eps_rhs-839"><a href="#LinearMomentum.compute_eps_rhs-839"><span class="linenos">839</span></a>
</span><span id="LinearMomentum.compute_eps_rhs-840"><a href="#LinearMomentum.compute_eps_rhs-840"><span class="linenos">840</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.compute_eps_rhs-841"><a href="#LinearMomentum.compute_eps_rhs-841"><span class="linenos">841</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.compute_eps_rhs-842"><a href="#LinearMomentum.compute_eps_rhs-842"><span class="linenos">842</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.compute_eps_rhs-843"><a href="#LinearMomentum.compute_eps_rhs-843"><span class="linenos">843</span></a>
</span><span id="LinearMomentum.compute_eps_rhs-844"><a href="#LinearMomentum.compute_eps_rhs-844"><span class="linenos">844</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.compute_eps_rhs-845"><a href="#LinearMomentum.compute_eps_rhs-845"><span class="linenos">845</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.compute_eps_rhs-846"><a href="#LinearMomentum.compute_eps_rhs-846"><span class="linenos">846</span></a><span class="sd">        Sets :attr:`eps_rhs_to` (torch) and :attr:`eps_rhs` (FE field).</span>
</span><span id="LinearMomentum.compute_eps_rhs-847"><a href="#LinearMomentum.compute_eps_rhs-847"><span class="linenos">847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_eps_rhs-848"><a href="#LinearMomentum.compute_eps_rhs-848"><span class="linenos">848</span></a>        <span class="n">eps_ne_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_k</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_eps_rhs-849"><a href="#LinearMomentum.compute_eps_rhs-849"><span class="linenos">849</span></a>        <span class="n">eps_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_th</span><span class="p">()</span>
</span><span id="LinearMomentum.compute_eps_rhs-850"><a href="#LinearMomentum.compute_eps_rhs-850"><span class="linenos">850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span> <span class="o">=</span> <span class="n">eps_ne_k</span> <span class="o">+</span> <span class="n">eps_th</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">B</span> <span class="o">+</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">))</span>
</span><span id="LinearMomentum.compute_eps_rhs-851"><a href="#LinearMomentum.compute_eps_rhs-851"><span class="linenos">851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs_to</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the right-hand-side strain term for the variational form.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time-step size.</li>
<li><strong>stress_k</strong> (torch.Tensor):
Intermediate stress, shape <code>(n_elems, 3, 3)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>eps_rhs_to</code> (torch) and <code>eps_rhs</code> (FE field).</p>
</div>


                            </div>
                            <div id="LinearMomentum.solve_elastic_response" class="classattr">
                                        <input id="LinearMomentum.solve_elastic_response-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">solve_elastic_response</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.solve_elastic_response-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.solve_elastic_response"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.solve_elastic_response-853"><a href="#LinearMomentum.solve_elastic_response-853"><span class="linenos">853</span></a>    <span class="k">def</span> <span class="nf">solve_elastic_response</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.solve_elastic_response-854"><a href="#LinearMomentum.solve_elastic_response-854"><span class="linenos">854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.solve_elastic_response-855"><a href="#LinearMomentum.solve_elastic_response-855"><span class="linenos">855</span></a><span class="sd">        Solve the purely elastic boundary-value problem.</span>
</span><span id="LinearMomentum.solve_elastic_response-856"><a href="#LinearMomentum.solve_elastic_response-856"><span class="linenos">856</span></a>
</span><span id="LinearMomentum.solve_elastic_response-857"><a href="#LinearMomentum.solve_elastic_response-857"><span class="linenos">857</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.solve_elastic_response-858"><a href="#LinearMomentum.solve_elastic_response-858"><span class="linenos">858</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.solve_elastic_response-859"><a href="#LinearMomentum.solve_elastic_response-859"><span class="linenos">859</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.solve_elastic_response-860"><a href="#LinearMomentum.solve_elastic_response-860"><span class="linenos">860</span></a>
</span><span id="LinearMomentum.solve_elastic_response-861"><a href="#LinearMomentum.solve_elastic_response-861"><span class="linenos">861</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.solve_elastic_response-862"><a href="#LinearMomentum.solve_elastic_response-862"><span class="linenos">862</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.solve_elastic_response-863"><a href="#LinearMomentum.solve_elastic_response-863"><span class="linenos">863</span></a><span class="sd">        - Assembles and solves the linear system with :math:`C`.</span>
</span><span id="LinearMomentum.solve_elastic_response-864"><a href="#LinearMomentum.solve_elastic_response-864"><span class="linenos">864</span></a><span class="sd">        - Updates :attr:`X` and calls :meth:`split_solution`.</span>
</span><span id="LinearMomentum.solve_elastic_response-865"><a href="#LinearMomentum.solve_elastic_response-865"><span class="linenos">865</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.solve_elastic_response-866"><a href="#LinearMomentum.solve_elastic_response-866"><span class="linenos">866</span></a>        <span class="c1"># Build bilinear form</span>
</span><span id="LinearMomentum.solve_elastic_response-867"><a href="#LinearMomentum.solve_elastic_response-867"><span class="linenos">867</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dotdot_ufl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)),</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentum.solve_elastic_response-868"><a href="#LinearMomentum.solve_elastic_response-868"><span class="linenos">868</span></a>        <span class="n">bilinear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-869"><a href="#LinearMomentum.solve_elastic_response-869"><span class="linenos">869</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">assemble_matrix</span><span class="p">(</span><span class="n">bilinear_form</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-870"><a href="#LinearMomentum.solve_elastic_response-870"><span class="linenos">870</span></a>        <span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</span><span id="LinearMomentum.solve_elastic_response-871"><a href="#LinearMomentum.solve_elastic_response-871"><span class="linenos">871</span></a>
</span><span id="LinearMomentum.solve_elastic_response-872"><a href="#LinearMomentum.solve_elastic_response-872"><span class="linenos">872</span></a>        <span class="c1"># Build linear form</span>
</span><span id="LinearMomentum.solve_elastic_response-873"><a href="#LinearMomentum.solve_elastic_response-873"><span class="linenos">873</span></a>        <span class="n">linear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_body</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">neumann_bcs</span><span class="p">))</span>
</span><span id="LinearMomentum.solve_elastic_response-874"><a href="#LinearMomentum.solve_elastic_response-874"><span class="linenos">874</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">fem_petsc</span><span class="o">.</span><span class="n">assemble_vector</span><span class="p">(</span><span class="n">linear_form</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-875"><a href="#LinearMomentum.solve_elastic_response-875"><span class="linenos">875</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">apply_lifting</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">bilinear_form</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">])</span>
</span><span id="LinearMomentum.solve_elastic_response-876"><a href="#LinearMomentum.solve_elastic_response-876"><span class="linenos">876</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">ADD_VALUES</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-877"><a href="#LinearMomentum.solve_elastic_response-877"><span class="linenos">877</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">set_bc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-878"><a href="#LinearMomentum.solve_elastic_response-878"><span class="linenos">878</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-879"><a href="#LinearMomentum.solve_elastic_response-879"><span class="linenos">879</span></a>
</span><span id="LinearMomentum.solve_elastic_response-880"><a href="#LinearMomentum.solve_elastic_response-880"><span class="linenos">880</span></a>        <span class="c1"># Solve linear system</span>
</span><span id="LinearMomentum.solve_elastic_response-881"><a href="#LinearMomentum.solve_elastic_response-881"><span class="linenos">881</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-882"><a href="#LinearMomentum.solve_elastic_response-882"><span class="linenos">882</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">petsc_vec</span><span class="p">)</span>
</span><span id="LinearMomentum.solve_elastic_response-883"><a href="#LinearMomentum.solve_elastic_response-883"><span class="linenos">883</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">scatter_forward</span><span class="p">()</span>
</span><span id="LinearMomentum.solve_elastic_response-884"><a href="#LinearMomentum.solve_elastic_response-884"><span class="linenos">884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_solution</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Solve the purely elastic boundary-value problem.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<ul>
<li>Assembles and solves the linear system with \( C \).</li>
<li>Updates <code>X</code> and calls <code><a href="#LinearMomentum.split_solution">split_solution()</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentum.split_solution" class="classattr">
                                        <input id="LinearMomentum.split_solution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_solution</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.split_solution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.split_solution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.split_solution-886"><a href="#LinearMomentum.split_solution-886"><span class="linenos">886</span></a>    <span class="k">def</span> <span class="nf">split_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.split_solution-887"><a href="#LinearMomentum.split_solution-887"><span class="linenos">887</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.split_solution-888"><a href="#LinearMomentum.split_solution-888"><span class="linenos">888</span></a><span class="sd">        Assign displacement solution `X` to the primary field `u`.</span>
</span><span id="LinearMomentum.split_solution-889"><a href="#LinearMomentum.split_solution-889"><span class="linenos">889</span></a>
</span><span id="LinearMomentum.split_solution-890"><a href="#LinearMomentum.split_solution-890"><span class="linenos">890</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.split_solution-891"><a href="#LinearMomentum.split_solution-891"><span class="linenos">891</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.split_solution-892"><a href="#LinearMomentum.split_solution-892"><span class="linenos">892</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.split_solution-893"><a href="#LinearMomentum.split_solution-893"><span class="linenos">893</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.split_solution-894"><a href="#LinearMomentum.split_solution-894"><span class="linenos">894</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
</span></pre></div>


            <div class="docstring"><p>Assign displacement solution <code>X</code> to the primary field <code>u</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="LinearMomentum.compute_p_nodes" class="classattr">
                                        <input id="LinearMomentum.compute_p_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_p_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.compute_p_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.compute_p_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.compute_p_nodes-905"><a href="#LinearMomentum.compute_p_nodes-905"><span class="linenos">905</span></a>    <span class="k">def</span> <span class="nf">compute_p_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.compute_p_nodes-906"><a href="#LinearMomentum.compute_p_nodes-906"><span class="linenos">906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_p_nodes-907"><a href="#LinearMomentum.compute_p_nodes-907"><span class="linenos">907</span></a><span class="sd">        Compute nodal pressure ``p = tr()/3`` via node-element averaging.</span>
</span><span id="LinearMomentum.compute_p_nodes-908"><a href="#LinearMomentum.compute_p_nodes-908"><span class="linenos">908</span></a>
</span><span id="LinearMomentum.compute_p_nodes-909"><a href="#LinearMomentum.compute_p_nodes-909"><span class="linenos">909</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.compute_p_nodes-910"><a href="#LinearMomentum.compute_p_nodes-910"><span class="linenos">910</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.compute_p_nodes-911"><a href="#LinearMomentum.compute_p_nodes-911"><span class="linenos">911</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.compute_p_nodes-912"><a href="#LinearMomentum.compute_p_nodes-912"><span class="linenos">912</span></a>
</span><span id="LinearMomentum.compute_p_nodes-913"><a href="#LinearMomentum.compute_p_nodes-913"><span class="linenos">913</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.compute_p_nodes-914"><a href="#LinearMomentum.compute_p_nodes-914"><span class="linenos">914</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.compute_p_nodes-915"><a href="#LinearMomentum.compute_p_nodes-915"><span class="linenos">915</span></a><span class="sd">        Writes to :attr:`p_nodes`.</span>
</span><span id="LinearMomentum.compute_p_nodes-916"><a href="#LinearMomentum.compute_p_nodes-916"><span class="linenos">916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_p_nodes-917"><a href="#LinearMomentum.compute_p_nodes-917"><span class="linenos">917</span></a>        <span class="n">stress</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentum.compute_p_nodes-918"><a href="#LinearMomentum.compute_p_nodes-918"><span class="linenos">918</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LinearMomentum.compute_p_nodes-919"><a href="#LinearMomentum.compute_p_nodes-919"><span class="linenos">919</span></a>        <span class="n">p_to</span> <span class="o">=</span> <span class="n">I1</span><span class="o">/</span><span class="mi">3</span>
</span><span id="LinearMomentum.compute_p_nodes-920"><a href="#LinearMomentum.compute_p_nodes-920"><span class="linenos">920</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_nodes</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">A_csr</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p_to</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute nodal pressure <code>p = tr()/3</code> via node-element averaging.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Writes to <code>p_nodes</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.compute_p_elems" class="classattr">
                                        <input id="LinearMomentum.compute_p_elems-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_p_elems</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.compute_p_elems-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.compute_p_elems"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.compute_p_elems-922"><a href="#LinearMomentum.compute_p_elems-922"><span class="linenos">922</span></a>    <span class="k">def</span> <span class="nf">compute_p_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.compute_p_elems-923"><a href="#LinearMomentum.compute_p_elems-923"><span class="linenos">923</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_p_elems-924"><a href="#LinearMomentum.compute_p_elems-924"><span class="linenos">924</span></a><span class="sd">        Compute element pressure by smoothing the nodal trace of stress.</span>
</span><span id="LinearMomentum.compute_p_elems-925"><a href="#LinearMomentum.compute_p_elems-925"><span class="linenos">925</span></a>
</span><span id="LinearMomentum.compute_p_elems-926"><a href="#LinearMomentum.compute_p_elems-926"><span class="linenos">926</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.compute_p_elems-927"><a href="#LinearMomentum.compute_p_elems-927"><span class="linenos">927</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.compute_p_elems-928"><a href="#LinearMomentum.compute_p_elems-928"><span class="linenos">928</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.compute_p_elems-929"><a href="#LinearMomentum.compute_p_elems-929"><span class="linenos">929</span></a>
</span><span id="LinearMomentum.compute_p_elems-930"><a href="#LinearMomentum.compute_p_elems-930"><span class="linenos">930</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.compute_p_elems-931"><a href="#LinearMomentum.compute_p_elems-931"><span class="linenos">931</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.compute_p_elems-932"><a href="#LinearMomentum.compute_p_elems-932"><span class="linenos">932</span></a><span class="sd">        Writes to :attr:`p_elems`.</span>
</span><span id="LinearMomentum.compute_p_elems-933"><a href="#LinearMomentum.compute_p_elems-933"><span class="linenos">933</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.compute_p_elems-934"><a href="#LinearMomentum.compute_p_elems-934"><span class="linenos">934</span></a>        <span class="n">stress_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="LinearMomentum.compute_p_elems-935"><a href="#LinearMomentum.compute_p_elems-935"><span class="linenos">935</span></a>        <span class="n">p_to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;kii-&gt;k&quot;</span><span class="p">,</span> <span class="n">stress_to</span><span class="p">)</span>
</span><span id="LinearMomentum.compute_p_elems-936"><a href="#LinearMomentum.compute_p_elems-936"><span class="linenos">936</span></a>        <span class="n">p_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">smoother</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p_to</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="LinearMomentum.compute_p_elems-937"><a href="#LinearMomentum.compute_p_elems-937"><span class="linenos">937</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">p_elems</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">p_to</span>
</span></pre></div>


            <div class="docstring"><p>Compute element pressure by smoothing the nodal trace of stress.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Writes to <code>p_elems</code>.</p>
</div>


                            </div>
                            <div id="LinearMomentum.solve" class="classattr">
                                        <input id="LinearMomentum.solve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">solve</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress_k_to</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">t</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LinearMomentum.solve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LinearMomentum.solve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LinearMomentum.solve-939"><a href="#LinearMomentum.solve-939"><span class="linenos">939</span></a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LinearMomentum.solve-940"><a href="#LinearMomentum.solve-940"><span class="linenos">940</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LinearMomentum.solve-941"><a href="#LinearMomentum.solve-941"><span class="linenos">941</span></a><span class="sd">        Assemble and solve one implicit time step for the inelastic problem.</span>
</span><span id="LinearMomentum.solve-942"><a href="#LinearMomentum.solve-942"><span class="linenos">942</span></a>
</span><span id="LinearMomentum.solve-943"><a href="#LinearMomentum.solve-943"><span class="linenos">943</span></a><span class="sd">        Parameters</span>
</span><span id="LinearMomentum.solve-944"><a href="#LinearMomentum.solve-944"><span class="linenos">944</span></a><span class="sd">        ----------</span>
</span><span id="LinearMomentum.solve-945"><a href="#LinearMomentum.solve-945"><span class="linenos">945</span></a><span class="sd">        stress_k_to : torch.Tensor</span>
</span><span id="LinearMomentum.solve-946"><a href="#LinearMomentum.solve-946"><span class="linenos">946</span></a><span class="sd">            Stress at previous iteration k, shape ``(n_elems, 3, 3)``.</span>
</span><span id="LinearMomentum.solve-947"><a href="#LinearMomentum.solve-947"><span class="linenos">947</span></a><span class="sd">        t : float</span>
</span><span id="LinearMomentum.solve-948"><a href="#LinearMomentum.solve-948"><span class="linenos">948</span></a><span class="sd">            Current time (used by BC handler externally).</span>
</span><span id="LinearMomentum.solve-949"><a href="#LinearMomentum.solve-949"><span class="linenos">949</span></a><span class="sd">        dt : float</span>
</span><span id="LinearMomentum.solve-950"><a href="#LinearMomentum.solve-950"><span class="linenos">950</span></a><span class="sd">            Time-step size.</span>
</span><span id="LinearMomentum.solve-951"><a href="#LinearMomentum.solve-951"><span class="linenos">951</span></a>
</span><span id="LinearMomentum.solve-952"><a href="#LinearMomentum.solve-952"><span class="linenos">952</span></a><span class="sd">        Returns</span>
</span><span id="LinearMomentum.solve-953"><a href="#LinearMomentum.solve-953"><span class="linenos">953</span></a><span class="sd">        -------</span>
</span><span id="LinearMomentum.solve-954"><a href="#LinearMomentum.solve-954"><span class="linenos">954</span></a><span class="sd">        None</span>
</span><span id="LinearMomentum.solve-955"><a href="#LinearMomentum.solve-955"><span class="linenos">955</span></a>
</span><span id="LinearMomentum.solve-956"><a href="#LinearMomentum.solve-956"><span class="linenos">956</span></a><span class="sd">        Side Effects</span>
</span><span id="LinearMomentum.solve-957"><a href="#LinearMomentum.solve-957"><span class="linenos">957</span></a><span class="sd">        ------------</span>
</span><span id="LinearMomentum.solve-958"><a href="#LinearMomentum.solve-958"><span class="linenos">958</span></a><span class="sd">        - Builds `CT` and `eps_rhs`, assembles and solves the linear system.</span>
</span><span id="LinearMomentum.solve-959"><a href="#LinearMomentum.solve-959"><span class="linenos">959</span></a><span class="sd">        - Updates :attr:`X`, calls :meth:`split_solution`, then :meth:`run_after_solve`.</span>
</span><span id="LinearMomentum.solve-960"><a href="#LinearMomentum.solve-960"><span class="linenos">960</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LinearMomentum.solve-961"><a href="#LinearMomentum.solve-961"><span class="linenos">961</span></a>
</span><span id="LinearMomentum.solve-962"><a href="#LinearMomentum.solve-962"><span class="linenos">962</span></a>        <span class="c1"># Compute consistent tangent matrix</span>
</span><span id="LinearMomentum.solve-963"><a href="#LinearMomentum.solve-963"><span class="linenos">963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_CT</span><span class="p">(</span><span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-964"><a href="#LinearMomentum.solve-964"><span class="linenos">964</span></a>
</span><span id="LinearMomentum.solve-965"><a href="#LinearMomentum.solve-965"><span class="linenos">965</span></a>        <span class="c1"># Compute right-hand side epsilon</span>
</span><span id="LinearMomentum.solve-966"><a href="#LinearMomentum.solve-966"><span class="linenos">966</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_rhs</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-967"><a href="#LinearMomentum.solve-967"><span class="linenos">967</span></a>
</span><span id="LinearMomentum.solve-968"><a href="#LinearMomentum.solve-968"><span class="linenos">968</span></a>        <span class="c1"># Build bilinear form</span>
</span><span id="LinearMomentum.solve-969"><a href="#LinearMomentum.solve-969"><span class="linenos">969</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dotdot_ufl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CT</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)),</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentum.solve-970"><a href="#LinearMomentum.solve-970"><span class="linenos">970</span></a>        <span class="n">bilinear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-971"><a href="#LinearMomentum.solve-971"><span class="linenos">971</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">fem_petsc</span><span class="o">.</span><span class="n">assemble_matrix</span><span class="p">(</span><span class="n">bilinear_form</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-972"><a href="#LinearMomentum.solve-972"><span class="linenos">972</span></a>        <span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</span><span id="LinearMomentum.solve-973"><a href="#LinearMomentum.solve-973"><span class="linenos">973</span></a>
</span><span id="LinearMomentum.solve-974"><a href="#LinearMomentum.solve-974"><span class="linenos">974</span></a>        <span class="c1"># Build linear form</span>
</span><span id="LinearMomentum.solve-975"><a href="#LinearMomentum.solve-975"><span class="linenos">975</span></a>        <span class="n">b_rhs</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dotdot_ufl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_rhs</span><span class="p">),</span> <span class="n">epsilon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
</span><span id="LinearMomentum.solve-976"><a href="#LinearMomentum.solve-976"><span class="linenos">976</span></a>        <span class="n">linear_form</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_body</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">neumann_bcs</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_rhs</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-977"><a href="#LinearMomentum.solve-977"><span class="linenos">977</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">fem_petsc</span><span class="o">.</span><span class="n">assemble_vector</span><span class="p">(</span><span class="n">linear_form</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-978"><a href="#LinearMomentum.solve-978"><span class="linenos">978</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">apply_lifting</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">bilinear_form</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">])</span>
</span><span id="LinearMomentum.solve-979"><a href="#LinearMomentum.solve-979"><span class="linenos">979</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">ADD_VALUES</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-980"><a href="#LinearMomentum.solve-980"><span class="linenos">980</span></a>        <span class="n">fem_petsc</span><span class="o">.</span><span class="n">set_bc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">dirichlet_bcs</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-981"><a href="#LinearMomentum.solve-981"><span class="linenos">981</span></a>        <span class="n">b</span><span class="o">.</span><span class="n">ghostUpdate</span><span class="p">(</span><span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-982"><a href="#LinearMomentum.solve-982"><span class="linenos">982</span></a>
</span><span id="LinearMomentum.solve-983"><a href="#LinearMomentum.solve-983"><span class="linenos">983</span></a>        <span class="c1"># Solve linear system</span>
</span><span id="LinearMomentum.solve-984"><a href="#LinearMomentum.solve-984"><span class="linenos">984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-985"><a href="#LinearMomentum.solve-985"><span class="linenos">985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">petsc_vec</span><span class="p">)</span>
</span><span id="LinearMomentum.solve-986"><a href="#LinearMomentum.solve-986"><span class="linenos">986</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">scatter_forward</span><span class="p">()</span>
</span><span id="LinearMomentum.solve-987"><a href="#LinearMomentum.solve-987"><span class="linenos">987</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_solution</span><span class="p">()</span>
</span><span id="LinearMomentum.solve-988"><a href="#LinearMomentum.solve-988"><span class="linenos">988</span></a>
</span><span id="LinearMomentum.solve-989"><a href="#LinearMomentum.solve-989"><span class="linenos">989</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_after_solve</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Assemble and solve one implicit time step for the inelastic problem.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress_k_to</strong> (torch.Tensor):
Stress at previous iteration k, shape <code>(n_elems, 3, 3)</code>.</li>
<li><strong>t</strong> (float):
Current time (used by BC handler externally).</li>
<li><strong>dt</strong> (float):
Time-step size.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<ul>
<li>Builds <code>CT</code> and <code>eps_rhs</code>, assembles and solves the linear system.</li>
<li>Updates <code>X</code>, calls <code><a href="#LinearMomentum.split_solution">split_solution()</a></code>, then <code><a href="#LinearMomentum.run_after_solve">run_after_solve()</a></code>.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="Material">
                            <input id="Material-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Material</span>:

                <label class="view-source-button" for="Material-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material-23"><a href="#Material-23"><span class="linenos"> 23</span></a><span class="k">class</span> <span class="nc">Material</span><span class="p">():</span>
</span><span id="Material-24"><a href="#Material-24"><span class="linenos"> 24</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-25"><a href="#Material-25"><span class="linenos"> 25</span></a><span class="sd">    Composite material model that aggregates elastic, thermoelastic,</span>
</span><span id="Material-26"><a href="#Material-26"><span class="linenos"> 26</span></a><span class="sd">    and non-elastic (e.g., viscoelastic/viscoplastic) elements.</span>
</span><span id="Material-27"><a href="#Material-27"><span class="linenos"> 27</span></a>
</span><span id="Material-28"><a href="#Material-28"><span class="linenos"> 28</span></a><span class="sd">    The class stores element-wise stiffness operators in Voigt form</span>
</span><span id="Material-29"><a href="#Material-29"><span class="linenos"> 29</span></a><span class="sd">    and assembles effective operators used during constitutive updates.</span>
</span><span id="Material-30"><a href="#Material-30"><span class="linenos"> 30</span></a>
</span><span id="Material-31"><a href="#Material-31"><span class="linenos"> 31</span></a><span class="sd">    Parameters</span>
</span><span id="Material-32"><a href="#Material-32"><span class="linenos"> 32</span></a><span class="sd">    ----------</span>
</span><span id="Material-33"><a href="#Material-33"><span class="linenos"> 33</span></a><span class="sd">    n_elems : int</span>
</span><span id="Material-34"><a href="#Material-34"><span class="linenos"> 34</span></a><span class="sd">        Number of finite elements (batch size).</span>
</span><span id="Material-35"><a href="#Material-35"><span class="linenos"> 35</span></a>
</span><span id="Material-36"><a href="#Material-36"><span class="linenos"> 36</span></a><span class="sd">    Attributes</span>
</span><span id="Material-37"><a href="#Material-37"><span class="linenos"> 37</span></a><span class="sd">    ----------</span>
</span><span id="Material-38"><a href="#Material-38"><span class="linenos"> 38</span></a><span class="sd">    n_elems : int</span>
</span><span id="Material-39"><a href="#Material-39"><span class="linenos"> 39</span></a><span class="sd">        Number of elements.</span>
</span><span id="Material-40"><a href="#Material-40"><span class="linenos"> 40</span></a><span class="sd">    elems_ne : list[NonElasticElement]</span>
</span><span id="Material-41"><a href="#Material-41"><span class="linenos"> 41</span></a><span class="sd">        Collection of non-elastic elements contributing to non-elastic response.</span>
</span><span id="Material-42"><a href="#Material-42"><span class="linenos"> 42</span></a><span class="sd">    elems_th : list[Thermoelastic]</span>
</span><span id="Material-43"><a href="#Material-43"><span class="linenos"> 43</span></a><span class="sd">        Collection of thermoelastic contributors (thermal strain).</span>
</span><span id="Material-44"><a href="#Material-44"><span class="linenos"> 44</span></a><span class="sd">    elems_e : list[Spring]</span>
</span><span id="Material-45"><a href="#Material-45"><span class="linenos"> 45</span></a><span class="sd">        Collection of elastic contributors (linear isotropic springs).</span>
</span><span id="Material-46"><a href="#Material-46"><span class="linenos"> 46</span></a><span class="sd">    C_inv, C : torch.Tensor</span>
</span><span id="Material-47"><a href="#Material-47"><span class="linenos"> 47</span></a><span class="sd">        Element-wise stiffness (and inverse) in tensorial Voigt form, shape (N, 6, 6).</span>
</span><span id="Material-48"><a href="#Material-48"><span class="linenos"> 48</span></a><span class="sd">    C_tilde_inv, C_tilde : torch.Tensor</span>
</span><span id="Material-49"><a href="#Material-49"><span class="linenos"> 49</span></a><span class="sd">        Element-wise deviatoric stiffness (and inverse), shape (N, 6, 6).</span>
</span><span id="Material-50"><a href="#Material-50"><span class="linenos"> 50</span></a><span class="sd">    G, B : torch.Tensor</span>
</span><span id="Material-51"><a href="#Material-51"><span class="linenos"> 51</span></a><span class="sd">        Assembled non-elastic tangent-like (G) and state variable (B) operators, shapes</span>
</span><span id="Material-52"><a href="#Material-52"><span class="linenos"> 52</span></a><span class="sd">        (N, 6, 6) and (N, 3, 3).</span>
</span><span id="Material-53"><a href="#Material-53"><span class="linenos"> 53</span></a><span class="sd">    IT, T : torch.Tensor</span>
</span><span id="Material-54"><a href="#Material-54"><span class="linenos"> 54</span></a><span class="sd">        Volumetric coupling tensors assembled from non-elastic elements.</span>
</span><span id="Material-55"><a href="#Material-55"><span class="linenos"> 55</span></a><span class="sd">    B_vol, T_vol : torch.Tensor</span>
</span><span id="Material-56"><a href="#Material-56"><span class="linenos"> 56</span></a><span class="sd">        Element-wise volumetric parts (scalars), shape (N,).</span>
</span><span id="Material-57"><a href="#Material-57"><span class="linenos"> 57</span></a><span class="sd">    G_tilde, B_tilde : torch.Tensor</span>
</span><span id="Material-58"><a href="#Material-58"><span class="linenos"> 58</span></a><span class="sd">        Deviatoric parts of G and B, shapes (N, 6, 6) and (N, 3, 3).</span>
</span><span id="Material-59"><a href="#Material-59"><span class="linenos"> 59</span></a><span class="sd">    CT, CT_tilde : torch.Tensor</span>
</span><span id="Material-60"><a href="#Material-60"><span class="linenos"> 60</span></a><span class="sd">        Effective consistent tangents after time integration, shapes (N, 6, 6).</span>
</span><span id="Material-61"><a href="#Material-61"><span class="linenos"> 61</span></a><span class="sd">    density, cp, k, alpha_th : torch.Tensor</span>
</span><span id="Material-62"><a href="#Material-62"><span class="linenos"> 62</span></a><span class="sd">        Optional material properties (per element).</span>
</span><span id="Material-63"><a href="#Material-63"><span class="linenos"> 63</span></a>
</span><span id="Material-64"><a href="#Material-64"><span class="linenos"> 64</span></a><span class="sd">    Notes</span>
</span><span id="Material-65"><a href="#Material-65"><span class="linenos"> 65</span></a><span class="sd">    -----</span>
</span><span id="Material-66"><a href="#Material-66"><span class="linenos"> 66</span></a><span class="sd">    - Voigt ordering is assumed to be `[xx, yy, zz, xy, xz, yz]` with</span>
</span><span id="Material-67"><a href="#Material-67"><span class="linenos"> 67</span></a><span class="sd">      **tensorial shear** convention (no engineering factors).</span>
</span><span id="Material-68"><a href="#Material-68"><span class="linenos"> 68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Material-69"><a href="#Material-69"><span class="linenos"> 69</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_elems</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Material-70"><a href="#Material-70"><span class="linenos"> 70</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="n">n_elems</span>
</span><span id="Material-71"><a href="#Material-71"><span class="linenos"> 71</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Material-72"><a href="#Material-72"><span class="linenos"> 72</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_th</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Material-73"><a href="#Material-73"><span class="linenos"> 73</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Material-74"><a href="#Material-74"><span class="linenos"> 74</span></a>
</span><span id="Material-75"><a href="#Material-75"><span class="linenos"> 75</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-76"><a href="#Material-76"><span class="linenos"> 76</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-77"><a href="#Material-77"><span class="linenos"> 77</span></a>
</span><span id="Material-78"><a href="#Material-78"><span class="linenos"> 78</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-79"><a href="#Material-79"><span class="linenos"> 79</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-80"><a href="#Material-80"><span class="linenos"> 80</span></a>
</span><span id="Material-81"><a href="#Material-81"><span class="linenos"> 81</span></a>	<span class="k">def</span> <span class="nf">set_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-82"><a href="#Material-82"><span class="linenos"> 82</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-83"><a href="#Material-83"><span class="linenos"> 83</span></a><span class="sd">        Set mass density per element.</span>
</span><span id="Material-84"><a href="#Material-84"><span class="linenos"> 84</span></a>
</span><span id="Material-85"><a href="#Material-85"><span class="linenos"> 85</span></a><span class="sd">        Parameters</span>
</span><span id="Material-86"><a href="#Material-86"><span class="linenos"> 86</span></a><span class="sd">        ----------</span>
</span><span id="Material-87"><a href="#Material-87"><span class="linenos"> 87</span></a><span class="sd">        density : torch.Tensor</span>
</span><span id="Material-88"><a href="#Material-88"><span class="linenos"> 88</span></a><span class="sd">            1D tensor of shape (N,) with densities.</span>
</span><span id="Material-89"><a href="#Material-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-90"><a href="#Material-90"><span class="linenos"> 90</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span>
</span><span id="Material-91"><a href="#Material-91"><span class="linenos"> 91</span></a>
</span><span id="Material-92"><a href="#Material-92"><span class="linenos"> 92</span></a>	<span class="k">def</span> <span class="nf">set_specific_heat_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-93"><a href="#Material-93"><span class="linenos"> 93</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-94"><a href="#Material-94"><span class="linenos"> 94</span></a><span class="sd">        Set specific heat capacity per element.</span>
</span><span id="Material-95"><a href="#Material-95"><span class="linenos"> 95</span></a>
</span><span id="Material-96"><a href="#Material-96"><span class="linenos"> 96</span></a><span class="sd">        Parameters</span>
</span><span id="Material-97"><a href="#Material-97"><span class="linenos"> 97</span></a><span class="sd">        ----------</span>
</span><span id="Material-98"><a href="#Material-98"><span class="linenos"> 98</span></a><span class="sd">        cp : torch.Tensor</span>
</span><span id="Material-99"><a href="#Material-99"><span class="linenos"> 99</span></a><span class="sd">            1D tensor of shape (N,) with specific heat capacities.</span>
</span><span id="Material-100"><a href="#Material-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-101"><a href="#Material-101"><span class="linenos">101</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">cp</span>
</span><span id="Material-102"><a href="#Material-102"><span class="linenos">102</span></a>
</span><span id="Material-103"><a href="#Material-103"><span class="linenos">103</span></a>	<span class="k">def</span> <span class="nf">set_thermal_conductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-104"><a href="#Material-104"><span class="linenos">104</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-105"><a href="#Material-105"><span class="linenos">105</span></a><span class="sd">        Set thermal conductivity per element.</span>
</span><span id="Material-106"><a href="#Material-106"><span class="linenos">106</span></a>
</span><span id="Material-107"><a href="#Material-107"><span class="linenos">107</span></a><span class="sd">        Parameters</span>
</span><span id="Material-108"><a href="#Material-108"><span class="linenos">108</span></a><span class="sd">        ----------</span>
</span><span id="Material-109"><a href="#Material-109"><span class="linenos">109</span></a><span class="sd">        k : torch.Tensor</span>
</span><span id="Material-110"><a href="#Material-110"><span class="linenos">110</span></a><span class="sd">            1D tensor of shape (N,) with conductivities.</span>
</span><span id="Material-111"><a href="#Material-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-112"><a href="#Material-112"><span class="linenos">112</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="Material-113"><a href="#Material-113"><span class="linenos">113</span></a>
</span><span id="Material-114"><a href="#Material-114"><span class="linenos">114</span></a>	<span class="k">def</span> <span class="nf">set_thermal_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_th</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-115"><a href="#Material-115"><span class="linenos">115</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-116"><a href="#Material-116"><span class="linenos">116</span></a><span class="sd">        Set coefficient of thermal expansion per element.</span>
</span><span id="Material-117"><a href="#Material-117"><span class="linenos">117</span></a>
</span><span id="Material-118"><a href="#Material-118"><span class="linenos">118</span></a><span class="sd">        Parameters</span>
</span><span id="Material-119"><a href="#Material-119"><span class="linenos">119</span></a><span class="sd">        ----------</span>
</span><span id="Material-120"><a href="#Material-120"><span class="linenos">120</span></a><span class="sd">        alpha_th : torch.Tensor</span>
</span><span id="Material-121"><a href="#Material-121"><span class="linenos">121</span></a><span class="sd">            1D tensor of shape (N,) with linear thermal expansion coefficients.</span>
</span><span id="Material-122"><a href="#Material-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-123"><a href="#Material-123"><span class="linenos">123</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">alpha_th</span> <span class="o">=</span> <span class="n">alpha_th</span>
</span><span id="Material-124"><a href="#Material-124"><span class="linenos">124</span></a>
</span><span id="Material-125"><a href="#Material-125"><span class="linenos">125</span></a>
</span><span id="Material-126"><a href="#Material-126"><span class="linenos">126</span></a>	<span class="k">def</span> <span class="nf">add_to_elastic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Spring</span><span class="p">):</span>
</span><span id="Material-127"><a href="#Material-127"><span class="linenos">127</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-128"><a href="#Material-128"><span class="linenos">128</span></a><span class="sd">        Add an elastic (linear isotropic) contributor and accumulate stiffness.</span>
</span><span id="Material-129"><a href="#Material-129"><span class="linenos">129</span></a>
</span><span id="Material-130"><a href="#Material-130"><span class="linenos">130</span></a><span class="sd">        Parameters</span>
</span><span id="Material-131"><a href="#Material-131"><span class="linenos">131</span></a><span class="sd">        ----------</span>
</span><span id="Material-132"><a href="#Material-132"><span class="linenos">132</span></a><span class="sd">        elem : Spring</span>
</span><span id="Material-133"><a href="#Material-133"><span class="linenos">133</span></a><span class="sd">            Elastic element. Its `initialize()` is called inside.</span>
</span><span id="Material-134"><a href="#Material-134"><span class="linenos">134</span></a>
</span><span id="Material-135"><a href="#Material-135"><span class="linenos">135</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-136"><a href="#Material-136"><span class="linenos">136</span></a><span class="sd">        ------------</span>
</span><span id="Material-137"><a href="#Material-137"><span class="linenos">137</span></a><span class="sd">        - Updates `C`, `C_inv`, `C_tilde`, `C_tilde_inv` by addition.</span>
</span><span id="Material-138"><a href="#Material-138"><span class="linenos">138</span></a><span class="sd">        - Stores `K`, `E`, and shear modulus estimate `ShearMod`.</span>
</span><span id="Material-139"><a href="#Material-139"><span class="linenos">139</span></a><span class="sd">        - Appends `elem` to `elems_e`.</span>
</span><span id="Material-140"><a href="#Material-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-141"><a href="#Material-141"><span class="linenos">141</span></a>		<span class="n">elem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Material-142"><a href="#Material-142"><span class="linenos">142</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C_inv</span>
</span><span id="Material-143"><a href="#Material-143"><span class="linenos">143</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C</span>
</span><span id="Material-144"><a href="#Material-144"><span class="linenos">144</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C_tilde_inv</span>
</span><span id="Material-145"><a href="#Material-145"><span class="linenos">145</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C_tilde</span>
</span><span id="Material-146"><a href="#Material-146"><span class="linenos">146</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="Material-147"><a href="#Material-147"><span class="linenos">147</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">K</span>
</span><span id="Material-148"><a href="#Material-148"><span class="linenos">148</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">E</span>
</span><span id="Material-149"><a href="#Material-149"><span class="linenos">149</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">ShearMod</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Material-150"><a href="#Material-150"><span class="linenos">150</span></a>
</span><span id="Material-151"><a href="#Material-151"><span class="linenos">151</span></a>	<span class="k">def</span> <span class="nf">add_to_non_elastic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">NonElasticElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-152"><a href="#Material-152"><span class="linenos">152</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-153"><a href="#Material-153"><span class="linenos">153</span></a><span class="sd">        Add a non-elastic element contributor.</span>
</span><span id="Material-154"><a href="#Material-154"><span class="linenos">154</span></a>
</span><span id="Material-155"><a href="#Material-155"><span class="linenos">155</span></a><span class="sd">        Parameters</span>
</span><span id="Material-156"><a href="#Material-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="Material-157"><a href="#Material-157"><span class="linenos">157</span></a><span class="sd">        elem : NonElasticElement</span>
</span><span id="Material-158"><a href="#Material-158"><span class="linenos">158</span></a><span class="sd">            Inelastic mechanism (e.g., creep, viscoplasticity).</span>
</span><span id="Material-159"><a href="#Material-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-160"><a href="#Material-160"><span class="linenos">160</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="Material-161"><a href="#Material-161"><span class="linenos">161</span></a>
</span><span id="Material-162"><a href="#Material-162"><span class="linenos">162</span></a>	<span class="k">def</span> <span class="nf">add_to_thermoelastic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Thermoelastic</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-163"><a href="#Material-163"><span class="linenos">163</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-164"><a href="#Material-164"><span class="linenos">164</span></a><span class="sd">        Add a thermoelastic contributor.</span>
</span><span id="Material-165"><a href="#Material-165"><span class="linenos">165</span></a>
</span><span id="Material-166"><a href="#Material-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="Material-167"><a href="#Material-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="Material-168"><a href="#Material-168"><span class="linenos">168</span></a><span class="sd">        elem : Thermoelastic</span>
</span><span id="Material-169"><a href="#Material-169"><span class="linenos">169</span></a><span class="sd">            Provides thermal strain contributions.</span>
</span><span id="Material-170"><a href="#Material-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-171"><a href="#Material-171"><span class="linenos">171</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="Material-172"><a href="#Material-172"><span class="linenos">172</span></a>
</span><span id="Material-173"><a href="#Material-173"><span class="linenos">173</span></a>	<span class="k">def</span> <span class="nf">compute_G_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-174"><a href="#Material-174"><span class="linenos">174</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-175"><a href="#Material-175"><span class="linenos">175</span></a><span class="sd">        Assemble non-elastic operators G and B over all inelastic elements.</span>
</span><span id="Material-176"><a href="#Material-176"><span class="linenos">176</span></a>
</span><span id="Material-177"><a href="#Material-177"><span class="linenos">177</span></a><span class="sd">        Parameters</span>
</span><span id="Material-178"><a href="#Material-178"><span class="linenos">178</span></a><span class="sd">        ----------</span>
</span><span id="Material-179"><a href="#Material-179"><span class="linenos">179</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Material-180"><a href="#Material-180"><span class="linenos">180</span></a><span class="sd">            Current Cauchy stress per element, shape (N, 3, 3).</span>
</span><span id="Material-181"><a href="#Material-181"><span class="linenos">181</span></a><span class="sd">        dt : float</span>
</span><span id="Material-182"><a href="#Material-182"><span class="linenos">182</span></a><span class="sd">            Time step size.</span>
</span><span id="Material-183"><a href="#Material-183"><span class="linenos">183</span></a><span class="sd">        theta : float</span>
</span><span id="Material-184"><a href="#Material-184"><span class="linenos">184</span></a><span class="sd">            Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</span>
</span><span id="Material-185"><a href="#Material-185"><span class="linenos">185</span></a><span class="sd">        T : torch.Tensor</span>
</span><span id="Material-186"><a href="#Material-186"><span class="linenos">186</span></a><span class="sd">            Temperature per element (shape (N,) or compatible).</span>
</span><span id="Material-187"><a href="#Material-187"><span class="linenos">187</span></a>
</span><span id="Material-188"><a href="#Material-188"><span class="linenos">188</span></a><span class="sd">        Returns</span>
</span><span id="Material-189"><a href="#Material-189"><span class="linenos">189</span></a><span class="sd">        -------</span>
</span><span id="Material-190"><a href="#Material-190"><span class="linenos">190</span></a><span class="sd">        None</span>
</span><span id="Material-191"><a href="#Material-191"><span class="linenos">191</span></a>
</span><span id="Material-192"><a href="#Material-192"><span class="linenos">192</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-193"><a href="#Material-193"><span class="linenos">193</span></a><span class="sd">        ------------</span>
</span><span id="Material-194"><a href="#Material-194"><span class="linenos">194</span></a><span class="sd">        Sets `self.G` (N,6,6) and `self.B` (N,3,3) as sums of element contributions.</span>
</span><span id="Material-195"><a href="#Material-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-196"><a href="#Material-196"><span class="linenos">196</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-197"><a href="#Material-197"><span class="linenos">197</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-198"><a href="#Material-198"><span class="linenos">198</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material-199"><a href="#Material-199"><span class="linenos">199</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_G_B</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</span><span id="Material-200"><a href="#Material-200"><span class="linenos">200</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">G</span>
</span><span id="Material-201"><a href="#Material-201"><span class="linenos">201</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">B</span>
</span><span id="Material-202"><a href="#Material-202"><span class="linenos">202</span></a>
</span><span id="Material-203"><a href="#Material-203"><span class="linenos">203</span></a>	<span class="k">def</span> <span class="nf">compute_T_IT</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-204"><a href="#Material-204"><span class="linenos">204</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-205"><a href="#Material-205"><span class="linenos">205</span></a><span class="sd">        Assemble volumetric coupling tensors T and IT from inelastic elements.</span>
</span><span id="Material-206"><a href="#Material-206"><span class="linenos">206</span></a>
</span><span id="Material-207"><a href="#Material-207"><span class="linenos">207</span></a><span class="sd">        Returns</span>
</span><span id="Material-208"><a href="#Material-208"><span class="linenos">208</span></a><span class="sd">        -------</span>
</span><span id="Material-209"><a href="#Material-209"><span class="linenos">209</span></a><span class="sd">        None</span>
</span><span id="Material-210"><a href="#Material-210"><span class="linenos">210</span></a>
</span><span id="Material-211"><a href="#Material-211"><span class="linenos">211</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-212"><a href="#Material-212"><span class="linenos">212</span></a><span class="sd">        ------------</span>
</span><span id="Material-213"><a href="#Material-213"><span class="linenos">213</span></a><span class="sd">        Sets `self.T` (N,3,3) and `self.IT` (N,6,6) as sums of element contributions.</span>
</span><span id="Material-214"><a href="#Material-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-215"><a href="#Material-215"><span class="linenos">215</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-216"><a href="#Material-216"><span class="linenos">216</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-217"><a href="#Material-217"><span class="linenos">217</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material-218"><a href="#Material-218"><span class="linenos">218</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_T_IT</span><span class="p">()</span>
</span><span id="Material-219"><a href="#Material-219"><span class="linenos">219</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">IT</span>
</span><span id="Material-220"><a href="#Material-220"><span class="linenos">220</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">T</span>
</span><span id="Material-221"><a href="#Material-221"><span class="linenos">221</span></a>
</span><span id="Material-222"><a href="#Material-222"><span class="linenos">222</span></a>	<span class="k">def</span> <span class="nf">compute_Bvol_Tvol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-223"><a href="#Material-223"><span class="linenos">223</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-224"><a href="#Material-224"><span class="linenos">224</span></a><span class="sd">        Compute volumetric parts of B and T.</span>
</span><span id="Material-225"><a href="#Material-225"><span class="linenos">225</span></a>
</span><span id="Material-226"><a href="#Material-226"><span class="linenos">226</span></a><span class="sd">        Parameters</span>
</span><span id="Material-227"><a href="#Material-227"><span class="linenos">227</span></a><span class="sd">        ----------</span>
</span><span id="Material-228"><a href="#Material-228"><span class="linenos">228</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Material-229"><a href="#Material-229"><span class="linenos">229</span></a><span class="sd">            Stress per element, shape (N, 3, 3). (Not used directly here.)</span>
</span><span id="Material-230"><a href="#Material-230"><span class="linenos">230</span></a><span class="sd">        dt : float</span>
</span><span id="Material-231"><a href="#Material-231"><span class="linenos">231</span></a><span class="sd">            Time step size. (Not used directly here.)</span>
</span><span id="Material-232"><a href="#Material-232"><span class="linenos">232</span></a>
</span><span id="Material-233"><a href="#Material-233"><span class="linenos">233</span></a><span class="sd">        Returns</span>
</span><span id="Material-234"><a href="#Material-234"><span class="linenos">234</span></a><span class="sd">        -------</span>
</span><span id="Material-235"><a href="#Material-235"><span class="linenos">235</span></a><span class="sd">        None</span>
</span><span id="Material-236"><a href="#Material-236"><span class="linenos">236</span></a>
</span><span id="Material-237"><a href="#Material-237"><span class="linenos">237</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-238"><a href="#Material-238"><span class="linenos">238</span></a><span class="sd">        ------------</span>
</span><span id="Material-239"><a href="#Material-239"><span class="linenos">239</span></a><span class="sd">        Sets `self.B_vol` and `self.T_vol` (shape (N,)) from element contributions.</span>
</span><span id="Material-240"><a href="#Material-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-241"><a href="#Material-241"><span class="linenos">241</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-242"><a href="#Material-242"><span class="linenos">242</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">T_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-243"><a href="#Material-243"><span class="linenos">243</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material-244"><a href="#Material-244"><span class="linenos">244</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_Bvol_Tvol</span><span class="p">()</span>
</span><span id="Material-245"><a href="#Material-245"><span class="linenos">245</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">B_vol</span>
</span><span id="Material-246"><a href="#Material-246"><span class="linenos">246</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">T_vol</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">T_vol</span>
</span><span id="Material-247"><a href="#Material-247"><span class="linenos">247</span></a>
</span><span id="Material-248"><a href="#Material-248"><span class="linenos">248</span></a>	<span class="k">def</span> <span class="nf">compute_Gtilde_Btilde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-249"><a href="#Material-249"><span class="linenos">249</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-250"><a href="#Material-250"><span class="linenos">250</span></a><span class="sd">        Compute deviatoric parts of G and B.</span>
</span><span id="Material-251"><a href="#Material-251"><span class="linenos">251</span></a>
</span><span id="Material-252"><a href="#Material-252"><span class="linenos">252</span></a><span class="sd">        Parameters</span>
</span><span id="Material-253"><a href="#Material-253"><span class="linenos">253</span></a><span class="sd">        ----------</span>
</span><span id="Material-254"><a href="#Material-254"><span class="linenos">254</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Material-255"><a href="#Material-255"><span class="linenos">255</span></a><span class="sd">            Stress per element, shape (N, 3, 3). (Not used directly here.)</span>
</span><span id="Material-256"><a href="#Material-256"><span class="linenos">256</span></a><span class="sd">        dt : float</span>
</span><span id="Material-257"><a href="#Material-257"><span class="linenos">257</span></a><span class="sd">            Time step size. (Not used directly here.)</span>
</span><span id="Material-258"><a href="#Material-258"><span class="linenos">258</span></a>
</span><span id="Material-259"><a href="#Material-259"><span class="linenos">259</span></a><span class="sd">        Returns</span>
</span><span id="Material-260"><a href="#Material-260"><span class="linenos">260</span></a><span class="sd">        -------</span>
</span><span id="Material-261"><a href="#Material-261"><span class="linenos">261</span></a><span class="sd">        None</span>
</span><span id="Material-262"><a href="#Material-262"><span class="linenos">262</span></a>
</span><span id="Material-263"><a href="#Material-263"><span class="linenos">263</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-264"><a href="#Material-264"><span class="linenos">264</span></a><span class="sd">        ------------</span>
</span><span id="Material-265"><a href="#Material-265"><span class="linenos">265</span></a><span class="sd">        Sets `self.G_tilde` and `self.B_tilde` (N,6,6) and (N,3,3).</span>
</span><span id="Material-266"><a href="#Material-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-267"><a href="#Material-267"><span class="linenos">267</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-268"><a href="#Material-268"><span class="linenos">268</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material-269"><a href="#Material-269"><span class="linenos">269</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material-270"><a href="#Material-270"><span class="linenos">270</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_Gtilde_Btilde</span><span class="p">()</span>
</span><span id="Material-271"><a href="#Material-271"><span class="linenos">271</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">G_tilde</span>
</span><span id="Material-272"><a href="#Material-272"><span class="linenos">272</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">B_tilde</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">B_tilde</span>
</span><span id="Material-273"><a href="#Material-273"><span class="linenos">273</span></a>
</span><span id="Material-274"><a href="#Material-274"><span class="linenos">274</span></a>	<span class="k">def</span> <span class="nf">compute_CT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-275"><a href="#Material-275"><span class="linenos">275</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-276"><a href="#Material-276"><span class="linenos">276</span></a><span class="sd">        Compute consistent tangent `CT = (C_inv + dt*(1-theta)*G)^{-1}`.</span>
</span><span id="Material-277"><a href="#Material-277"><span class="linenos">277</span></a>
</span><span id="Material-278"><a href="#Material-278"><span class="linenos">278</span></a><span class="sd">        Parameters</span>
</span><span id="Material-279"><a href="#Material-279"><span class="linenos">279</span></a><span class="sd">        ----------</span>
</span><span id="Material-280"><a href="#Material-280"><span class="linenos">280</span></a><span class="sd">        dt : float</span>
</span><span id="Material-281"><a href="#Material-281"><span class="linenos">281</span></a><span class="sd">            Time step size.</span>
</span><span id="Material-282"><a href="#Material-282"><span class="linenos">282</span></a><span class="sd">        theta : float</span>
</span><span id="Material-283"><a href="#Material-283"><span class="linenos">283</span></a><span class="sd">            Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</span>
</span><span id="Material-284"><a href="#Material-284"><span class="linenos">284</span></a>
</span><span id="Material-285"><a href="#Material-285"><span class="linenos">285</span></a><span class="sd">        Returns</span>
</span><span id="Material-286"><a href="#Material-286"><span class="linenos">286</span></a><span class="sd">        -------</span>
</span><span id="Material-287"><a href="#Material-287"><span class="linenos">287</span></a><span class="sd">        None</span>
</span><span id="Material-288"><a href="#Material-288"><span class="linenos">288</span></a>
</span><span id="Material-289"><a href="#Material-289"><span class="linenos">289</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-290"><a href="#Material-290"><span class="linenos">290</span></a><span class="sd">        ------------</span>
</span><span id="Material-291"><a href="#Material-291"><span class="linenos">291</span></a><span class="sd">        Sets `self.CT` (N, 6, 6).</span>
</span><span id="Material-292"><a href="#Material-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-293"><a href="#Material-293"><span class="linenos">293</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">CT</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
</span><span id="Material-294"><a href="#Material-294"><span class="linenos">294</span></a>
</span><span id="Material-295"><a href="#Material-295"><span class="linenos">295</span></a>	<span class="k">def</span> <span class="nf">compute_CT_tilde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material-296"><a href="#Material-296"><span class="linenos">296</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material-297"><a href="#Material-297"><span class="linenos">297</span></a><span class="sd">        Compute deviatoric consistent tangent `CT_tilde`.</span>
</span><span id="Material-298"><a href="#Material-298"><span class="linenos">298</span></a>
</span><span id="Material-299"><a href="#Material-299"><span class="linenos">299</span></a><span class="sd">        Parameters</span>
</span><span id="Material-300"><a href="#Material-300"><span class="linenos">300</span></a><span class="sd">        ----------</span>
</span><span id="Material-301"><a href="#Material-301"><span class="linenos">301</span></a><span class="sd">        dt : float</span>
</span><span id="Material-302"><a href="#Material-302"><span class="linenos">302</span></a><span class="sd">            Time step size.</span>
</span><span id="Material-303"><a href="#Material-303"><span class="linenos">303</span></a><span class="sd">        theta : float</span>
</span><span id="Material-304"><a href="#Material-304"><span class="linenos">304</span></a><span class="sd">            Time integration parameter in [0, 1].</span>
</span><span id="Material-305"><a href="#Material-305"><span class="linenos">305</span></a>
</span><span id="Material-306"><a href="#Material-306"><span class="linenos">306</span></a><span class="sd">        Returns</span>
</span><span id="Material-307"><a href="#Material-307"><span class="linenos">307</span></a><span class="sd">        -------</span>
</span><span id="Material-308"><a href="#Material-308"><span class="linenos">308</span></a><span class="sd">        None</span>
</span><span id="Material-309"><a href="#Material-309"><span class="linenos">309</span></a>
</span><span id="Material-310"><a href="#Material-310"><span class="linenos">310</span></a><span class="sd">        Side Effects</span>
</span><span id="Material-311"><a href="#Material-311"><span class="linenos">311</span></a><span class="sd">        ------------</span>
</span><span id="Material-312"><a href="#Material-312"><span class="linenos">312</span></a><span class="sd">        Sets `self.CT_tilde` (N, 6, 6).</span>
</span><span id="Material-313"><a href="#Material-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material-314"><a href="#Material-314"><span class="linenos">314</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">CT_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Composite material model that aggregates elastic, thermoelastic,
and non-elastic (e.g., viscoelastic/viscoplastic) elements.</p>

<p>The class stores element-wise stiffness operators in Voigt form
and assembles effective operators used during constitutive updates.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_elems</strong> (int):
Number of finite elements (batch size).</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>n_elems</strong> (int):
Number of elements.</li>
<li><strong>elems_ne</strong> (list[NonElasticElement]):
Collection of non-elastic elements contributing to non-elastic response.</li>
<li><strong>elems_th</strong> (list[Thermoelastic]):
Collection of thermoelastic contributors (thermal strain).</li>
<li><strong>elems_e</strong> (list[Spring]):
Collection of elastic contributors (linear isotropic springs).</li>
<li><strong>C_inv, C</strong> (torch.Tensor):
Element-wise stiffness (and inverse) in tensorial Voigt form, shape (N, 6, 6).</li>
<li><strong>C_tilde_inv, C_tilde</strong> (torch.Tensor):
Element-wise deviatoric stiffness (and inverse), shape (N, 6, 6).</li>
<li><strong>G, B</strong> (torch.Tensor):
Assembled non-elastic tangent-like (G) and state variable (B) operators, shapes
(N, 6, 6) and (N, 3, 3).</li>
<li><strong>IT, T</strong> (torch.Tensor):
Volumetric coupling tensors assembled from non-elastic elements.</li>
<li><strong>B_vol, T_vol</strong> (torch.Tensor):
Element-wise volumetric parts (scalars), shape (N,).</li>
<li><strong>G_tilde, B_tilde</strong> (torch.Tensor):
Deviatoric parts of G and B, shapes (N, 6, 6) and (N, 3, 3).</li>
<li><strong>CT, CT_tilde</strong> (torch.Tensor):
Effective consistent tangents after time integration, shapes (N, 6, 6).</li>
<li><strong>density, cp, k, alpha_th</strong> (torch.Tensor):
Optional material properties (per element).</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Voigt ordering is assumed to be <code>[xx, yy, zz, xy, xz, yz]</code> with
<strong>tensorial shear</strong> convention (no engineering factors).</li>
</ul>
</div>


                            <div id="Material.__init__" class="classattr">
                                        <input id="Material.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Material</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n_elems</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="Material.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.__init__-69"><a href="#Material.__init__-69"><span class="linenos">69</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_elems</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Material.__init__-70"><a href="#Material.__init__-70"><span class="linenos">70</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="n">n_elems</span>
</span><span id="Material.__init__-71"><a href="#Material.__init__-71"><span class="linenos">71</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Material.__init__-72"><a href="#Material.__init__-72"><span class="linenos">72</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_th</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Material.__init__-73"><a href="#Material.__init__-73"><span class="linenos">73</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Material.__init__-74"><a href="#Material.__init__-74"><span class="linenos">74</span></a>
</span><span id="Material.__init__-75"><a href="#Material.__init__-75"><span class="linenos">75</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.__init__-76"><a href="#Material.__init__-76"><span class="linenos">76</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.__init__-77"><a href="#Material.__init__-77"><span class="linenos">77</span></a>
</span><span id="Material.__init__-78"><a href="#Material.__init__-78"><span class="linenos">78</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.__init__-79"><a href="#Material.__init__-79"><span class="linenos">79</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Material.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#Material.n_elems"></a>
    
    

                            </div>
                            <div id="Material.elems_ne" class="classattr">
                                <div class="attr variable">
            <span class="name">elems_ne</span>

        
    </div>
    <a class="headerlink" href="#Material.elems_ne"></a>
    
    

                            </div>
                            <div id="Material.elems_th" class="classattr">
                                <div class="attr variable">
            <span class="name">elems_th</span>

        
    </div>
    <a class="headerlink" href="#Material.elems_th"></a>
    
    

                            </div>
                            <div id="Material.elems_e" class="classattr">
                                <div class="attr variable">
            <span class="name">elems_e</span>

        
    </div>
    <a class="headerlink" href="#Material.elems_e"></a>
    
    

                            </div>
                            <div id="Material.C_inv" class="classattr">
                                <div class="attr variable">
            <span class="name">C_inv</span>

        
    </div>
    <a class="headerlink" href="#Material.C_inv"></a>
    
    

                            </div>
                            <div id="Material.C" class="classattr">
                                <div class="attr variable">
            <span class="name">C</span>

        
    </div>
    <a class="headerlink" href="#Material.C"></a>
    
    

                            </div>
                            <div id="Material.C_tilde_inv" class="classattr">
                                <div class="attr variable">
            <span class="name">C_tilde_inv</span>

        
    </div>
    <a class="headerlink" href="#Material.C_tilde_inv"></a>
    
    

                            </div>
                            <div id="Material.C_tilde" class="classattr">
                                <div class="attr variable">
            <span class="name">C_tilde</span>

        
    </div>
    <a class="headerlink" href="#Material.C_tilde"></a>
    
    

                            </div>
                            <div id="Material.set_density" class="classattr">
                                        <input id="Material.set_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_density</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">density</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.set_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.set_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.set_density-81"><a href="#Material.set_density-81"><span class="linenos">81</span></a>	<span class="k">def</span> <span class="nf">set_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.set_density-82"><a href="#Material.set_density-82"><span class="linenos">82</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.set_density-83"><a href="#Material.set_density-83"><span class="linenos">83</span></a><span class="sd">        Set mass density per element.</span>
</span><span id="Material.set_density-84"><a href="#Material.set_density-84"><span class="linenos">84</span></a>
</span><span id="Material.set_density-85"><a href="#Material.set_density-85"><span class="linenos">85</span></a><span class="sd">        Parameters</span>
</span><span id="Material.set_density-86"><a href="#Material.set_density-86"><span class="linenos">86</span></a><span class="sd">        ----------</span>
</span><span id="Material.set_density-87"><a href="#Material.set_density-87"><span class="linenos">87</span></a><span class="sd">        density : torch.Tensor</span>
</span><span id="Material.set_density-88"><a href="#Material.set_density-88"><span class="linenos">88</span></a><span class="sd">            1D tensor of shape (N,) with densities.</span>
</span><span id="Material.set_density-89"><a href="#Material.set_density-89"><span class="linenos">89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.set_density-90"><a href="#Material.set_density-90"><span class="linenos">90</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="n">density</span>
</span></pre></div>


            <div class="docstring"><p>Set mass density per element.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>density</strong> (torch.Tensor):
1D tensor of shape (N,) with densities.</li>
</ul>
</div>


                            </div>
                            <div id="Material.set_specific_heat_capacity" class="classattr">
                                        <input id="Material.set_specific_heat_capacity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_specific_heat_capacity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.set_specific_heat_capacity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.set_specific_heat_capacity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.set_specific_heat_capacity-92"><a href="#Material.set_specific_heat_capacity-92"><span class="linenos"> 92</span></a>	<span class="k">def</span> <span class="nf">set_specific_heat_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.set_specific_heat_capacity-93"><a href="#Material.set_specific_heat_capacity-93"><span class="linenos"> 93</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.set_specific_heat_capacity-94"><a href="#Material.set_specific_heat_capacity-94"><span class="linenos"> 94</span></a><span class="sd">        Set specific heat capacity per element.</span>
</span><span id="Material.set_specific_heat_capacity-95"><a href="#Material.set_specific_heat_capacity-95"><span class="linenos"> 95</span></a>
</span><span id="Material.set_specific_heat_capacity-96"><a href="#Material.set_specific_heat_capacity-96"><span class="linenos"> 96</span></a><span class="sd">        Parameters</span>
</span><span id="Material.set_specific_heat_capacity-97"><a href="#Material.set_specific_heat_capacity-97"><span class="linenos"> 97</span></a><span class="sd">        ----------</span>
</span><span id="Material.set_specific_heat_capacity-98"><a href="#Material.set_specific_heat_capacity-98"><span class="linenos"> 98</span></a><span class="sd">        cp : torch.Tensor</span>
</span><span id="Material.set_specific_heat_capacity-99"><a href="#Material.set_specific_heat_capacity-99"><span class="linenos"> 99</span></a><span class="sd">            1D tensor of shape (N,) with specific heat capacities.</span>
</span><span id="Material.set_specific_heat_capacity-100"><a href="#Material.set_specific_heat_capacity-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.set_specific_heat_capacity-101"><a href="#Material.set_specific_heat_capacity-101"><span class="linenos">101</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">cp</span>
</span></pre></div>


            <div class="docstring"><p>Set specific heat capacity per element.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>cp</strong> (torch.Tensor):
1D tensor of shape (N,) with specific heat capacities.</li>
</ul>
</div>


                            </div>
                            <div id="Material.set_thermal_conductivity" class="classattr">
                                        <input id="Material.set_thermal_conductivity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_thermal_conductivity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.set_thermal_conductivity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.set_thermal_conductivity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.set_thermal_conductivity-103"><a href="#Material.set_thermal_conductivity-103"><span class="linenos">103</span></a>	<span class="k">def</span> <span class="nf">set_thermal_conductivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.set_thermal_conductivity-104"><a href="#Material.set_thermal_conductivity-104"><span class="linenos">104</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.set_thermal_conductivity-105"><a href="#Material.set_thermal_conductivity-105"><span class="linenos">105</span></a><span class="sd">        Set thermal conductivity per element.</span>
</span><span id="Material.set_thermal_conductivity-106"><a href="#Material.set_thermal_conductivity-106"><span class="linenos">106</span></a>
</span><span id="Material.set_thermal_conductivity-107"><a href="#Material.set_thermal_conductivity-107"><span class="linenos">107</span></a><span class="sd">        Parameters</span>
</span><span id="Material.set_thermal_conductivity-108"><a href="#Material.set_thermal_conductivity-108"><span class="linenos">108</span></a><span class="sd">        ----------</span>
</span><span id="Material.set_thermal_conductivity-109"><a href="#Material.set_thermal_conductivity-109"><span class="linenos">109</span></a><span class="sd">        k : torch.Tensor</span>
</span><span id="Material.set_thermal_conductivity-110"><a href="#Material.set_thermal_conductivity-110"><span class="linenos">110</span></a><span class="sd">            1D tensor of shape (N,) with conductivities.</span>
</span><span id="Material.set_thermal_conductivity-111"><a href="#Material.set_thermal_conductivity-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.set_thermal_conductivity-112"><a href="#Material.set_thermal_conductivity-112"><span class="linenos">112</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
</span></pre></div>


            <div class="docstring"><p>Set thermal conductivity per element.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>k</strong> (torch.Tensor):
1D tensor of shape (N,) with conductivities.</li>
</ul>
</div>


                            </div>
                            <div id="Material.set_thermal_expansion" class="classattr">
                                        <input id="Material.set_thermal_expansion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_thermal_expansion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">alpha_th</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.set_thermal_expansion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.set_thermal_expansion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.set_thermal_expansion-114"><a href="#Material.set_thermal_expansion-114"><span class="linenos">114</span></a>	<span class="k">def</span> <span class="nf">set_thermal_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_th</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.set_thermal_expansion-115"><a href="#Material.set_thermal_expansion-115"><span class="linenos">115</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.set_thermal_expansion-116"><a href="#Material.set_thermal_expansion-116"><span class="linenos">116</span></a><span class="sd">        Set coefficient of thermal expansion per element.</span>
</span><span id="Material.set_thermal_expansion-117"><a href="#Material.set_thermal_expansion-117"><span class="linenos">117</span></a>
</span><span id="Material.set_thermal_expansion-118"><a href="#Material.set_thermal_expansion-118"><span class="linenos">118</span></a><span class="sd">        Parameters</span>
</span><span id="Material.set_thermal_expansion-119"><a href="#Material.set_thermal_expansion-119"><span class="linenos">119</span></a><span class="sd">        ----------</span>
</span><span id="Material.set_thermal_expansion-120"><a href="#Material.set_thermal_expansion-120"><span class="linenos">120</span></a><span class="sd">        alpha_th : torch.Tensor</span>
</span><span id="Material.set_thermal_expansion-121"><a href="#Material.set_thermal_expansion-121"><span class="linenos">121</span></a><span class="sd">            1D tensor of shape (N,) with linear thermal expansion coefficients.</span>
</span><span id="Material.set_thermal_expansion-122"><a href="#Material.set_thermal_expansion-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.set_thermal_expansion-123"><a href="#Material.set_thermal_expansion-123"><span class="linenos">123</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">alpha_th</span> <span class="o">=</span> <span class="n">alpha_th</span>
</span></pre></div>


            <div class="docstring"><p>Set coefficient of thermal expansion per element.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>alpha_th</strong> (torch.Tensor):
1D tensor of shape (N,) with linear thermal expansion coefficients.</li>
</ul>
</div>


                            </div>
                            <div id="Material.add_to_elastic" class="classattr">
                                        <input id="Material.add_to_elastic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_to_elastic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">elem</span><span class="p">:</span> <span class="n"><a href="#Spring">Spring</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Material.add_to_elastic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.add_to_elastic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.add_to_elastic-126"><a href="#Material.add_to_elastic-126"><span class="linenos">126</span></a>	<span class="k">def</span> <span class="nf">add_to_elastic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Spring</span><span class="p">):</span>
</span><span id="Material.add_to_elastic-127"><a href="#Material.add_to_elastic-127"><span class="linenos">127</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.add_to_elastic-128"><a href="#Material.add_to_elastic-128"><span class="linenos">128</span></a><span class="sd">        Add an elastic (linear isotropic) contributor and accumulate stiffness.</span>
</span><span id="Material.add_to_elastic-129"><a href="#Material.add_to_elastic-129"><span class="linenos">129</span></a>
</span><span id="Material.add_to_elastic-130"><a href="#Material.add_to_elastic-130"><span class="linenos">130</span></a><span class="sd">        Parameters</span>
</span><span id="Material.add_to_elastic-131"><a href="#Material.add_to_elastic-131"><span class="linenos">131</span></a><span class="sd">        ----------</span>
</span><span id="Material.add_to_elastic-132"><a href="#Material.add_to_elastic-132"><span class="linenos">132</span></a><span class="sd">        elem : Spring</span>
</span><span id="Material.add_to_elastic-133"><a href="#Material.add_to_elastic-133"><span class="linenos">133</span></a><span class="sd">            Elastic element. Its `initialize()` is called inside.</span>
</span><span id="Material.add_to_elastic-134"><a href="#Material.add_to_elastic-134"><span class="linenos">134</span></a>
</span><span id="Material.add_to_elastic-135"><a href="#Material.add_to_elastic-135"><span class="linenos">135</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.add_to_elastic-136"><a href="#Material.add_to_elastic-136"><span class="linenos">136</span></a><span class="sd">        ------------</span>
</span><span id="Material.add_to_elastic-137"><a href="#Material.add_to_elastic-137"><span class="linenos">137</span></a><span class="sd">        - Updates `C`, `C_inv`, `C_tilde`, `C_tilde_inv` by addition.</span>
</span><span id="Material.add_to_elastic-138"><a href="#Material.add_to_elastic-138"><span class="linenos">138</span></a><span class="sd">        - Stores `K`, `E`, and shear modulus estimate `ShearMod`.</span>
</span><span id="Material.add_to_elastic-139"><a href="#Material.add_to_elastic-139"><span class="linenos">139</span></a><span class="sd">        - Appends `elem` to `elems_e`.</span>
</span><span id="Material.add_to_elastic-140"><a href="#Material.add_to_elastic-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.add_to_elastic-141"><a href="#Material.add_to_elastic-141"><span class="linenos">141</span></a>		<span class="n">elem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Material.add_to_elastic-142"><a href="#Material.add_to_elastic-142"><span class="linenos">142</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C_inv</span>
</span><span id="Material.add_to_elastic-143"><a href="#Material.add_to_elastic-143"><span class="linenos">143</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C</span>
</span><span id="Material.add_to_elastic-144"><a href="#Material.add_to_elastic-144"><span class="linenos">144</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C_tilde_inv</span>
</span><span id="Material.add_to_elastic-145"><a href="#Material.add_to_elastic-145"><span class="linenos">145</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">C_tilde</span>
</span><span id="Material.add_to_elastic-146"><a href="#Material.add_to_elastic-146"><span class="linenos">146</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="Material.add_to_elastic-147"><a href="#Material.add_to_elastic-147"><span class="linenos">147</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">K</span>
</span><span id="Material.add_to_elastic-148"><a href="#Material.add_to_elastic-148"><span class="linenos">148</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">E</span>
</span><span id="Material.add_to_elastic-149"><a href="#Material.add_to_elastic-149"><span class="linenos">149</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">ShearMod</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add an elastic (linear isotropic) contributor and accumulate stiffness.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>elem</strong> (Spring):
Elastic element. Its <code>initialize()</code> is called inside.</li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<ul>
<li>Updates <code><a href="#Material.C">C</a></code>, <code><a href="#Material.C_inv">C_inv</a></code>, <code><a href="#Material.C_tilde">C_tilde</a></code>, <code><a href="#Material.C_tilde_inv">C_tilde_inv</a></code> by addition.</li>
<li>Stores <code>K</code>, <code>E</code>, and shear modulus estimate <code>ShearMod</code>.</li>
<li>Appends <code>elem</code> to <code><a href="#Material.elems_e">elems_e</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Material.add_to_non_elastic" class="classattr">
                                        <input id="Material.add_to_non_elastic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_to_non_elastic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">elem</span><span class="p">:</span> <span class="n"><a href="#NonElasticElement">NonElasticElement</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.add_to_non_elastic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.add_to_non_elastic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.add_to_non_elastic-151"><a href="#Material.add_to_non_elastic-151"><span class="linenos">151</span></a>	<span class="k">def</span> <span class="nf">add_to_non_elastic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">NonElasticElement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.add_to_non_elastic-152"><a href="#Material.add_to_non_elastic-152"><span class="linenos">152</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.add_to_non_elastic-153"><a href="#Material.add_to_non_elastic-153"><span class="linenos">153</span></a><span class="sd">        Add a non-elastic element contributor.</span>
</span><span id="Material.add_to_non_elastic-154"><a href="#Material.add_to_non_elastic-154"><span class="linenos">154</span></a>
</span><span id="Material.add_to_non_elastic-155"><a href="#Material.add_to_non_elastic-155"><span class="linenos">155</span></a><span class="sd">        Parameters</span>
</span><span id="Material.add_to_non_elastic-156"><a href="#Material.add_to_non_elastic-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="Material.add_to_non_elastic-157"><a href="#Material.add_to_non_elastic-157"><span class="linenos">157</span></a><span class="sd">        elem : NonElasticElement</span>
</span><span id="Material.add_to_non_elastic-158"><a href="#Material.add_to_non_elastic-158"><span class="linenos">158</span></a><span class="sd">            Inelastic mechanism (e.g., creep, viscoplasticity).</span>
</span><span id="Material.add_to_non_elastic-159"><a href="#Material.add_to_non_elastic-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.add_to_non_elastic-160"><a href="#Material.add_to_non_elastic-160"><span class="linenos">160</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a non-elastic element contributor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>elem</strong> (NonElasticElement):
Inelastic mechanism (e.g., creep, viscoplasticity).</li>
</ul>
</div>


                            </div>
                            <div id="Material.add_to_thermoelastic" class="classattr">
                                        <input id="Material.add_to_thermoelastic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_to_thermoelastic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">elem</span><span class="p">:</span> <span class="n"><a href="#Thermoelastic">Thermoelastic</a></span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.add_to_thermoelastic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.add_to_thermoelastic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.add_to_thermoelastic-162"><a href="#Material.add_to_thermoelastic-162"><span class="linenos">162</span></a>	<span class="k">def</span> <span class="nf">add_to_thermoelastic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Thermoelastic</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.add_to_thermoelastic-163"><a href="#Material.add_to_thermoelastic-163"><span class="linenos">163</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.add_to_thermoelastic-164"><a href="#Material.add_to_thermoelastic-164"><span class="linenos">164</span></a><span class="sd">        Add a thermoelastic contributor.</span>
</span><span id="Material.add_to_thermoelastic-165"><a href="#Material.add_to_thermoelastic-165"><span class="linenos">165</span></a>
</span><span id="Material.add_to_thermoelastic-166"><a href="#Material.add_to_thermoelastic-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="Material.add_to_thermoelastic-167"><a href="#Material.add_to_thermoelastic-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="Material.add_to_thermoelastic-168"><a href="#Material.add_to_thermoelastic-168"><span class="linenos">168</span></a><span class="sd">        elem : Thermoelastic</span>
</span><span id="Material.add_to_thermoelastic-169"><a href="#Material.add_to_thermoelastic-169"><span class="linenos">169</span></a><span class="sd">            Provides thermal strain contributions.</span>
</span><span id="Material.add_to_thermoelastic-170"><a href="#Material.add_to_thermoelastic-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.add_to_thermoelastic-171"><a href="#Material.add_to_thermoelastic-171"><span class="linenos">171</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">elems_th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a thermoelastic contributor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>elem</strong> (Thermoelastic):
Provides thermal strain contributions.</li>
</ul>
</div>


                            </div>
                            <div id="Material.compute_G_B" class="classattr">
                                        <input id="Material.compute_G_B-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_G_B</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">T</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.compute_G_B-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.compute_G_B"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.compute_G_B-173"><a href="#Material.compute_G_B-173"><span class="linenos">173</span></a>	<span class="k">def</span> <span class="nf">compute_G_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.compute_G_B-174"><a href="#Material.compute_G_B-174"><span class="linenos">174</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.compute_G_B-175"><a href="#Material.compute_G_B-175"><span class="linenos">175</span></a><span class="sd">        Assemble non-elastic operators G and B over all inelastic elements.</span>
</span><span id="Material.compute_G_B-176"><a href="#Material.compute_G_B-176"><span class="linenos">176</span></a>
</span><span id="Material.compute_G_B-177"><a href="#Material.compute_G_B-177"><span class="linenos">177</span></a><span class="sd">        Parameters</span>
</span><span id="Material.compute_G_B-178"><a href="#Material.compute_G_B-178"><span class="linenos">178</span></a><span class="sd">        ----------</span>
</span><span id="Material.compute_G_B-179"><a href="#Material.compute_G_B-179"><span class="linenos">179</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Material.compute_G_B-180"><a href="#Material.compute_G_B-180"><span class="linenos">180</span></a><span class="sd">            Current Cauchy stress per element, shape (N, 3, 3).</span>
</span><span id="Material.compute_G_B-181"><a href="#Material.compute_G_B-181"><span class="linenos">181</span></a><span class="sd">        dt : float</span>
</span><span id="Material.compute_G_B-182"><a href="#Material.compute_G_B-182"><span class="linenos">182</span></a><span class="sd">            Time step size.</span>
</span><span id="Material.compute_G_B-183"><a href="#Material.compute_G_B-183"><span class="linenos">183</span></a><span class="sd">        theta : float</span>
</span><span id="Material.compute_G_B-184"><a href="#Material.compute_G_B-184"><span class="linenos">184</span></a><span class="sd">            Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</span>
</span><span id="Material.compute_G_B-185"><a href="#Material.compute_G_B-185"><span class="linenos">185</span></a><span class="sd">        T : torch.Tensor</span>
</span><span id="Material.compute_G_B-186"><a href="#Material.compute_G_B-186"><span class="linenos">186</span></a><span class="sd">            Temperature per element (shape (N,) or compatible).</span>
</span><span id="Material.compute_G_B-187"><a href="#Material.compute_G_B-187"><span class="linenos">187</span></a>
</span><span id="Material.compute_G_B-188"><a href="#Material.compute_G_B-188"><span class="linenos">188</span></a><span class="sd">        Returns</span>
</span><span id="Material.compute_G_B-189"><a href="#Material.compute_G_B-189"><span class="linenos">189</span></a><span class="sd">        -------</span>
</span><span id="Material.compute_G_B-190"><a href="#Material.compute_G_B-190"><span class="linenos">190</span></a><span class="sd">        None</span>
</span><span id="Material.compute_G_B-191"><a href="#Material.compute_G_B-191"><span class="linenos">191</span></a>
</span><span id="Material.compute_G_B-192"><a href="#Material.compute_G_B-192"><span class="linenos">192</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.compute_G_B-193"><a href="#Material.compute_G_B-193"><span class="linenos">193</span></a><span class="sd">        ------------</span>
</span><span id="Material.compute_G_B-194"><a href="#Material.compute_G_B-194"><span class="linenos">194</span></a><span class="sd">        Sets `self.G` (N,6,6) and `self.B` (N,3,3) as sums of element contributions.</span>
</span><span id="Material.compute_G_B-195"><a href="#Material.compute_G_B-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.compute_G_B-196"><a href="#Material.compute_G_B-196"><span class="linenos">196</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_G_B-197"><a href="#Material.compute_G_B-197"><span class="linenos">197</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_G_B-198"><a href="#Material.compute_G_B-198"><span class="linenos">198</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material.compute_G_B-199"><a href="#Material.compute_G_B-199"><span class="linenos">199</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_G_B</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
</span><span id="Material.compute_G_B-200"><a href="#Material.compute_G_B-200"><span class="linenos">200</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">G</span>
</span><span id="Material.compute_G_B-201"><a href="#Material.compute_G_B-201"><span class="linenos">201</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">B</span>
</span></pre></div>


            <div class="docstring"><p>Assemble non-elastic operators G and B over all inelastic elements.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Current Cauchy stress per element, shape (N, 3, 3).</li>
<li><strong>dt</strong> (float):
Time step size.</li>
<li><strong>theta</strong> (float):
Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</li>
<li><strong>T</strong> (torch.Tensor):
Temperature per element (shape (N,) or compatible).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.G</code> (N,6,6) and <code>self.B</code> (N,3,3) as sums of element contributions.</p>
</div>


                            </div>
                            <div id="Material.compute_T_IT" class="classattr">
                                        <input id="Material.compute_T_IT-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_T_IT</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.compute_T_IT-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.compute_T_IT"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.compute_T_IT-203"><a href="#Material.compute_T_IT-203"><span class="linenos">203</span></a>	<span class="k">def</span> <span class="nf">compute_T_IT</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.compute_T_IT-204"><a href="#Material.compute_T_IT-204"><span class="linenos">204</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.compute_T_IT-205"><a href="#Material.compute_T_IT-205"><span class="linenos">205</span></a><span class="sd">        Assemble volumetric coupling tensors T and IT from inelastic elements.</span>
</span><span id="Material.compute_T_IT-206"><a href="#Material.compute_T_IT-206"><span class="linenos">206</span></a>
</span><span id="Material.compute_T_IT-207"><a href="#Material.compute_T_IT-207"><span class="linenos">207</span></a><span class="sd">        Returns</span>
</span><span id="Material.compute_T_IT-208"><a href="#Material.compute_T_IT-208"><span class="linenos">208</span></a><span class="sd">        -------</span>
</span><span id="Material.compute_T_IT-209"><a href="#Material.compute_T_IT-209"><span class="linenos">209</span></a><span class="sd">        None</span>
</span><span id="Material.compute_T_IT-210"><a href="#Material.compute_T_IT-210"><span class="linenos">210</span></a>
</span><span id="Material.compute_T_IT-211"><a href="#Material.compute_T_IT-211"><span class="linenos">211</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.compute_T_IT-212"><a href="#Material.compute_T_IT-212"><span class="linenos">212</span></a><span class="sd">        ------------</span>
</span><span id="Material.compute_T_IT-213"><a href="#Material.compute_T_IT-213"><span class="linenos">213</span></a><span class="sd">        Sets `self.T` (N,3,3) and `self.IT` (N,6,6) as sums of element contributions.</span>
</span><span id="Material.compute_T_IT-214"><a href="#Material.compute_T_IT-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.compute_T_IT-215"><a href="#Material.compute_T_IT-215"><span class="linenos">215</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_T_IT-216"><a href="#Material.compute_T_IT-216"><span class="linenos">216</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_T_IT-217"><a href="#Material.compute_T_IT-217"><span class="linenos">217</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material.compute_T_IT-218"><a href="#Material.compute_T_IT-218"><span class="linenos">218</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_T_IT</span><span class="p">()</span>
</span><span id="Material.compute_T_IT-219"><a href="#Material.compute_T_IT-219"><span class="linenos">219</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">IT</span>
</span><span id="Material.compute_T_IT-220"><a href="#Material.compute_T_IT-220"><span class="linenos">220</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">T</span>
</span></pre></div>


            <div class="docstring"><p>Assemble volumetric coupling tensors T and IT from inelastic elements.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.T</code> (N,3,3) and <code>self.IT</code> (N,6,6) as sums of element contributions.</p>
</div>


                            </div>
                            <div id="Material.compute_Bvol_Tvol" class="classattr">
                                        <input id="Material.compute_Bvol_Tvol-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_Bvol_Tvol</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.compute_Bvol_Tvol-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.compute_Bvol_Tvol"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.compute_Bvol_Tvol-222"><a href="#Material.compute_Bvol_Tvol-222"><span class="linenos">222</span></a>	<span class="k">def</span> <span class="nf">compute_Bvol_Tvol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.compute_Bvol_Tvol-223"><a href="#Material.compute_Bvol_Tvol-223"><span class="linenos">223</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.compute_Bvol_Tvol-224"><a href="#Material.compute_Bvol_Tvol-224"><span class="linenos">224</span></a><span class="sd">        Compute volumetric parts of B and T.</span>
</span><span id="Material.compute_Bvol_Tvol-225"><a href="#Material.compute_Bvol_Tvol-225"><span class="linenos">225</span></a>
</span><span id="Material.compute_Bvol_Tvol-226"><a href="#Material.compute_Bvol_Tvol-226"><span class="linenos">226</span></a><span class="sd">        Parameters</span>
</span><span id="Material.compute_Bvol_Tvol-227"><a href="#Material.compute_Bvol_Tvol-227"><span class="linenos">227</span></a><span class="sd">        ----------</span>
</span><span id="Material.compute_Bvol_Tvol-228"><a href="#Material.compute_Bvol_Tvol-228"><span class="linenos">228</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Material.compute_Bvol_Tvol-229"><a href="#Material.compute_Bvol_Tvol-229"><span class="linenos">229</span></a><span class="sd">            Stress per element, shape (N, 3, 3). (Not used directly here.)</span>
</span><span id="Material.compute_Bvol_Tvol-230"><a href="#Material.compute_Bvol_Tvol-230"><span class="linenos">230</span></a><span class="sd">        dt : float</span>
</span><span id="Material.compute_Bvol_Tvol-231"><a href="#Material.compute_Bvol_Tvol-231"><span class="linenos">231</span></a><span class="sd">            Time step size. (Not used directly here.)</span>
</span><span id="Material.compute_Bvol_Tvol-232"><a href="#Material.compute_Bvol_Tvol-232"><span class="linenos">232</span></a>
</span><span id="Material.compute_Bvol_Tvol-233"><a href="#Material.compute_Bvol_Tvol-233"><span class="linenos">233</span></a><span class="sd">        Returns</span>
</span><span id="Material.compute_Bvol_Tvol-234"><a href="#Material.compute_Bvol_Tvol-234"><span class="linenos">234</span></a><span class="sd">        -------</span>
</span><span id="Material.compute_Bvol_Tvol-235"><a href="#Material.compute_Bvol_Tvol-235"><span class="linenos">235</span></a><span class="sd">        None</span>
</span><span id="Material.compute_Bvol_Tvol-236"><a href="#Material.compute_Bvol_Tvol-236"><span class="linenos">236</span></a>
</span><span id="Material.compute_Bvol_Tvol-237"><a href="#Material.compute_Bvol_Tvol-237"><span class="linenos">237</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.compute_Bvol_Tvol-238"><a href="#Material.compute_Bvol_Tvol-238"><span class="linenos">238</span></a><span class="sd">        ------------</span>
</span><span id="Material.compute_Bvol_Tvol-239"><a href="#Material.compute_Bvol_Tvol-239"><span class="linenos">239</span></a><span class="sd">        Sets `self.B_vol` and `self.T_vol` (shape (N,)) from element contributions.</span>
</span><span id="Material.compute_Bvol_Tvol-240"><a href="#Material.compute_Bvol_Tvol-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.compute_Bvol_Tvol-241"><a href="#Material.compute_Bvol_Tvol-241"><span class="linenos">241</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_Bvol_Tvol-242"><a href="#Material.compute_Bvol_Tvol-242"><span class="linenos">242</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">T_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_Bvol_Tvol-243"><a href="#Material.compute_Bvol_Tvol-243"><span class="linenos">243</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material.compute_Bvol_Tvol-244"><a href="#Material.compute_Bvol_Tvol-244"><span class="linenos">244</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_Bvol_Tvol</span><span class="p">()</span>
</span><span id="Material.compute_Bvol_Tvol-245"><a href="#Material.compute_Bvol_Tvol-245"><span class="linenos">245</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">B_vol</span>
</span><span id="Material.compute_Bvol_Tvol-246"><a href="#Material.compute_Bvol_Tvol-246"><span class="linenos">246</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">T_vol</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">T_vol</span>
</span></pre></div>


            <div class="docstring"><p>Compute volumetric parts of B and T.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3). (Not used directly here.)</li>
<li><strong>dt</strong> (float):
Time step size. (Not used directly here.)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.B_vol</code> and <code>self.T_vol</code> (shape (N,)) from element contributions.</p>
</div>


                            </div>
                            <div id="Material.compute_Gtilde_Btilde" class="classattr">
                                        <input id="Material.compute_Gtilde_Btilde-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_Gtilde_Btilde</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.compute_Gtilde_Btilde-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.compute_Gtilde_Btilde"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.compute_Gtilde_Btilde-248"><a href="#Material.compute_Gtilde_Btilde-248"><span class="linenos">248</span></a>	<span class="k">def</span> <span class="nf">compute_Gtilde_Btilde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.compute_Gtilde_Btilde-249"><a href="#Material.compute_Gtilde_Btilde-249"><span class="linenos">249</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.compute_Gtilde_Btilde-250"><a href="#Material.compute_Gtilde_Btilde-250"><span class="linenos">250</span></a><span class="sd">        Compute deviatoric parts of G and B.</span>
</span><span id="Material.compute_Gtilde_Btilde-251"><a href="#Material.compute_Gtilde_Btilde-251"><span class="linenos">251</span></a>
</span><span id="Material.compute_Gtilde_Btilde-252"><a href="#Material.compute_Gtilde_Btilde-252"><span class="linenos">252</span></a><span class="sd">        Parameters</span>
</span><span id="Material.compute_Gtilde_Btilde-253"><a href="#Material.compute_Gtilde_Btilde-253"><span class="linenos">253</span></a><span class="sd">        ----------</span>
</span><span id="Material.compute_Gtilde_Btilde-254"><a href="#Material.compute_Gtilde_Btilde-254"><span class="linenos">254</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Material.compute_Gtilde_Btilde-255"><a href="#Material.compute_Gtilde_Btilde-255"><span class="linenos">255</span></a><span class="sd">            Stress per element, shape (N, 3, 3). (Not used directly here.)</span>
</span><span id="Material.compute_Gtilde_Btilde-256"><a href="#Material.compute_Gtilde_Btilde-256"><span class="linenos">256</span></a><span class="sd">        dt : float</span>
</span><span id="Material.compute_Gtilde_Btilde-257"><a href="#Material.compute_Gtilde_Btilde-257"><span class="linenos">257</span></a><span class="sd">            Time step size. (Not used directly here.)</span>
</span><span id="Material.compute_Gtilde_Btilde-258"><a href="#Material.compute_Gtilde_Btilde-258"><span class="linenos">258</span></a>
</span><span id="Material.compute_Gtilde_Btilde-259"><a href="#Material.compute_Gtilde_Btilde-259"><span class="linenos">259</span></a><span class="sd">        Returns</span>
</span><span id="Material.compute_Gtilde_Btilde-260"><a href="#Material.compute_Gtilde_Btilde-260"><span class="linenos">260</span></a><span class="sd">        -------</span>
</span><span id="Material.compute_Gtilde_Btilde-261"><a href="#Material.compute_Gtilde_Btilde-261"><span class="linenos">261</span></a><span class="sd">        None</span>
</span><span id="Material.compute_Gtilde_Btilde-262"><a href="#Material.compute_Gtilde_Btilde-262"><span class="linenos">262</span></a>
</span><span id="Material.compute_Gtilde_Btilde-263"><a href="#Material.compute_Gtilde_Btilde-263"><span class="linenos">263</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.compute_Gtilde_Btilde-264"><a href="#Material.compute_Gtilde_Btilde-264"><span class="linenos">264</span></a><span class="sd">        ------------</span>
</span><span id="Material.compute_Gtilde_Btilde-265"><a href="#Material.compute_Gtilde_Btilde-265"><span class="linenos">265</span></a><span class="sd">        Sets `self.G_tilde` and `self.B_tilde` (N,6,6) and (N,3,3).</span>
</span><span id="Material.compute_Gtilde_Btilde-266"><a href="#Material.compute_Gtilde_Btilde-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.compute_Gtilde_Btilde-267"><a href="#Material.compute_Gtilde_Btilde-267"><span class="linenos">267</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_Gtilde_Btilde-268"><a href="#Material.compute_Gtilde_Btilde-268"><span class="linenos">268</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">B_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Material.compute_Gtilde_Btilde-269"><a href="#Material.compute_Gtilde_Btilde-269"><span class="linenos">269</span></a>		<span class="k">for</span> <span class="n">elem_ne</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">:</span>
</span><span id="Material.compute_Gtilde_Btilde-270"><a href="#Material.compute_Gtilde_Btilde-270"><span class="linenos">270</span></a>			<span class="n">elem_ne</span><span class="o">.</span><span class="n">compute_Gtilde_Btilde</span><span class="p">()</span>
</span><span id="Material.compute_Gtilde_Btilde-271"><a href="#Material.compute_Gtilde_Btilde-271"><span class="linenos">271</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">G_tilde</span>
</span><span id="Material.compute_Gtilde_Btilde-272"><a href="#Material.compute_Gtilde_Btilde-272"><span class="linenos">272</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">B_tilde</span> <span class="o">+=</span> <span class="n">elem_ne</span><span class="o">.</span><span class="n">B_tilde</span>
</span></pre></div>


            <div class="docstring"><p>Compute deviatoric parts of G and B.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3). (Not used directly here.)</li>
<li><strong>dt</strong> (float):
Time step size. (Not used directly here.)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.G_tilde</code> and <code>self.B_tilde</code> (N,6,6) and (N,3,3).</p>
</div>


                            </div>
                            <div id="Material.compute_CT" class="classattr">
                                        <input id="Material.compute_CT-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_CT</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">theta</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.compute_CT-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.compute_CT"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.compute_CT-274"><a href="#Material.compute_CT-274"><span class="linenos">274</span></a>	<span class="k">def</span> <span class="nf">compute_CT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.compute_CT-275"><a href="#Material.compute_CT-275"><span class="linenos">275</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.compute_CT-276"><a href="#Material.compute_CT-276"><span class="linenos">276</span></a><span class="sd">        Compute consistent tangent `CT = (C_inv + dt*(1-theta)*G)^{-1}`.</span>
</span><span id="Material.compute_CT-277"><a href="#Material.compute_CT-277"><span class="linenos">277</span></a>
</span><span id="Material.compute_CT-278"><a href="#Material.compute_CT-278"><span class="linenos">278</span></a><span class="sd">        Parameters</span>
</span><span id="Material.compute_CT-279"><a href="#Material.compute_CT-279"><span class="linenos">279</span></a><span class="sd">        ----------</span>
</span><span id="Material.compute_CT-280"><a href="#Material.compute_CT-280"><span class="linenos">280</span></a><span class="sd">        dt : float</span>
</span><span id="Material.compute_CT-281"><a href="#Material.compute_CT-281"><span class="linenos">281</span></a><span class="sd">            Time step size.</span>
</span><span id="Material.compute_CT-282"><a href="#Material.compute_CT-282"><span class="linenos">282</span></a><span class="sd">        theta : float</span>
</span><span id="Material.compute_CT-283"><a href="#Material.compute_CT-283"><span class="linenos">283</span></a><span class="sd">            Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</span>
</span><span id="Material.compute_CT-284"><a href="#Material.compute_CT-284"><span class="linenos">284</span></a>
</span><span id="Material.compute_CT-285"><a href="#Material.compute_CT-285"><span class="linenos">285</span></a><span class="sd">        Returns</span>
</span><span id="Material.compute_CT-286"><a href="#Material.compute_CT-286"><span class="linenos">286</span></a><span class="sd">        -------</span>
</span><span id="Material.compute_CT-287"><a href="#Material.compute_CT-287"><span class="linenos">287</span></a><span class="sd">        None</span>
</span><span id="Material.compute_CT-288"><a href="#Material.compute_CT-288"><span class="linenos">288</span></a>
</span><span id="Material.compute_CT-289"><a href="#Material.compute_CT-289"><span class="linenos">289</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.compute_CT-290"><a href="#Material.compute_CT-290"><span class="linenos">290</span></a><span class="sd">        ------------</span>
</span><span id="Material.compute_CT-291"><a href="#Material.compute_CT-291"><span class="linenos">291</span></a><span class="sd">        Sets `self.CT` (N, 6, 6).</span>
</span><span id="Material.compute_CT-292"><a href="#Material.compute_CT-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.compute_CT-293"><a href="#Material.compute_CT-293"><span class="linenos">293</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">CT</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute consistent tangent <code>CT = (C_inv + dt*(1-theta)*G)^{-1}</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time step size.</li>
<li><strong>theta</strong> (float):
Time integration parameter: 0 for fully implicit, 0.5 for Crank-Nicolson, 1 for explicit.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.CT</code> (N, 6, 6).</p>
</div>


                            </div>
                            <div id="Material.compute_CT_tilde" class="classattr">
                                        <input id="Material.compute_CT_tilde-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_CT_tilde</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">theta</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Material.compute_CT_tilde-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Material.compute_CT_tilde"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Material.compute_CT_tilde-295"><a href="#Material.compute_CT_tilde-295"><span class="linenos">295</span></a>	<span class="k">def</span> <span class="nf">compute_CT_tilde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Material.compute_CT_tilde-296"><a href="#Material.compute_CT_tilde-296"><span class="linenos">296</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Material.compute_CT_tilde-297"><a href="#Material.compute_CT_tilde-297"><span class="linenos">297</span></a><span class="sd">        Compute deviatoric consistent tangent `CT_tilde`.</span>
</span><span id="Material.compute_CT_tilde-298"><a href="#Material.compute_CT_tilde-298"><span class="linenos">298</span></a>
</span><span id="Material.compute_CT_tilde-299"><a href="#Material.compute_CT_tilde-299"><span class="linenos">299</span></a><span class="sd">        Parameters</span>
</span><span id="Material.compute_CT_tilde-300"><a href="#Material.compute_CT_tilde-300"><span class="linenos">300</span></a><span class="sd">        ----------</span>
</span><span id="Material.compute_CT_tilde-301"><a href="#Material.compute_CT_tilde-301"><span class="linenos">301</span></a><span class="sd">        dt : float</span>
</span><span id="Material.compute_CT_tilde-302"><a href="#Material.compute_CT_tilde-302"><span class="linenos">302</span></a><span class="sd">            Time step size.</span>
</span><span id="Material.compute_CT_tilde-303"><a href="#Material.compute_CT_tilde-303"><span class="linenos">303</span></a><span class="sd">        theta : float</span>
</span><span id="Material.compute_CT_tilde-304"><a href="#Material.compute_CT_tilde-304"><span class="linenos">304</span></a><span class="sd">            Time integration parameter in [0, 1].</span>
</span><span id="Material.compute_CT_tilde-305"><a href="#Material.compute_CT_tilde-305"><span class="linenos">305</span></a>
</span><span id="Material.compute_CT_tilde-306"><a href="#Material.compute_CT_tilde-306"><span class="linenos">306</span></a><span class="sd">        Returns</span>
</span><span id="Material.compute_CT_tilde-307"><a href="#Material.compute_CT_tilde-307"><span class="linenos">307</span></a><span class="sd">        -------</span>
</span><span id="Material.compute_CT_tilde-308"><a href="#Material.compute_CT_tilde-308"><span class="linenos">308</span></a><span class="sd">        None</span>
</span><span id="Material.compute_CT_tilde-309"><a href="#Material.compute_CT_tilde-309"><span class="linenos">309</span></a>
</span><span id="Material.compute_CT_tilde-310"><a href="#Material.compute_CT_tilde-310"><span class="linenos">310</span></a><span class="sd">        Side Effects</span>
</span><span id="Material.compute_CT_tilde-311"><a href="#Material.compute_CT_tilde-311"><span class="linenos">311</span></a><span class="sd">        ------------</span>
</span><span id="Material.compute_CT_tilde-312"><a href="#Material.compute_CT_tilde-312"><span class="linenos">312</span></a><span class="sd">        Sets `self.CT_tilde` (N, 6, 6).</span>
</span><span id="Material.compute_CT_tilde-313"><a href="#Material.compute_CT_tilde-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Material.compute_CT_tilde-314"><a href="#Material.compute_CT_tilde-314"><span class="linenos">314</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">CT_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute deviatoric consistent tangent <code>CT_tilde</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time step size.</li>
<li><strong>theta</strong> (float):
Time integration parameter in [0, 1].</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.CT_tilde</code> (N, 6, 6).</p>
</div>


                            </div>
                </section>
                <section id="NonElasticElement">
                            <input id="NonElasticElement-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NonElasticElement</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="NonElasticElement-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement-527"><a href="#NonElasticElement-527"><span class="linenos">527</span></a><span class="k">class</span> <span class="nc">NonElasticElement</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="NonElasticElement-528"><a href="#NonElasticElement-528"><span class="linenos">528</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-529"><a href="#NonElasticElement-529"><span class="linenos">529</span></a><span class="sd">    Abstract base for inelastic mechanisms (e.g., viscoelasticity,</span>
</span><span id="NonElasticElement-530"><a href="#NonElasticElement-530"><span class="linenos">530</span></a><span class="sd">    dislocation creep, viscoplasticity). Provides common storage</span>
</span><span id="NonElasticElement-531"><a href="#NonElasticElement-531"><span class="linenos">531</span></a><span class="sd">    and utility updates for internal variables.</span>
</span><span id="NonElasticElement-532"><a href="#NonElasticElement-532"><span class="linenos">532</span></a>
</span><span id="NonElasticElement-533"><a href="#NonElasticElement-533"><span class="linenos">533</span></a><span class="sd">    Parameters</span>
</span><span id="NonElasticElement-534"><a href="#NonElasticElement-534"><span class="linenos">534</span></a><span class="sd">    ----------</span>
</span><span id="NonElasticElement-535"><a href="#NonElasticElement-535"><span class="linenos">535</span></a><span class="sd">    n_elems : int</span>
</span><span id="NonElasticElement-536"><a href="#NonElasticElement-536"><span class="linenos">536</span></a><span class="sd">        Number of elements.</span>
</span><span id="NonElasticElement-537"><a href="#NonElasticElement-537"><span class="linenos">537</span></a>
</span><span id="NonElasticElement-538"><a href="#NonElasticElement-538"><span class="linenos">538</span></a><span class="sd">    Attributes</span>
</span><span id="NonElasticElement-539"><a href="#NonElasticElement-539"><span class="linenos">539</span></a><span class="sd">    ----------</span>
</span><span id="NonElasticElement-540"><a href="#NonElasticElement-540"><span class="linenos">540</span></a><span class="sd">    n_elems : int</span>
</span><span id="NonElasticElement-541"><a href="#NonElasticElement-541"><span class="linenos">541</span></a><span class="sd">        Number of elements.</span>
</span><span id="NonElasticElement-542"><a href="#NonElasticElement-542"><span class="linenos">542</span></a><span class="sd">    eps_ne_rate, eps_ne_rate_old : torch.Tensor</span>
</span><span id="NonElasticElement-543"><a href="#NonElasticElement-543"><span class="linenos">543</span></a><span class="sd">        Current and previous non-elastic strain rate, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-544"><a href="#NonElasticElement-544"><span class="linenos">544</span></a><span class="sd">    eps_ne_old, eps_ne_k : torch.Tensor</span>
</span><span id="NonElasticElement-545"><a href="#NonElasticElement-545"><span class="linenos">545</span></a><span class="sd">        Non-elastic strain at old and current time, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-546"><a href="#NonElasticElement-546"><span class="linenos">546</span></a><span class="sd">    B : torch.Tensor</span>
</span><span id="NonElasticElement-547"><a href="#NonElasticElement-547"><span class="linenos">547</span></a><span class="sd">        State variable term (N, 3, 3) assembled in `compute_G_B`.</span>
</span><span id="NonElasticElement-548"><a href="#NonElasticElement-548"><span class="linenos">548</span></a><span class="sd">    G : torch.Tensor</span>
</span><span id="NonElasticElement-549"><a href="#NonElasticElement-549"><span class="linenos">549</span></a><span class="sd">        Tangent-like operator (N, 6, 6) assembled in `compute_G_B`.</span>
</span><span id="NonElasticElement-550"><a href="#NonElasticElement-550"><span class="linenos">550</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-551"><a href="#NonElasticElement-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_elems</span><span class="p">):</span>
</span><span id="NonElasticElement-552"><a href="#NonElasticElement-552"><span class="linenos">552</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="n">n_elems</span>
</span><span id="NonElasticElement-553"><a href="#NonElasticElement-553"><span class="linenos">553</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-554"><a href="#NonElasticElement-554"><span class="linenos">554</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-555"><a href="#NonElasticElement-555"><span class="linenos">555</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-556"><a href="#NonElasticElement-556"><span class="linenos">556</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_k</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-557"><a href="#NonElasticElement-557"><span class="linenos">557</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-558"><a href="#NonElasticElement-558"><span class="linenos">558</span></a>    	<span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-559"><a href="#NonElasticElement-559"><span class="linenos">559</span></a>
</span><span id="NonElasticElement-560"><a href="#NonElasticElement-560"><span class="linenos">560</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="NonElasticElement-561"><a href="#NonElasticElement-561"><span class="linenos">561</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_vec</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-562"><a href="#NonElasticElement-562"><span class="linenos">562</span></a>    	<span class="k">pass</span>
</span><span id="NonElasticElement-563"><a href="#NonElasticElement-563"><span class="linenos">563</span></a>
</span><span id="NonElasticElement-564"><a href="#NonElasticElement-564"><span class="linenos">564</span></a>    <span class="k">def</span> <span class="nf">increment_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-565"><a href="#NonElasticElement-565"><span class="linenos">565</span></a>    	<span class="k">pass</span>
</span><span id="NonElasticElement-566"><a href="#NonElasticElement-566"><span class="linenos">566</span></a>
</span><span id="NonElasticElement-567"><a href="#NonElasticElement-567"><span class="linenos">567</span></a>    <span class="k">def</span> <span class="nf">update_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-568"><a href="#NonElasticElement-568"><span class="linenos">568</span></a>    	<span class="k">pass</span>
</span><span id="NonElasticElement-569"><a href="#NonElasticElement-569"><span class="linenos">569</span></a>
</span><span id="NonElasticElement-570"><a href="#NonElasticElement-570"><span class="linenos">570</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">phi2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-571"><a href="#NonElasticElement-571"><span class="linenos">571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-572"><a href="#NonElasticElement-572"><span class="linenos">572</span></a><span class="sd">        Predictor for non-elastic strain at the previous iteration k.</span>
</span><span id="NonElasticElement-573"><a href="#NonElasticElement-573"><span class="linenos">573</span></a>
</span><span id="NonElasticElement-574"><a href="#NonElasticElement-574"><span class="linenos">574</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement-575"><a href="#NonElasticElement-575"><span class="linenos">575</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement-576"><a href="#NonElasticElement-576"><span class="linenos">576</span></a><span class="sd">        phi1 : float</span>
</span><span id="NonElasticElement-577"><a href="#NonElasticElement-577"><span class="linenos">577</span></a><span class="sd">            Typically `phi1=dt*theta`.</span>
</span><span id="NonElasticElement-578"><a href="#NonElasticElement-578"><span class="linenos">578</span></a><span class="sd">        phi2 : float</span>
</span><span id="NonElasticElement-579"><a href="#NonElasticElement-579"><span class="linenos">579</span></a><span class="sd">            Typically `phi2=dt*(1-theta)`.</span>
</span><span id="NonElasticElement-580"><a href="#NonElasticElement-580"><span class="linenos">580</span></a>
</span><span id="NonElasticElement-581"><a href="#NonElasticElement-581"><span class="linenos">581</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-582"><a href="#NonElasticElement-582"><span class="linenos">582</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-583"><a href="#NonElasticElement-583"><span class="linenos">583</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-584"><a href="#NonElasticElement-584"><span class="linenos">584</span></a>
</span><span id="NonElasticElement-585"><a href="#NonElasticElement-585"><span class="linenos">585</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement-586"><a href="#NonElasticElement-586"><span class="linenos">586</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement-587"><a href="#NonElasticElement-587"><span class="linenos">587</span></a><span class="sd">        Sets `self.eps_ne_k`.</span>
</span><span id="NonElasticElement-588"><a href="#NonElasticElement-588"><span class="linenos">588</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-589"><a href="#NonElasticElement-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">+</span> <span class="n">phi1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span> <span class="o">+</span> <span class="n">phi2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span>
</span><span id="NonElasticElement-590"><a href="#NonElasticElement-590"><span class="linenos">590</span></a>
</span><span id="NonElasticElement-591"><a href="#NonElasticElement-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-592"><a href="#NonElasticElement-592"><span class="linenos">592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-593"><a href="#NonElasticElement-593"><span class="linenos">593</span></a><span class="sd">        Update non-elastic strain from previous time step.</span>
</span><span id="NonElasticElement-594"><a href="#NonElasticElement-594"><span class="linenos">594</span></a>
</span><span id="NonElasticElement-595"><a href="#NonElasticElement-595"><span class="linenos">595</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement-596"><a href="#NonElasticElement-596"><span class="linenos">596</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement-597"><a href="#NonElasticElement-597"><span class="linenos">597</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement-598"><a href="#NonElasticElement-598"><span class="linenos">598</span></a><span class="sd">            Stress at current iteration k+1, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-599"><a href="#NonElasticElement-599"><span class="linenos">599</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="NonElasticElement-600"><a href="#NonElasticElement-600"><span class="linenos">600</span></a><span class="sd">            Stress at previous iteration k, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-601"><a href="#NonElasticElement-601"><span class="linenos">601</span></a><span class="sd">        phi2 : float</span>
</span><span id="NonElasticElement-602"><a href="#NonElasticElement-602"><span class="linenos">602</span></a><span class="sd">            Typically `phi2=dt*(1-theta)`.</span>
</span><span id="NonElasticElement-603"><a href="#NonElasticElement-603"><span class="linenos">603</span></a>
</span><span id="NonElasticElement-604"><a href="#NonElasticElement-604"><span class="linenos">604</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-605"><a href="#NonElasticElement-605"><span class="linenos">605</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-606"><a href="#NonElasticElement-606"><span class="linenos">606</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-607"><a href="#NonElasticElement-607"><span class="linenos">607</span></a>
</span><span id="NonElasticElement-608"><a href="#NonElasticElement-608"><span class="linenos">608</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement-609"><a href="#NonElasticElement-609"><span class="linenos">609</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement-610"><a href="#NonElasticElement-610"><span class="linenos">610</span></a><span class="sd">        Updates `self.eps_ne_old`.</span>
</span><span id="NonElasticElement-611"><a href="#NonElasticElement-611"><span class="linenos">611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-612"><a href="#NonElasticElement-612"><span class="linenos">612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_k</span> <span class="o">+</span> <span class="n">phi2</span><span class="o">*</span><span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">stress</span> <span class="o">-</span> <span class="n">stress_k</span><span class="p">)</span> <span class="o">-</span> <span class="n">phi2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span>
</span><span id="NonElasticElement-613"><a href="#NonElasticElement-613"><span class="linenos">613</span></a>
</span><span id="NonElasticElement-614"><a href="#NonElasticElement-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_rate_old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-615"><a href="#NonElasticElement-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-616"><a href="#NonElasticElement-616"><span class="linenos">616</span></a><span class="sd">        Update the current non-nelastic strain rate to the previous time step.</span>
</span><span id="NonElasticElement-617"><a href="#NonElasticElement-617"><span class="linenos">617</span></a>
</span><span id="NonElasticElement-618"><a href="#NonElasticElement-618"><span class="linenos">618</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-619"><a href="#NonElasticElement-619"><span class="linenos">619</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-620"><a href="#NonElasticElement-620"><span class="linenos">620</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-621"><a href="#NonElasticElement-621"><span class="linenos">621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-622"><a href="#NonElasticElement-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="NonElasticElement-623"><a href="#NonElasticElement-623"><span class="linenos">623</span></a>
</span><span id="NonElasticElement-624"><a href="#NonElasticElement-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">compute_E</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-625"><a href="#NonElasticElement-625"><span class="linenos">625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-626"><a href="#NonElasticElement-626"><span class="linenos">626</span></a><span class="sd">        Finite-difference approximation of the 66 operator E = d(eps_ne)/d(stress).</span>
</span><span id="NonElasticElement-627"><a href="#NonElasticElement-627"><span class="linenos">627</span></a>
</span><span id="NonElasticElement-628"><a href="#NonElasticElement-628"><span class="linenos">628</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement-629"><a href="#NonElasticElement-629"><span class="linenos">629</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement-630"><a href="#NonElasticElement-630"><span class="linenos">630</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement-631"><a href="#NonElasticElement-631"><span class="linenos">631</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-632"><a href="#NonElasticElement-632"><span class="linenos">632</span></a><span class="sd">        dt : float</span>
</span><span id="NonElasticElement-633"><a href="#NonElasticElement-633"><span class="linenos">633</span></a><span class="sd">            Time step.</span>
</span><span id="NonElasticElement-634"><a href="#NonElasticElement-634"><span class="linenos">634</span></a><span class="sd">        theta : float</span>
</span><span id="NonElasticElement-635"><a href="#NonElasticElement-635"><span class="linenos">635</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="NonElasticElement-636"><a href="#NonElasticElement-636"><span class="linenos">636</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="NonElasticElement-637"><a href="#NonElasticElement-637"><span class="linenos">637</span></a><span class="sd">            Temperature per element.</span>
</span><span id="NonElasticElement-638"><a href="#NonElasticElement-638"><span class="linenos">638</span></a>
</span><span id="NonElasticElement-639"><a href="#NonElasticElement-639"><span class="linenos">639</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-640"><a href="#NonElasticElement-640"><span class="linenos">640</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-641"><a href="#NonElasticElement-641"><span class="linenos">641</span></a><span class="sd">        torch.Tensor</span>
</span><span id="NonElasticElement-642"><a href="#NonElasticElement-642"><span class="linenos">642</span></a><span class="sd">            Operator `E` with shape (N, 6, 6).</span>
</span><span id="NonElasticElement-643"><a href="#NonElasticElement-643"><span class="linenos">643</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-644"><a href="#NonElasticElement-644"><span class="linenos">644</span></a>        <span class="n">phi1</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">theta</span>
</span><span id="NonElasticElement-645"><a href="#NonElasticElement-645"><span class="linenos">645</span></a>        <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-2</span>
</span><span id="NonElasticElement-646"><a href="#NonElasticElement-646"><span class="linenos">646</span></a>        <span class="n">E</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-647"><a href="#NonElasticElement-647"><span class="linenos">647</span></a>        <span class="n">stress_eps</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="NonElasticElement-648"><a href="#NonElasticElement-648"><span class="linenos">648</span></a>        <span class="n">c1</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="NonElasticElement-649"><a href="#NonElasticElement-649"><span class="linenos">649</span></a>        <span class="n">c2</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="NonElasticElement-650"><a href="#NonElasticElement-650"><span class="linenos">650</span></a>        <span class="n">magic_indexes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">c2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">c2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">c2</span><span class="p">)]</span>
</span><span id="NonElasticElement-651"><a href="#NonElasticElement-651"><span class="linenos">651</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">magic_indexes</span><span class="p">:</span>
</span><span id="NonElasticElement-652"><a href="#NonElasticElement-652"><span class="linenos">652</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement-653"><a href="#NonElasticElement-653"><span class="linenos">653</span></a>        	<span class="n">eps_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_eps</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="NonElasticElement-654"><a href="#NonElasticElement-654"><span class="linenos">654</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement-655"><a href="#NonElasticElement-655"><span class="linenos">655</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement-656"><a href="#NonElasticElement-656"><span class="linenos">656</span></a>        	<span class="n">eps_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_eps</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="NonElasticElement-657"><a href="#NonElasticElement-657"><span class="linenos">657</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement-658"><a href="#NonElasticElement-658"><span class="linenos">658</span></a>        	<span class="n">E</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="o">*</span><span class="p">(</span><span class="n">eps_A</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">eps_B</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EPSILON</span><span class="p">)</span>
</span><span id="NonElasticElement-659"><a href="#NonElasticElement-659"><span class="linenos">659</span></a>        <span class="k">return</span> <span class="n">E</span>
</span><span id="NonElasticElement-660"><a href="#NonElasticElement-660"><span class="linenos">660</span></a>
</span><span id="NonElasticElement-661"><a href="#NonElasticElement-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="nf">compute_B_and_H_over_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-662"><a href="#NonElasticElement-662"><span class="linenos">662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-663"><a href="#NonElasticElement-663"><span class="linenos">663</span></a><span class="sd">        Compute state variable term `B` and linearization term `H/h`.</span>
</span><span id="NonElasticElement-664"><a href="#NonElasticElement-664"><span class="linenos">664</span></a>
</span><span id="NonElasticElement-665"><a href="#NonElasticElement-665"><span class="linenos">665</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement-666"><a href="#NonElasticElement-666"><span class="linenos">666</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement-667"><a href="#NonElasticElement-667"><span class="linenos">667</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement-668"><a href="#NonElasticElement-668"><span class="linenos">668</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-669"><a href="#NonElasticElement-669"><span class="linenos">669</span></a><span class="sd">        dt : float</span>
</span><span id="NonElasticElement-670"><a href="#NonElasticElement-670"><span class="linenos">670</span></a><span class="sd">            Time step.</span>
</span><span id="NonElasticElement-671"><a href="#NonElasticElement-671"><span class="linenos">671</span></a><span class="sd">        theta : float</span>
</span><span id="NonElasticElement-672"><a href="#NonElasticElement-672"><span class="linenos">672</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="NonElasticElement-673"><a href="#NonElasticElement-673"><span class="linenos">673</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="NonElasticElement-674"><a href="#NonElasticElement-674"><span class="linenos">674</span></a><span class="sd">            Temperature per element.</span>
</span><span id="NonElasticElement-675"><a href="#NonElasticElement-675"><span class="linenos">675</span></a>
</span><span id="NonElasticElement-676"><a href="#NonElasticElement-676"><span class="linenos">676</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-677"><a href="#NonElasticElement-677"><span class="linenos">677</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-678"><a href="#NonElasticElement-678"><span class="linenos">678</span></a><span class="sd">        B : torch.Tensor</span>
</span><span id="NonElasticElement-679"><a href="#NonElasticElement-679"><span class="linenos">679</span></a><span class="sd">            Driving term, shape (N, 3, 3).</span>
</span><span id="NonElasticElement-680"><a href="#NonElasticElement-680"><span class="linenos">680</span></a><span class="sd">        H_over_h : torch.Tensor</span>
</span><span id="NonElasticElement-681"><a href="#NonElasticElement-681"><span class="linenos">681</span></a><span class="sd">            Linearization ratio, shape (N, 6, 6).</span>
</span><span id="NonElasticElement-682"><a href="#NonElasticElement-682"><span class="linenos">682</span></a>
</span><span id="NonElasticElement-683"><a href="#NonElasticElement-683"><span class="linenos">683</span></a><span class="sd">        Notes</span>
</span><span id="NonElasticElement-684"><a href="#NonElasticElement-684"><span class="linenos">684</span></a><span class="sd">        -----</span>
</span><span id="NonElasticElement-685"><a href="#NonElasticElement-685"><span class="linenos">685</span></a><span class="sd">        Default implementation returns zeros; subclasses override.</span>
</span><span id="NonElasticElement-686"><a href="#NonElasticElement-686"><span class="linenos">686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-687"><a href="#NonElasticElement-687"><span class="linenos">687</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-688"><a href="#NonElasticElement-688"><span class="linenos">688</span></a>        <span class="n">H_over_h</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement-689"><a href="#NonElasticElement-689"><span class="linenos">689</span></a>        <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="n">H_over_h</span>
</span><span id="NonElasticElement-690"><a href="#NonElasticElement-690"><span class="linenos">690</span></a>
</span><span id="NonElasticElement-691"><a href="#NonElasticElement-691"><span class="linenos">691</span></a>    <span class="k">def</span> <span class="nf">compute_G_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-692"><a href="#NonElasticElement-692"><span class="linenos">692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-693"><a href="#NonElasticElement-693"><span class="linenos">693</span></a><span class="sd">        Assemble `G` and `B` for the element based on `E` and `H/h`.</span>
</span><span id="NonElasticElement-694"><a href="#NonElasticElement-694"><span class="linenos">694</span></a>
</span><span id="NonElasticElement-695"><a href="#NonElasticElement-695"><span class="linenos">695</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement-696"><a href="#NonElasticElement-696"><span class="linenos">696</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement-697"><a href="#NonElasticElement-697"><span class="linenos">697</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement-698"><a href="#NonElasticElement-698"><span class="linenos">698</span></a><span class="sd">        dt : float</span>
</span><span id="NonElasticElement-699"><a href="#NonElasticElement-699"><span class="linenos">699</span></a><span class="sd">        theta : float</span>
</span><span id="NonElasticElement-700"><a href="#NonElasticElement-700"><span class="linenos">700</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="NonElasticElement-701"><a href="#NonElasticElement-701"><span class="linenos">701</span></a>
</span><span id="NonElasticElement-702"><a href="#NonElasticElement-702"><span class="linenos">702</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-703"><a href="#NonElasticElement-703"><span class="linenos">703</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-704"><a href="#NonElasticElement-704"><span class="linenos">704</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-705"><a href="#NonElasticElement-705"><span class="linenos">705</span></a>
</span><span id="NonElasticElement-706"><a href="#NonElasticElement-706"><span class="linenos">706</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement-707"><a href="#NonElasticElement-707"><span class="linenos">707</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement-708"><a href="#NonElasticElement-708"><span class="linenos">708</span></a><span class="sd">        Sets `self.B` and `self.G`.</span>
</span><span id="NonElasticElement-709"><a href="#NonElasticElement-709"><span class="linenos">709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-710"><a href="#NonElasticElement-710"><span class="linenos">710</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">H_over_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_B_and_H_over_h</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">)</span>
</span><span id="NonElasticElement-711"><a href="#NonElasticElement-711"><span class="linenos">711</span></a>        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_E</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">)</span>
</span><span id="NonElasticElement-712"><a href="#NonElasticElement-712"><span class="linenos">712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="o">-</span> <span class="n">H_over_h</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="NonElasticElement-713"><a href="#NonElasticElement-713"><span class="linenos">713</span></a>
</span><span id="NonElasticElement-714"><a href="#NonElasticElement-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">compute_T_IT</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-715"><a href="#NonElasticElement-715"><span class="linenos">715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-716"><a href="#NonElasticElement-716"><span class="linenos">716</span></a><span class="sd">        Build volumetric coupling tensors `T` (33) and `IT` (66) from `G`.</span>
</span><span id="NonElasticElement-717"><a href="#NonElasticElement-717"><span class="linenos">717</span></a>
</span><span id="NonElasticElement-718"><a href="#NonElasticElement-718"><span class="linenos">718</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-719"><a href="#NonElasticElement-719"><span class="linenos">719</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-720"><a href="#NonElasticElement-720"><span class="linenos">720</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-721"><a href="#NonElasticElement-721"><span class="linenos">721</span></a>
</span><span id="NonElasticElement-722"><a href="#NonElasticElement-722"><span class="linenos">722</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement-723"><a href="#NonElasticElement-723"><span class="linenos">723</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement-724"><a href="#NonElasticElement-724"><span class="linenos">724</span></a><span class="sd">        Sets `self.T` and `self.IT`.</span>
</span><span id="NonElasticElement-725"><a href="#NonElasticElement-725"><span class="linenos">725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-726"><a href="#NonElasticElement-726"><span class="linenos">726</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="NonElasticElement-727"><a href="#NonElasticElement-727"><span class="linenos">727</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement-728"><a href="#NonElasticElement-728"><span class="linenos">728</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NonElasticElement-729"><a href="#NonElasticElement-729"><span class="linenos">729</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="NonElasticElement-730"><a href="#NonElasticElement-730"><span class="linenos">730</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</span><span id="NonElasticElement-731"><a href="#NonElasticElement-731"><span class="linenos">731</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</span><span id="NonElasticElement-732"><a href="#NonElasticElement-732"><span class="linenos">732</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</span><span id="NonElasticElement-733"><a href="#NonElasticElement-733"><span class="linenos">733</span></a>
</span><span id="NonElasticElement-734"><a href="#NonElasticElement-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="NonElasticElement-735"><a href="#NonElasticElement-735"><span class="linenos">735</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement-736"><a href="#NonElasticElement-736"><span class="linenos">736</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NonElasticElement-737"><a href="#NonElasticElement-737"><span class="linenos">737</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="NonElasticElement-738"><a href="#NonElasticElement-738"><span class="linenos">738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement-739"><a href="#NonElasticElement-739"><span class="linenos">739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement-740"><a href="#NonElasticElement-740"><span class="linenos">740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NonElasticElement-741"><a href="#NonElasticElement-741"><span class="linenos">741</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span>
</span><span id="NonElasticElement-742"><a href="#NonElasticElement-742"><span class="linenos">742</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span>
</span><span id="NonElasticElement-743"><a href="#NonElasticElement-743"><span class="linenos">743</span></a>
</span><span id="NonElasticElement-744"><a href="#NonElasticElement-744"><span class="linenos">744</span></a>    <span class="k">def</span> <span class="nf">compute_Bvol_Tvol</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-745"><a href="#NonElasticElement-745"><span class="linenos">745</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-746"><a href="#NonElasticElement-746"><span class="linenos">746</span></a><span class="sd">        Compute volumetric parts of `B` and `T`.</span>
</span><span id="NonElasticElement-747"><a href="#NonElasticElement-747"><span class="linenos">747</span></a>
</span><span id="NonElasticElement-748"><a href="#NonElasticElement-748"><span class="linenos">748</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-749"><a href="#NonElasticElement-749"><span class="linenos">749</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-750"><a href="#NonElasticElement-750"><span class="linenos">750</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-751"><a href="#NonElasticElement-751"><span class="linenos">751</span></a>
</span><span id="NonElasticElement-752"><a href="#NonElasticElement-752"><span class="linenos">752</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement-753"><a href="#NonElasticElement-753"><span class="linenos">753</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement-754"><a href="#NonElasticElement-754"><span class="linenos">754</span></a><span class="sd">        Sets `self.B_vol` and `self.T_vol` as traces of `B` and `T`.</span>
</span><span id="NonElasticElement-755"><a href="#NonElasticElement-755"><span class="linenos">755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-756"><a href="#NonElasticElement-756"><span class="linenos">756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bii-&gt;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="NonElasticElement-757"><a href="#NonElasticElement-757"><span class="linenos">757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bii-&gt;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
</span><span id="NonElasticElement-758"><a href="#NonElasticElement-758"><span class="linenos">758</span></a>
</span><span id="NonElasticElement-759"><a href="#NonElasticElement-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">compute_Gtilde_Btilde</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement-760"><a href="#NonElasticElement-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement-761"><a href="#NonElasticElement-761"><span class="linenos">761</span></a><span class="sd">        Compute deviatoric parts `G_tilde` and `B_tilde`.</span>
</span><span id="NonElasticElement-762"><a href="#NonElasticElement-762"><span class="linenos">762</span></a>
</span><span id="NonElasticElement-763"><a href="#NonElasticElement-763"><span class="linenos">763</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement-764"><a href="#NonElasticElement-764"><span class="linenos">764</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement-765"><a href="#NonElasticElement-765"><span class="linenos">765</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement-766"><a href="#NonElasticElement-766"><span class="linenos">766</span></a>
</span><span id="NonElasticElement-767"><a href="#NonElasticElement-767"><span class="linenos">767</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement-768"><a href="#NonElasticElement-768"><span class="linenos">768</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement-769"><a href="#NonElasticElement-769"><span class="linenos">769</span></a><span class="sd">        Sets `self.G_tilde` and `self.B_tilde`.</span>
</span><span id="NonElasticElement-770"><a href="#NonElasticElement-770"><span class="linenos">770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement-771"><a href="#NonElasticElement-771"><span class="linenos">771</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="NonElasticElement-772"><a href="#NonElasticElement-772"><span class="linenos">772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="o">/</span><span class="mi">3</span>
</span><span id="NonElasticElement-773"><a href="#NonElasticElement-773"><span class="linenos">773</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">B_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="mi">3</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base for inelastic mechanisms (e.g., viscoelasticity,
dislocation creep, viscoplasticity). Provides common storage
and utility updates for internal variables.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_elems</strong> (int):
Number of elements.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>n_elems</strong> (int):
Number of elements.</li>
<li><strong>eps_ne_rate, eps_ne_rate_old</strong> (torch.Tensor):
Current and previous non-elastic strain rate, shape (N, 3, 3).</li>
<li><strong>eps_ne_old, eps_ne_k</strong> (torch.Tensor):
Non-elastic strain at old and current time, shape (N, 3, 3).</li>
<li><strong>B</strong> (torch.Tensor):
State variable term (N, 3, 3) assembled in <code><a href="#NonElasticElement.compute_G_B">compute_G_B</a></code>.</li>
<li><strong>G</strong> (torch.Tensor):
Tangent-like operator (N, 6, 6) assembled in <code><a href="#NonElasticElement.compute_G_B">compute_G_B</a></code>.</li>
</ul>
</div>


                            <div id="NonElasticElement.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.n_elems"></a>
    
    

                            </div>
                            <div id="NonElasticElement.eps_ne_rate" class="classattr">
                                <div class="attr variable">
            <span class="name">eps_ne_rate</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.eps_ne_rate"></a>
    
    

                            </div>
                            <div id="NonElasticElement.eps_ne_rate_old" class="classattr">
                                <div class="attr variable">
            <span class="name">eps_ne_rate_old</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.eps_ne_rate_old"></a>
    
    

                            </div>
                            <div id="NonElasticElement.eps_ne_old" class="classattr">
                                <div class="attr variable">
            <span class="name">eps_ne_old</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.eps_ne_old"></a>
    
    

                            </div>
                            <div id="NonElasticElement.eps_ne_k" class="classattr">
                                <div class="attr variable">
            <span class="name">eps_ne_k</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.eps_ne_k"></a>
    
    

                            </div>
                            <div id="NonElasticElement.B" class="classattr">
                                <div class="attr variable">
            <span class="name">B</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.B"></a>
    
    

                            </div>
                            <div id="NonElasticElement.G" class="classattr">
                                <div class="attr variable">
            <span class="name">G</span>

        
    </div>
    <a class="headerlink" href="#NonElasticElement.G"></a>
    
    

                            </div>
                            <div id="NonElasticElement.compute_eps_ne_rate" class="classattr">
                                        <input id="NonElasticElement.compute_eps_ne_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute_eps_ne_rate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress_vec</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_eps_ne_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_eps_ne_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_eps_ne_rate-560"><a href="#NonElasticElement.compute_eps_ne_rate-560"><span class="linenos">560</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="NonElasticElement.compute_eps_ne_rate-561"><a href="#NonElasticElement.compute_eps_ne_rate-561"><span class="linenos">561</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_vec</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_eps_ne_rate-562"><a href="#NonElasticElement.compute_eps_ne_rate-562"><span class="linenos">562</span></a>    	<span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="NonElasticElement.increment_internal_variables" class="classattr">
                                        <input id="NonElasticElement.increment_internal_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">increment_internal_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.increment_internal_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.increment_internal_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.increment_internal_variables-564"><a href="#NonElasticElement.increment_internal_variables-564"><span class="linenos">564</span></a>    <span class="k">def</span> <span class="nf">increment_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.increment_internal_variables-565"><a href="#NonElasticElement.increment_internal_variables-565"><span class="linenos">565</span></a>    	<span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="NonElasticElement.update_internal_variables" class="classattr">
                                        <input id="NonElasticElement.update_internal_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_internal_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.update_internal_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.update_internal_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.update_internal_variables-567"><a href="#NonElasticElement.update_internal_variables-567"><span class="linenos">567</span></a>    <span class="k">def</span> <span class="nf">update_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.update_internal_variables-568"><a href="#NonElasticElement.update_internal_variables-568"><span class="linenos">568</span></a>    	<span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="NonElasticElement.compute_eps_ne_k" class="classattr">
                                        <input id="NonElasticElement.compute_eps_ne_k-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_ne_k</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">phi2</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_eps_ne_k-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_eps_ne_k"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_eps_ne_k-570"><a href="#NonElasticElement.compute_eps_ne_k-570"><span class="linenos">570</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">phi2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_eps_ne_k-571"><a href="#NonElasticElement.compute_eps_ne_k-571"><span class="linenos">571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_eps_ne_k-572"><a href="#NonElasticElement.compute_eps_ne_k-572"><span class="linenos">572</span></a><span class="sd">        Predictor for non-elastic strain at the previous iteration k.</span>
</span><span id="NonElasticElement.compute_eps_ne_k-573"><a href="#NonElasticElement.compute_eps_ne_k-573"><span class="linenos">573</span></a>
</span><span id="NonElasticElement.compute_eps_ne_k-574"><a href="#NonElasticElement.compute_eps_ne_k-574"><span class="linenos">574</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement.compute_eps_ne_k-575"><a href="#NonElasticElement.compute_eps_ne_k-575"><span class="linenos">575</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement.compute_eps_ne_k-576"><a href="#NonElasticElement.compute_eps_ne_k-576"><span class="linenos">576</span></a><span class="sd">        phi1 : float</span>
</span><span id="NonElasticElement.compute_eps_ne_k-577"><a href="#NonElasticElement.compute_eps_ne_k-577"><span class="linenos">577</span></a><span class="sd">            Typically `phi1=dt*theta`.</span>
</span><span id="NonElasticElement.compute_eps_ne_k-578"><a href="#NonElasticElement.compute_eps_ne_k-578"><span class="linenos">578</span></a><span class="sd">        phi2 : float</span>
</span><span id="NonElasticElement.compute_eps_ne_k-579"><a href="#NonElasticElement.compute_eps_ne_k-579"><span class="linenos">579</span></a><span class="sd">            Typically `phi2=dt*(1-theta)`.</span>
</span><span id="NonElasticElement.compute_eps_ne_k-580"><a href="#NonElasticElement.compute_eps_ne_k-580"><span class="linenos">580</span></a>
</span><span id="NonElasticElement.compute_eps_ne_k-581"><a href="#NonElasticElement.compute_eps_ne_k-581"><span class="linenos">581</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_eps_ne_k-582"><a href="#NonElasticElement.compute_eps_ne_k-582"><span class="linenos">582</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_eps_ne_k-583"><a href="#NonElasticElement.compute_eps_ne_k-583"><span class="linenos">583</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.compute_eps_ne_k-584"><a href="#NonElasticElement.compute_eps_ne_k-584"><span class="linenos">584</span></a>
</span><span id="NonElasticElement.compute_eps_ne_k-585"><a href="#NonElasticElement.compute_eps_ne_k-585"><span class="linenos">585</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement.compute_eps_ne_k-586"><a href="#NonElasticElement.compute_eps_ne_k-586"><span class="linenos">586</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement.compute_eps_ne_k-587"><a href="#NonElasticElement.compute_eps_ne_k-587"><span class="linenos">587</span></a><span class="sd">        Sets `self.eps_ne_k`.</span>
</span><span id="NonElasticElement.compute_eps_ne_k-588"><a href="#NonElasticElement.compute_eps_ne_k-588"><span class="linenos">588</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_eps_ne_k-589"><a href="#NonElasticElement.compute_eps_ne_k-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">+</span> <span class="n">phi1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span> <span class="o">+</span> <span class="n">phi2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span>
</span></pre></div>


            <div class="docstring"><p>Predictor for non-elastic strain at the previous iteration k.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>phi1</strong> (float):
Typically <code>phi1=dt*theta</code>.</li>
<li><strong>phi2</strong> (float):
Typically <code>phi2=dt*(1-theta)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.eps_ne_k</code>.</p>
</div>


                            </div>
                            <div id="NonElasticElement.update_eps_ne_old" class="classattr">
                                        <input id="NonElasticElement.update_eps_ne_old-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_eps_ne_old</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">phi2</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.update_eps_ne_old-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.update_eps_ne_old"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.update_eps_ne_old-591"><a href="#NonElasticElement.update_eps_ne_old-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.update_eps_ne_old-592"><a href="#NonElasticElement.update_eps_ne_old-592"><span class="linenos">592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.update_eps_ne_old-593"><a href="#NonElasticElement.update_eps_ne_old-593"><span class="linenos">593</span></a><span class="sd">        Update non-elastic strain from previous time step.</span>
</span><span id="NonElasticElement.update_eps_ne_old-594"><a href="#NonElasticElement.update_eps_ne_old-594"><span class="linenos">594</span></a>
</span><span id="NonElasticElement.update_eps_ne_old-595"><a href="#NonElasticElement.update_eps_ne_old-595"><span class="linenos">595</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement.update_eps_ne_old-596"><a href="#NonElasticElement.update_eps_ne_old-596"><span class="linenos">596</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement.update_eps_ne_old-597"><a href="#NonElasticElement.update_eps_ne_old-597"><span class="linenos">597</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement.update_eps_ne_old-598"><a href="#NonElasticElement.update_eps_ne_old-598"><span class="linenos">598</span></a><span class="sd">            Stress at current iteration k+1, shape (N, 3, 3).</span>
</span><span id="NonElasticElement.update_eps_ne_old-599"><a href="#NonElasticElement.update_eps_ne_old-599"><span class="linenos">599</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="NonElasticElement.update_eps_ne_old-600"><a href="#NonElasticElement.update_eps_ne_old-600"><span class="linenos">600</span></a><span class="sd">            Stress at previous iteration k, shape (N, 3, 3).</span>
</span><span id="NonElasticElement.update_eps_ne_old-601"><a href="#NonElasticElement.update_eps_ne_old-601"><span class="linenos">601</span></a><span class="sd">        phi2 : float</span>
</span><span id="NonElasticElement.update_eps_ne_old-602"><a href="#NonElasticElement.update_eps_ne_old-602"><span class="linenos">602</span></a><span class="sd">            Typically `phi2=dt*(1-theta)`.</span>
</span><span id="NonElasticElement.update_eps_ne_old-603"><a href="#NonElasticElement.update_eps_ne_old-603"><span class="linenos">603</span></a>
</span><span id="NonElasticElement.update_eps_ne_old-604"><a href="#NonElasticElement.update_eps_ne_old-604"><span class="linenos">604</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.update_eps_ne_old-605"><a href="#NonElasticElement.update_eps_ne_old-605"><span class="linenos">605</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.update_eps_ne_old-606"><a href="#NonElasticElement.update_eps_ne_old-606"><span class="linenos">606</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.update_eps_ne_old-607"><a href="#NonElasticElement.update_eps_ne_old-607"><span class="linenos">607</span></a>
</span><span id="NonElasticElement.update_eps_ne_old-608"><a href="#NonElasticElement.update_eps_ne_old-608"><span class="linenos">608</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement.update_eps_ne_old-609"><a href="#NonElasticElement.update_eps_ne_old-609"><span class="linenos">609</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement.update_eps_ne_old-610"><a href="#NonElasticElement.update_eps_ne_old-610"><span class="linenos">610</span></a><span class="sd">        Updates `self.eps_ne_old`.</span>
</span><span id="NonElasticElement.update_eps_ne_old-611"><a href="#NonElasticElement.update_eps_ne_old-611"><span class="linenos">611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.update_eps_ne_old-612"><a href="#NonElasticElement.update_eps_ne_old-612"><span class="linenos">612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_k</span> <span class="o">+</span> <span class="n">phi2</span><span class="o">*</span><span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">stress</span> <span class="o">-</span> <span class="n">stress_k</span><span class="p">)</span> <span class="o">-</span> <span class="n">phi2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span>
</span></pre></div>


            <div class="docstring"><p>Update non-elastic strain from previous time step.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress at current iteration k+1, shape (N, 3, 3).</li>
<li><strong>stress_k</strong> (torch.Tensor):
Stress at previous iteration k, shape (N, 3, 3).</li>
<li><strong>phi2</strong> (float):
Typically <code>phi2=dt*(1-theta)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Updates <code>self.eps_ne_old</code>.</p>
</div>


                            </div>
                            <div id="NonElasticElement.update_eps_ne_rate_old" class="classattr">
                                        <input id="NonElasticElement.update_eps_ne_rate_old-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_eps_ne_rate_old</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.update_eps_ne_rate_old-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.update_eps_ne_rate_old"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.update_eps_ne_rate_old-614"><a href="#NonElasticElement.update_eps_ne_rate_old-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">update_eps_ne_rate_old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-615"><a href="#NonElasticElement.update_eps_ne_rate_old-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-616"><a href="#NonElasticElement.update_eps_ne_rate_old-616"><span class="linenos">616</span></a><span class="sd">        Update the current non-nelastic strain rate to the previous time step.</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-617"><a href="#NonElasticElement.update_eps_ne_rate_old-617"><span class="linenos">617</span></a>
</span><span id="NonElasticElement.update_eps_ne_rate_old-618"><a href="#NonElasticElement.update_eps_ne_rate_old-618"><span class="linenos">618</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-619"><a href="#NonElasticElement.update_eps_ne_rate_old-619"><span class="linenos">619</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-620"><a href="#NonElasticElement.update_eps_ne_rate_old-620"><span class="linenos">620</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-621"><a href="#NonElasticElement.update_eps_ne_rate_old-621"><span class="linenos">621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.update_eps_ne_rate_old-622"><a href="#NonElasticElement.update_eps_ne_rate_old-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Update the current non-nelastic strain rate to the previous time step.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="NonElasticElement.compute_E" class="classattr">
                                        <input id="NonElasticElement.compute_E-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_E</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_E-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_E"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_E-624"><a href="#NonElasticElement.compute_E-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">compute_E</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_E-625"><a href="#NonElasticElement.compute_E-625"><span class="linenos">625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_E-626"><a href="#NonElasticElement.compute_E-626"><span class="linenos">626</span></a><span class="sd">        Finite-difference approximation of the 66 operator E = d(eps_ne)/d(stress).</span>
</span><span id="NonElasticElement.compute_E-627"><a href="#NonElasticElement.compute_E-627"><span class="linenos">627</span></a>
</span><span id="NonElasticElement.compute_E-628"><a href="#NonElasticElement.compute_E-628"><span class="linenos">628</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement.compute_E-629"><a href="#NonElasticElement.compute_E-629"><span class="linenos">629</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement.compute_E-630"><a href="#NonElasticElement.compute_E-630"><span class="linenos">630</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement.compute_E-631"><a href="#NonElasticElement.compute_E-631"><span class="linenos">631</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="NonElasticElement.compute_E-632"><a href="#NonElasticElement.compute_E-632"><span class="linenos">632</span></a><span class="sd">        dt : float</span>
</span><span id="NonElasticElement.compute_E-633"><a href="#NonElasticElement.compute_E-633"><span class="linenos">633</span></a><span class="sd">            Time step.</span>
</span><span id="NonElasticElement.compute_E-634"><a href="#NonElasticElement.compute_E-634"><span class="linenos">634</span></a><span class="sd">        theta : float</span>
</span><span id="NonElasticElement.compute_E-635"><a href="#NonElasticElement.compute_E-635"><span class="linenos">635</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="NonElasticElement.compute_E-636"><a href="#NonElasticElement.compute_E-636"><span class="linenos">636</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="NonElasticElement.compute_E-637"><a href="#NonElasticElement.compute_E-637"><span class="linenos">637</span></a><span class="sd">            Temperature per element.</span>
</span><span id="NonElasticElement.compute_E-638"><a href="#NonElasticElement.compute_E-638"><span class="linenos">638</span></a>
</span><span id="NonElasticElement.compute_E-639"><a href="#NonElasticElement.compute_E-639"><span class="linenos">639</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_E-640"><a href="#NonElasticElement.compute_E-640"><span class="linenos">640</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_E-641"><a href="#NonElasticElement.compute_E-641"><span class="linenos">641</span></a><span class="sd">        torch.Tensor</span>
</span><span id="NonElasticElement.compute_E-642"><a href="#NonElasticElement.compute_E-642"><span class="linenos">642</span></a><span class="sd">            Operator `E` with shape (N, 6, 6).</span>
</span><span id="NonElasticElement.compute_E-643"><a href="#NonElasticElement.compute_E-643"><span class="linenos">643</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_E-644"><a href="#NonElasticElement.compute_E-644"><span class="linenos">644</span></a>        <span class="n">phi1</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">theta</span>
</span><span id="NonElasticElement.compute_E-645"><a href="#NonElasticElement.compute_E-645"><span class="linenos">645</span></a>        <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-2</span>
</span><span id="NonElasticElement.compute_E-646"><a href="#NonElasticElement.compute_E-646"><span class="linenos">646</span></a>        <span class="n">E</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_E-647"><a href="#NonElasticElement.compute_E-647"><span class="linenos">647</span></a>        <span class="n">stress_eps</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="NonElasticElement.compute_E-648"><a href="#NonElasticElement.compute_E-648"><span class="linenos">648</span></a>        <span class="n">c1</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="NonElasticElement.compute_E-649"><a href="#NonElasticElement.compute_E-649"><span class="linenos">649</span></a>        <span class="n">c2</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="NonElasticElement.compute_E-650"><a href="#NonElasticElement.compute_E-650"><span class="linenos">650</span></a>        <span class="n">magic_indexes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">c2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">c2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">c2</span><span class="p">)]</span>
</span><span id="NonElasticElement.compute_E-651"><a href="#NonElasticElement.compute_E-651"><span class="linenos">651</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">magic_indexes</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_E-652"><a href="#NonElasticElement.compute_E-652"><span class="linenos">652</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement.compute_E-653"><a href="#NonElasticElement.compute_E-653"><span class="linenos">653</span></a>        	<span class="n">eps_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_eps</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_E-654"><a href="#NonElasticElement.compute_E-654"><span class="linenos">654</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement.compute_E-655"><a href="#NonElasticElement.compute_E-655"><span class="linenos">655</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement.compute_E-656"><a href="#NonElasticElement.compute_E-656"><span class="linenos">656</span></a>        	<span class="n">eps_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_eps</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_E-657"><a href="#NonElasticElement.compute_E-657"><span class="linenos">657</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPSILON</span>
</span><span id="NonElasticElement.compute_E-658"><a href="#NonElasticElement.compute_E-658"><span class="linenos">658</span></a>        	<span class="n">E</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="o">*</span><span class="p">(</span><span class="n">eps_A</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">eps_B</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EPSILON</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_E-659"><a href="#NonElasticElement.compute_E-659"><span class="linenos">659</span></a>        <span class="k">return</span> <span class="n">E</span>
</span></pre></div>


            <div class="docstring"><p>Finite-difference approximation of the 66 operator E = d(eps_ne)/d(stress).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3).</li>
<li><strong>dt</strong> (float):
Time step.</li>
<li><strong>theta</strong> (float):
Time integration parameter.</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Operator <code>E</code> with shape (N, 6, 6).</li>
</ul>
</div>


                            </div>
                            <div id="NonElasticElement.compute_B_and_H_over_h" class="classattr">
                                        <input id="NonElasticElement.compute_B_and_H_over_h-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_B_and_H_over_h</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_B_and_H_over_h-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_B_and_H_over_h"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_B_and_H_over_h-661"><a href="#NonElasticElement.compute_B_and_H_over_h-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="nf">compute_B_and_H_over_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-662"><a href="#NonElasticElement.compute_B_and_H_over_h-662"><span class="linenos">662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-663"><a href="#NonElasticElement.compute_B_and_H_over_h-663"><span class="linenos">663</span></a><span class="sd">        Compute state variable term `B` and linearization term `H/h`.</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-664"><a href="#NonElasticElement.compute_B_and_H_over_h-664"><span class="linenos">664</span></a>
</span><span id="NonElasticElement.compute_B_and_H_over_h-665"><a href="#NonElasticElement.compute_B_and_H_over_h-665"><span class="linenos">665</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-666"><a href="#NonElasticElement.compute_B_and_H_over_h-666"><span class="linenos">666</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-667"><a href="#NonElasticElement.compute_B_and_H_over_h-667"><span class="linenos">667</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-668"><a href="#NonElasticElement.compute_B_and_H_over_h-668"><span class="linenos">668</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-669"><a href="#NonElasticElement.compute_B_and_H_over_h-669"><span class="linenos">669</span></a><span class="sd">        dt : float</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-670"><a href="#NonElasticElement.compute_B_and_H_over_h-670"><span class="linenos">670</span></a><span class="sd">            Time step.</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-671"><a href="#NonElasticElement.compute_B_and_H_over_h-671"><span class="linenos">671</span></a><span class="sd">        theta : float</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-672"><a href="#NonElasticElement.compute_B_and_H_over_h-672"><span class="linenos">672</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-673"><a href="#NonElasticElement.compute_B_and_H_over_h-673"><span class="linenos">673</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-674"><a href="#NonElasticElement.compute_B_and_H_over_h-674"><span class="linenos">674</span></a><span class="sd">            Temperature per element.</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-675"><a href="#NonElasticElement.compute_B_and_H_over_h-675"><span class="linenos">675</span></a>
</span><span id="NonElasticElement.compute_B_and_H_over_h-676"><a href="#NonElasticElement.compute_B_and_H_over_h-676"><span class="linenos">676</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-677"><a href="#NonElasticElement.compute_B_and_H_over_h-677"><span class="linenos">677</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-678"><a href="#NonElasticElement.compute_B_and_H_over_h-678"><span class="linenos">678</span></a><span class="sd">        B : torch.Tensor</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-679"><a href="#NonElasticElement.compute_B_and_H_over_h-679"><span class="linenos">679</span></a><span class="sd">            Driving term, shape (N, 3, 3).</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-680"><a href="#NonElasticElement.compute_B_and_H_over_h-680"><span class="linenos">680</span></a><span class="sd">        H_over_h : torch.Tensor</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-681"><a href="#NonElasticElement.compute_B_and_H_over_h-681"><span class="linenos">681</span></a><span class="sd">            Linearization ratio, shape (N, 6, 6).</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-682"><a href="#NonElasticElement.compute_B_and_H_over_h-682"><span class="linenos">682</span></a>
</span><span id="NonElasticElement.compute_B_and_H_over_h-683"><a href="#NonElasticElement.compute_B_and_H_over_h-683"><span class="linenos">683</span></a><span class="sd">        Notes</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-684"><a href="#NonElasticElement.compute_B_and_H_over_h-684"><span class="linenos">684</span></a><span class="sd">        -----</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-685"><a href="#NonElasticElement.compute_B_and_H_over_h-685"><span class="linenos">685</span></a><span class="sd">        Default implementation returns zeros; subclasses override.</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-686"><a href="#NonElasticElement.compute_B_and_H_over_h-686"><span class="linenos">686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-687"><a href="#NonElasticElement.compute_B_and_H_over_h-687"><span class="linenos">687</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-688"><a href="#NonElasticElement.compute_B_and_H_over_h-688"><span class="linenos">688</span></a>        <span class="n">H_over_h</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_B_and_H_over_h-689"><a href="#NonElasticElement.compute_B_and_H_over_h-689"><span class="linenos">689</span></a>        <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="n">H_over_h</span>
</span></pre></div>


            <div class="docstring"><p>Compute state variable term <code><a href="#NonElasticElement.B">B</a></code> and linearization term <code>H/h</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3).</li>
<li><strong>dt</strong> (float):
Time step.</li>
<li><strong>theta</strong> (float):
Time integration parameter.</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>B</strong> (torch.Tensor):
Driving term, shape (N, 3, 3).</li>
<li><strong>H_over_h</strong> (torch.Tensor):
Linearization ratio, shape (N, 6, 6).</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Default implementation returns zeros; subclasses override.</p>
</div>


                            </div>
                            <div id="NonElasticElement.compute_G_B" class="classattr">
                                        <input id="NonElasticElement.compute_G_B-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_G_B</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_G_B-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_G_B"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_G_B-691"><a href="#NonElasticElement.compute_G_B-691"><span class="linenos">691</span></a>    <span class="k">def</span> <span class="nf">compute_G_B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_G_B-692"><a href="#NonElasticElement.compute_G_B-692"><span class="linenos">692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_G_B-693"><a href="#NonElasticElement.compute_G_B-693"><span class="linenos">693</span></a><span class="sd">        Assemble `G` and `B` for the element based on `E` and `H/h`.</span>
</span><span id="NonElasticElement.compute_G_B-694"><a href="#NonElasticElement.compute_G_B-694"><span class="linenos">694</span></a>
</span><span id="NonElasticElement.compute_G_B-695"><a href="#NonElasticElement.compute_G_B-695"><span class="linenos">695</span></a><span class="sd">        Parameters</span>
</span><span id="NonElasticElement.compute_G_B-696"><a href="#NonElasticElement.compute_G_B-696"><span class="linenos">696</span></a><span class="sd">        ----------</span>
</span><span id="NonElasticElement.compute_G_B-697"><a href="#NonElasticElement.compute_G_B-697"><span class="linenos">697</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="NonElasticElement.compute_G_B-698"><a href="#NonElasticElement.compute_G_B-698"><span class="linenos">698</span></a><span class="sd">        dt : float</span>
</span><span id="NonElasticElement.compute_G_B-699"><a href="#NonElasticElement.compute_G_B-699"><span class="linenos">699</span></a><span class="sd">        theta : float</span>
</span><span id="NonElasticElement.compute_G_B-700"><a href="#NonElasticElement.compute_G_B-700"><span class="linenos">700</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="NonElasticElement.compute_G_B-701"><a href="#NonElasticElement.compute_G_B-701"><span class="linenos">701</span></a>
</span><span id="NonElasticElement.compute_G_B-702"><a href="#NonElasticElement.compute_G_B-702"><span class="linenos">702</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_G_B-703"><a href="#NonElasticElement.compute_G_B-703"><span class="linenos">703</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_G_B-704"><a href="#NonElasticElement.compute_G_B-704"><span class="linenos">704</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.compute_G_B-705"><a href="#NonElasticElement.compute_G_B-705"><span class="linenos">705</span></a>
</span><span id="NonElasticElement.compute_G_B-706"><a href="#NonElasticElement.compute_G_B-706"><span class="linenos">706</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement.compute_G_B-707"><a href="#NonElasticElement.compute_G_B-707"><span class="linenos">707</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement.compute_G_B-708"><a href="#NonElasticElement.compute_G_B-708"><span class="linenos">708</span></a><span class="sd">        Sets `self.B` and `self.G`.</span>
</span><span id="NonElasticElement.compute_G_B-709"><a href="#NonElasticElement.compute_G_B-709"><span class="linenos">709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_G_B-710"><a href="#NonElasticElement.compute_G_B-710"><span class="linenos">710</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">H_over_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_B_and_H_over_h</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_G_B-711"><a href="#NonElasticElement.compute_G_B-711"><span class="linenos">711</span></a>        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_E</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_G_B-712"><a href="#NonElasticElement.compute_G_B-712"><span class="linenos">712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="o">-</span> <span class="n">H_over_h</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Assemble <code><a href="#NonElasticElement.G">G</a></code> and <code><a href="#NonElasticElement.B">B</a></code> for the element based on <code>E</code> and <code>H/h</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>stress</strong> (torch.Tensor):</p></li>
<li><p><strong>dt</strong> (float):</p></li>
<li><p><strong>theta</strong> (float):</p></li>
<li><p><strong>Temp</strong> (torch.Tensor):</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.B</code> and <code>self.G</code>.</p>
</div>


                            </div>
                            <div id="NonElasticElement.compute_T_IT" class="classattr">
                                        <input id="NonElasticElement.compute_T_IT-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_T_IT</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_T_IT-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_T_IT"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_T_IT-714"><a href="#NonElasticElement.compute_T_IT-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">compute_T_IT</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_T_IT-715"><a href="#NonElasticElement.compute_T_IT-715"><span class="linenos">715</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_T_IT-716"><a href="#NonElasticElement.compute_T_IT-716"><span class="linenos">716</span></a><span class="sd">        Build volumetric coupling tensors `T` (33) and `IT` (66) from `G`.</span>
</span><span id="NonElasticElement.compute_T_IT-717"><a href="#NonElasticElement.compute_T_IT-717"><span class="linenos">717</span></a>
</span><span id="NonElasticElement.compute_T_IT-718"><a href="#NonElasticElement.compute_T_IT-718"><span class="linenos">718</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_T_IT-719"><a href="#NonElasticElement.compute_T_IT-719"><span class="linenos">719</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_T_IT-720"><a href="#NonElasticElement.compute_T_IT-720"><span class="linenos">720</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.compute_T_IT-721"><a href="#NonElasticElement.compute_T_IT-721"><span class="linenos">721</span></a>
</span><span id="NonElasticElement.compute_T_IT-722"><a href="#NonElasticElement.compute_T_IT-722"><span class="linenos">722</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement.compute_T_IT-723"><a href="#NonElasticElement.compute_T_IT-723"><span class="linenos">723</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement.compute_T_IT-724"><a href="#NonElasticElement.compute_T_IT-724"><span class="linenos">724</span></a><span class="sd">        Sets `self.T` and `self.IT`.</span>
</span><span id="NonElasticElement.compute_T_IT-725"><a href="#NonElasticElement.compute_T_IT-725"><span class="linenos">725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_T_IT-726"><a href="#NonElasticElement.compute_T_IT-726"><span class="linenos">726</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="NonElasticElement.compute_T_IT-727"><a href="#NonElasticElement.compute_T_IT-727"><span class="linenos">727</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-728"><a href="#NonElasticElement.compute_T_IT-728"><span class="linenos">728</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-729"><a href="#NonElasticElement.compute_T_IT-729"><span class="linenos">729</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-730"><a href="#NonElasticElement.compute_T_IT-730"><span class="linenos">730</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</span><span id="NonElasticElement.compute_T_IT-731"><a href="#NonElasticElement.compute_T_IT-731"><span class="linenos">731</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</span><span id="NonElasticElement.compute_T_IT-732"><a href="#NonElasticElement.compute_T_IT-732"><span class="linenos">732</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</span><span id="NonElasticElement.compute_T_IT-733"><a href="#NonElasticElement.compute_T_IT-733"><span class="linenos">733</span></a>
</span><span id="NonElasticElement.compute_T_IT-734"><a href="#NonElasticElement.compute_T_IT-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="NonElasticElement.compute_T_IT-735"><a href="#NonElasticElement.compute_T_IT-735"><span class="linenos">735</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-736"><a href="#NonElasticElement.compute_T_IT-736"><span class="linenos">736</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-737"><a href="#NonElasticElement.compute_T_IT-737"><span class="linenos">737</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-738"><a href="#NonElasticElement.compute_T_IT-738"><span class="linenos">738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-739"><a href="#NonElasticElement.compute_T_IT-739"><span class="linenos">739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-740"><a href="#NonElasticElement.compute_T_IT-740"><span class="linenos">740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NonElasticElement.compute_T_IT-741"><a href="#NonElasticElement.compute_T_IT-741"><span class="linenos">741</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span>
</span><span id="NonElasticElement.compute_T_IT-742"><a href="#NonElasticElement.compute_T_IT-742"><span class="linenos">742</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span>
</span></pre></div>


            <div class="docstring"><p>Build volumetric coupling tensors <code>T</code> (33) and <code>IT</code> (66) from <code><a href="#NonElasticElement.G">G</a></code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.T</code> and <code>self.IT</code>.</p>
</div>


                            </div>
                            <div id="NonElasticElement.compute_Bvol_Tvol" class="classattr">
                                        <input id="NonElasticElement.compute_Bvol_Tvol-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_Bvol_Tvol</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_Bvol_Tvol-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_Bvol_Tvol"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_Bvol_Tvol-744"><a href="#NonElasticElement.compute_Bvol_Tvol-744"><span class="linenos">744</span></a>    <span class="k">def</span> <span class="nf">compute_Bvol_Tvol</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-745"><a href="#NonElasticElement.compute_Bvol_Tvol-745"><span class="linenos">745</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-746"><a href="#NonElasticElement.compute_Bvol_Tvol-746"><span class="linenos">746</span></a><span class="sd">        Compute volumetric parts of `B` and `T`.</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-747"><a href="#NonElasticElement.compute_Bvol_Tvol-747"><span class="linenos">747</span></a>
</span><span id="NonElasticElement.compute_Bvol_Tvol-748"><a href="#NonElasticElement.compute_Bvol_Tvol-748"><span class="linenos">748</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-749"><a href="#NonElasticElement.compute_Bvol_Tvol-749"><span class="linenos">749</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-750"><a href="#NonElasticElement.compute_Bvol_Tvol-750"><span class="linenos">750</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-751"><a href="#NonElasticElement.compute_Bvol_Tvol-751"><span class="linenos">751</span></a>
</span><span id="NonElasticElement.compute_Bvol_Tvol-752"><a href="#NonElasticElement.compute_Bvol_Tvol-752"><span class="linenos">752</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-753"><a href="#NonElasticElement.compute_Bvol_Tvol-753"><span class="linenos">753</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-754"><a href="#NonElasticElement.compute_Bvol_Tvol-754"><span class="linenos">754</span></a><span class="sd">        Sets `self.B_vol` and `self.T_vol` as traces of `B` and `T`.</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-755"><a href="#NonElasticElement.compute_Bvol_Tvol-755"><span class="linenos">755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-756"><a href="#NonElasticElement.compute_Bvol_Tvol-756"><span class="linenos">756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bii-&gt;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_Bvol_Tvol-757"><a href="#NonElasticElement.compute_Bvol_Tvol-757"><span class="linenos">757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bii-&gt;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute volumetric parts of <code><a href="#NonElasticElement.B">B</a></code> and <code>T</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.B_vol</code> and <code>self.T_vol</code> as traces of <code><a href="#NonElasticElement.B">B</a></code> and <code>T</code>.</p>
</div>


                            </div>
                            <div id="NonElasticElement.compute_Gtilde_Btilde" class="classattr">
                                        <input id="NonElasticElement.compute_Gtilde_Btilde-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_Gtilde_Btilde</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="NonElasticElement.compute_Gtilde_Btilde-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NonElasticElement.compute_Gtilde_Btilde"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NonElasticElement.compute_Gtilde_Btilde-759"><a href="#NonElasticElement.compute_Gtilde_Btilde-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">compute_Gtilde_Btilde</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-760"><a href="#NonElasticElement.compute_Gtilde_Btilde-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-761"><a href="#NonElasticElement.compute_Gtilde_Btilde-761"><span class="linenos">761</span></a><span class="sd">        Compute deviatoric parts `G_tilde` and `B_tilde`.</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-762"><a href="#NonElasticElement.compute_Gtilde_Btilde-762"><span class="linenos">762</span></a>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-763"><a href="#NonElasticElement.compute_Gtilde_Btilde-763"><span class="linenos">763</span></a><span class="sd">        Returns</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-764"><a href="#NonElasticElement.compute_Gtilde_Btilde-764"><span class="linenos">764</span></a><span class="sd">        -------</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-765"><a href="#NonElasticElement.compute_Gtilde_Btilde-765"><span class="linenos">765</span></a><span class="sd">        None</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-766"><a href="#NonElasticElement.compute_Gtilde_Btilde-766"><span class="linenos">766</span></a>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-767"><a href="#NonElasticElement.compute_Gtilde_Btilde-767"><span class="linenos">767</span></a><span class="sd">        Side Effects</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-768"><a href="#NonElasticElement.compute_Gtilde_Btilde-768"><span class="linenos">768</span></a><span class="sd">        ------------</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-769"><a href="#NonElasticElement.compute_Gtilde_Btilde-769"><span class="linenos">769</span></a><span class="sd">        Sets `self.G_tilde` and `self.B_tilde`.</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-770"><a href="#NonElasticElement.compute_Gtilde_Btilde-770"><span class="linenos">770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-771"><a href="#NonElasticElement.compute_Gtilde_Btilde-771"><span class="linenos">771</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-772"><a href="#NonElasticElement.compute_Gtilde_Btilde-772"><span class="linenos">772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT</span><span class="o">/</span><span class="mi">3</span>
</span><span id="NonElasticElement.compute_Gtilde_Btilde-773"><a href="#NonElasticElement.compute_Gtilde_Btilde-773"><span class="linenos">773</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">B_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">B_vol</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="mi">3</span>
</span></pre></div>


            <div class="docstring"><p>Compute deviatoric parts <code>G_tilde</code> and <code>B_tilde</code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.G_tilde</code> and <code>self.B_tilde</code>.</p>
</div>


                            </div>
                </section>
                <section id="Spring">
                            <input id="Spring-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Spring</span>:

                <label class="view-source-button" for="Spring-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Spring"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Spring-369"><a href="#Spring-369"><span class="linenos">369</span></a><span class="k">class</span> <span class="nc">Spring</span><span class="p">():</span>
</span><span id="Spring-370"><a href="#Spring-370"><span class="linenos">370</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring-371"><a href="#Spring-371"><span class="linenos">371</span></a><span class="sd">    Linear isotropic elastic element in Voigt notation.</span>
</span><span id="Spring-372"><a href="#Spring-372"><span class="linenos">372</span></a>
</span><span id="Spring-373"><a href="#Spring-373"><span class="linenos">373</span></a><span class="sd">    Parameters</span>
</span><span id="Spring-374"><a href="#Spring-374"><span class="linenos">374</span></a><span class="sd">    ----------</span>
</span><span id="Spring-375"><a href="#Spring-375"><span class="linenos">375</span></a><span class="sd">    E : torch.Tensor</span>
</span><span id="Spring-376"><a href="#Spring-376"><span class="linenos">376</span></a><span class="sd">        Young&#39;s modulus per element, shape (N,).</span>
</span><span id="Spring-377"><a href="#Spring-377"><span class="linenos">377</span></a><span class="sd">    nu : torch.Tensor</span>
</span><span id="Spring-378"><a href="#Spring-378"><span class="linenos">378</span></a><span class="sd">        Poisson&#39;s ratio per element, shape (N,).</span>
</span><span id="Spring-379"><a href="#Spring-379"><span class="linenos">379</span></a><span class="sd">    name : str, optional</span>
</span><span id="Spring-380"><a href="#Spring-380"><span class="linenos">380</span></a><span class="sd">        Element name, by default &quot;spring&quot;.</span>
</span><span id="Spring-381"><a href="#Spring-381"><span class="linenos">381</span></a>
</span><span id="Spring-382"><a href="#Spring-382"><span class="linenos">382</span></a><span class="sd">    Attributes</span>
</span><span id="Spring-383"><a href="#Spring-383"><span class="linenos">383</span></a><span class="sd">    ----------</span>
</span><span id="Spring-384"><a href="#Spring-384"><span class="linenos">384</span></a><span class="sd">    E, nu : torch.Tensor</span>
</span><span id="Spring-385"><a href="#Spring-385"><span class="linenos">385</span></a><span class="sd">        Material parameters, shape (N,).</span>
</span><span id="Spring-386"><a href="#Spring-386"><span class="linenos">386</span></a><span class="sd">    n_elems : int</span>
</span><span id="Spring-387"><a href="#Spring-387"><span class="linenos">387</span></a><span class="sd">        Number of elements.</span>
</span><span id="Spring-388"><a href="#Spring-388"><span class="linenos">388</span></a><span class="sd">    C, C_inv : torch.Tensor</span>
</span><span id="Spring-389"><a href="#Spring-389"><span class="linenos">389</span></a><span class="sd">        Stiffness and its inverse in tensorial Voigt form, shape (N, 6, 6).</span>
</span><span id="Spring-390"><a href="#Spring-390"><span class="linenos">390</span></a><span class="sd">    C_tilde, C_tilde_inv : torch.Tensor</span>
</span><span id="Spring-391"><a href="#Spring-391"><span class="linenos">391</span></a><span class="sd">        Deviatoric stiffness and inverse, shape (N, 6, 6).</span>
</span><span id="Spring-392"><a href="#Spring-392"><span class="linenos">392</span></a><span class="sd">    K : torch.Tensor</span>
</span><span id="Spring-393"><a href="#Spring-393"><span class="linenos">393</span></a><span class="sd">        Bulk modulus per element, shape (N,).</span>
</span><span id="Spring-394"><a href="#Spring-394"><span class="linenos">394</span></a><span class="sd">    eps_e : torch.Tensor</span>
</span><span id="Spring-395"><a href="#Spring-395"><span class="linenos">395</span></a><span class="sd">        Elastic strain tensor per element, shape (N, 3, 3).</span>
</span><span id="Spring-396"><a href="#Spring-396"><span class="linenos">396</span></a><span class="sd">    name : str</span>
</span><span id="Spring-397"><a href="#Spring-397"><span class="linenos">397</span></a><span class="sd">        Element name.</span>
</span><span id="Spring-398"><a href="#Spring-398"><span class="linenos">398</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Spring-399"><a href="#Spring-399"><span class="linenos">399</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;spring&quot;</span><span class="p">):</span>
</span><span id="Spring-400"><a href="#Spring-400"><span class="linenos">400</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="Spring-401"><a href="#Spring-401"><span class="linenos">401</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
</span><span id="Spring-402"><a href="#Spring-402"><span class="linenos">402</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Spring-403"><a href="#Spring-403"><span class="linenos">403</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Spring-404"><a href="#Spring-404"><span class="linenos">404</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_e</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">tensor</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Spring-405"><a href="#Spring-405"><span class="linenos">405</span></a>
</span><span id="Spring-406"><a href="#Spring-406"><span class="linenos">406</span></a>	<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Spring-407"><a href="#Spring-407"><span class="linenos">407</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring-408"><a href="#Spring-408"><span class="linenos">408</span></a><span class="sd">        Build stiffness operators and bulk modulus.</span>
</span><span id="Spring-409"><a href="#Spring-409"><span class="linenos">409</span></a>
</span><span id="Spring-410"><a href="#Spring-410"><span class="linenos">410</span></a><span class="sd">        Returns</span>
</span><span id="Spring-411"><a href="#Spring-411"><span class="linenos">411</span></a><span class="sd">        -------</span>
</span><span id="Spring-412"><a href="#Spring-412"><span class="linenos">412</span></a><span class="sd">        None</span>
</span><span id="Spring-413"><a href="#Spring-413"><span class="linenos">413</span></a>
</span><span id="Spring-414"><a href="#Spring-414"><span class="linenos">414</span></a><span class="sd">        Side Effects</span>
</span><span id="Spring-415"><a href="#Spring-415"><span class="linenos">415</span></a><span class="sd">        ------------</span>
</span><span id="Spring-416"><a href="#Spring-416"><span class="linenos">416</span></a><span class="sd">        Sets `C`, `C_inv`, `C_tilde`, `C_tilde_inv`, and `K`.</span>
</span><span id="Spring-417"><a href="#Spring-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring-418"><a href="#Spring-418"><span class="linenos">418</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Spring-419"><a href="#Spring-419"><span class="linenos">419</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C_inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span><span id="Spring-420"><a href="#Spring-420"><span class="linenos">420</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C_tilde</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Spring-421"><a href="#Spring-421"><span class="linenos">421</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C_tilde_inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Spring-422"><a href="#Spring-422"><span class="linenos">422</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>
</span><span id="Spring-423"><a href="#Spring-423"><span class="linenos">423</span></a>
</span><span id="Spring-424"><a href="#Spring-424"><span class="linenos">424</span></a>	<span class="k">def</span> <span class="nf">compute_eps_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">):</span>
</span><span id="Spring-425"><a href="#Spring-425"><span class="linenos">425</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring-426"><a href="#Spring-426"><span class="linenos">426</span></a><span class="sd">        Compute elastic strain from stress using `C_inv`.</span>
</span><span id="Spring-427"><a href="#Spring-427"><span class="linenos">427</span></a>
</span><span id="Spring-428"><a href="#Spring-428"><span class="linenos">428</span></a><span class="sd">        Parameters</span>
</span><span id="Spring-429"><a href="#Spring-429"><span class="linenos">429</span></a><span class="sd">        ----------</span>
</span><span id="Spring-430"><a href="#Spring-430"><span class="linenos">430</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Spring-431"><a href="#Spring-431"><span class="linenos">431</span></a><span class="sd">            Cauchy stress tensor per element, shape (N, 3, 3).</span>
</span><span id="Spring-432"><a href="#Spring-432"><span class="linenos">432</span></a>
</span><span id="Spring-433"><a href="#Spring-433"><span class="linenos">433</span></a><span class="sd">        Returns</span>
</span><span id="Spring-434"><a href="#Spring-434"><span class="linenos">434</span></a><span class="sd">        -------</span>
</span><span id="Spring-435"><a href="#Spring-435"><span class="linenos">435</span></a><span class="sd">        None</span>
</span><span id="Spring-436"><a href="#Spring-436"><span class="linenos">436</span></a>
</span><span id="Spring-437"><a href="#Spring-437"><span class="linenos">437</span></a><span class="sd">        Side Effects</span>
</span><span id="Spring-438"><a href="#Spring-438"><span class="linenos">438</span></a><span class="sd">        ------------</span>
</span><span id="Spring-439"><a href="#Spring-439"><span class="linenos">439</span></a><span class="sd">        Sets `self.eps_e` (N, 3, 3).</span>
</span><span id="Spring-440"><a href="#Spring-440"><span class="linenos">440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring-441"><a href="#Spring-441"><span class="linenos">441</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_e</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span><span class="p">,</span> <span class="n">stress</span><span class="p">)</span>
</span><span id="Spring-442"><a href="#Spring-442"><span class="linenos">442</span></a>
</span><span id="Spring-443"><a href="#Spring-443"><span class="linenos">443</span></a>	<span class="k">def</span> <span class="nf">__compute_C</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_elems</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="Spring-444"><a href="#Spring-444"><span class="linenos">444</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring-445"><a href="#Spring-445"><span class="linenos">445</span></a><span class="sd">        Construct isotropic stiffness in tensorial Voigt form.</span>
</span><span id="Spring-446"><a href="#Spring-446"><span class="linenos">446</span></a>
</span><span id="Spring-447"><a href="#Spring-447"><span class="linenos">447</span></a><span class="sd">        Parameters</span>
</span><span id="Spring-448"><a href="#Spring-448"><span class="linenos">448</span></a><span class="sd">        ----------</span>
</span><span id="Spring-449"><a href="#Spring-449"><span class="linenos">449</span></a><span class="sd">        n_elems : int</span>
</span><span id="Spring-450"><a href="#Spring-450"><span class="linenos">450</span></a><span class="sd">            Number of elements.</span>
</span><span id="Spring-451"><a href="#Spring-451"><span class="linenos">451</span></a><span class="sd">        nu : torch.Tensor</span>
</span><span id="Spring-452"><a href="#Spring-452"><span class="linenos">452</span></a><span class="sd">            Poisson&#39;s ratio, shape (N,).</span>
</span><span id="Spring-453"><a href="#Spring-453"><span class="linenos">453</span></a><span class="sd">        E : torch.Tensor</span>
</span><span id="Spring-454"><a href="#Spring-454"><span class="linenos">454</span></a><span class="sd">            Young&#39;s modulus, shape (N,).</span>
</span><span id="Spring-455"><a href="#Spring-455"><span class="linenos">455</span></a>
</span><span id="Spring-456"><a href="#Spring-456"><span class="linenos">456</span></a><span class="sd">        Returns</span>
</span><span id="Spring-457"><a href="#Spring-457"><span class="linenos">457</span></a><span class="sd">        -------</span>
</span><span id="Spring-458"><a href="#Spring-458"><span class="linenos">458</span></a><span class="sd">        torch.Tensor</span>
</span><span id="Spring-459"><a href="#Spring-459"><span class="linenos">459</span></a><span class="sd">            Stiffness matrix `(N, 6, 6)` with shear terms `2G` on the diagonal</span>
</span><span id="Spring-460"><a href="#Spring-460"><span class="linenos">460</span></a><span class="sd">            of the shear block (tensorial, not engineering).</span>
</span><span id="Spring-461"><a href="#Spring-461"><span class="linenos">461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring-462"><a href="#Spring-462"><span class="linenos">462</span></a>		<span class="n">C</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Spring-463"><a href="#Spring-463"><span class="linenos">463</span></a>		<span class="n">a0</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">))</span>
</span><span id="Spring-464"><a href="#Spring-464"><span class="linenos">464</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
</span><span id="Spring-465"><a href="#Spring-465"><span class="linenos">465</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
</span><span id="Spring-466"><a href="#Spring-466"><span class="linenos">466</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
</span><span id="Spring-467"><a href="#Spring-467"><span class="linenos">467</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Spring-468"><a href="#Spring-468"><span class="linenos">468</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Spring-469"><a href="#Spring-469"><span class="linenos">469</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Spring-470"><a href="#Spring-470"><span class="linenos">470</span></a>		<span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="n">nu</span>
</span><span id="Spring-471"><a href="#Spring-471"><span class="linenos">471</span></a>		<span class="k">return</span> <span class="n">C</span>
</span><span id="Spring-472"><a href="#Spring-472"><span class="linenos">472</span></a>
</span><span id="Spring-473"><a href="#Spring-473"><span class="linenos">473</span></a>	<span class="k">def</span> <span class="nf">__compute_C_inv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
</span><span id="Spring-474"><a href="#Spring-474"><span class="linenos">474</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring-475"><a href="#Spring-475"><span class="linenos">475</span></a><span class="sd">        Invert the stiffness matrix per element.</span>
</span><span id="Spring-476"><a href="#Spring-476"><span class="linenos">476</span></a>
</span><span id="Spring-477"><a href="#Spring-477"><span class="linenos">477</span></a><span class="sd">        Parameters</span>
</span><span id="Spring-478"><a href="#Spring-478"><span class="linenos">478</span></a><span class="sd">        ----------</span>
</span><span id="Spring-479"><a href="#Spring-479"><span class="linenos">479</span></a><span class="sd">        C : torch.Tensor</span>
</span><span id="Spring-480"><a href="#Spring-480"><span class="linenos">480</span></a><span class="sd">            Stiffness matrix, shape (N, 6, 6).</span>
</span><span id="Spring-481"><a href="#Spring-481"><span class="linenos">481</span></a>
</span><span id="Spring-482"><a href="#Spring-482"><span class="linenos">482</span></a><span class="sd">        Returns</span>
</span><span id="Spring-483"><a href="#Spring-483"><span class="linenos">483</span></a><span class="sd">        -------</span>
</span><span id="Spring-484"><a href="#Spring-484"><span class="linenos">484</span></a><span class="sd">        torch.Tensor</span>
</span><span id="Spring-485"><a href="#Spring-485"><span class="linenos">485</span></a><span class="sd">            Element-wise inverse, shape (N, 6, 6).</span>
</span><span id="Spring-486"><a href="#Spring-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring-487"><a href="#Spring-487"><span class="linenos">487</span></a>		<span class="k">return</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span><span id="Spring-488"><a href="#Spring-488"><span class="linenos">488</span></a>
</span><span id="Spring-489"><a href="#Spring-489"><span class="linenos">489</span></a>	<span class="k">def</span> <span class="nf">__compute_C_tilde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_elems</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="Spring-490"><a href="#Spring-490"><span class="linenos">490</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring-491"><a href="#Spring-491"><span class="linenos">491</span></a><span class="sd">        Construct deviatoric stiffness (2G on all six Voigt diagonals).</span>
</span><span id="Spring-492"><a href="#Spring-492"><span class="linenos">492</span></a>
</span><span id="Spring-493"><a href="#Spring-493"><span class="linenos">493</span></a><span class="sd">        Parameters</span>
</span><span id="Spring-494"><a href="#Spring-494"><span class="linenos">494</span></a><span class="sd">        ----------</span>
</span><span id="Spring-495"><a href="#Spring-495"><span class="linenos">495</span></a><span class="sd">        n_elems : int</span>
</span><span id="Spring-496"><a href="#Spring-496"><span class="linenos">496</span></a><span class="sd">        nu : torch.Tensor</span>
</span><span id="Spring-497"><a href="#Spring-497"><span class="linenos">497</span></a><span class="sd">        E : torch.Tensor</span>
</span><span id="Spring-498"><a href="#Spring-498"><span class="linenos">498</span></a>
</span><span id="Spring-499"><a href="#Spring-499"><span class="linenos">499</span></a><span class="sd">        Returns</span>
</span><span id="Spring-500"><a href="#Spring-500"><span class="linenos">500</span></a><span class="sd">        -------</span>
</span><span id="Spring-501"><a href="#Spring-501"><span class="linenos">501</span></a><span class="sd">        torch.Tensor</span>
</span><span id="Spring-502"><a href="#Spring-502"><span class="linenos">502</span></a><span class="sd">            `(N, 6, 6)` with diagonal entries `2G`, zeros elsewhere.</span>
</span><span id="Spring-503"><a href="#Spring-503"><span class="linenos">503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring-504"><a href="#Spring-504"><span class="linenos">504</span></a>		<span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">))</span>
</span><span id="Spring-505"><a href="#Spring-505"><span class="linenos">505</span></a>		<span class="n">C_tilde</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Spring-506"><a href="#Spring-506"><span class="linenos">506</span></a>		<span class="n">C_tilde</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
</span><span id="Spring-507"><a href="#Spring-507"><span class="linenos">507</span></a>		<span class="n">C_tilde</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
</span><span id="Spring-508"><a href="#Spring-508"><span class="linenos">508</span></a>		<span class="n">C_tilde</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
</span><span id="Spring-509"><a href="#Spring-509"><span class="linenos">509</span></a>		<span class="n">C_tilde</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
</span><span id="Spring-510"><a href="#Spring-510"><span class="linenos">510</span></a>		<span class="n">C_tilde</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
</span><span id="Spring-511"><a href="#Spring-511"><span class="linenos">511</span></a>		<span class="n">C_tilde</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
</span><span id="Spring-512"><a href="#Spring-512"><span class="linenos">512</span></a>		<span class="k">return</span> <span class="n">C_tilde</span>
</span><span id="Spring-513"><a href="#Spring-513"><span class="linenos">513</span></a>
</span><span id="Spring-514"><a href="#Spring-514"><span class="linenos">514</span></a>	<span class="k">def</span> <span class="nf">__compute_C_tilde_inv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_elems</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="Spring-515"><a href="#Spring-515"><span class="linenos">515</span></a>		<span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">))</span>
</span><span id="Spring-516"><a href="#Spring-516"><span class="linenos">516</span></a>		<span class="n">C_tilde_inv</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Spring-517"><a href="#Spring-517"><span class="linenos">517</span></a>		<span class="n">C_tilde_inv</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
</span><span id="Spring-518"><a href="#Spring-518"><span class="linenos">518</span></a>		<span class="n">C_tilde_inv</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
</span><span id="Spring-519"><a href="#Spring-519"><span class="linenos">519</span></a>		<span class="n">C_tilde_inv</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
</span><span id="Spring-520"><a href="#Spring-520"><span class="linenos">520</span></a>		<span class="n">C_tilde_inv</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
</span><span id="Spring-521"><a href="#Spring-521"><span class="linenos">521</span></a>		<span class="n">C_tilde_inv</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
</span><span id="Spring-522"><a href="#Spring-522"><span class="linenos">522</span></a>		<span class="n">C_tilde_inv</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
</span><span id="Spring-523"><a href="#Spring-523"><span class="linenos">523</span></a>		<span class="k">return</span> <span class="n">C_tilde_inv</span>
</span></pre></div>


            <div class="docstring"><p>Linear isotropic elastic element in Voigt notation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>E</strong> (torch.Tensor):
Young's modulus per element, shape (N,).</li>
<li><strong>nu</strong> (torch.Tensor):
Poisson's ratio per element, shape (N,).</li>
<li><strong>name</strong> (str, optional):
Element name, by default "spring".</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>E, nu</strong> (torch.Tensor):
Material parameters, shape (N,).</li>
<li><strong>n_elems</strong> (int):
Number of elements.</li>
<li><strong>C, C_inv</strong> (torch.Tensor):
Stiffness and its inverse in tensorial Voigt form, shape (N, 6, 6).</li>
<li><strong>C_tilde, C_tilde_inv</strong> (torch.Tensor):
Deviatoric stiffness and inverse, shape (N, 6, 6).</li>
<li><strong>K</strong> (torch.Tensor):
Bulk modulus per element, shape (N,).</li>
<li><strong>eps_e</strong> (torch.Tensor):
Elastic strain tensor per element, shape (N, 3, 3).</li>
<li><strong>name</strong> (str):
Element name.</li>
</ul>
</div>


                            <div id="Spring.__init__" class="classattr">
                                        <input id="Spring.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Spring</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">E</span>, </span><span class="param"><span class="n">nu</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="s1">&#39;spring&#39;</span></span>)</span>

                <label class="view-source-button" for="Spring.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Spring.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Spring.__init__-399"><a href="#Spring.__init__-399"><span class="linenos">399</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;spring&quot;</span><span class="p">):</span>
</span><span id="Spring.__init__-400"><a href="#Spring.__init__-400"><span class="linenos">400</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="Spring.__init__-401"><a href="#Spring.__init__-401"><span class="linenos">401</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
</span><span id="Spring.__init__-402"><a href="#Spring.__init__-402"><span class="linenos">402</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Spring.__init__-403"><a href="#Spring.__init__-403"><span class="linenos">403</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Spring.__init__-404"><a href="#Spring.__init__-404"><span class="linenos">404</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_e</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">tensor</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Spring.E" class="classattr">
                                <div class="attr variable">
            <span class="name">E</span>

        
    </div>
    <a class="headerlink" href="#Spring.E"></a>
    
    

                            </div>
                            <div id="Spring.nu" class="classattr">
                                <div class="attr variable">
            <span class="name">nu</span>

        
    </div>
    <a class="headerlink" href="#Spring.nu"></a>
    
    

                            </div>
                            <div id="Spring.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#Spring.name"></a>
    
    

                            </div>
                            <div id="Spring.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#Spring.n_elems"></a>
    
    

                            </div>
                            <div id="Spring.eps_e" class="classattr">
                                <div class="attr variable">
            <span class="name">eps_e</span>

        
    </div>
    <a class="headerlink" href="#Spring.eps_e"></a>
    
    

                            </div>
                            <div id="Spring.initialize" class="classattr">
                                        <input id="Spring.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Spring.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Spring.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Spring.initialize-406"><a href="#Spring.initialize-406"><span class="linenos">406</span></a>	<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Spring.initialize-407"><a href="#Spring.initialize-407"><span class="linenos">407</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring.initialize-408"><a href="#Spring.initialize-408"><span class="linenos">408</span></a><span class="sd">        Build stiffness operators and bulk modulus.</span>
</span><span id="Spring.initialize-409"><a href="#Spring.initialize-409"><span class="linenos">409</span></a>
</span><span id="Spring.initialize-410"><a href="#Spring.initialize-410"><span class="linenos">410</span></a><span class="sd">        Returns</span>
</span><span id="Spring.initialize-411"><a href="#Spring.initialize-411"><span class="linenos">411</span></a><span class="sd">        -------</span>
</span><span id="Spring.initialize-412"><a href="#Spring.initialize-412"><span class="linenos">412</span></a><span class="sd">        None</span>
</span><span id="Spring.initialize-413"><a href="#Spring.initialize-413"><span class="linenos">413</span></a>
</span><span id="Spring.initialize-414"><a href="#Spring.initialize-414"><span class="linenos">414</span></a><span class="sd">        Side Effects</span>
</span><span id="Spring.initialize-415"><a href="#Spring.initialize-415"><span class="linenos">415</span></a><span class="sd">        ------------</span>
</span><span id="Spring.initialize-416"><a href="#Spring.initialize-416"><span class="linenos">416</span></a><span class="sd">        Sets `C`, `C_inv`, `C_tilde`, `C_tilde_inv`, and `K`.</span>
</span><span id="Spring.initialize-417"><a href="#Spring.initialize-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring.initialize-418"><a href="#Spring.initialize-418"><span class="linenos">418</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Spring.initialize-419"><a href="#Spring.initialize-419"><span class="linenos">419</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C_inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
</span><span id="Spring.initialize-420"><a href="#Spring.initialize-420"><span class="linenos">420</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C_tilde</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Spring.initialize-421"><a href="#Spring.initialize-421"><span class="linenos">421</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">C_tilde_inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__compute_C_tilde_inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
</span><span id="Spring.initialize-422"><a href="#Spring.initialize-422"><span class="linenos">422</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Build stiffness operators and bulk modulus.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>C</code>, <code>C_inv</code>, <code>C_tilde</code>, <code>C_tilde_inv</code>, and <code>K</code>.</p>
</div>


                            </div>
                            <div id="Spring.compute_eps_e" class="classattr">
                                        <input id="Spring.compute_eps_e-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_e</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Spring.compute_eps_e-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Spring.compute_eps_e"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Spring.compute_eps_e-424"><a href="#Spring.compute_eps_e-424"><span class="linenos">424</span></a>	<span class="k">def</span> <span class="nf">compute_eps_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">):</span>
</span><span id="Spring.compute_eps_e-425"><a href="#Spring.compute_eps_e-425"><span class="linenos">425</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Spring.compute_eps_e-426"><a href="#Spring.compute_eps_e-426"><span class="linenos">426</span></a><span class="sd">        Compute elastic strain from stress using `C_inv`.</span>
</span><span id="Spring.compute_eps_e-427"><a href="#Spring.compute_eps_e-427"><span class="linenos">427</span></a>
</span><span id="Spring.compute_eps_e-428"><a href="#Spring.compute_eps_e-428"><span class="linenos">428</span></a><span class="sd">        Parameters</span>
</span><span id="Spring.compute_eps_e-429"><a href="#Spring.compute_eps_e-429"><span class="linenos">429</span></a><span class="sd">        ----------</span>
</span><span id="Spring.compute_eps_e-430"><a href="#Spring.compute_eps_e-430"><span class="linenos">430</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Spring.compute_eps_e-431"><a href="#Spring.compute_eps_e-431"><span class="linenos">431</span></a><span class="sd">            Cauchy stress tensor per element, shape (N, 3, 3).</span>
</span><span id="Spring.compute_eps_e-432"><a href="#Spring.compute_eps_e-432"><span class="linenos">432</span></a>
</span><span id="Spring.compute_eps_e-433"><a href="#Spring.compute_eps_e-433"><span class="linenos">433</span></a><span class="sd">        Returns</span>
</span><span id="Spring.compute_eps_e-434"><a href="#Spring.compute_eps_e-434"><span class="linenos">434</span></a><span class="sd">        -------</span>
</span><span id="Spring.compute_eps_e-435"><a href="#Spring.compute_eps_e-435"><span class="linenos">435</span></a><span class="sd">        None</span>
</span><span id="Spring.compute_eps_e-436"><a href="#Spring.compute_eps_e-436"><span class="linenos">436</span></a>
</span><span id="Spring.compute_eps_e-437"><a href="#Spring.compute_eps_e-437"><span class="linenos">437</span></a><span class="sd">        Side Effects</span>
</span><span id="Spring.compute_eps_e-438"><a href="#Spring.compute_eps_e-438"><span class="linenos">438</span></a><span class="sd">        ------------</span>
</span><span id="Spring.compute_eps_e-439"><a href="#Spring.compute_eps_e-439"><span class="linenos">439</span></a><span class="sd">        Sets `self.eps_e` (N, 3, 3).</span>
</span><span id="Spring.compute_eps_e-440"><a href="#Spring.compute_eps_e-440"><span class="linenos">440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Spring.compute_eps_e-441"><a href="#Spring.compute_eps_e-441"><span class="linenos">441</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_e</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C_inv</span><span class="p">,</span> <span class="n">stress</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute elastic strain from stress using <code>C_inv</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Cauchy stress tensor per element, shape (N, 3, 3).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.eps_e</code> (N, 3, 3).</p>
</div>


                            </div>
                </section>
                <section id="Thermoelastic">
                            <input id="Thermoelastic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Thermoelastic</span>:

                <label class="view-source-button" for="Thermoelastic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Thermoelastic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Thermoelastic-317"><a href="#Thermoelastic-317"><span class="linenos">317</span></a><span class="k">class</span> <span class="nc">Thermoelastic</span><span class="p">():</span>
</span><span id="Thermoelastic-318"><a href="#Thermoelastic-318"><span class="linenos">318</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Thermoelastic-319"><a href="#Thermoelastic-319"><span class="linenos">319</span></a><span class="sd">    Thermoelastic contribution producing thermal strain :math:`\\varepsilon_{th}</span>
</span><span id="Thermoelastic-320"><a href="#Thermoelastic-320"><span class="linenos">320</span></a><span class="sd">    = \\alpha\\,\\Delta T\\,I`.</span>
</span><span id="Thermoelastic-321"><a href="#Thermoelastic-321"><span class="linenos">321</span></a>
</span><span id="Thermoelastic-322"><a href="#Thermoelastic-322"><span class="linenos">322</span></a><span class="sd">    Parameters</span>
</span><span id="Thermoelastic-323"><a href="#Thermoelastic-323"><span class="linenos">323</span></a><span class="sd">    ----------</span>
</span><span id="Thermoelastic-324"><a href="#Thermoelastic-324"><span class="linenos">324</span></a><span class="sd">    alpha : torch.Tensor</span>
</span><span id="Thermoelastic-325"><a href="#Thermoelastic-325"><span class="linenos">325</span></a><span class="sd">        Linear coefficient of thermal expansion per element, shape (N,).</span>
</span><span id="Thermoelastic-326"><a href="#Thermoelastic-326"><span class="linenos">326</span></a><span class="sd">    name : str, optional</span>
</span><span id="Thermoelastic-327"><a href="#Thermoelastic-327"><span class="linenos">327</span></a><span class="sd">        Identifier for the element, by default &quot;thermoelastic&quot;.</span>
</span><span id="Thermoelastic-328"><a href="#Thermoelastic-328"><span class="linenos">328</span></a>
</span><span id="Thermoelastic-329"><a href="#Thermoelastic-329"><span class="linenos">329</span></a><span class="sd">    Attributes</span>
</span><span id="Thermoelastic-330"><a href="#Thermoelastic-330"><span class="linenos">330</span></a><span class="sd">    ----------</span>
</span><span id="Thermoelastic-331"><a href="#Thermoelastic-331"><span class="linenos">331</span></a><span class="sd">    alpha : torch.Tensor</span>
</span><span id="Thermoelastic-332"><a href="#Thermoelastic-332"><span class="linenos">332</span></a><span class="sd">        Thermal expansion coefficients, shape (N,).</span>
</span><span id="Thermoelastic-333"><a href="#Thermoelastic-333"><span class="linenos">333</span></a><span class="sd">    n_elems : int</span>
</span><span id="Thermoelastic-334"><a href="#Thermoelastic-334"><span class="linenos">334</span></a><span class="sd">        Number of elements.</span>
</span><span id="Thermoelastic-335"><a href="#Thermoelastic-335"><span class="linenos">335</span></a><span class="sd">    eps_th : torch.Tensor</span>
</span><span id="Thermoelastic-336"><a href="#Thermoelastic-336"><span class="linenos">336</span></a><span class="sd">        Thermal strain tensor per element, shape (N, 3, 3).</span>
</span><span id="Thermoelastic-337"><a href="#Thermoelastic-337"><span class="linenos">337</span></a><span class="sd">    I : torch.Tensor</span>
</span><span id="Thermoelastic-338"><a href="#Thermoelastic-338"><span class="linenos">338</span></a><span class="sd">        Identity tensor (broadcasted to N), shape (N, 3, 3).</span>
</span><span id="Thermoelastic-339"><a href="#Thermoelastic-339"><span class="linenos">339</span></a><span class="sd">    name : str</span>
</span><span id="Thermoelastic-340"><a href="#Thermoelastic-340"><span class="linenos">340</span></a><span class="sd">        Element name.</span>
</span><span id="Thermoelastic-341"><a href="#Thermoelastic-341"><span class="linenos">341</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Thermoelastic-342"><a href="#Thermoelastic-342"><span class="linenos">342</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;thermoelastic&quot;</span><span class="p">):</span>
</span><span id="Thermoelastic-343"><a href="#Thermoelastic-343"><span class="linenos">343</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="Thermoelastic-344"><a href="#Thermoelastic-344"><span class="linenos">344</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Thermoelastic-345"><a href="#Thermoelastic-345"><span class="linenos">345</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Thermoelastic-346"><a href="#Thermoelastic-346"><span class="linenos">346</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_th</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Thermoelastic-347"><a href="#Thermoelastic-347"><span class="linenos">347</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Thermoelastic-348"><a href="#Thermoelastic-348"><span class="linenos">348</span></a>
</span><span id="Thermoelastic-349"><a href="#Thermoelastic-349"><span class="linenos">349</span></a>	<span class="k">def</span> <span class="nf">compute_eps_th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dT_DG_vec</span><span class="p">):</span>
</span><span id="Thermoelastic-350"><a href="#Thermoelastic-350"><span class="linenos">350</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Thermoelastic-351"><a href="#Thermoelastic-351"><span class="linenos">351</span></a><span class="sd">        Compute thermal strain from a temperature increment.</span>
</span><span id="Thermoelastic-352"><a href="#Thermoelastic-352"><span class="linenos">352</span></a>
</span><span id="Thermoelastic-353"><a href="#Thermoelastic-353"><span class="linenos">353</span></a><span class="sd">        Parameters</span>
</span><span id="Thermoelastic-354"><a href="#Thermoelastic-354"><span class="linenos">354</span></a><span class="sd">        ----------</span>
</span><span id="Thermoelastic-355"><a href="#Thermoelastic-355"><span class="linenos">355</span></a><span class="sd">        dT_DG_vec : torch.Tensor</span>
</span><span id="Thermoelastic-356"><a href="#Thermoelastic-356"><span class="linenos">356</span></a><span class="sd">            Temperature increment per element (N,) or broadcastable to (N,).</span>
</span><span id="Thermoelastic-357"><a href="#Thermoelastic-357"><span class="linenos">357</span></a>
</span><span id="Thermoelastic-358"><a href="#Thermoelastic-358"><span class="linenos">358</span></a><span class="sd">        Returns</span>
</span><span id="Thermoelastic-359"><a href="#Thermoelastic-359"><span class="linenos">359</span></a><span class="sd">        -------</span>
</span><span id="Thermoelastic-360"><a href="#Thermoelastic-360"><span class="linenos">360</span></a><span class="sd">        None</span>
</span><span id="Thermoelastic-361"><a href="#Thermoelastic-361"><span class="linenos">361</span></a>
</span><span id="Thermoelastic-362"><a href="#Thermoelastic-362"><span class="linenos">362</span></a><span class="sd">        Side Effects</span>
</span><span id="Thermoelastic-363"><a href="#Thermoelastic-363"><span class="linenos">363</span></a><span class="sd">        ------------</span>
</span><span id="Thermoelastic-364"><a href="#Thermoelastic-364"><span class="linenos">364</span></a><span class="sd">        Sets `self.eps_th = alpha * dT * I`.</span>
</span><span id="Thermoelastic-365"><a href="#Thermoelastic-365"><span class="linenos">365</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Thermoelastic-366"><a href="#Thermoelastic-366"><span class="linenos">366</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">dT_DG_vec</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span>
</span></pre></div>


            <div class="docstring"><p>Thermoelastic contribution producing thermal strain :math:<code>\varepsilon_{th}
= \alpha\,\Delta T\,I</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>alpha</strong> (torch.Tensor):
Linear coefficient of thermal expansion per element, shape (N,).</li>
<li><strong>name</strong> (str, optional):
Identifier for the element, by default "thermoelastic".</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>alpha</strong> (torch.Tensor):
Thermal expansion coefficients, shape (N,).</li>
<li><strong>n_elems</strong> (int):
Number of elements.</li>
<li><strong>eps_th</strong> (torch.Tensor):
Thermal strain tensor per element, shape (N, 3, 3).</li>
<li><strong>I</strong> (torch.Tensor):
Identity tensor (broadcasted to N), shape (N, 3, 3).</li>
<li><strong>name</strong> (str):
Element name.</li>
</ul>
</div>


                            <div id="Thermoelastic.__init__" class="classattr">
                                        <input id="Thermoelastic.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Thermoelastic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">alpha</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="s1">&#39;thermoelastic&#39;</span></span>)</span>

                <label class="view-source-button" for="Thermoelastic.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Thermoelastic.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Thermoelastic.__init__-342"><a href="#Thermoelastic.__init__-342"><span class="linenos">342</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;thermoelastic&quot;</span><span class="p">):</span>
</span><span id="Thermoelastic.__init__-343"><a href="#Thermoelastic.__init__-343"><span class="linenos">343</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="Thermoelastic.__init__-344"><a href="#Thermoelastic.__init__-344"><span class="linenos">344</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Thermoelastic.__init__-345"><a href="#Thermoelastic.__init__-345"><span class="linenos">345</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Thermoelastic.__init__-346"><a href="#Thermoelastic.__init__-346"><span class="linenos">346</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_th</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Thermoelastic.__init__-347"><a href="#Thermoelastic.__init__-347"><span class="linenos">347</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Thermoelastic.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#Thermoelastic.alpha"></a>
    
    

                            </div>
                            <div id="Thermoelastic.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#Thermoelastic.name"></a>
    
    

                            </div>
                            <div id="Thermoelastic.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#Thermoelastic.n_elems"></a>
    
    

                            </div>
                            <div id="Thermoelastic.eps_th" class="classattr">
                                <div class="attr variable">
            <span class="name">eps_th</span>

        
    </div>
    <a class="headerlink" href="#Thermoelastic.eps_th"></a>
    
    

                            </div>
                            <div id="Thermoelastic.I" class="classattr">
                                <div class="attr variable">
            <span class="name">I</span>

        
    </div>
    <a class="headerlink" href="#Thermoelastic.I"></a>
    
    

                            </div>
                            <div id="Thermoelastic.compute_eps_th" class="classattr">
                                        <input id="Thermoelastic.compute_eps_th-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_th</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dT_DG_vec</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Thermoelastic.compute_eps_th-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Thermoelastic.compute_eps_th"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Thermoelastic.compute_eps_th-349"><a href="#Thermoelastic.compute_eps_th-349"><span class="linenos">349</span></a>	<span class="k">def</span> <span class="nf">compute_eps_th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dT_DG_vec</span><span class="p">):</span>
</span><span id="Thermoelastic.compute_eps_th-350"><a href="#Thermoelastic.compute_eps_th-350"><span class="linenos">350</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Thermoelastic.compute_eps_th-351"><a href="#Thermoelastic.compute_eps_th-351"><span class="linenos">351</span></a><span class="sd">        Compute thermal strain from a temperature increment.</span>
</span><span id="Thermoelastic.compute_eps_th-352"><a href="#Thermoelastic.compute_eps_th-352"><span class="linenos">352</span></a>
</span><span id="Thermoelastic.compute_eps_th-353"><a href="#Thermoelastic.compute_eps_th-353"><span class="linenos">353</span></a><span class="sd">        Parameters</span>
</span><span id="Thermoelastic.compute_eps_th-354"><a href="#Thermoelastic.compute_eps_th-354"><span class="linenos">354</span></a><span class="sd">        ----------</span>
</span><span id="Thermoelastic.compute_eps_th-355"><a href="#Thermoelastic.compute_eps_th-355"><span class="linenos">355</span></a><span class="sd">        dT_DG_vec : torch.Tensor</span>
</span><span id="Thermoelastic.compute_eps_th-356"><a href="#Thermoelastic.compute_eps_th-356"><span class="linenos">356</span></a><span class="sd">            Temperature increment per element (N,) or broadcastable to (N,).</span>
</span><span id="Thermoelastic.compute_eps_th-357"><a href="#Thermoelastic.compute_eps_th-357"><span class="linenos">357</span></a>
</span><span id="Thermoelastic.compute_eps_th-358"><a href="#Thermoelastic.compute_eps_th-358"><span class="linenos">358</span></a><span class="sd">        Returns</span>
</span><span id="Thermoelastic.compute_eps_th-359"><a href="#Thermoelastic.compute_eps_th-359"><span class="linenos">359</span></a><span class="sd">        -------</span>
</span><span id="Thermoelastic.compute_eps_th-360"><a href="#Thermoelastic.compute_eps_th-360"><span class="linenos">360</span></a><span class="sd">        None</span>
</span><span id="Thermoelastic.compute_eps_th-361"><a href="#Thermoelastic.compute_eps_th-361"><span class="linenos">361</span></a>
</span><span id="Thermoelastic.compute_eps_th-362"><a href="#Thermoelastic.compute_eps_th-362"><span class="linenos">362</span></a><span class="sd">        Side Effects</span>
</span><span id="Thermoelastic.compute_eps_th-363"><a href="#Thermoelastic.compute_eps_th-363"><span class="linenos">363</span></a><span class="sd">        ------------</span>
</span><span id="Thermoelastic.compute_eps_th-364"><a href="#Thermoelastic.compute_eps_th-364"><span class="linenos">364</span></a><span class="sd">        Sets `self.eps_th = alpha * dT * I`.</span>
</span><span id="Thermoelastic.compute_eps_th-365"><a href="#Thermoelastic.compute_eps_th-365"><span class="linenos">365</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Thermoelastic.compute_eps_th-366"><a href="#Thermoelastic.compute_eps_th-366"><span class="linenos">366</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eps_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">dT_DG_vec</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span>
</span></pre></div>


            <div class="docstring"><p>Compute thermal strain from a temperature increment.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dT_DG_vec</strong> (torch.Tensor):
Temperature increment per element (N,) or broadcastable to (N,).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.eps_th = alpha * dT * I</code>.</p>
</div>


                            </div>
                </section>
                <section id="Viscoelastic">
                            <input id="Viscoelastic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Viscoelastic</span><wbr>(<span class="base"><a href="#NonElasticElement">safeincave.NonElasticElement</a></span>):

                <label class="view-source-button" for="Viscoelastic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Viscoelastic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Viscoelastic-779"><a href="#Viscoelastic-779"><span class="linenos">779</span></a><span class="k">class</span> <span class="nc">Viscoelastic</span><span class="p">(</span><span class="n">NonElasticElement</span><span class="p">):</span>
</span><span id="Viscoelastic-780"><a href="#Viscoelastic-780"><span class="linenos">780</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Viscoelastic-781"><a href="#Viscoelastic-781"><span class="linenos">781</span></a><span class="sd">    KelvinVoigt-type viscoelastic element.</span>
</span><span id="Viscoelastic-782"><a href="#Viscoelastic-782"><span class="linenos">782</span></a>
</span><span id="Viscoelastic-783"><a href="#Viscoelastic-783"><span class="linenos">783</span></a><span class="sd">    Parameters</span>
</span><span id="Viscoelastic-784"><a href="#Viscoelastic-784"><span class="linenos">784</span></a><span class="sd">    ----------</span>
</span><span id="Viscoelastic-785"><a href="#Viscoelastic-785"><span class="linenos">785</span></a><span class="sd">    eta : torch.Tensor</span>
</span><span id="Viscoelastic-786"><a href="#Viscoelastic-786"><span class="linenos">786</span></a><span class="sd">        Viscosity parameter per element, shape (N,).</span>
</span><span id="Viscoelastic-787"><a href="#Viscoelastic-787"><span class="linenos">787</span></a><span class="sd">    E : torch.Tensor</span>
</span><span id="Viscoelastic-788"><a href="#Viscoelastic-788"><span class="linenos">788</span></a><span class="sd">        Young&#39;s modulus per element, shape (N,).</span>
</span><span id="Viscoelastic-789"><a href="#Viscoelastic-789"><span class="linenos">789</span></a><span class="sd">    nu : torch.Tensor</span>
</span><span id="Viscoelastic-790"><a href="#Viscoelastic-790"><span class="linenos">790</span></a><span class="sd">        Poisson&#39;s ratio per element, shape (N,).</span>
</span><span id="Viscoelastic-791"><a href="#Viscoelastic-791"><span class="linenos">791</span></a><span class="sd">    name : str, optional</span>
</span><span id="Viscoelastic-792"><a href="#Viscoelastic-792"><span class="linenos">792</span></a><span class="sd">        Element name, by default &quot;kelvin_voigt&quot;.</span>
</span><span id="Viscoelastic-793"><a href="#Viscoelastic-793"><span class="linenos">793</span></a>
</span><span id="Viscoelastic-794"><a href="#Viscoelastic-794"><span class="linenos">794</span></a><span class="sd">    Attributes</span>
</span><span id="Viscoelastic-795"><a href="#Viscoelastic-795"><span class="linenos">795</span></a><span class="sd">    ----------</span>
</span><span id="Viscoelastic-796"><a href="#Viscoelastic-796"><span class="linenos">796</span></a><span class="sd">    C1 : torch.Tensor</span>
</span><span id="Viscoelastic-797"><a href="#Viscoelastic-797"><span class="linenos">797</span></a><span class="sd">        Elastic stiffness in Voigt form, shape (N, 6, 6).</span>
</span><span id="Viscoelastic-798"><a href="#Viscoelastic-798"><span class="linenos">798</span></a><span class="sd">    eta, E, nu : torch.Tensor</span>
</span><span id="Viscoelastic-799"><a href="#Viscoelastic-799"><span class="linenos">799</span></a><span class="sd">        Material parameters, shape (N,).</span>
</span><span id="Viscoelastic-800"><a href="#Viscoelastic-800"><span class="linenos">800</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Viscoelastic-801"><a href="#Viscoelastic-801"><span class="linenos">801</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eta</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">E</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">nu</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="s2">&quot;kelvin_voigt&quot;</span><span class="p">):</span>
</span><span id="Viscoelastic-802"><a href="#Viscoelastic-802"><span class="linenos">802</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Viscoelastic-803"><a href="#Viscoelastic-803"><span class="linenos">803</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
</span><span id="Viscoelastic-804"><a href="#Viscoelastic-804"><span class="linenos">804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="Viscoelastic-805"><a href="#Viscoelastic-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
</span><span id="Viscoelastic-806"><a href="#Viscoelastic-806"><span class="linenos">806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Viscoelastic-807"><a href="#Viscoelastic-807"><span class="linenos">807</span></a>
</span><span id="Viscoelastic-808"><a href="#Viscoelastic-808"><span class="linenos">808</span></a>        <span class="c1"># Assemble C1 tensor (n_elems, 6, 6)</span>
</span><span id="Viscoelastic-809"><a href="#Viscoelastic-809"><span class="linenos">809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Viscoelastic-810"><a href="#Viscoelastic-810"><span class="linenos">810</span></a>        <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>
</span><span id="Viscoelastic-811"><a href="#Viscoelastic-811"><span class="linenos">811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic-812"><a href="#Viscoelastic-812"><span class="linenos">812</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic-813"><a href="#Viscoelastic-813"><span class="linenos">813</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic-814"><a href="#Viscoelastic-814"><span class="linenos">814</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic-815"><a href="#Viscoelastic-815"><span class="linenos">815</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic-816"><a href="#Viscoelastic-816"><span class="linenos">816</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic-817"><a href="#Viscoelastic-817"><span class="linenos">817</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
</span><span id="Viscoelastic-818"><a href="#Viscoelastic-818"><span class="linenos">818</span></a>
</span><span id="Viscoelastic-819"><a href="#Viscoelastic-819"><span class="linenos">819</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_vec</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Viscoelastic-820"><a href="#Viscoelastic-820"><span class="linenos">820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Viscoelastic-821"><a href="#Viscoelastic-821"><span class="linenos">821</span></a><span class="sd">        Compute viscoelastic strain rate (KelvinVoigt form).</span>
</span><span id="Viscoelastic-822"><a href="#Viscoelastic-822"><span class="linenos">822</span></a>
</span><span id="Viscoelastic-823"><a href="#Viscoelastic-823"><span class="linenos">823</span></a><span class="sd">        Parameters</span>
</span><span id="Viscoelastic-824"><a href="#Viscoelastic-824"><span class="linenos">824</span></a><span class="sd">        ----------</span>
</span><span id="Viscoelastic-825"><a href="#Viscoelastic-825"><span class="linenos">825</span></a><span class="sd">        stress_vec : torch.Tensor</span>
</span><span id="Viscoelastic-826"><a href="#Viscoelastic-826"><span class="linenos">826</span></a><span class="sd">            Stress tensor per element, shape (N, 3, 3).</span>
</span><span id="Viscoelastic-827"><a href="#Viscoelastic-827"><span class="linenos">827</span></a><span class="sd">        phi1 : float</span>
</span><span id="Viscoelastic-828"><a href="#Viscoelastic-828"><span class="linenos">828</span></a><span class="sd">            Time integration factor (dt*theta).</span>
</span><span id="Viscoelastic-829"><a href="#Viscoelastic-829"><span class="linenos">829</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="Viscoelastic-830"><a href="#Viscoelastic-830"><span class="linenos">830</span></a><span class="sd">            Temperature per element (unused here).</span>
</span><span id="Viscoelastic-831"><a href="#Viscoelastic-831"><span class="linenos">831</span></a><span class="sd">        return_eps_ne : bool, default=False</span>
</span><span id="Viscoelastic-832"><a href="#Viscoelastic-832"><span class="linenos">832</span></a><span class="sd">            If True, return the rate; else store it.</span>
</span><span id="Viscoelastic-833"><a href="#Viscoelastic-833"><span class="linenos">833</span></a>
</span><span id="Viscoelastic-834"><a href="#Viscoelastic-834"><span class="linenos">834</span></a><span class="sd">        Returns</span>
</span><span id="Viscoelastic-835"><a href="#Viscoelastic-835"><span class="linenos">835</span></a><span class="sd">        -------</span>
</span><span id="Viscoelastic-836"><a href="#Viscoelastic-836"><span class="linenos">836</span></a><span class="sd">        None or torch.Tensor</span>
</span><span id="Viscoelastic-837"><a href="#Viscoelastic-837"><span class="linenos">837</span></a><span class="sd">            (N, 3, 3) if `return_eps_ne=True`, else `None`.</span>
</span><span id="Viscoelastic-838"><a href="#Viscoelastic-838"><span class="linenos">838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Viscoelastic-839"><a href="#Viscoelastic-839"><span class="linenos">839</span></a>        <span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">stress_vec</span> <span class="o">-</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">+</span> <span class="n">phi1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span><span class="p">))</span>
</span><span id="Viscoelastic-840"><a href="#Viscoelastic-840"><span class="linenos">840</span></a>        <span class="k">if</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="Viscoelastic-841"><a href="#Viscoelastic-841"><span class="linenos">841</span></a>        	<span class="k">return</span> <span class="n">eps_ne_rate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Viscoelastic-842"><a href="#Viscoelastic-842"><span class="linenos">842</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Viscoelastic-843"><a href="#Viscoelastic-843"><span class="linenos">843</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">eps_ne_rate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Viscoelastic-844"><a href="#Viscoelastic-844"><span class="linenos">844</span></a>
</span><span id="Viscoelastic-845"><a href="#Viscoelastic-845"><span class="linenos">845</span></a>    <span class="k">def</span> <span class="nf">compute_E</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="Viscoelastic-846"><a href="#Viscoelastic-846"><span class="linenos">846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Viscoelastic-847"><a href="#Viscoelastic-847"><span class="linenos">847</span></a><span class="sd">        Closed-form 66 operator for viscoelasticity:</span>
</span><span id="Viscoelastic-848"><a href="#Viscoelastic-848"><span class="linenos">848</span></a><span class="sd">        `E = (eta*I + phi2*C1)^{-1}`.</span>
</span><span id="Viscoelastic-849"><a href="#Viscoelastic-849"><span class="linenos">849</span></a>
</span><span id="Viscoelastic-850"><a href="#Viscoelastic-850"><span class="linenos">850</span></a><span class="sd">        Parameters</span>
</span><span id="Viscoelastic-851"><a href="#Viscoelastic-851"><span class="linenos">851</span></a><span class="sd">        ----------</span>
</span><span id="Viscoelastic-852"><a href="#Viscoelastic-852"><span class="linenos">852</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Viscoelastic-853"><a href="#Viscoelastic-853"><span class="linenos">853</span></a><span class="sd">            Stress per element, shape (N, 3, 3). (Unused here.)</span>
</span><span id="Viscoelastic-854"><a href="#Viscoelastic-854"><span class="linenos">854</span></a><span class="sd">        dt : float</span>
</span><span id="Viscoelastic-855"><a href="#Viscoelastic-855"><span class="linenos">855</span></a><span class="sd">            Time step.</span>
</span><span id="Viscoelastic-856"><a href="#Viscoelastic-856"><span class="linenos">856</span></a><span class="sd">        theta : float</span>
</span><span id="Viscoelastic-857"><a href="#Viscoelastic-857"><span class="linenos">857</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="Viscoelastic-858"><a href="#Viscoelastic-858"><span class="linenos">858</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="Viscoelastic-859"><a href="#Viscoelastic-859"><span class="linenos">859</span></a><span class="sd">            Temperature per element (unused).</span>
</span><span id="Viscoelastic-860"><a href="#Viscoelastic-860"><span class="linenos">860</span></a>
</span><span id="Viscoelastic-861"><a href="#Viscoelastic-861"><span class="linenos">861</span></a><span class="sd">        Returns</span>
</span><span id="Viscoelastic-862"><a href="#Viscoelastic-862"><span class="linenos">862</span></a><span class="sd">        -------</span>
</span><span id="Viscoelastic-863"><a href="#Viscoelastic-863"><span class="linenos">863</span></a><span class="sd">        torch.Tensor</span>
</span><span id="Viscoelastic-864"><a href="#Viscoelastic-864"><span class="linenos">864</span></a><span class="sd">            `E` with shape (N, 6, 6).</span>
</span><span id="Viscoelastic-865"><a href="#Viscoelastic-865"><span class="linenos">865</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Viscoelastic-866"><a href="#Viscoelastic-866"><span class="linenos">866</span></a>        <span class="n">phi2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="Viscoelastic-867"><a href="#Viscoelastic-867"><span class="linenos">867</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Viscoelastic-868"><a href="#Viscoelastic-868"><span class="linenos">868</span></a>        <span class="n">E</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">I</span> <span class="o">+</span> <span class="n">phi2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">)</span>
</span><span id="Viscoelastic-869"><a href="#Viscoelastic-869"><span class="linenos">869</span></a>        <span class="k">return</span> <span class="n">E</span>
</span></pre></div>


            <div class="docstring"><p>KelvinVoigt-type viscoelastic element.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eta</strong> (torch.Tensor):
Viscosity parameter per element, shape (N,).</li>
<li><strong>E</strong> (torch.Tensor):
Young's modulus per element, shape (N,).</li>
<li><strong>nu</strong> (torch.Tensor):
Poisson's ratio per element, shape (N,).</li>
<li><strong>name</strong> (str, optional):
Element name, by default "kelvin_voigt".</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>C1</strong> (torch.Tensor):
Elastic stiffness in Voigt form, shape (N, 6, 6).</li>
<li><strong>eta, E, nu</strong> (torch.Tensor):
Material parameters, shape (N,).</li>
</ul>
</div>


                            <div id="Viscoelastic.__init__" class="classattr">
                                        <input id="Viscoelastic.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Viscoelastic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">eta</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">E</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">nu</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="s1">&#39;kelvin_voigt&#39;</span></span>)</span>

                <label class="view-source-button" for="Viscoelastic.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Viscoelastic.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Viscoelastic.__init__-801"><a href="#Viscoelastic.__init__-801"><span class="linenos">801</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eta</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">E</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">nu</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="s2">&quot;kelvin_voigt&quot;</span><span class="p">):</span>
</span><span id="Viscoelastic.__init__-802"><a href="#Viscoelastic.__init__-802"><span class="linenos">802</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Viscoelastic.__init__-803"><a href="#Viscoelastic.__init__-803"><span class="linenos">803</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
</span><span id="Viscoelastic.__init__-804"><a href="#Viscoelastic.__init__-804"><span class="linenos">804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="Viscoelastic.__init__-805"><a href="#Viscoelastic.__init__-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
</span><span id="Viscoelastic.__init__-806"><a href="#Viscoelastic.__init__-806"><span class="linenos">806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Viscoelastic.__init__-807"><a href="#Viscoelastic.__init__-807"><span class="linenos">807</span></a>
</span><span id="Viscoelastic.__init__-808"><a href="#Viscoelastic.__init__-808"><span class="linenos">808</span></a>        <span class="c1"># Assemble C1 tensor (n_elems, 6, 6)</span>
</span><span id="Viscoelastic.__init__-809"><a href="#Viscoelastic.__init__-809"><span class="linenos">809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-810"><a href="#Viscoelastic.__init__-810"><span class="linenos">810</span></a>        <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>
</span><span id="Viscoelastic.__init__-811"><a href="#Viscoelastic.__init__-811"><span class="linenos">811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-812"><a href="#Viscoelastic.__init__-812"><span class="linenos">812</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-813"><a href="#Viscoelastic.__init__-813"><span class="linenos">813</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-814"><a href="#Viscoelastic.__init__-814"><span class="linenos">814</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-815"><a href="#Viscoelastic.__init__-815"><span class="linenos">815</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-816"><a href="#Viscoelastic.__init__-816"><span class="linenos">816</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
</span><span id="Viscoelastic.__init__-817"><a href="#Viscoelastic.__init__-817"><span class="linenos">817</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
</span></pre></div>


    

                            </div>
                            <div id="Viscoelastic.eta" class="classattr">
                                <div class="attr variable">
            <span class="name">eta</span>

        
    </div>
    <a class="headerlink" href="#Viscoelastic.eta"></a>
    
    

                            </div>
                            <div id="Viscoelastic.E" class="classattr">
                                <div class="attr variable">
            <span class="name">E</span>

        
    </div>
    <a class="headerlink" href="#Viscoelastic.E"></a>
    
    

                            </div>
                            <div id="Viscoelastic.nu" class="classattr">
                                <div class="attr variable">
            <span class="name">nu</span>

        
    </div>
    <a class="headerlink" href="#Viscoelastic.nu"></a>
    
    

                            </div>
                            <div id="Viscoelastic.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#Viscoelastic.name"></a>
    
    

                            </div>
                            <div id="Viscoelastic.C1" class="classattr">
                                <div class="attr variable">
            <span class="name">C1</span>

        
    </div>
    <a class="headerlink" href="#Viscoelastic.C1"></a>
    
    

                            </div>
                            <div id="Viscoelastic.compute_eps_ne_rate" class="classattr">
                                        <input id="Viscoelastic.compute_eps_ne_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_ne_rate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress_vec</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Viscoelastic.compute_eps_ne_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Viscoelastic.compute_eps_ne_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Viscoelastic.compute_eps_ne_rate-819"><a href="#Viscoelastic.compute_eps_ne_rate-819"><span class="linenos">819</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_vec</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-820"><a href="#Viscoelastic.compute_eps_ne_rate-820"><span class="linenos">820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-821"><a href="#Viscoelastic.compute_eps_ne_rate-821"><span class="linenos">821</span></a><span class="sd">        Compute viscoelastic strain rate (KelvinVoigt form).</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-822"><a href="#Viscoelastic.compute_eps_ne_rate-822"><span class="linenos">822</span></a>
</span><span id="Viscoelastic.compute_eps_ne_rate-823"><a href="#Viscoelastic.compute_eps_ne_rate-823"><span class="linenos">823</span></a><span class="sd">        Parameters</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-824"><a href="#Viscoelastic.compute_eps_ne_rate-824"><span class="linenos">824</span></a><span class="sd">        ----------</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-825"><a href="#Viscoelastic.compute_eps_ne_rate-825"><span class="linenos">825</span></a><span class="sd">        stress_vec : torch.Tensor</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-826"><a href="#Viscoelastic.compute_eps_ne_rate-826"><span class="linenos">826</span></a><span class="sd">            Stress tensor per element, shape (N, 3, 3).</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-827"><a href="#Viscoelastic.compute_eps_ne_rate-827"><span class="linenos">827</span></a><span class="sd">        phi1 : float</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-828"><a href="#Viscoelastic.compute_eps_ne_rate-828"><span class="linenos">828</span></a><span class="sd">            Time integration factor (dt*theta).</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-829"><a href="#Viscoelastic.compute_eps_ne_rate-829"><span class="linenos">829</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-830"><a href="#Viscoelastic.compute_eps_ne_rate-830"><span class="linenos">830</span></a><span class="sd">            Temperature per element (unused here).</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-831"><a href="#Viscoelastic.compute_eps_ne_rate-831"><span class="linenos">831</span></a><span class="sd">        return_eps_ne : bool, default=False</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-832"><a href="#Viscoelastic.compute_eps_ne_rate-832"><span class="linenos">832</span></a><span class="sd">            If True, return the rate; else store it.</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-833"><a href="#Viscoelastic.compute_eps_ne_rate-833"><span class="linenos">833</span></a>
</span><span id="Viscoelastic.compute_eps_ne_rate-834"><a href="#Viscoelastic.compute_eps_ne_rate-834"><span class="linenos">834</span></a><span class="sd">        Returns</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-835"><a href="#Viscoelastic.compute_eps_ne_rate-835"><span class="linenos">835</span></a><span class="sd">        -------</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-836"><a href="#Viscoelastic.compute_eps_ne_rate-836"><span class="linenos">836</span></a><span class="sd">        None or torch.Tensor</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-837"><a href="#Viscoelastic.compute_eps_ne_rate-837"><span class="linenos">837</span></a><span class="sd">            (N, 3, 3) if `return_eps_ne=True`, else `None`.</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-838"><a href="#Viscoelastic.compute_eps_ne_rate-838"><span class="linenos">838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-839"><a href="#Viscoelastic.compute_eps_ne_rate-839"><span class="linenos">839</span></a>        <span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">stress_vec</span> <span class="o">-</span> <span class="n">dotdot_torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_old</span> <span class="o">+</span> <span class="n">phi1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate_old</span><span class="p">))</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-840"><a href="#Viscoelastic.compute_eps_ne_rate-840"><span class="linenos">840</span></a>        <span class="k">if</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-841"><a href="#Viscoelastic.compute_eps_ne_rate-841"><span class="linenos">841</span></a>        	<span class="k">return</span> <span class="n">eps_ne_rate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-842"><a href="#Viscoelastic.compute_eps_ne_rate-842"><span class="linenos">842</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Viscoelastic.compute_eps_ne_rate-843"><a href="#Viscoelastic.compute_eps_ne_rate-843"><span class="linenos">843</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">eps_ne_rate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Compute viscoelastic strain rate (KelvinVoigt form).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress_vec</strong> (torch.Tensor):
Stress tensor per element, shape (N, 3, 3).</li>
<li><strong>phi1</strong> (float):
Time integration factor (dt*theta).</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element (unused here).</li>
<li><strong>return_eps_ne</strong> (bool, default=False):
If True, return the rate; else store it.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None or torch.Tensor</strong>: (N, 3, 3) if <code>return_eps_ne=True</code>, else <code>None</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Viscoelastic.compute_E" class="classattr">
                                        <input id="Viscoelastic.compute_E-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_E</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="Viscoelastic.compute_E-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Viscoelastic.compute_E"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Viscoelastic.compute_E-845"><a href="#Viscoelastic.compute_E-845"><span class="linenos">845</span></a>    <span class="k">def</span> <span class="nf">compute_E</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="Viscoelastic.compute_E-846"><a href="#Viscoelastic.compute_E-846"><span class="linenos">846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Viscoelastic.compute_E-847"><a href="#Viscoelastic.compute_E-847"><span class="linenos">847</span></a><span class="sd">        Closed-form 66 operator for viscoelasticity:</span>
</span><span id="Viscoelastic.compute_E-848"><a href="#Viscoelastic.compute_E-848"><span class="linenos">848</span></a><span class="sd">        `E = (eta*I + phi2*C1)^{-1}`.</span>
</span><span id="Viscoelastic.compute_E-849"><a href="#Viscoelastic.compute_E-849"><span class="linenos">849</span></a>
</span><span id="Viscoelastic.compute_E-850"><a href="#Viscoelastic.compute_E-850"><span class="linenos">850</span></a><span class="sd">        Parameters</span>
</span><span id="Viscoelastic.compute_E-851"><a href="#Viscoelastic.compute_E-851"><span class="linenos">851</span></a><span class="sd">        ----------</span>
</span><span id="Viscoelastic.compute_E-852"><a href="#Viscoelastic.compute_E-852"><span class="linenos">852</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="Viscoelastic.compute_E-853"><a href="#Viscoelastic.compute_E-853"><span class="linenos">853</span></a><span class="sd">            Stress per element, shape (N, 3, 3). (Unused here.)</span>
</span><span id="Viscoelastic.compute_E-854"><a href="#Viscoelastic.compute_E-854"><span class="linenos">854</span></a><span class="sd">        dt : float</span>
</span><span id="Viscoelastic.compute_E-855"><a href="#Viscoelastic.compute_E-855"><span class="linenos">855</span></a><span class="sd">            Time step.</span>
</span><span id="Viscoelastic.compute_E-856"><a href="#Viscoelastic.compute_E-856"><span class="linenos">856</span></a><span class="sd">        theta : float</span>
</span><span id="Viscoelastic.compute_E-857"><a href="#Viscoelastic.compute_E-857"><span class="linenos">857</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="Viscoelastic.compute_E-858"><a href="#Viscoelastic.compute_E-858"><span class="linenos">858</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="Viscoelastic.compute_E-859"><a href="#Viscoelastic.compute_E-859"><span class="linenos">859</span></a><span class="sd">            Temperature per element (unused).</span>
</span><span id="Viscoelastic.compute_E-860"><a href="#Viscoelastic.compute_E-860"><span class="linenos">860</span></a>
</span><span id="Viscoelastic.compute_E-861"><a href="#Viscoelastic.compute_E-861"><span class="linenos">861</span></a><span class="sd">        Returns</span>
</span><span id="Viscoelastic.compute_E-862"><a href="#Viscoelastic.compute_E-862"><span class="linenos">862</span></a><span class="sd">        -------</span>
</span><span id="Viscoelastic.compute_E-863"><a href="#Viscoelastic.compute_E-863"><span class="linenos">863</span></a><span class="sd">        torch.Tensor</span>
</span><span id="Viscoelastic.compute_E-864"><a href="#Viscoelastic.compute_E-864"><span class="linenos">864</span></a><span class="sd">            `E` with shape (N, 6, 6).</span>
</span><span id="Viscoelastic.compute_E-865"><a href="#Viscoelastic.compute_E-865"><span class="linenos">865</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Viscoelastic.compute_E-866"><a href="#Viscoelastic.compute_E-866"><span class="linenos">866</span></a>        <span class="n">phi2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="Viscoelastic.compute_E-867"><a href="#Viscoelastic.compute_E-867"><span class="linenos">867</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Viscoelastic.compute_E-868"><a href="#Viscoelastic.compute_E-868"><span class="linenos">868</span></a>        <span class="n">E</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">I</span> <span class="o">+</span> <span class="n">phi2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">)</span>
</span><span id="Viscoelastic.compute_E-869"><a href="#Viscoelastic.compute_E-869"><span class="linenos">869</span></a>        <span class="k">return</span> <span class="n">E</span>
</span></pre></div>


            <div class="docstring"><p>Closed-form 66 operator for viscoelasticity:
<code>E = (eta*I + phi2*C1)^{-1}</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3). (Unused here.)</li>
<li><strong>dt</strong> (float):
Time step.</li>
<li><strong>theta</strong> (float):
Time integration parameter.</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element (unused).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: <code><a href="#Viscoelastic.E">E</a></code> with shape (N, 6, 6).</li>
</ul>
</div>


                            </div>
                </section>
                <section id="DislocationCreep">
                            <input id="DislocationCreep-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DislocationCreep</span><wbr>(<span class="base"><a href="#NonElasticElement">safeincave.NonElasticElement</a></span>):

                <label class="view-source-button" for="DislocationCreep-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DislocationCreep"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DislocationCreep-874"><a href="#DislocationCreep-874"><span class="linenos">874</span></a><span class="k">class</span> <span class="nc">DislocationCreep</span><span class="p">(</span><span class="n">NonElasticElement</span><span class="p">):</span>
</span><span id="DislocationCreep-875"><a href="#DislocationCreep-875"><span class="linenos">875</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DislocationCreep-876"><a href="#DislocationCreep-876"><span class="linenos">876</span></a><span class="sd">    Power-law dislocation creep: :math:`\\dot\\varepsilon_{ne}</span>
</span><span id="DislocationCreep-877"><a href="#DislocationCreep-877"><span class="linenos">877</span></a><span class="sd">    = A\\,\\exp(-Q/(RT))\\,\\q^{n-1}\\,\\mathbf{s}`.</span>
</span><span id="DislocationCreep-878"><a href="#DislocationCreep-878"><span class="linenos">878</span></a>
</span><span id="DislocationCreep-879"><a href="#DislocationCreep-879"><span class="linenos">879</span></a><span class="sd">    Parameters</span>
</span><span id="DislocationCreep-880"><a href="#DislocationCreep-880"><span class="linenos">880</span></a><span class="sd">    ----------</span>
</span><span id="DislocationCreep-881"><a href="#DislocationCreep-881"><span class="linenos">881</span></a><span class="sd">    A : torch.Tensor</span>
</span><span id="DislocationCreep-882"><a href="#DislocationCreep-882"><span class="linenos">882</span></a><span class="sd">        Pre-exponential factor per element, shape (N,).</span>
</span><span id="DislocationCreep-883"><a href="#DislocationCreep-883"><span class="linenos">883</span></a><span class="sd">    Q : torch.Tensor</span>
</span><span id="DislocationCreep-884"><a href="#DislocationCreep-884"><span class="linenos">884</span></a><span class="sd">        Activation energy per element, shape (N,).</span>
</span><span id="DislocationCreep-885"><a href="#DislocationCreep-885"><span class="linenos">885</span></a><span class="sd">    n : torch.Tensor</span>
</span><span id="DislocationCreep-886"><a href="#DislocationCreep-886"><span class="linenos">886</span></a><span class="sd">        Stress exponent per element, shape (N,).</span>
</span><span id="DislocationCreep-887"><a href="#DislocationCreep-887"><span class="linenos">887</span></a><span class="sd">    name : str, optional</span>
</span><span id="DislocationCreep-888"><a href="#DislocationCreep-888"><span class="linenos">888</span></a><span class="sd">        Element name, by default &quot;creep&quot;.</span>
</span><span id="DislocationCreep-889"><a href="#DislocationCreep-889"><span class="linenos">889</span></a>
</span><span id="DislocationCreep-890"><a href="#DislocationCreep-890"><span class="linenos">890</span></a><span class="sd">    Attributes</span>
</span><span id="DislocationCreep-891"><a href="#DislocationCreep-891"><span class="linenos">891</span></a><span class="sd">    ----------</span>
</span><span id="DislocationCreep-892"><a href="#DislocationCreep-892"><span class="linenos">892</span></a><span class="sd">    R : float</span>
</span><span id="DislocationCreep-893"><a href="#DislocationCreep-893"><span class="linenos">893</span></a><span class="sd">        Gas constant used (8.32).</span>
</span><span id="DislocationCreep-894"><a href="#DislocationCreep-894"><span class="linenos">894</span></a><span class="sd">    A, Q, n : torch.Tensor</span>
</span><span id="DislocationCreep-895"><a href="#DislocationCreep-895"><span class="linenos">895</span></a><span class="sd">        Material parameters, shape (N,).</span>
</span><span id="DislocationCreep-896"><a href="#DislocationCreep-896"><span class="linenos">896</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DislocationCreep-897"><a href="#DislocationCreep-897"><span class="linenos">897</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="s2">&quot;creep&quot;</span><span class="p">):</span>
</span><span id="DislocationCreep-898"><a href="#DislocationCreep-898"><span class="linenos">898</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DislocationCreep-899"><a href="#DislocationCreep-899"><span class="linenos">899</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="mf">8.32</span>
</span><span id="DislocationCreep-900"><a href="#DislocationCreep-900"><span class="linenos">900</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span>
</span><span id="DislocationCreep-901"><a href="#DislocationCreep-901"><span class="linenos">901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>
</span><span id="DislocationCreep-902"><a href="#DislocationCreep-902"><span class="linenos">902</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="DislocationCreep-903"><a href="#DislocationCreep-903"><span class="linenos">903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="DislocationCreep-904"><a href="#DislocationCreep-904"><span class="linenos">904</span></a>
</span><span id="DislocationCreep-905"><a href="#DislocationCreep-905"><span class="linenos">905</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_vec</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DislocationCreep-906"><a href="#DislocationCreep-906"><span class="linenos">906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DislocationCreep-907"><a href="#DislocationCreep-907"><span class="linenos">907</span></a><span class="sd">        Compute creep strain rate from current stress.</span>
</span><span id="DislocationCreep-908"><a href="#DislocationCreep-908"><span class="linenos">908</span></a>
</span><span id="DislocationCreep-909"><a href="#DislocationCreep-909"><span class="linenos">909</span></a><span class="sd">        Parameters</span>
</span><span id="DislocationCreep-910"><a href="#DislocationCreep-910"><span class="linenos">910</span></a><span class="sd">        ----------</span>
</span><span id="DislocationCreep-911"><a href="#DislocationCreep-911"><span class="linenos">911</span></a><span class="sd">        stress_vec : torch.Tensor</span>
</span><span id="DislocationCreep-912"><a href="#DislocationCreep-912"><span class="linenos">912</span></a><span class="sd">            Stress tensor per element, shape (N, 3, 3).</span>
</span><span id="DislocationCreep-913"><a href="#DislocationCreep-913"><span class="linenos">913</span></a><span class="sd">        phi1 : float</span>
</span><span id="DislocationCreep-914"><a href="#DislocationCreep-914"><span class="linenos">914</span></a><span class="sd">            Time integration factor (unused here).</span>
</span><span id="DislocationCreep-915"><a href="#DislocationCreep-915"><span class="linenos">915</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="DislocationCreep-916"><a href="#DislocationCreep-916"><span class="linenos">916</span></a><span class="sd">            Temperature per element (N,) or broadcastable.</span>
</span><span id="DislocationCreep-917"><a href="#DislocationCreep-917"><span class="linenos">917</span></a><span class="sd">        return_eps_ne : bool, default=False</span>
</span><span id="DislocationCreep-918"><a href="#DislocationCreep-918"><span class="linenos">918</span></a><span class="sd">            If True, return the rate; else store it.</span>
</span><span id="DislocationCreep-919"><a href="#DislocationCreep-919"><span class="linenos">919</span></a>
</span><span id="DislocationCreep-920"><a href="#DislocationCreep-920"><span class="linenos">920</span></a><span class="sd">        Returns</span>
</span><span id="DislocationCreep-921"><a href="#DislocationCreep-921"><span class="linenos">921</span></a><span class="sd">        -------</span>
</span><span id="DislocationCreep-922"><a href="#DislocationCreep-922"><span class="linenos">922</span></a><span class="sd">        None or torch.Tensor</span>
</span><span id="DislocationCreep-923"><a href="#DislocationCreep-923"><span class="linenos">923</span></a><span class="sd">            (N, 3, 3) if `return_eps_ne=True`, else `None`.</span>
</span><span id="DislocationCreep-924"><a href="#DislocationCreep-924"><span class="linenos">924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DislocationCreep-925"><a href="#DislocationCreep-925"><span class="linenos">925</span></a>        <span class="n">s_xx</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DislocationCreep-926"><a href="#DislocationCreep-926"><span class="linenos">926</span></a>        <span class="n">s_yy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DislocationCreep-927"><a href="#DislocationCreep-927"><span class="linenos">927</span></a>        <span class="n">s_zz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DislocationCreep-928"><a href="#DislocationCreep-928"><span class="linenos">928</span></a>        <span class="n">s_xy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DislocationCreep-929"><a href="#DislocationCreep-929"><span class="linenos">929</span></a>        <span class="n">s_xz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DislocationCreep-930"><a href="#DislocationCreep-930"><span class="linenos">930</span></a>        <span class="n">s_yz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DislocationCreep-931"><a href="#DislocationCreep-931"><span class="linenos">931</span></a>
</span><span id="DislocationCreep-932"><a href="#DislocationCreep-932"><span class="linenos">932</span></a>        <span class="n">sigma_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_zz</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="DislocationCreep-933"><a href="#DislocationCreep-933"><span class="linenos">933</span></a>        <span class="n">dev</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="DislocationCreep-934"><a href="#DislocationCreep-934"><span class="linenos">934</span></a>        <span class="n">dev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">-</span> <span class="n">sigma_mean</span>
</span><span id="DislocationCreep-935"><a href="#DislocationCreep-935"><span class="linenos">935</span></a>        <span class="n">dev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_yy</span> <span class="o">-</span> <span class="n">sigma_mean</span>
</span><span id="DislocationCreep-936"><a href="#DislocationCreep-936"><span class="linenos">936</span></a>        <span class="n">dev</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_zz</span> <span class="o">-</span> <span class="n">sigma_mean</span>
</span><span id="DislocationCreep-937"><a href="#DislocationCreep-937"><span class="linenos">937</span></a>
</span><span id="DislocationCreep-938"><a href="#DislocationCreep-938"><span class="linenos">938</span></a>        <span class="n">q_vm</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">s_xx</span> <span class="o">-</span> <span class="n">s_yy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_xx</span> <span class="o">-</span> <span class="n">s_zz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_yy</span> <span class="o">-</span> <span class="n">s_zz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="DislocationCreep-939"><a href="#DislocationCreep-939"><span class="linenos">939</span></a>
</span><span id="DislocationCreep-940"><a href="#DislocationCreep-940"><span class="linenos">940</span></a>        <span class="n">A_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">*</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">Temp</span><span class="p">)</span><span class="o">*</span><span class="n">q_vm</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DislocationCreep-941"><a href="#DislocationCreep-941"><span class="linenos">941</span></a>        <span class="n">eps_rate</span> <span class="o">=</span> <span class="n">A_bar</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">dev</span>
</span><span id="DislocationCreep-942"><a href="#DislocationCreep-942"><span class="linenos">942</span></a>        <span class="k">if</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="DislocationCreep-943"><a href="#DislocationCreep-943"><span class="linenos">943</span></a>        	<span class="k">return</span> <span class="n">eps_rate</span>
</span><span id="DislocationCreep-944"><a href="#DislocationCreep-944"><span class="linenos">944</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DislocationCreep-945"><a href="#DislocationCreep-945"><span class="linenos">945</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">eps_rate</span>
</span></pre></div>


            <div class="docstring"><p>Power-law dislocation creep: :math:<code>\dot\varepsilon_{ne}
= A\,\exp(-Q/(RT))\,\q^{n-1}\,\mathbf{s}</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>A</strong> (torch.Tensor):
Pre-exponential factor per element, shape (N,).</li>
<li><strong>Q</strong> (torch.Tensor):
Activation energy per element, shape (N,).</li>
<li><strong>n</strong> (torch.Tensor):
Stress exponent per element, shape (N,).</li>
<li><strong>name</strong> (str, optional):
Element name, by default "creep".</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>R</strong> (float):
Gas constant used (8.32).</li>
<li><strong>A, Q, n</strong> (torch.Tensor):
Material parameters, shape (N,).</li>
</ul>
</div>


                            <div id="DislocationCreep.__init__" class="classattr">
                                        <input id="DislocationCreep.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DislocationCreep</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">A</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">Q</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="s1">&#39;creep&#39;</span></span>)</span>

                <label class="view-source-button" for="DislocationCreep.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DislocationCreep.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DislocationCreep.__init__-897"><a href="#DislocationCreep.__init__-897"><span class="linenos">897</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="s2">&quot;creep&quot;</span><span class="p">):</span>
</span><span id="DislocationCreep.__init__-898"><a href="#DislocationCreep.__init__-898"><span class="linenos">898</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DislocationCreep.__init__-899"><a href="#DislocationCreep.__init__-899"><span class="linenos">899</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="mf">8.32</span>
</span><span id="DislocationCreep.__init__-900"><a href="#DislocationCreep.__init__-900"><span class="linenos">900</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span>
</span><span id="DislocationCreep.__init__-901"><a href="#DislocationCreep.__init__-901"><span class="linenos">901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>
</span><span id="DislocationCreep.__init__-902"><a href="#DislocationCreep.__init__-902"><span class="linenos">902</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="DislocationCreep.__init__-903"><a href="#DislocationCreep.__init__-903"><span class="linenos">903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></pre></div>


    

                            </div>
                            <div id="DislocationCreep.R" class="classattr">
                                <div class="attr variable">
            <span class="name">R</span>

        
    </div>
    <a class="headerlink" href="#DislocationCreep.R"></a>
    
    

                            </div>
                            <div id="DislocationCreep.Q" class="classattr">
                                <div class="attr variable">
            <span class="name">Q</span>

        
    </div>
    <a class="headerlink" href="#DislocationCreep.Q"></a>
    
    

                            </div>
                            <div id="DislocationCreep.A" class="classattr">
                                <div class="attr variable">
            <span class="name">A</span>

        
    </div>
    <a class="headerlink" href="#DislocationCreep.A"></a>
    
    

                            </div>
                            <div id="DislocationCreep.n" class="classattr">
                                <div class="attr variable">
            <span class="name">n</span>

        
    </div>
    <a class="headerlink" href="#DislocationCreep.n"></a>
    
    

                            </div>
                            <div id="DislocationCreep.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#DislocationCreep.name"></a>
    
    

                            </div>
                            <div id="DislocationCreep.compute_eps_ne_rate" class="classattr">
                                        <input id="DislocationCreep.compute_eps_ne_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_ne_rate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress_vec</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DislocationCreep.compute_eps_ne_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DislocationCreep.compute_eps_ne_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DislocationCreep.compute_eps_ne_rate-905"><a href="#DislocationCreep.compute_eps_ne_rate-905"><span class="linenos">905</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress_vec</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-906"><a href="#DislocationCreep.compute_eps_ne_rate-906"><span class="linenos">906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-907"><a href="#DislocationCreep.compute_eps_ne_rate-907"><span class="linenos">907</span></a><span class="sd">        Compute creep strain rate from current stress.</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-908"><a href="#DislocationCreep.compute_eps_ne_rate-908"><span class="linenos">908</span></a>
</span><span id="DislocationCreep.compute_eps_ne_rate-909"><a href="#DislocationCreep.compute_eps_ne_rate-909"><span class="linenos">909</span></a><span class="sd">        Parameters</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-910"><a href="#DislocationCreep.compute_eps_ne_rate-910"><span class="linenos">910</span></a><span class="sd">        ----------</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-911"><a href="#DislocationCreep.compute_eps_ne_rate-911"><span class="linenos">911</span></a><span class="sd">        stress_vec : torch.Tensor</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-912"><a href="#DislocationCreep.compute_eps_ne_rate-912"><span class="linenos">912</span></a><span class="sd">            Stress tensor per element, shape (N, 3, 3).</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-913"><a href="#DislocationCreep.compute_eps_ne_rate-913"><span class="linenos">913</span></a><span class="sd">        phi1 : float</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-914"><a href="#DislocationCreep.compute_eps_ne_rate-914"><span class="linenos">914</span></a><span class="sd">            Time integration factor (unused here).</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-915"><a href="#DislocationCreep.compute_eps_ne_rate-915"><span class="linenos">915</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-916"><a href="#DislocationCreep.compute_eps_ne_rate-916"><span class="linenos">916</span></a><span class="sd">            Temperature per element (N,) or broadcastable.</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-917"><a href="#DislocationCreep.compute_eps_ne_rate-917"><span class="linenos">917</span></a><span class="sd">        return_eps_ne : bool, default=False</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-918"><a href="#DislocationCreep.compute_eps_ne_rate-918"><span class="linenos">918</span></a><span class="sd">            If True, return the rate; else store it.</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-919"><a href="#DislocationCreep.compute_eps_ne_rate-919"><span class="linenos">919</span></a>
</span><span id="DislocationCreep.compute_eps_ne_rate-920"><a href="#DislocationCreep.compute_eps_ne_rate-920"><span class="linenos">920</span></a><span class="sd">        Returns</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-921"><a href="#DislocationCreep.compute_eps_ne_rate-921"><span class="linenos">921</span></a><span class="sd">        -------</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-922"><a href="#DislocationCreep.compute_eps_ne_rate-922"><span class="linenos">922</span></a><span class="sd">        None or torch.Tensor</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-923"><a href="#DislocationCreep.compute_eps_ne_rate-923"><span class="linenos">923</span></a><span class="sd">            (N, 3, 3) if `return_eps_ne=True`, else `None`.</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-924"><a href="#DislocationCreep.compute_eps_ne_rate-924"><span class="linenos">924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-925"><a href="#DislocationCreep.compute_eps_ne_rate-925"><span class="linenos">925</span></a>        <span class="n">s_xx</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-926"><a href="#DislocationCreep.compute_eps_ne_rate-926"><span class="linenos">926</span></a>        <span class="n">s_yy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-927"><a href="#DislocationCreep.compute_eps_ne_rate-927"><span class="linenos">927</span></a>        <span class="n">s_zz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-928"><a href="#DislocationCreep.compute_eps_ne_rate-928"><span class="linenos">928</span></a>        <span class="n">s_xy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-929"><a href="#DislocationCreep.compute_eps_ne_rate-929"><span class="linenos">929</span></a>        <span class="n">s_xz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-930"><a href="#DislocationCreep.compute_eps_ne_rate-930"><span class="linenos">930</span></a>        <span class="n">s_yz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-931"><a href="#DislocationCreep.compute_eps_ne_rate-931"><span class="linenos">931</span></a>
</span><span id="DislocationCreep.compute_eps_ne_rate-932"><a href="#DislocationCreep.compute_eps_ne_rate-932"><span class="linenos">932</span></a>        <span class="n">sigma_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_zz</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-933"><a href="#DislocationCreep.compute_eps_ne_rate-933"><span class="linenos">933</span></a>        <span class="n">dev</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-934"><a href="#DislocationCreep.compute_eps_ne_rate-934"><span class="linenos">934</span></a>        <span class="n">dev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">-</span> <span class="n">sigma_mean</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-935"><a href="#DislocationCreep.compute_eps_ne_rate-935"><span class="linenos">935</span></a>        <span class="n">dev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_yy</span> <span class="o">-</span> <span class="n">sigma_mean</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-936"><a href="#DislocationCreep.compute_eps_ne_rate-936"><span class="linenos">936</span></a>        <span class="n">dev</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_zz</span> <span class="o">-</span> <span class="n">sigma_mean</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-937"><a href="#DislocationCreep.compute_eps_ne_rate-937"><span class="linenos">937</span></a>
</span><span id="DislocationCreep.compute_eps_ne_rate-938"><a href="#DislocationCreep.compute_eps_ne_rate-938"><span class="linenos">938</span></a>        <span class="n">q_vm</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">s_xx</span> <span class="o">-</span> <span class="n">s_yy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_xx</span> <span class="o">-</span> <span class="n">s_zz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_yy</span> <span class="o">-</span> <span class="n">s_zz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-939"><a href="#DislocationCreep.compute_eps_ne_rate-939"><span class="linenos">939</span></a>
</span><span id="DislocationCreep.compute_eps_ne_rate-940"><a href="#DislocationCreep.compute_eps_ne_rate-940"><span class="linenos">940</span></a>        <span class="n">A_bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">*</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">/</span><span class="n">Temp</span><span class="p">)</span><span class="o">*</span><span class="n">q_vm</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-941"><a href="#DislocationCreep.compute_eps_ne_rate-941"><span class="linenos">941</span></a>        <span class="n">eps_rate</span> <span class="o">=</span> <span class="n">A_bar</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">dev</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-942"><a href="#DislocationCreep.compute_eps_ne_rate-942"><span class="linenos">942</span></a>        <span class="k">if</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-943"><a href="#DislocationCreep.compute_eps_ne_rate-943"><span class="linenos">943</span></a>        	<span class="k">return</span> <span class="n">eps_rate</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-944"><a href="#DislocationCreep.compute_eps_ne_rate-944"><span class="linenos">944</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DislocationCreep.compute_eps_ne_rate-945"><a href="#DislocationCreep.compute_eps_ne_rate-945"><span class="linenos">945</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">eps_rate</span>
</span></pre></div>


            <div class="docstring"><p>Compute creep strain rate from current stress.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress_vec</strong> (torch.Tensor):
Stress tensor per element, shape (N, 3, 3).</li>
<li><strong>phi1</strong> (float):
Time integration factor (unused here).</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element (N,) or broadcastable.</li>
<li><strong>return_eps_ne</strong> (bool, default=False):
If True, return the rate; else store it.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None or torch.Tensor</strong>: (N, 3, 3) if <code>return_eps_ne=True</code>, else <code>None</code>.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="ViscoplasticDesai">
                            <input id="ViscoplasticDesai-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ViscoplasticDesai</span><wbr>(<span class="base"><a href="#NonElasticElement">safeincave.NonElasticElement</a></span>):

                <label class="view-source-button" for="ViscoplasticDesai-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai-949"><a href="#ViscoplasticDesai-949"><span class="linenos"> 949</span></a><span class="k">class</span> <span class="nc">ViscoplasticDesai</span><span class="p">(</span><span class="n">NonElasticElement</span><span class="p">):</span>
</span><span id="ViscoplasticDesai-950"><a href="#ViscoplasticDesai-950"><span class="linenos"> 950</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-951"><a href="#ViscoplasticDesai-951"><span class="linenos"> 951</span></a><span class="sd">    Viscoplastic model of Desai-type with hardening (state) variable `alpha`.</span>
</span><span id="ViscoplasticDesai-952"><a href="#ViscoplasticDesai-952"><span class="linenos"> 952</span></a>
</span><span id="ViscoplasticDesai-953"><a href="#ViscoplasticDesai-953"><span class="linenos"> 953</span></a><span class="sd">    Parameters</span>
</span><span id="ViscoplasticDesai-954"><a href="#ViscoplasticDesai-954"><span class="linenos"> 954</span></a><span class="sd">    ----------</span>
</span><span id="ViscoplasticDesai-955"><a href="#ViscoplasticDesai-955"><span class="linenos"> 955</span></a><span class="sd">    mu_1, N_1, a_1, eta, n, beta_1, beta, m, gamma, sigma_t, alpha_0 : torch.Tensor</span>
</span><span id="ViscoplasticDesai-956"><a href="#ViscoplasticDesai-956"><span class="linenos"> 956</span></a><span class="sd">        Model parameters per element, shape (N,).</span>
</span><span id="ViscoplasticDesai-957"><a href="#ViscoplasticDesai-957"><span class="linenos"> 957</span></a><span class="sd">    name : str, optional</span>
</span><span id="ViscoplasticDesai-958"><a href="#ViscoplasticDesai-958"><span class="linenos"> 958</span></a><span class="sd">        Element name, by default &quot;desai&quot;.</span>
</span><span id="ViscoplasticDesai-959"><a href="#ViscoplasticDesai-959"><span class="linenos"> 959</span></a>
</span><span id="ViscoplasticDesai-960"><a href="#ViscoplasticDesai-960"><span class="linenos"> 960</span></a><span class="sd">    Attributes</span>
</span><span id="ViscoplasticDesai-961"><a href="#ViscoplasticDesai-961"><span class="linenos"> 961</span></a><span class="sd">    ----------</span>
</span><span id="ViscoplasticDesai-962"><a href="#ViscoplasticDesai-962"><span class="linenos"> 962</span></a><span class="sd">    alpha : torch.Tensor</span>
</span><span id="ViscoplasticDesai-963"><a href="#ViscoplasticDesai-963"><span class="linenos"> 963</span></a><span class="sd">        Current hardening variable per element, shape (N,).</span>
</span><span id="ViscoplasticDesai-964"><a href="#ViscoplasticDesai-964"><span class="linenos"> 964</span></a><span class="sd">    Fvp : torch.Tensor</span>
</span><span id="ViscoplasticDesai-965"><a href="#ViscoplasticDesai-965"><span class="linenos"> 965</span></a><span class="sd">        Current value of the yield function per element, shape (N,).</span>
</span><span id="ViscoplasticDesai-966"><a href="#ViscoplasticDesai-966"><span class="linenos"> 966</span></a><span class="sd">    qsi, qsi_old : torch.Tensor</span>
</span><span id="ViscoplasticDesai-967"><a href="#ViscoplasticDesai-967"><span class="linenos"> 967</span></a><span class="sd">        Accumulated viscoplastic strain measure and its previous value, shape (N,).</span>
</span><span id="ViscoplasticDesai-968"><a href="#ViscoplasticDesai-968"><span class="linenos"> 968</span></a><span class="sd">    P : torch.Tensor</span>
</span><span id="ViscoplasticDesai-969"><a href="#ViscoplasticDesai-969"><span class="linenos"> 969</span></a><span class="sd">        Sensitivity of the residue to stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-970"><a href="#ViscoplasticDesai-970"><span class="linenos"> 970</span></a><span class="sd">    r, h : torch.Tensor</span>
</span><span id="ViscoplasticDesai-971"><a href="#ViscoplasticDesai-971"><span class="linenos"> 971</span></a><span class="sd">        Residue and its derivative w.r.t. `alpha`, shapes (N,) and (N,).</span>
</span><span id="ViscoplasticDesai-972"><a href="#ViscoplasticDesai-972"><span class="linenos"> 972</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-973"><a href="#ViscoplasticDesai-973"><span class="linenos"> 973</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-974"><a href="#ViscoplasticDesai-974"><span class="linenos"> 974</span></a>						<span class="n">mu_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-975"><a href="#ViscoplasticDesai-975"><span class="linenos"> 975</span></a>						<span class="n">N_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-976"><a href="#ViscoplasticDesai-976"><span class="linenos"> 976</span></a>						<span class="n">a_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-977"><a href="#ViscoplasticDesai-977"><span class="linenos"> 977</span></a>						<span class="n">eta</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-978"><a href="#ViscoplasticDesai-978"><span class="linenos"> 978</span></a>						<span class="n">n</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-979"><a href="#ViscoplasticDesai-979"><span class="linenos"> 979</span></a>						<span class="n">beta_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-980"><a href="#ViscoplasticDesai-980"><span class="linenos"> 980</span></a>						<span class="n">beta</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-981"><a href="#ViscoplasticDesai-981"><span class="linenos"> 981</span></a>						<span class="n">m</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-982"><a href="#ViscoplasticDesai-982"><span class="linenos"> 982</span></a>						<span class="n">gamma</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-983"><a href="#ViscoplasticDesai-983"><span class="linenos"> 983</span></a>						<span class="n">sigma_t</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-984"><a href="#ViscoplasticDesai-984"><span class="linenos"> 984</span></a>						<span class="n">alpha_0</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-985"><a href="#ViscoplasticDesai-985"><span class="linenos"> 985</span></a>						<span class="n">name</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="s2">&quot;desai&quot;</span><span class="p">):</span>
</span><span id="ViscoplasticDesai-986"><a href="#ViscoplasticDesai-986"><span class="linenos"> 986</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mu_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ViscoplasticDesai-987"><a href="#ViscoplasticDesai-987"><span class="linenos"> 987</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="ViscoplasticDesai-988"><a href="#ViscoplasticDesai-988"><span class="linenos"> 988</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu_1</span> <span class="o">=</span> <span class="n">mu_1</span>
</span><span id="ViscoplasticDesai-989"><a href="#ViscoplasticDesai-989"><span class="linenos"> 989</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N_1</span> <span class="o">=</span> <span class="n">N_1</span>
</span><span id="ViscoplasticDesai-990"><a href="#ViscoplasticDesai-990"><span class="linenos"> 990</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a_1</span> <span class="o">=</span> <span class="n">a_1</span>
</span><span id="ViscoplasticDesai-991"><a href="#ViscoplasticDesai-991"><span class="linenos"> 991</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
</span><span id="ViscoplasticDesai-992"><a href="#ViscoplasticDesai-992"><span class="linenos"> 992</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="ViscoplasticDesai-993"><a href="#ViscoplasticDesai-993"><span class="linenos"> 993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span> <span class="o">=</span> <span class="n">beta_1</span>
</span><span id="ViscoplasticDesai-994"><a href="#ViscoplasticDesai-994"><span class="linenos"> 994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
</span><span id="ViscoplasticDesai-995"><a href="#ViscoplasticDesai-995"><span class="linenos"> 995</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
</span><span id="ViscoplasticDesai-996"><a href="#ViscoplasticDesai-996"><span class="linenos"> 996</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="ViscoplasticDesai-997"><a href="#ViscoplasticDesai-997"><span class="linenos"> 997</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_t</span> <span class="o">=</span> <span class="n">sigma_t</span>
</span><span id="ViscoplasticDesai-998"><a href="#ViscoplasticDesai-998"><span class="linenos"> 998</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span> <span class="o">=</span> <span class="n">alpha_0</span>
</span><span id="ViscoplasticDesai-999"><a href="#ViscoplasticDesai-999"><span class="linenos"> 999</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">F_0</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai-1000"><a href="#ViscoplasticDesai-1000"><span class="linenos">1000</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1001"><a href="#ViscoplasticDesai-1001"><span class="linenos">1001</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai-1002"><a href="#ViscoplasticDesai-1002"><span class="linenos">1002</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Fvp</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1003"><a href="#ViscoplasticDesai-1003"><span class="linenos">1003</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1004"><a href="#ViscoplasticDesai-1004"><span class="linenos">1004</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi_old</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1005"><a href="#ViscoplasticDesai-1005"><span class="linenos">1005</span></a>
</span><span id="ViscoplasticDesai-1006"><a href="#ViscoplasticDesai-1006"><span class="linenos">1006</span></a>    <span class="k">def</span> <span class="nf">compute_residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_rate</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1007"><a href="#ViscoplasticDesai-1007"><span class="linenos">1007</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1008"><a href="#ViscoplasticDesai-1008"><span class="linenos">1008</span></a><span class="sd">        Residue of the implicit hardening equation.</span>
</span><span id="ViscoplasticDesai-1009"><a href="#ViscoplasticDesai-1009"><span class="linenos">1009</span></a>
</span><span id="ViscoplasticDesai-1010"><a href="#ViscoplasticDesai-1010"><span class="linenos">1010</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1011"><a href="#ViscoplasticDesai-1011"><span class="linenos">1011</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1012"><a href="#ViscoplasticDesai-1012"><span class="linenos">1012</span></a><span class="sd">        eps_rate : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1013"><a href="#ViscoplasticDesai-1013"><span class="linenos">1013</span></a><span class="sd">            Current inelastic strain rate, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1014"><a href="#ViscoplasticDesai-1014"><span class="linenos">1014</span></a><span class="sd">        alpha : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1015"><a href="#ViscoplasticDesai-1015"><span class="linenos">1015</span></a><span class="sd">            Hardening variable, shape (N,).</span>
</span><span id="ViscoplasticDesai-1016"><a href="#ViscoplasticDesai-1016"><span class="linenos">1016</span></a><span class="sd">        dt : float</span>
</span><span id="ViscoplasticDesai-1017"><a href="#ViscoplasticDesai-1017"><span class="linenos">1017</span></a><span class="sd">            Time step.</span>
</span><span id="ViscoplasticDesai-1018"><a href="#ViscoplasticDesai-1018"><span class="linenos">1018</span></a>
</span><span id="ViscoplasticDesai-1019"><a href="#ViscoplasticDesai-1019"><span class="linenos">1019</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1020"><a href="#ViscoplasticDesai-1020"><span class="linenos">1020</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1021"><a href="#ViscoplasticDesai-1021"><span class="linenos">1021</span></a><span class="sd">        torch.Tensor</span>
</span><span id="ViscoplasticDesai-1022"><a href="#ViscoplasticDesai-1022"><span class="linenos">1022</span></a><span class="sd">            Residue per element, shape (N,).</span>
</span><span id="ViscoplasticDesai-1023"><a href="#ViscoplasticDesai-1023"><span class="linenos">1023</span></a>
</span><span id="ViscoplasticDesai-1024"><a href="#ViscoplasticDesai-1024"><span class="linenos">1024</span></a><span class="sd">        Notes</span>
</span><span id="ViscoplasticDesai-1025"><a href="#ViscoplasticDesai-1025"><span class="linenos">1025</span></a><span class="sd">        -----</span>
</span><span id="ViscoplasticDesai-1026"><a href="#ViscoplasticDesai-1026"><span class="linenos">1026</span></a><span class="sd">        Updates `self.qsi` internally based on `eps_rate`.</span>
</span><span id="ViscoplasticDesai-1027"><a href="#ViscoplasticDesai-1027"><span class="linenos">1027</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1028"><a href="#ViscoplasticDesai-1028"><span class="linenos">1028</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsi_old</span> <span class="o">+</span> <span class="n">to</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eps_rate</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span>
</span><span id="ViscoplasticDesai-1029"><a href="#ViscoplasticDesai-1029"><span class="linenos">1029</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_1</span> <span class="o">/</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">a_1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1030"><a href="#ViscoplasticDesai-1030"><span class="linenos">1030</span></a>
</span><span id="ViscoplasticDesai-1031"><a href="#ViscoplasticDesai-1031"><span class="linenos">1031</span></a>    <span class="k">def</span> <span class="nf">update_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1032"><a href="#ViscoplasticDesai-1032"><span class="linenos">1032</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1033"><a href="#ViscoplasticDesai-1033"><span class="linenos">1033</span></a><span class="sd">        Commit accumulated measure `qsi`.</span>
</span><span id="ViscoplasticDesai-1034"><a href="#ViscoplasticDesai-1034"><span class="linenos">1034</span></a>
</span><span id="ViscoplasticDesai-1035"><a href="#ViscoplasticDesai-1035"><span class="linenos">1035</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1036"><a href="#ViscoplasticDesai-1036"><span class="linenos">1036</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1037"><a href="#ViscoplasticDesai-1037"><span class="linenos">1037</span></a><span class="sd">        None</span>
</span><span id="ViscoplasticDesai-1038"><a href="#ViscoplasticDesai-1038"><span class="linenos">1038</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1039"><a href="#ViscoplasticDesai-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai-1040"><a href="#ViscoplasticDesai-1040"><span class="linenos">1040</span></a>
</span><span id="ViscoplasticDesai-1041"><a href="#ViscoplasticDesai-1041"><span class="linenos">1041</span></a>    <span class="k">def</span> <span class="nf">increment_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1042"><a href="#ViscoplasticDesai-1042"><span class="linenos">1042</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1043"><a href="#ViscoplasticDesai-1043"><span class="linenos">1043</span></a><span class="sd">        Increment hardening variable `alpha` using linearization.</span>
</span><span id="ViscoplasticDesai-1044"><a href="#ViscoplasticDesai-1044"><span class="linenos">1044</span></a>
</span><span id="ViscoplasticDesai-1045"><a href="#ViscoplasticDesai-1045"><span class="linenos">1045</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1046"><a href="#ViscoplasticDesai-1046"><span class="linenos">1046</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1047"><a href="#ViscoplasticDesai-1047"><span class="linenos">1047</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1048"><a href="#ViscoplasticDesai-1048"><span class="linenos">1048</span></a><span class="sd">            End-of-step stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1049"><a href="#ViscoplasticDesai-1049"><span class="linenos">1049</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1050"><a href="#ViscoplasticDesai-1050"><span class="linenos">1050</span></a><span class="sd">            Intermediate stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1051"><a href="#ViscoplasticDesai-1051"><span class="linenos">1051</span></a><span class="sd">        dt : float</span>
</span><span id="ViscoplasticDesai-1052"><a href="#ViscoplasticDesai-1052"><span class="linenos">1052</span></a><span class="sd">            Time step.</span>
</span><span id="ViscoplasticDesai-1053"><a href="#ViscoplasticDesai-1053"><span class="linenos">1053</span></a>
</span><span id="ViscoplasticDesai-1054"><a href="#ViscoplasticDesai-1054"><span class="linenos">1054</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1055"><a href="#ViscoplasticDesai-1055"><span class="linenos">1055</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1056"><a href="#ViscoplasticDesai-1056"><span class="linenos">1056</span></a><span class="sd">        None</span>
</span><span id="ViscoplasticDesai-1057"><a href="#ViscoplasticDesai-1057"><span class="linenos">1057</span></a>
</span><span id="ViscoplasticDesai-1058"><a href="#ViscoplasticDesai-1058"><span class="linenos">1058</span></a><span class="sd">        Side Effects</span>
</span><span id="ViscoplasticDesai-1059"><a href="#ViscoplasticDesai-1059"><span class="linenos">1059</span></a><span class="sd">        ------------</span>
</span><span id="ViscoplasticDesai-1060"><a href="#ViscoplasticDesai-1060"><span class="linenos">1060</span></a><span class="sd">        Updates `self.alpha`.</span>
</span><span id="ViscoplasticDesai-1061"><a href="#ViscoplasticDesai-1061"><span class="linenos">1061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1062"><a href="#ViscoplasticDesai-1062"><span class="linenos">1062</span></a>        <span class="n">delta_alpha</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bij,bij-&gt;b&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">stress</span> <span class="o">-</span> <span class="n">stress_k</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="ViscoplasticDesai-1063"><a href="#ViscoplasticDesai-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+=</span> <span class="n">delta_alpha</span>
</span><span id="ViscoplasticDesai-1064"><a href="#ViscoplasticDesai-1064"><span class="linenos">1064</span></a>
</span><span id="ViscoplasticDesai-1065"><a href="#ViscoplasticDesai-1065"><span class="linenos">1065</span></a>    <span class="k">def</span> <span class="nf">compute_stress_invariants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_xx</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-1066"><a href="#ViscoplasticDesai-1066"><span class="linenos">1066</span></a>										<span class="n">s_yy</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-1067"><a href="#ViscoplasticDesai-1067"><span class="linenos">1067</span></a>										<span class="n">s_zz</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-1068"><a href="#ViscoplasticDesai-1068"><span class="linenos">1068</span></a>										<span class="n">s_xy</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-1069"><a href="#ViscoplasticDesai-1069"><span class="linenos">1069</span></a>										<span class="n">s_xz</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai-1070"><a href="#ViscoplasticDesai-1070"><span class="linenos">1070</span></a>										<span class="n">s_yz</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ViscoplasticDesai-1071"><a href="#ViscoplasticDesai-1071"><span class="linenos">1071</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1072"><a href="#ViscoplasticDesai-1072"><span class="linenos">1072</span></a><span class="sd">        Compute invariants (I1, I2, I3, J2, J3) and auxiliary quantities.</span>
</span><span id="ViscoplasticDesai-1073"><a href="#ViscoplasticDesai-1073"><span class="linenos">1073</span></a>
</span><span id="ViscoplasticDesai-1074"><a href="#ViscoplasticDesai-1074"><span class="linenos">1074</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1075"><a href="#ViscoplasticDesai-1075"><span class="linenos">1075</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1076"><a href="#ViscoplasticDesai-1076"><span class="linenos">1076</span></a><span class="sd">        s_xx, s_yy, s_zz, s_xy, s_xz, s_yz : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1077"><a href="#ViscoplasticDesai-1077"><span class="linenos">1077</span></a><span class="sd">            Normal and shear components (MPa-scaled as provided), each shape (N,).</span>
</span><span id="ViscoplasticDesai-1078"><a href="#ViscoplasticDesai-1078"><span class="linenos">1078</span></a>
</span><span id="ViscoplasticDesai-1079"><a href="#ViscoplasticDesai-1079"><span class="linenos">1079</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1080"><a href="#ViscoplasticDesai-1080"><span class="linenos">1080</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1081"><a href="#ViscoplasticDesai-1081"><span class="linenos">1081</span></a><span class="sd">        I1, I2, I3, J2, J3, Sr, I1_star, ind_J2_leq_0 : tuple of torch.Tensor</span>
</span><span id="ViscoplasticDesai-1082"><a href="#ViscoplasticDesai-1082"><span class="linenos">1082</span></a><span class="sd">            Invariants and helper arrays; `ind_J2_leq_0` are indices where `J2 &lt;= 0`.</span>
</span><span id="ViscoplasticDesai-1083"><a href="#ViscoplasticDesai-1083"><span class="linenos">1083</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1084"><a href="#ViscoplasticDesai-1084"><span class="linenos">1084</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_zz</span>
</span><span id="ViscoplasticDesai-1085"><a href="#ViscoplasticDesai-1085"><span class="linenos">1085</span></a>        <span class="n">I2</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">+</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">-</span> <span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai-1086"><a href="#ViscoplasticDesai-1086"><span class="linenos">1086</span></a>        <span class="n">I3</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yy</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">s_xy</span><span class="o">*</span><span class="n">s_yz</span><span class="o">*</span><span class="n">s_xz</span> <span class="o">-</span> <span class="n">s_zz</span><span class="o">*</span><span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai-1087"><a href="#ViscoplasticDesai-1087"><span class="linenos">1087</span></a>        <span class="n">J2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">I2</span>
</span><span id="ViscoplasticDesai-1088"><a href="#ViscoplasticDesai-1088"><span class="linenos">1088</span></a>        <span class="n">J3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">27</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">*</span><span class="n">I2</span> <span class="o">+</span> <span class="n">I3</span>
</span><span id="ViscoplasticDesai-1089"><a href="#ViscoplasticDesai-1089"><span class="linenos">1089</span></a>        <span class="n">Sr</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">J3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">27</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J2</span><span class="o">**</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1090"><a href="#ViscoplasticDesai-1090"><span class="linenos">1090</span></a>
</span><span id="ViscoplasticDesai-1091"><a href="#ViscoplasticDesai-1091"><span class="linenos">1091</span></a>        <span class="c1"># Check where J2 &lt;= 0.0</span>
</span><span id="ViscoplasticDesai-1092"><a href="#ViscoplasticDesai-1092"><span class="linenos">1092</span></a>        <span class="n">ind_J2_leq_0</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">J2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1093"><a href="#ViscoplasticDesai-1093"><span class="linenos">1093</span></a>
</span><span id="ViscoplasticDesai-1094"><a href="#ViscoplasticDesai-1094"><span class="linenos">1094</span></a>        <span class="c1"># Sr will be nan if, J2=0.0. So, replace it by 0.0</span>
</span><span id="ViscoplasticDesai-1095"><a href="#ViscoplasticDesai-1095"><span class="linenos">1095</span></a>        <span class="n">Sr</span><span class="p">[</span><span class="n">ind_J2_leq_0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai-1096"><a href="#ViscoplasticDesai-1096"><span class="linenos">1096</span></a>
</span><span id="ViscoplasticDesai-1097"><a href="#ViscoplasticDesai-1097"><span class="linenos">1097</span></a>        <span class="n">I1_star</span> <span class="o">=</span> <span class="n">I1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_t</span>
</span><span id="ViscoplasticDesai-1098"><a href="#ViscoplasticDesai-1098"><span class="linenos">1098</span></a>        <span class="k">return</span> <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">ind_J2_leq_0</span>
</span><span id="ViscoplasticDesai-1099"><a href="#ViscoplasticDesai-1099"><span class="linenos">1099</span></a>
</span><span id="ViscoplasticDesai-1100"><a href="#ViscoplasticDesai-1100"><span class="linenos">1100</span></a>    <span class="k">def</span> <span class="nf">extract_stress_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1101"><a href="#ViscoplasticDesai-1101"><span class="linenos">1101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1102"><a href="#ViscoplasticDesai-1102"><span class="linenos">1102</span></a><span class="sd">        Extract and scale stress components from a 33 tensor.</span>
</span><span id="ViscoplasticDesai-1103"><a href="#ViscoplasticDesai-1103"><span class="linenos">1103</span></a>
</span><span id="ViscoplasticDesai-1104"><a href="#ViscoplasticDesai-1104"><span class="linenos">1104</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1105"><a href="#ViscoplasticDesai-1105"><span class="linenos">1105</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1106"><a href="#ViscoplasticDesai-1106"><span class="linenos">1106</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1107"><a href="#ViscoplasticDesai-1107"><span class="linenos">1107</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1108"><a href="#ViscoplasticDesai-1108"><span class="linenos">1108</span></a>
</span><span id="ViscoplasticDesai-1109"><a href="#ViscoplasticDesai-1109"><span class="linenos">1109</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1110"><a href="#ViscoplasticDesai-1110"><span class="linenos">1110</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1111"><a href="#ViscoplasticDesai-1111"><span class="linenos">1111</span></a><span class="sd">        tuple[torch.Tensor, ...]</span>
</span><span id="ViscoplasticDesai-1112"><a href="#ViscoplasticDesai-1112"><span class="linenos">1112</span></a><span class="sd">            `(s_xx, s_yy, s_zz, s_xy, s_xz, s_yz)`, each shape (N,).</span>
</span><span id="ViscoplasticDesai-1113"><a href="#ViscoplasticDesai-1113"><span class="linenos">1113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1114"><a href="#ViscoplasticDesai-1114"><span class="linenos">1114</span></a>        <span class="n">stress_vec</span> <span class="o">=</span> <span class="o">-</span><span class="n">stress</span>
</span><span id="ViscoplasticDesai-1115"><a href="#ViscoplasticDesai-1115"><span class="linenos">1115</span></a>        <span class="n">s_xx</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai-1116"><a href="#ViscoplasticDesai-1116"><span class="linenos">1116</span></a>        <span class="n">s_yy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai-1117"><a href="#ViscoplasticDesai-1117"><span class="linenos">1117</span></a>        <span class="n">s_zz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai-1118"><a href="#ViscoplasticDesai-1118"><span class="linenos">1118</span></a>        <span class="n">s_xy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai-1119"><a href="#ViscoplasticDesai-1119"><span class="linenos">1119</span></a>        <span class="n">s_xz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai-1120"><a href="#ViscoplasticDesai-1120"><span class="linenos">1120</span></a>        <span class="n">s_yz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai-1121"><a href="#ViscoplasticDesai-1121"><span class="linenos">1121</span></a>        <span class="k">return</span> <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span>
</span><span id="ViscoplasticDesai-1122"><a href="#ViscoplasticDesai-1122"><span class="linenos">1122</span></a>
</span><span id="ViscoplasticDesai-1123"><a href="#ViscoplasticDesai-1123"><span class="linenos">1123</span></a>    <span class="k">def</span> <span class="nf">compute_Fvp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">Sr</span><span class="p">):</span>
</span><span id="ViscoplasticDesai-1124"><a href="#ViscoplasticDesai-1124"><span class="linenos">1124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1125"><a href="#ViscoplasticDesai-1125"><span class="linenos">1125</span></a><span class="sd">        Compute the Desai viscoplastic yield function value `Fvp`.</span>
</span><span id="ViscoplasticDesai-1126"><a href="#ViscoplasticDesai-1126"><span class="linenos">1126</span></a>
</span><span id="ViscoplasticDesai-1127"><a href="#ViscoplasticDesai-1127"><span class="linenos">1127</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1128"><a href="#ViscoplasticDesai-1128"><span class="linenos">1128</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1129"><a href="#ViscoplasticDesai-1129"><span class="linenos">1129</span></a><span class="sd">        alpha : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1130"><a href="#ViscoplasticDesai-1130"><span class="linenos">1130</span></a><span class="sd">            Hardening variable per element, shape (N,).</span>
</span><span id="ViscoplasticDesai-1131"><a href="#ViscoplasticDesai-1131"><span class="linenos">1131</span></a><span class="sd">        I1 : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1132"><a href="#ViscoplasticDesai-1132"><span class="linenos">1132</span></a><span class="sd">            First invariant, shape (N,).</span>
</span><span id="ViscoplasticDesai-1133"><a href="#ViscoplasticDesai-1133"><span class="linenos">1133</span></a><span class="sd">        J2 : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1134"><a href="#ViscoplasticDesai-1134"><span class="linenos">1134</span></a><span class="sd">            Second deviatoric invariant, shape (N,).</span>
</span><span id="ViscoplasticDesai-1135"><a href="#ViscoplasticDesai-1135"><span class="linenos">1135</span></a><span class="sd">        Sr : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1136"><a href="#ViscoplasticDesai-1136"><span class="linenos">1136</span></a><span class="sd">            Lode-related parameter, shape (N,).</span>
</span><span id="ViscoplasticDesai-1137"><a href="#ViscoplasticDesai-1137"><span class="linenos">1137</span></a>
</span><span id="ViscoplasticDesai-1138"><a href="#ViscoplasticDesai-1138"><span class="linenos">1138</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1139"><a href="#ViscoplasticDesai-1139"><span class="linenos">1139</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1140"><a href="#ViscoplasticDesai-1140"><span class="linenos">1140</span></a><span class="sd">        torch.Tensor</span>
</span><span id="ViscoplasticDesai-1141"><a href="#ViscoplasticDesai-1141"><span class="linenos">1141</span></a><span class="sd">            `Fvp` per element, shape (N,).</span>
</span><span id="ViscoplasticDesai-1142"><a href="#ViscoplasticDesai-1142"><span class="linenos">1142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1143"><a href="#ViscoplasticDesai-1143"><span class="linenos">1143</span></a>        <span class="n">F1</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1144"><a href="#ViscoplasticDesai-1144"><span class="linenos">1144</span></a>        <span class="n">F2</span> <span class="o">=</span> <span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1145"><a href="#ViscoplasticDesai-1145"><span class="linenos">1145</span></a>        <span class="n">Fvp</span> <span class="o">=</span> <span class="n">J2</span> <span class="o">+</span> <span class="n">F1</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span>
</span><span id="ViscoplasticDesai-1146"><a href="#ViscoplasticDesai-1146"><span class="linenos">1146</span></a>        <span class="k">return</span> <span class="n">Fvp</span>
</span><span id="ViscoplasticDesai-1147"><a href="#ViscoplasticDesai-1147"><span class="linenos">1147</span></a>
</span><span id="ViscoplasticDesai-1148"><a href="#ViscoplasticDesai-1148"><span class="linenos">1148</span></a>    <span class="k">def</span> <span class="nf">compute_initial_hardening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Fvp_0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1149"><a href="#ViscoplasticDesai-1149"><span class="linenos">1149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1150"><a href="#ViscoplasticDesai-1150"><span class="linenos">1150</span></a><span class="sd">        Initialize `alpha` from a target `Fvp_0` and the current stress state.</span>
</span><span id="ViscoplasticDesai-1151"><a href="#ViscoplasticDesai-1151"><span class="linenos">1151</span></a>
</span><span id="ViscoplasticDesai-1152"><a href="#ViscoplasticDesai-1152"><span class="linenos">1152</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1153"><a href="#ViscoplasticDesai-1153"><span class="linenos">1153</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1154"><a href="#ViscoplasticDesai-1154"><span class="linenos">1154</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1155"><a href="#ViscoplasticDesai-1155"><span class="linenos">1155</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1156"><a href="#ViscoplasticDesai-1156"><span class="linenos">1156</span></a><span class="sd">        Fvp_0 : float, default=0.0</span>
</span><span id="ViscoplasticDesai-1157"><a href="#ViscoplasticDesai-1157"><span class="linenos">1157</span></a><span class="sd">            Target initial value for `Fvp`.</span>
</span><span id="ViscoplasticDesai-1158"><a href="#ViscoplasticDesai-1158"><span class="linenos">1158</span></a>
</span><span id="ViscoplasticDesai-1159"><a href="#ViscoplasticDesai-1159"><span class="linenos">1159</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1160"><a href="#ViscoplasticDesai-1160"><span class="linenos">1160</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1161"><a href="#ViscoplasticDesai-1161"><span class="linenos">1161</span></a><span class="sd">        None</span>
</span><span id="ViscoplasticDesai-1162"><a href="#ViscoplasticDesai-1162"><span class="linenos">1162</span></a>
</span><span id="ViscoplasticDesai-1163"><a href="#ViscoplasticDesai-1163"><span class="linenos">1163</span></a><span class="sd">        Side Effects</span>
</span><span id="ViscoplasticDesai-1164"><a href="#ViscoplasticDesai-1164"><span class="linenos">1164</span></a><span class="sd">        ------------</span>
</span><span id="ViscoplasticDesai-1165"><a href="#ViscoplasticDesai-1165"><span class="linenos">1165</span></a><span class="sd">        Sets `self.alpha_0`, `self.alpha`, and `self.Fvp`.</span>
</span><span id="ViscoplasticDesai-1166"><a href="#ViscoplasticDesai-1166"><span class="linenos">1166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1167"><a href="#ViscoplasticDesai-1167"><span class="linenos">1167</span></a>        <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stress_components</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1168"><a href="#ViscoplasticDesai-1168"><span class="linenos">1168</span></a>        <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_stress_invariants</span><span class="p">(</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1169"><a href="#ViscoplasticDesai-1169"><span class="linenos">1169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1_star</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Fvp_0</span> <span class="o">-</span> <span class="n">J2</span><span class="p">)</span><span class="o">*</span><span class="n">I1_star</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1_star</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">Sr</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1170"><a href="#ViscoplasticDesai-1170"><span class="linenos">1170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai-1171"><a href="#ViscoplasticDesai-1171"><span class="linenos">1171</span></a>
</span><span id="ViscoplasticDesai-1172"><a href="#ViscoplasticDesai-1172"><span class="linenos">1172</span></a>        <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stress_components</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1173"><a href="#ViscoplasticDesai-1173"><span class="linenos">1173</span></a>        <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">ind_J2_leq_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_stress_invariants</span><span class="p">(</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1174"><a href="#ViscoplasticDesai-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Fvp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Fvp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1175"><a href="#ViscoplasticDesai-1175"><span class="linenos">1175</span></a>
</span><span id="ViscoplasticDesai-1176"><a href="#ViscoplasticDesai-1176"><span class="linenos">1176</span></a>
</span><span id="ViscoplasticDesai-1177"><a href="#ViscoplasticDesai-1177"><span class="linenos">1177</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ViscoplasticDesai-1178"><a href="#ViscoplasticDesai-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1179"><a href="#ViscoplasticDesai-1179"><span class="linenos">1179</span></a><span class="sd">        Compute viscoplastic strain rate and optionally return it.</span>
</span><span id="ViscoplasticDesai-1180"><a href="#ViscoplasticDesai-1180"><span class="linenos">1180</span></a>
</span><span id="ViscoplasticDesai-1181"><a href="#ViscoplasticDesai-1181"><span class="linenos">1181</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1182"><a href="#ViscoplasticDesai-1182"><span class="linenos">1182</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1183"><a href="#ViscoplasticDesai-1183"><span class="linenos">1183</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1184"><a href="#ViscoplasticDesai-1184"><span class="linenos">1184</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1185"><a href="#ViscoplasticDesai-1185"><span class="linenos">1185</span></a><span class="sd">        phi1 : float</span>
</span><span id="ViscoplasticDesai-1186"><a href="#ViscoplasticDesai-1186"><span class="linenos">1186</span></a><span class="sd">            Time integration factor (dt*theta).</span>
</span><span id="ViscoplasticDesai-1187"><a href="#ViscoplasticDesai-1187"><span class="linenos">1187</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1188"><a href="#ViscoplasticDesai-1188"><span class="linenos">1188</span></a><span class="sd">            Temperature per element (unused).</span>
</span><span id="ViscoplasticDesai-1189"><a href="#ViscoplasticDesai-1189"><span class="linenos">1189</span></a><span class="sd">        alpha : torch.Tensor or None, optional</span>
</span><span id="ViscoplasticDesai-1190"><a href="#ViscoplasticDesai-1190"><span class="linenos">1190</span></a><span class="sd">            Hardening variable override; if `None`, use `self.alpha`.</span>
</span><span id="ViscoplasticDesai-1191"><a href="#ViscoplasticDesai-1191"><span class="linenos">1191</span></a><span class="sd">        return_eps_ne : bool, default=False</span>
</span><span id="ViscoplasticDesai-1192"><a href="#ViscoplasticDesai-1192"><span class="linenos">1192</span></a><span class="sd">            If True, return rate; else store it.</span>
</span><span id="ViscoplasticDesai-1193"><a href="#ViscoplasticDesai-1193"><span class="linenos">1193</span></a>
</span><span id="ViscoplasticDesai-1194"><a href="#ViscoplasticDesai-1194"><span class="linenos">1194</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1195"><a href="#ViscoplasticDesai-1195"><span class="linenos">1195</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1196"><a href="#ViscoplasticDesai-1196"><span class="linenos">1196</span></a><span class="sd">        None or torch.Tensor</span>
</span><span id="ViscoplasticDesai-1197"><a href="#ViscoplasticDesai-1197"><span class="linenos">1197</span></a><span class="sd">            (N, 3, 3) if `return_eps_ne=True`, else `None`.</span>
</span><span id="ViscoplasticDesai-1198"><a href="#ViscoplasticDesai-1198"><span class="linenos">1198</span></a>
</span><span id="ViscoplasticDesai-1199"><a href="#ViscoplasticDesai-1199"><span class="linenos">1199</span></a><span class="sd">        Notes</span>
</span><span id="ViscoplasticDesai-1200"><a href="#ViscoplasticDesai-1200"><span class="linenos">1200</span></a><span class="sd">        -----</span>
</span><span id="ViscoplasticDesai-1201"><a href="#ViscoplasticDesai-1201"><span class="linenos">1201</span></a><span class="sd">        Also updates `self.Fvp` when `return_eps_ne=False`.</span>
</span><span id="ViscoplasticDesai-1202"><a href="#ViscoplasticDesai-1202"><span class="linenos">1202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1203"><a href="#ViscoplasticDesai-1203"><span class="linenos">1203</span></a>        <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1204"><a href="#ViscoplasticDesai-1204"><span class="linenos">1204</span></a>        	<span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="ViscoplasticDesai-1205"><a href="#ViscoplasticDesai-1205"><span class="linenos">1205</span></a>
</span><span id="ViscoplasticDesai-1206"><a href="#ViscoplasticDesai-1206"><span class="linenos">1206</span></a>        <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stress_components</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1207"><a href="#ViscoplasticDesai-1207"><span class="linenos">1207</span></a>        <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">ind_J2_leq_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_stress_invariants</span><span class="p">(</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1208"><a href="#ViscoplasticDesai-1208"><span class="linenos">1208</span></a>
</span><span id="ViscoplasticDesai-1209"><a href="#ViscoplasticDesai-1209"><span class="linenos">1209</span></a>        <span class="c1"># Compute yield function</span>
</span><span id="ViscoplasticDesai-1210"><a href="#ViscoplasticDesai-1210"><span class="linenos">1210</span></a>        <span class="n">Fvp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Fvp</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1211"><a href="#ViscoplasticDesai-1211"><span class="linenos">1211</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1212"><a href="#ViscoplasticDesai-1212"><span class="linenos">1212</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">Fvp</span> <span class="o">=</span> <span class="n">Fvp</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai-1213"><a href="#ViscoplasticDesai-1213"><span class="linenos">1213</span></a>
</span><span id="ViscoplasticDesai-1214"><a href="#ViscoplasticDesai-1214"><span class="linenos">1214</span></a>
</span><span id="ViscoplasticDesai-1215"><a href="#ViscoplasticDesai-1215"><span class="linenos">1215</span></a>        <span class="c1"># Compute flow direction, i.e. d(Fvp)/d(stress)</span>
</span><span id="ViscoplasticDesai-1216"><a href="#ViscoplasticDesai-1216"><span class="linenos">1216</span></a>        <span class="n">F1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1217"><a href="#ViscoplasticDesai-1217"><span class="linenos">1217</span></a>        <span class="n">F2</span> <span class="o">=</span> <span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1218"><a href="#ViscoplasticDesai-1218"><span class="linenos">1218</span></a>        <span class="n">dF1_dI1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1219"><a href="#ViscoplasticDesai-1219"><span class="linenos">1219</span></a>        <span class="n">dF2m_dI1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1</span><span class="p">)</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1220"><a href="#ViscoplasticDesai-1220"><span class="linenos">1220</span></a>        <span class="n">dF_dI1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">dF1_dI1</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">F1</span><span class="o">*</span><span class="n">dF2m_dI1</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1221"><a href="#ViscoplasticDesai-1221"><span class="linenos">1221</span></a>
</span><span id="ViscoplasticDesai-1222"><a href="#ViscoplasticDesai-1222"><span class="linenos">1222</span></a>        <span class="n">dF2_dJ2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">J3</span><span class="o">*</span><span class="mi">27</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">J2</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</span><span id="ViscoplasticDesai-1223"><a href="#ViscoplasticDesai-1223"><span class="linenos">1223</span></a>        <span class="n">dF_dJ2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">F1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dF2_dJ2</span>
</span><span id="ViscoplasticDesai-1224"><a href="#ViscoplasticDesai-1224"><span class="linenos">1224</span></a>        <span class="n">dF_dJ3</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="n">F1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J2</span><span class="o">**</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1225"><a href="#ViscoplasticDesai-1225"><span class="linenos">1225</span></a>
</span><span id="ViscoplasticDesai-1226"><a href="#ViscoplasticDesai-1226"><span class="linenos">1226</span></a>
</span><span id="ViscoplasticDesai-1227"><a href="#ViscoplasticDesai-1227"><span class="linenos">1227</span></a>        <span class="n">dI1_dSxx</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai-1228"><a href="#ViscoplasticDesai-1228"><span class="linenos">1228</span></a>        <span class="n">dI1_dSyy</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai-1229"><a href="#ViscoplasticDesai-1229"><span class="linenos">1229</span></a>        <span class="n">dI1_dSzz</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai-1230"><a href="#ViscoplasticDesai-1230"><span class="linenos">1230</span></a>        <span class="n">dI1_dSxy</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai-1231"><a href="#ViscoplasticDesai-1231"><span class="linenos">1231</span></a>        <span class="n">dI1_dSxz</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai-1232"><a href="#ViscoplasticDesai-1232"><span class="linenos">1232</span></a>        <span class="n">dI1_dSyz</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai-1233"><a href="#ViscoplasticDesai-1233"><span class="linenos">1233</span></a>
</span><span id="ViscoplasticDesai-1234"><a href="#ViscoplasticDesai-1234"><span class="linenos">1234</span></a>        <span class="n">dI2_dSxx</span> <span class="o">=</span> <span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_zz</span>
</span><span id="ViscoplasticDesai-1235"><a href="#ViscoplasticDesai-1235"><span class="linenos">1235</span></a>        <span class="n">dI2_dSyy</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_zz</span>
</span><span id="ViscoplasticDesai-1236"><a href="#ViscoplasticDesai-1236"><span class="linenos">1236</span></a>        <span class="n">dI2_dSzz</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_yy</span>
</span><span id="ViscoplasticDesai-1237"><a href="#ViscoplasticDesai-1237"><span class="linenos">1237</span></a>        <span class="n">dI2_dSxy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s_xy</span>
</span><span id="ViscoplasticDesai-1238"><a href="#ViscoplasticDesai-1238"><span class="linenos">1238</span></a>        <span class="n">dI2_dSxz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s_xz</span>
</span><span id="ViscoplasticDesai-1239"><a href="#ViscoplasticDesai-1239"><span class="linenos">1239</span></a>        <span class="n">dI2_dSyz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s_yz</span>
</span><span id="ViscoplasticDesai-1240"><a href="#ViscoplasticDesai-1240"><span class="linenos">1240</span></a>
</span><span id="ViscoplasticDesai-1241"><a href="#ViscoplasticDesai-1241"><span class="linenos">1241</span></a>        <span class="n">dI3_dSxx</span> <span class="o">=</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">-</span> <span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai-1242"><a href="#ViscoplasticDesai-1242"><span class="linenos">1242</span></a>        <span class="n">dI3_dSyy</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">-</span> <span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai-1243"><a href="#ViscoplasticDesai-1243"><span class="linenos">1243</span></a>        <span class="n">dI3_dSzz</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yy</span> <span class="o">-</span> <span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai-1244"><a href="#ViscoplasticDesai-1244"><span class="linenos">1244</span></a>        <span class="n">dI3_dSxy</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_xz</span><span class="o">*</span><span class="n">s_yz</span> <span class="o">-</span> <span class="n">s_zz</span><span class="o">*</span><span class="n">s_xy</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1245"><a href="#ViscoplasticDesai-1245"><span class="linenos">1245</span></a>        <span class="n">dI3_dSxz</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_xy</span><span class="o">*</span><span class="n">s_yz</span> <span class="o">-</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_xz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1246"><a href="#ViscoplasticDesai-1246"><span class="linenos">1246</span></a>        <span class="n">dI3_dSyz</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_xz</span><span class="o">*</span><span class="n">s_xy</span> <span class="o">-</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1247"><a href="#ViscoplasticDesai-1247"><span class="linenos">1247</span></a>
</span><span id="ViscoplasticDesai-1248"><a href="#ViscoplasticDesai-1248"><span class="linenos">1248</span></a>        <span class="n">dJ2_dI1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span>
</span><span id="ViscoplasticDesai-1249"><a href="#ViscoplasticDesai-1249"><span class="linenos">1249</span></a>        <span class="n">dJ2_dI2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="ViscoplasticDesai-1250"><a href="#ViscoplasticDesai-1250"><span class="linenos">1250</span></a>
</span><span id="ViscoplasticDesai-1251"><a href="#ViscoplasticDesai-1251"><span class="linenos">1251</span></a>        <span class="n">dJ2_dSxx</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSxx</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSxx</span>
</span><span id="ViscoplasticDesai-1252"><a href="#ViscoplasticDesai-1252"><span class="linenos">1252</span></a>        <span class="n">dJ2_dSyy</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSyy</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSyy</span>
</span><span id="ViscoplasticDesai-1253"><a href="#ViscoplasticDesai-1253"><span class="linenos">1253</span></a>        <span class="n">dJ2_dSzz</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSzz</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSzz</span>
</span><span id="ViscoplasticDesai-1254"><a href="#ViscoplasticDesai-1254"><span class="linenos">1254</span></a>        <span class="n">dJ2_dSxy</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSxy</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSxy</span>
</span><span id="ViscoplasticDesai-1255"><a href="#ViscoplasticDesai-1255"><span class="linenos">1255</span></a>        <span class="n">dJ2_dSxz</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSxz</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSxz</span>
</span><span id="ViscoplasticDesai-1256"><a href="#ViscoplasticDesai-1256"><span class="linenos">1256</span></a>        <span class="n">dJ2_dSyz</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSyz</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSyz</span>
</span><span id="ViscoplasticDesai-1257"><a href="#ViscoplasticDesai-1257"><span class="linenos">1257</span></a>
</span><span id="ViscoplasticDesai-1258"><a href="#ViscoplasticDesai-1258"><span class="linenos">1258</span></a>        <span class="n">dJ3_dI1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I2</span>
</span><span id="ViscoplasticDesai-1259"><a href="#ViscoplasticDesai-1259"><span class="linenos">1259</span></a>        <span class="n">dJ3_dI2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span>
</span><span id="ViscoplasticDesai-1260"><a href="#ViscoplasticDesai-1260"><span class="linenos">1260</span></a>        <span class="n">dJ3_dI3</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai-1261"><a href="#ViscoplasticDesai-1261"><span class="linenos">1261</span></a>
</span><span id="ViscoplasticDesai-1262"><a href="#ViscoplasticDesai-1262"><span class="linenos">1262</span></a>        <span class="n">dJ3_dSxx</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSxx</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSxx</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSxx</span>
</span><span id="ViscoplasticDesai-1263"><a href="#ViscoplasticDesai-1263"><span class="linenos">1263</span></a>        <span class="n">dJ3_dSyy</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSyy</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSyy</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSyy</span>
</span><span id="ViscoplasticDesai-1264"><a href="#ViscoplasticDesai-1264"><span class="linenos">1264</span></a>        <span class="n">dJ3_dSzz</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSzz</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSzz</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSzz</span>
</span><span id="ViscoplasticDesai-1265"><a href="#ViscoplasticDesai-1265"><span class="linenos">1265</span></a>        <span class="n">dJ3_dSxy</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSxy</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSxy</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSxy</span>
</span><span id="ViscoplasticDesai-1266"><a href="#ViscoplasticDesai-1266"><span class="linenos">1266</span></a>        <span class="n">dJ3_dSxz</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSxz</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSxz</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSxz</span>
</span><span id="ViscoplasticDesai-1267"><a href="#ViscoplasticDesai-1267"><span class="linenos">1267</span></a>        <span class="n">dJ3_dSyz</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSyz</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSyz</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSyz</span>
</span><span id="ViscoplasticDesai-1268"><a href="#ViscoplasticDesai-1268"><span class="linenos">1268</span></a>
</span><span id="ViscoplasticDesai-1269"><a href="#ViscoplasticDesai-1269"><span class="linenos">1269</span></a>        <span class="n">dQdS_00</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSxx</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSxx</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSxx</span>
</span><span id="ViscoplasticDesai-1270"><a href="#ViscoplasticDesai-1270"><span class="linenos">1270</span></a>        <span class="n">dQdS_11</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSyy</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSyy</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSyy</span>
</span><span id="ViscoplasticDesai-1271"><a href="#ViscoplasticDesai-1271"><span class="linenos">1271</span></a>        <span class="n">dQdS_22</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSzz</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSzz</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSzz</span>
</span><span id="ViscoplasticDesai-1272"><a href="#ViscoplasticDesai-1272"><span class="linenos">1272</span></a>        <span class="n">dQdS_01</span> <span class="o">=</span> <span class="n">dQdS_10</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSxy</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSxy</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSxy</span>
</span><span id="ViscoplasticDesai-1273"><a href="#ViscoplasticDesai-1273"><span class="linenos">1273</span></a>        <span class="n">dQdS_02</span> <span class="o">=</span> <span class="n">dQdS_20</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSxz</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSxz</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSxz</span>
</span><span id="ViscoplasticDesai-1274"><a href="#ViscoplasticDesai-1274"><span class="linenos">1274</span></a>        <span class="n">dQdS_12</span> <span class="o">=</span> <span class="n">dQdS_21</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSyz</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSyz</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSyz</span>
</span><span id="ViscoplasticDesai-1275"><a href="#ViscoplasticDesai-1275"><span class="linenos">1275</span></a>
</span><span id="ViscoplasticDesai-1276"><a href="#ViscoplasticDesai-1276"><span class="linenos">1276</span></a>        <span class="c1"># Initialize viscoplastic direction</span>
</span><span id="ViscoplasticDesai-1277"><a href="#ViscoplasticDesai-1277"><span class="linenos">1277</span></a>        <span class="n">dQdS</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1278"><a href="#ViscoplasticDesai-1278"><span class="linenos">1278</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_00</span>
</span><span id="ViscoplasticDesai-1279"><a href="#ViscoplasticDesai-1279"><span class="linenos">1279</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_11</span>
</span><span id="ViscoplasticDesai-1280"><a href="#ViscoplasticDesai-1280"><span class="linenos">1280</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_22</span>
</span><span id="ViscoplasticDesai-1281"><a href="#ViscoplasticDesai-1281"><span class="linenos">1281</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_01</span>
</span><span id="ViscoplasticDesai-1282"><a href="#ViscoplasticDesai-1282"><span class="linenos">1282</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_02</span>
</span><span id="ViscoplasticDesai-1283"><a href="#ViscoplasticDesai-1283"><span class="linenos">1283</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_12</span>
</span><span id="ViscoplasticDesai-1284"><a href="#ViscoplasticDesai-1284"><span class="linenos">1284</span></a>
</span><span id="ViscoplasticDesai-1285"><a href="#ViscoplasticDesai-1285"><span class="linenos">1285</span></a>        <span class="c1"># Wherever J2=0, make viscoplasticity to be zero</span>
</span><span id="ViscoplasticDesai-1286"><a href="#ViscoplasticDesai-1286"><span class="linenos">1286</span></a>        <span class="n">dQdS</span><span class="p">[</span><span class="n">ind_J2_leq_0</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai-1287"><a href="#ViscoplasticDesai-1287"><span class="linenos">1287</span></a>
</span><span id="ViscoplasticDesai-1288"><a href="#ViscoplasticDesai-1288"><span class="linenos">1288</span></a>        <span class="c1"># Calculate strain rate</span>
</span><span id="ViscoplasticDesai-1289"><a href="#ViscoplasticDesai-1289"><span class="linenos">1289</span></a>        <span class="n">ramp_idx</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Fvp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1290"><a href="#ViscoplasticDesai-1290"><span class="linenos">1290</span></a>        <span class="n">lmbda</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1291"><a href="#ViscoplasticDesai-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ramp_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1292"><a href="#ViscoplasticDesai-1292"><span class="linenos">1292</span></a>        	<span class="n">lmbda</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_1</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Fvp</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">F_0</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">N_1</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1293"><a href="#ViscoplasticDesai-1293"><span class="linenos">1293</span></a>        <span class="n">eps_vp_rate</span> <span class="o">=</span> <span class="o">-</span><span class="n">dQdS</span><span class="o">*</span><span class="n">lmbda</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1294"><a href="#ViscoplasticDesai-1294"><span class="linenos">1294</span></a>
</span><span id="ViscoplasticDesai-1295"><a href="#ViscoplasticDesai-1295"><span class="linenos">1295</span></a>        <span class="k">if</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1296"><a href="#ViscoplasticDesai-1296"><span class="linenos">1296</span></a>        	<span class="k">return</span> <span class="n">eps_vp_rate</span>
</span><span id="ViscoplasticDesai-1297"><a href="#ViscoplasticDesai-1297"><span class="linenos">1297</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1298"><a href="#ViscoplasticDesai-1298"><span class="linenos">1298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">eps_vp_rate</span>
</span><span id="ViscoplasticDesai-1299"><a href="#ViscoplasticDesai-1299"><span class="linenos">1299</span></a>
</span><span id="ViscoplasticDesai-1300"><a href="#ViscoplasticDesai-1300"><span class="linenos">1300</span></a>
</span><span id="ViscoplasticDesai-1301"><a href="#ViscoplasticDesai-1301"><span class="linenos">1301</span></a>    <span class="k">def</span> <span class="nf">compute_B_and_H_over_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ViscoplasticDesai-1302"><a href="#ViscoplasticDesai-1302"><span class="linenos">1302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1303"><a href="#ViscoplasticDesai-1303"><span class="linenos">1303</span></a><span class="sd">        Compute `B` and `H/h` via perturbations of `alpha` and stress.</span>
</span><span id="ViscoplasticDesai-1304"><a href="#ViscoplasticDesai-1304"><span class="linenos">1304</span></a>
</span><span id="ViscoplasticDesai-1305"><a href="#ViscoplasticDesai-1305"><span class="linenos">1305</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1306"><a href="#ViscoplasticDesai-1306"><span class="linenos">1306</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1307"><a href="#ViscoplasticDesai-1307"><span class="linenos">1307</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1308"><a href="#ViscoplasticDesai-1308"><span class="linenos">1308</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1309"><a href="#ViscoplasticDesai-1309"><span class="linenos">1309</span></a><span class="sd">        dt : float</span>
</span><span id="ViscoplasticDesai-1310"><a href="#ViscoplasticDesai-1310"><span class="linenos">1310</span></a><span class="sd">            Time step.</span>
</span><span id="ViscoplasticDesai-1311"><a href="#ViscoplasticDesai-1311"><span class="linenos">1311</span></a><span class="sd">        theta : float</span>
</span><span id="ViscoplasticDesai-1312"><a href="#ViscoplasticDesai-1312"><span class="linenos">1312</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="ViscoplasticDesai-1313"><a href="#ViscoplasticDesai-1313"><span class="linenos">1313</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1314"><a href="#ViscoplasticDesai-1314"><span class="linenos">1314</span></a><span class="sd">            Temperature per element (unused).</span>
</span><span id="ViscoplasticDesai-1315"><a href="#ViscoplasticDesai-1315"><span class="linenos">1315</span></a>
</span><span id="ViscoplasticDesai-1316"><a href="#ViscoplasticDesai-1316"><span class="linenos">1316</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1317"><a href="#ViscoplasticDesai-1317"><span class="linenos">1317</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1318"><a href="#ViscoplasticDesai-1318"><span class="linenos">1318</span></a><span class="sd">        B : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1319"><a href="#ViscoplasticDesai-1319"><span class="linenos">1319</span></a><span class="sd">            Driving term, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1320"><a href="#ViscoplasticDesai-1320"><span class="linenos">1320</span></a><span class="sd">        H_over_h : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1321"><a href="#ViscoplasticDesai-1321"><span class="linenos">1321</span></a><span class="sd">            Linearization ratio, shape (N, 6, 6).</span>
</span><span id="ViscoplasticDesai-1322"><a href="#ViscoplasticDesai-1322"><span class="linenos">1322</span></a>
</span><span id="ViscoplasticDesai-1323"><a href="#ViscoplasticDesai-1323"><span class="linenos">1323</span></a><span class="sd">        Notes</span>
</span><span id="ViscoplasticDesai-1324"><a href="#ViscoplasticDesai-1324"><span class="linenos">1324</span></a><span class="sd">        -----</span>
</span><span id="ViscoplasticDesai-1325"><a href="#ViscoplasticDesai-1325"><span class="linenos">1325</span></a><span class="sd">        Uses finite differences to approximate sensitivities.</span>
</span><span id="ViscoplasticDesai-1326"><a href="#ViscoplasticDesai-1326"><span class="linenos">1326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1327"><a href="#ViscoplasticDesai-1327"><span class="linenos">1327</span></a>        <span class="c1"># EPSILON_ALPHA = 1e-7</span>
</span><span id="ViscoplasticDesai-1328"><a href="#ViscoplasticDesai-1328"><span class="linenos">1328</span></a>        <span class="n">EPSILON_ALPHA</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="ViscoplasticDesai-1329"><a href="#ViscoplasticDesai-1329"><span class="linenos">1329</span></a>        <span class="n">EPSILON_STRESS</span> <span class="o">=</span> <span class="mf">1e-1</span>
</span><span id="ViscoplasticDesai-1330"><a href="#ViscoplasticDesai-1330"><span class="linenos">1330</span></a>
</span><span id="ViscoplasticDesai-1331"><a href="#ViscoplasticDesai-1331"><span class="linenos">1331</span></a>        <span class="n">alpha_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">EPSILON_ALPHA</span>
</span><span id="ViscoplasticDesai-1332"><a href="#ViscoplasticDesai-1332"><span class="linenos">1332</span></a>        <span class="n">eps_ne_rate_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_eps</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1333"><a href="#ViscoplasticDesai-1333"><span class="linenos">1333</span></a>
</span><span id="ViscoplasticDesai-1334"><a href="#ViscoplasticDesai-1334"><span class="linenos">1334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_residue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1335"><a href="#ViscoplasticDesai-1335"><span class="linenos">1335</span></a>        <span class="n">r_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_residue</span><span class="p">(</span><span class="n">eps_ne_rate_eps</span><span class="p">,</span> <span class="n">alpha_eps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1336"><a href="#ViscoplasticDesai-1336"><span class="linenos">1336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_eps</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">EPSILON_ALPHA</span>
</span><span id="ViscoplasticDesai-1337"><a href="#ViscoplasticDesai-1337"><span class="linenos">1337</span></a>        <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">eps_ne_rate_eps</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">EPSILON_ALPHA</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1338"><a href="#ViscoplasticDesai-1338"><span class="linenos">1338</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span>
</span><span id="ViscoplasticDesai-1339"><a href="#ViscoplasticDesai-1339"><span class="linenos">1339</span></a>
</span><span id="ViscoplasticDesai-1340"><a href="#ViscoplasticDesai-1340"><span class="linenos">1340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1341"><a href="#ViscoplasticDesai-1341"><span class="linenos">1341</span></a>        <span class="n">stress_eps</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai-1342"><a href="#ViscoplasticDesai-1342"><span class="linenos">1342</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)]:</span>
</span><span id="ViscoplasticDesai-1343"><a href="#ViscoplasticDesai-1343"><span class="linenos">1343</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPSILON_STRESS</span>
</span><span id="ViscoplasticDesai-1344"><a href="#ViscoplasticDesai-1344"><span class="linenos">1344</span></a>        	<span class="n">eps_ne_rate_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_eps</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1345"><a href="#ViscoplasticDesai-1345"><span class="linenos">1345</span></a>        	<span class="n">r_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_residue</span><span class="p">(</span><span class="n">eps_ne_rate_eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1346"><a href="#ViscoplasticDesai-1346"><span class="linenos">1346</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_eps</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">EPSILON_STRESS</span>
</span><span id="ViscoplasticDesai-1347"><a href="#ViscoplasticDesai-1347"><span class="linenos">1347</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1348"><a href="#ViscoplasticDesai-1348"><span class="linenos">1348</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">EPSILON_STRESS</span>
</span><span id="ViscoplasticDesai-1349"><a href="#ViscoplasticDesai-1349"><span class="linenos">1349</span></a>
</span><span id="ViscoplasticDesai-1350"><a href="#ViscoplasticDesai-1350"><span class="linenos">1350</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_H</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1351"><a href="#ViscoplasticDesai-1351"><span class="linenos">1351</span></a>        <span class="n">H_over_h</span> <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1352"><a href="#ViscoplasticDesai-1352"><span class="linenos">1352</span></a>
</span><span id="ViscoplasticDesai-1353"><a href="#ViscoplasticDesai-1353"><span class="linenos">1353</span></a>        <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="n">H_over_h</span>
</span><span id="ViscoplasticDesai-1354"><a href="#ViscoplasticDesai-1354"><span class="linenos">1354</span></a>
</span><span id="ViscoplasticDesai-1355"><a href="#ViscoplasticDesai-1355"><span class="linenos">1355</span></a>
</span><span id="ViscoplasticDesai-1356"><a href="#ViscoplasticDesai-1356"><span class="linenos">1356</span></a>    <span class="k">def</span> <span class="nf">compute_H</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">P</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ViscoplasticDesai-1357"><a href="#ViscoplasticDesai-1357"><span class="linenos">1357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1358"><a href="#ViscoplasticDesai-1358"><span class="linenos">1358</span></a><span class="sd">        Build the 66 matrix `H` from tensors `Q` and `P`.</span>
</span><span id="ViscoplasticDesai-1359"><a href="#ViscoplasticDesai-1359"><span class="linenos">1359</span></a>
</span><span id="ViscoplasticDesai-1360"><a href="#ViscoplasticDesai-1360"><span class="linenos">1360</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai-1361"><a href="#ViscoplasticDesai-1361"><span class="linenos">1361</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai-1362"><a href="#ViscoplasticDesai-1362"><span class="linenos">1362</span></a><span class="sd">        Q : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1363"><a href="#ViscoplasticDesai-1363"><span class="linenos">1363</span></a><span class="sd">            Sensitivity of rate to `alpha`, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1364"><a href="#ViscoplasticDesai-1364"><span class="linenos">1364</span></a><span class="sd">        P : torch.Tensor</span>
</span><span id="ViscoplasticDesai-1365"><a href="#ViscoplasticDesai-1365"><span class="linenos">1365</span></a><span class="sd">            Sensitivity of residue to stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai-1366"><a href="#ViscoplasticDesai-1366"><span class="linenos">1366</span></a>
</span><span id="ViscoplasticDesai-1367"><a href="#ViscoplasticDesai-1367"><span class="linenos">1367</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai-1368"><a href="#ViscoplasticDesai-1368"><span class="linenos">1368</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai-1369"><a href="#ViscoplasticDesai-1369"><span class="linenos">1369</span></a><span class="sd">        torch.Tensor</span>
</span><span id="ViscoplasticDesai-1370"><a href="#ViscoplasticDesai-1370"><span class="linenos">1370</span></a><span class="sd">            `H` with shape (N, 6, 6) in tensorial Voigt ordering.</span>
</span><span id="ViscoplasticDesai-1371"><a href="#ViscoplasticDesai-1371"><span class="linenos">1371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai-1372"><a href="#ViscoplasticDesai-1372"><span class="linenos">1372</span></a>        <span class="n">n_elems</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span>
</span><span id="ViscoplasticDesai-1373"><a href="#ViscoplasticDesai-1373"><span class="linenos">1373</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai-1374"><a href="#ViscoplasticDesai-1374"><span class="linenos">1374</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1375"><a href="#ViscoplasticDesai-1375"><span class="linenos">1375</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1376"><a href="#ViscoplasticDesai-1376"><span class="linenos">1376</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1377"><a href="#ViscoplasticDesai-1377"><span class="linenos">1377</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1378"><a href="#ViscoplasticDesai-1378"><span class="linenos">1378</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1379"><a href="#ViscoplasticDesai-1379"><span class="linenos">1379</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1380"><a href="#ViscoplasticDesai-1380"><span class="linenos">1380</span></a>
</span><span id="ViscoplasticDesai-1381"><a href="#ViscoplasticDesai-1381"><span class="linenos">1381</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1382"><a href="#ViscoplasticDesai-1382"><span class="linenos">1382</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1383"><a href="#ViscoplasticDesai-1383"><span class="linenos">1383</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1384"><a href="#ViscoplasticDesai-1384"><span class="linenos">1384</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1385"><a href="#ViscoplasticDesai-1385"><span class="linenos">1385</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1386"><a href="#ViscoplasticDesai-1386"><span class="linenos">1386</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1387"><a href="#ViscoplasticDesai-1387"><span class="linenos">1387</span></a>
</span><span id="ViscoplasticDesai-1388"><a href="#ViscoplasticDesai-1388"><span class="linenos">1388</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1389"><a href="#ViscoplasticDesai-1389"><span class="linenos">1389</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1390"><a href="#ViscoplasticDesai-1390"><span class="linenos">1390</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1391"><a href="#ViscoplasticDesai-1391"><span class="linenos">1391</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1392"><a href="#ViscoplasticDesai-1392"><span class="linenos">1392</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1393"><a href="#ViscoplasticDesai-1393"><span class="linenos">1393</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1394"><a href="#ViscoplasticDesai-1394"><span class="linenos">1394</span></a>
</span><span id="ViscoplasticDesai-1395"><a href="#ViscoplasticDesai-1395"><span class="linenos">1395</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1396"><a href="#ViscoplasticDesai-1396"><span class="linenos">1396</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1397"><a href="#ViscoplasticDesai-1397"><span class="linenos">1397</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1398"><a href="#ViscoplasticDesai-1398"><span class="linenos">1398</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1399"><a href="#ViscoplasticDesai-1399"><span class="linenos">1399</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1400"><a href="#ViscoplasticDesai-1400"><span class="linenos">1400</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1401"><a href="#ViscoplasticDesai-1401"><span class="linenos">1401</span></a>
</span><span id="ViscoplasticDesai-1402"><a href="#ViscoplasticDesai-1402"><span class="linenos">1402</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1403"><a href="#ViscoplasticDesai-1403"><span class="linenos">1403</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1404"><a href="#ViscoplasticDesai-1404"><span class="linenos">1404</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1405"><a href="#ViscoplasticDesai-1405"><span class="linenos">1405</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1406"><a href="#ViscoplasticDesai-1406"><span class="linenos">1406</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1407"><a href="#ViscoplasticDesai-1407"><span class="linenos">1407</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1408"><a href="#ViscoplasticDesai-1408"><span class="linenos">1408</span></a>
</span><span id="ViscoplasticDesai-1409"><a href="#ViscoplasticDesai-1409"><span class="linenos">1409</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1410"><a href="#ViscoplasticDesai-1410"><span class="linenos">1410</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1411"><a href="#ViscoplasticDesai-1411"><span class="linenos">1411</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1412"><a href="#ViscoplasticDesai-1412"><span class="linenos">1412</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1413"><a href="#ViscoplasticDesai-1413"><span class="linenos">1413</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1414"><a href="#ViscoplasticDesai-1414"><span class="linenos">1414</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai-1415"><a href="#ViscoplasticDesai-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="n">H</span>
</span></pre></div>


            <div class="docstring"><p>Viscoplastic model of Desai-type with hardening (state) variable <code><a href="#ViscoplasticDesai.alpha">alpha</a></code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mu_1, N_1, a_1, eta, n, beta_1, beta, m, gamma, sigma_t, alpha_0</strong> (torch.Tensor):
Model parameters per element, shape (N,).</li>
<li><strong>name</strong> (str, optional):
Element name, by default "desai".</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>alpha</strong> (torch.Tensor):
Current hardening variable per element, shape (N,).</li>
<li><strong>Fvp</strong> (torch.Tensor):
Current value of the yield function per element, shape (N,).</li>
<li><strong>qsi, qsi_old</strong> (torch.Tensor):
Accumulated viscoplastic strain measure and its previous value, shape (N,).</li>
<li><strong>P</strong> (torch.Tensor):
Sensitivity of the residue to stress, shape (N, 3, 3).</li>
<li><strong>r, h</strong> (torch.Tensor):
Residue and its derivative w.r.t. <code><a href="#ViscoplasticDesai.alpha">alpha</a></code>, shapes (N,) and (N,).</li>
</ul>
</div>


                            <div id="ViscoplasticDesai.__init__" class="classattr">
                                        <input id="ViscoplasticDesai.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ViscoplasticDesai</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">mu_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">N_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">a_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">eta</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">beta_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">beta</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">m</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">sigma_t</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">alpha_0</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="s1">&#39;desai&#39;</span></span>)</span>

                <label class="view-source-button" for="ViscoplasticDesai.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.__init__-973"><a href="#ViscoplasticDesai.__init__-973"><span class="linenos"> 973</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-974"><a href="#ViscoplasticDesai.__init__-974"><span class="linenos"> 974</span></a>						<span class="n">mu_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-975"><a href="#ViscoplasticDesai.__init__-975"><span class="linenos"> 975</span></a>						<span class="n">N_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-976"><a href="#ViscoplasticDesai.__init__-976"><span class="linenos"> 976</span></a>						<span class="n">a_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-977"><a href="#ViscoplasticDesai.__init__-977"><span class="linenos"> 977</span></a>						<span class="n">eta</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-978"><a href="#ViscoplasticDesai.__init__-978"><span class="linenos"> 978</span></a>						<span class="n">n</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-979"><a href="#ViscoplasticDesai.__init__-979"><span class="linenos"> 979</span></a>						<span class="n">beta_1</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-980"><a href="#ViscoplasticDesai.__init__-980"><span class="linenos"> 980</span></a>						<span class="n">beta</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-981"><a href="#ViscoplasticDesai.__init__-981"><span class="linenos"> 981</span></a>						<span class="n">m</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-982"><a href="#ViscoplasticDesai.__init__-982"><span class="linenos"> 982</span></a>						<span class="n">gamma</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-983"><a href="#ViscoplasticDesai.__init__-983"><span class="linenos"> 983</span></a>						<span class="n">sigma_t</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-984"><a href="#ViscoplasticDesai.__init__-984"><span class="linenos"> 984</span></a>						<span class="n">alpha_0</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.__init__-985"><a href="#ViscoplasticDesai.__init__-985"><span class="linenos"> 985</span></a>						<span class="n">name</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="s2">&quot;desai&quot;</span><span class="p">):</span>
</span><span id="ViscoplasticDesai.__init__-986"><a href="#ViscoplasticDesai.__init__-986"><span class="linenos"> 986</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mu_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ViscoplasticDesai.__init__-987"><a href="#ViscoplasticDesai.__init__-987"><span class="linenos"> 987</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="ViscoplasticDesai.__init__-988"><a href="#ViscoplasticDesai.__init__-988"><span class="linenos"> 988</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mu_1</span> <span class="o">=</span> <span class="n">mu_1</span>
</span><span id="ViscoplasticDesai.__init__-989"><a href="#ViscoplasticDesai.__init__-989"><span class="linenos"> 989</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N_1</span> <span class="o">=</span> <span class="n">N_1</span>
</span><span id="ViscoplasticDesai.__init__-990"><a href="#ViscoplasticDesai.__init__-990"><span class="linenos"> 990</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a_1</span> <span class="o">=</span> <span class="n">a_1</span>
</span><span id="ViscoplasticDesai.__init__-991"><a href="#ViscoplasticDesai.__init__-991"><span class="linenos"> 991</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
</span><span id="ViscoplasticDesai.__init__-992"><a href="#ViscoplasticDesai.__init__-992"><span class="linenos"> 992</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="ViscoplasticDesai.__init__-993"><a href="#ViscoplasticDesai.__init__-993"><span class="linenos"> 993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span> <span class="o">=</span> <span class="n">beta_1</span>
</span><span id="ViscoplasticDesai.__init__-994"><a href="#ViscoplasticDesai.__init__-994"><span class="linenos"> 994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
</span><span id="ViscoplasticDesai.__init__-995"><a href="#ViscoplasticDesai.__init__-995"><span class="linenos"> 995</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
</span><span id="ViscoplasticDesai.__init__-996"><a href="#ViscoplasticDesai.__init__-996"><span class="linenos"> 996</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="ViscoplasticDesai.__init__-997"><a href="#ViscoplasticDesai.__init__-997"><span class="linenos"> 997</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_t</span> <span class="o">=</span> <span class="n">sigma_t</span>
</span><span id="ViscoplasticDesai.__init__-998"><a href="#ViscoplasticDesai.__init__-998"><span class="linenos"> 998</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span> <span class="o">=</span> <span class="n">alpha_0</span>
</span><span id="ViscoplasticDesai.__init__-999"><a href="#ViscoplasticDesai.__init__-999"><span class="linenos"> 999</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">F_0</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai.__init__-1000"><a href="#ViscoplasticDesai.__init__-1000"><span class="linenos">1000</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.__init__-1001"><a href="#ViscoplasticDesai.__init__-1001"><span class="linenos">1001</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai.__init__-1002"><a href="#ViscoplasticDesai.__init__-1002"><span class="linenos">1002</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Fvp</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.__init__-1003"><a href="#ViscoplasticDesai.__init__-1003"><span class="linenos">1003</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.__init__-1004"><a href="#ViscoplasticDesai.__init__-1004"><span class="linenos">1004</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi_old</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ViscoplasticDesai.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.name"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.mu_1" class="classattr">
                                <div class="attr variable">
            <span class="name">mu_1</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.mu_1"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.N_1" class="classattr">
                                <div class="attr variable">
            <span class="name">N_1</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.N_1"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.a_1" class="classattr">
                                <div class="attr variable">
            <span class="name">a_1</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.a_1"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.eta" class="classattr">
                                <div class="attr variable">
            <span class="name">eta</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.eta"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.n" class="classattr">
                                <div class="attr variable">
            <span class="name">n</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.n"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.beta_1" class="classattr">
                                <div class="attr variable">
            <span class="name">beta_1</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.beta_1"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.beta" class="classattr">
                                <div class="attr variable">
            <span class="name">beta</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.beta"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.m" class="classattr">
                                <div class="attr variable">
            <span class="name">m</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.m"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.gamma" class="classattr">
                                <div class="attr variable">
            <span class="name">gamma</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.gamma"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.sigma_t" class="classattr">
                                <div class="attr variable">
            <span class="name">sigma_t</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.sigma_t"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.alpha_0" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha_0</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.alpha_0"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.F_0" class="classattr">
                                <div class="attr variable">
            <span class="name">F_0</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.F_0"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.n_elems" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elems</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.n_elems"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.alpha"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.Fvp" class="classattr">
                                <div class="attr variable">
            <span class="name">Fvp</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.Fvp"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.qsi" class="classattr">
                                <div class="attr variable">
            <span class="name">qsi</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.qsi"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.qsi_old" class="classattr">
                                <div class="attr variable">
            <span class="name">qsi_old</span>

        
    </div>
    <a class="headerlink" href="#ViscoplasticDesai.qsi_old"></a>
    
    

                            </div>
                            <div id="ViscoplasticDesai.compute_residue" class="classattr">
                                        <input id="ViscoplasticDesai.compute_residue-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_residue</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">eps_rate</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">alpha</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_residue-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_residue"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_residue-1006"><a href="#ViscoplasticDesai.compute_residue-1006"><span class="linenos">1006</span></a>    <span class="k">def</span> <span class="nf">compute_residue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps_rate</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_residue-1007"><a href="#ViscoplasticDesai.compute_residue-1007"><span class="linenos">1007</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_residue-1008"><a href="#ViscoplasticDesai.compute_residue-1008"><span class="linenos">1008</span></a><span class="sd">        Residue of the implicit hardening equation.</span>
</span><span id="ViscoplasticDesai.compute_residue-1009"><a href="#ViscoplasticDesai.compute_residue-1009"><span class="linenos">1009</span></a>
</span><span id="ViscoplasticDesai.compute_residue-1010"><a href="#ViscoplasticDesai.compute_residue-1010"><span class="linenos">1010</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_residue-1011"><a href="#ViscoplasticDesai.compute_residue-1011"><span class="linenos">1011</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_residue-1012"><a href="#ViscoplasticDesai.compute_residue-1012"><span class="linenos">1012</span></a><span class="sd">        eps_rate : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_residue-1013"><a href="#ViscoplasticDesai.compute_residue-1013"><span class="linenos">1013</span></a><span class="sd">            Current inelastic strain rate, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_residue-1014"><a href="#ViscoplasticDesai.compute_residue-1014"><span class="linenos">1014</span></a><span class="sd">        alpha : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_residue-1015"><a href="#ViscoplasticDesai.compute_residue-1015"><span class="linenos">1015</span></a><span class="sd">            Hardening variable, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_residue-1016"><a href="#ViscoplasticDesai.compute_residue-1016"><span class="linenos">1016</span></a><span class="sd">        dt : float</span>
</span><span id="ViscoplasticDesai.compute_residue-1017"><a href="#ViscoplasticDesai.compute_residue-1017"><span class="linenos">1017</span></a><span class="sd">            Time step.</span>
</span><span id="ViscoplasticDesai.compute_residue-1018"><a href="#ViscoplasticDesai.compute_residue-1018"><span class="linenos">1018</span></a>
</span><span id="ViscoplasticDesai.compute_residue-1019"><a href="#ViscoplasticDesai.compute_residue-1019"><span class="linenos">1019</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_residue-1020"><a href="#ViscoplasticDesai.compute_residue-1020"><span class="linenos">1020</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_residue-1021"><a href="#ViscoplasticDesai.compute_residue-1021"><span class="linenos">1021</span></a><span class="sd">        torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_residue-1022"><a href="#ViscoplasticDesai.compute_residue-1022"><span class="linenos">1022</span></a><span class="sd">            Residue per element, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_residue-1023"><a href="#ViscoplasticDesai.compute_residue-1023"><span class="linenos">1023</span></a>
</span><span id="ViscoplasticDesai.compute_residue-1024"><a href="#ViscoplasticDesai.compute_residue-1024"><span class="linenos">1024</span></a><span class="sd">        Notes</span>
</span><span id="ViscoplasticDesai.compute_residue-1025"><a href="#ViscoplasticDesai.compute_residue-1025"><span class="linenos">1025</span></a><span class="sd">        -----</span>
</span><span id="ViscoplasticDesai.compute_residue-1026"><a href="#ViscoplasticDesai.compute_residue-1026"><span class="linenos">1026</span></a><span class="sd">        Updates `self.qsi` internally based on `eps_rate`.</span>
</span><span id="ViscoplasticDesai.compute_residue-1027"><a href="#ViscoplasticDesai.compute_residue-1027"><span class="linenos">1027</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_residue-1028"><a href="#ViscoplasticDesai.compute_residue-1028"><span class="linenos">1028</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsi_old</span> <span class="o">+</span> <span class="n">to</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eps_rate</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span>
</span><span id="ViscoplasticDesai.compute_residue-1029"><a href="#ViscoplasticDesai.compute_residue-1029"><span class="linenos">1029</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_1</span> <span class="o">/</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">a_1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Residue of the implicit hardening equation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps_rate</strong> (torch.Tensor):
Current inelastic strain rate, shape (N, 3, 3).</li>
<li><strong>alpha</strong> (torch.Tensor):
Hardening variable, shape (N,).</li>
<li><strong>dt</strong> (float):
Time step.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: Residue per element, shape (N,).</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Updates <code>self.qsi</code> internally based on <code>eps_rate</code>.</p>
</div>


                            </div>
                            <div id="ViscoplasticDesai.update_internal_variables" class="classattr">
                                        <input id="ViscoplasticDesai.update_internal_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_internal_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.update_internal_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.update_internal_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.update_internal_variables-1031"><a href="#ViscoplasticDesai.update_internal_variables-1031"><span class="linenos">1031</span></a>    <span class="k">def</span> <span class="nf">update_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1032"><a href="#ViscoplasticDesai.update_internal_variables-1032"><span class="linenos">1032</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1033"><a href="#ViscoplasticDesai.update_internal_variables-1033"><span class="linenos">1033</span></a><span class="sd">        Commit accumulated measure `qsi`.</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1034"><a href="#ViscoplasticDesai.update_internal_variables-1034"><span class="linenos">1034</span></a>
</span><span id="ViscoplasticDesai.update_internal_variables-1035"><a href="#ViscoplasticDesai.update_internal_variables-1035"><span class="linenos">1035</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1036"><a href="#ViscoplasticDesai.update_internal_variables-1036"><span class="linenos">1036</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1037"><a href="#ViscoplasticDesai.update_internal_variables-1037"><span class="linenos">1037</span></a><span class="sd">        None</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1038"><a href="#ViscoplasticDesai.update_internal_variables-1038"><span class="linenos">1038</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.update_internal_variables-1039"><a href="#ViscoplasticDesai.update_internal_variables-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qsi_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsi</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Commit accumulated measure <code><a href="#ViscoplasticDesai.qsi">qsi</a></code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="ViscoplasticDesai.increment_internal_variables" class="classattr">
                                        <input id="ViscoplasticDesai.increment_internal_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">increment_internal_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">stress_k</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.increment_internal_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.increment_internal_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.increment_internal_variables-1041"><a href="#ViscoplasticDesai.increment_internal_variables-1041"><span class="linenos">1041</span></a>    <span class="k">def</span> <span class="nf">increment_internal_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">stress_k</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1042"><a href="#ViscoplasticDesai.increment_internal_variables-1042"><span class="linenos">1042</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1043"><a href="#ViscoplasticDesai.increment_internal_variables-1043"><span class="linenos">1043</span></a><span class="sd">        Increment hardening variable `alpha` using linearization.</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1044"><a href="#ViscoplasticDesai.increment_internal_variables-1044"><span class="linenos">1044</span></a>
</span><span id="ViscoplasticDesai.increment_internal_variables-1045"><a href="#ViscoplasticDesai.increment_internal_variables-1045"><span class="linenos">1045</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1046"><a href="#ViscoplasticDesai.increment_internal_variables-1046"><span class="linenos">1046</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1047"><a href="#ViscoplasticDesai.increment_internal_variables-1047"><span class="linenos">1047</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1048"><a href="#ViscoplasticDesai.increment_internal_variables-1048"><span class="linenos">1048</span></a><span class="sd">            End-of-step stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1049"><a href="#ViscoplasticDesai.increment_internal_variables-1049"><span class="linenos">1049</span></a><span class="sd">        stress_k : torch.Tensor</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1050"><a href="#ViscoplasticDesai.increment_internal_variables-1050"><span class="linenos">1050</span></a><span class="sd">            Intermediate stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1051"><a href="#ViscoplasticDesai.increment_internal_variables-1051"><span class="linenos">1051</span></a><span class="sd">        dt : float</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1052"><a href="#ViscoplasticDesai.increment_internal_variables-1052"><span class="linenos">1052</span></a><span class="sd">            Time step.</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1053"><a href="#ViscoplasticDesai.increment_internal_variables-1053"><span class="linenos">1053</span></a>
</span><span id="ViscoplasticDesai.increment_internal_variables-1054"><a href="#ViscoplasticDesai.increment_internal_variables-1054"><span class="linenos">1054</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1055"><a href="#ViscoplasticDesai.increment_internal_variables-1055"><span class="linenos">1055</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1056"><a href="#ViscoplasticDesai.increment_internal_variables-1056"><span class="linenos">1056</span></a><span class="sd">        None</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1057"><a href="#ViscoplasticDesai.increment_internal_variables-1057"><span class="linenos">1057</span></a>
</span><span id="ViscoplasticDesai.increment_internal_variables-1058"><a href="#ViscoplasticDesai.increment_internal_variables-1058"><span class="linenos">1058</span></a><span class="sd">        Side Effects</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1059"><a href="#ViscoplasticDesai.increment_internal_variables-1059"><span class="linenos">1059</span></a><span class="sd">        ------------</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1060"><a href="#ViscoplasticDesai.increment_internal_variables-1060"><span class="linenos">1060</span></a><span class="sd">        Updates `self.alpha`.</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1061"><a href="#ViscoplasticDesai.increment_internal_variables-1061"><span class="linenos">1061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1062"><a href="#ViscoplasticDesai.increment_internal_variables-1062"><span class="linenos">1062</span></a>        <span class="n">delta_alpha</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">to</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bij,bij-&gt;b&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">stress</span> <span class="o">-</span> <span class="n">stress_k</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="ViscoplasticDesai.increment_internal_variables-1063"><a href="#ViscoplasticDesai.increment_internal_variables-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+=</span> <span class="n">delta_alpha</span>
</span></pre></div>


            <div class="docstring"><p>Increment hardening variable <code><a href="#ViscoplasticDesai.alpha">alpha</a></code> using linearization.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
End-of-step stress, shape (N, 3, 3).</li>
<li><strong>stress_k</strong> (torch.Tensor):
Intermediate stress, shape (N, 3, 3).</li>
<li><strong>dt</strong> (float):
Time step.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Updates <code>self.alpha</code>.</p>
</div>


                            </div>
                            <div id="ViscoplasticDesai.compute_stress_invariants" class="classattr">
                                        <input id="ViscoplasticDesai.compute_stress_invariants-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_stress_invariants</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">s_xx</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">s_yy</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">s_zz</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">s_xy</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">s_xz</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">s_yz</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_stress_invariants-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_stress_invariants"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_stress_invariants-1065"><a href="#ViscoplasticDesai.compute_stress_invariants-1065"><span class="linenos">1065</span></a>    <span class="k">def</span> <span class="nf">compute_stress_invariants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_xx</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1066"><a href="#ViscoplasticDesai.compute_stress_invariants-1066"><span class="linenos">1066</span></a>										<span class="n">s_yy</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1067"><a href="#ViscoplasticDesai.compute_stress_invariants-1067"><span class="linenos">1067</span></a>										<span class="n">s_zz</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1068"><a href="#ViscoplasticDesai.compute_stress_invariants-1068"><span class="linenos">1068</span></a>										<span class="n">s_xy</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1069"><a href="#ViscoplasticDesai.compute_stress_invariants-1069"><span class="linenos">1069</span></a>										<span class="n">s_xz</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1070"><a href="#ViscoplasticDesai.compute_stress_invariants-1070"><span class="linenos">1070</span></a>										<span class="n">s_yz</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1071"><a href="#ViscoplasticDesai.compute_stress_invariants-1071"><span class="linenos">1071</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1072"><a href="#ViscoplasticDesai.compute_stress_invariants-1072"><span class="linenos">1072</span></a><span class="sd">        Compute invariants (I1, I2, I3, J2, J3) and auxiliary quantities.</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1073"><a href="#ViscoplasticDesai.compute_stress_invariants-1073"><span class="linenos">1073</span></a>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1074"><a href="#ViscoplasticDesai.compute_stress_invariants-1074"><span class="linenos">1074</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1075"><a href="#ViscoplasticDesai.compute_stress_invariants-1075"><span class="linenos">1075</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1076"><a href="#ViscoplasticDesai.compute_stress_invariants-1076"><span class="linenos">1076</span></a><span class="sd">        s_xx, s_yy, s_zz, s_xy, s_xz, s_yz : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1077"><a href="#ViscoplasticDesai.compute_stress_invariants-1077"><span class="linenos">1077</span></a><span class="sd">            Normal and shear components (MPa-scaled as provided), each shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1078"><a href="#ViscoplasticDesai.compute_stress_invariants-1078"><span class="linenos">1078</span></a>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1079"><a href="#ViscoplasticDesai.compute_stress_invariants-1079"><span class="linenos">1079</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1080"><a href="#ViscoplasticDesai.compute_stress_invariants-1080"><span class="linenos">1080</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1081"><a href="#ViscoplasticDesai.compute_stress_invariants-1081"><span class="linenos">1081</span></a><span class="sd">        I1, I2, I3, J2, J3, Sr, I1_star, ind_J2_leq_0 : tuple of torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1082"><a href="#ViscoplasticDesai.compute_stress_invariants-1082"><span class="linenos">1082</span></a><span class="sd">            Invariants and helper arrays; `ind_J2_leq_0` are indices where `J2 &lt;= 0`.</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1083"><a href="#ViscoplasticDesai.compute_stress_invariants-1083"><span class="linenos">1083</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1084"><a href="#ViscoplasticDesai.compute_stress_invariants-1084"><span class="linenos">1084</span></a>        <span class="n">I1</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_zz</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1085"><a href="#ViscoplasticDesai.compute_stress_invariants-1085"><span class="linenos">1085</span></a>        <span class="n">I2</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">+</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">-</span> <span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1086"><a href="#ViscoplasticDesai.compute_stress_invariants-1086"><span class="linenos">1086</span></a>        <span class="n">I3</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yy</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">s_xy</span><span class="o">*</span><span class="n">s_yz</span><span class="o">*</span><span class="n">s_xz</span> <span class="o">-</span> <span class="n">s_zz</span><span class="o">*</span><span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1087"><a href="#ViscoplasticDesai.compute_stress_invariants-1087"><span class="linenos">1087</span></a>        <span class="n">J2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">I2</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1088"><a href="#ViscoplasticDesai.compute_stress_invariants-1088"><span class="linenos">1088</span></a>        <span class="n">J3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">27</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">*</span><span class="n">I2</span> <span class="o">+</span> <span class="n">I3</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1089"><a href="#ViscoplasticDesai.compute_stress_invariants-1089"><span class="linenos">1089</span></a>        <span class="n">Sr</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">J3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">27</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J2</span><span class="o">**</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1090"><a href="#ViscoplasticDesai.compute_stress_invariants-1090"><span class="linenos">1090</span></a>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1091"><a href="#ViscoplasticDesai.compute_stress_invariants-1091"><span class="linenos">1091</span></a>        <span class="c1"># Check where J2 &lt;= 0.0</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1092"><a href="#ViscoplasticDesai.compute_stress_invariants-1092"><span class="linenos">1092</span></a>        <span class="n">ind_J2_leq_0</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">J2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1093"><a href="#ViscoplasticDesai.compute_stress_invariants-1093"><span class="linenos">1093</span></a>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1094"><a href="#ViscoplasticDesai.compute_stress_invariants-1094"><span class="linenos">1094</span></a>        <span class="c1"># Sr will be nan if, J2=0.0. So, replace it by 0.0</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1095"><a href="#ViscoplasticDesai.compute_stress_invariants-1095"><span class="linenos">1095</span></a>        <span class="n">Sr</span><span class="p">[</span><span class="n">ind_J2_leq_0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1096"><a href="#ViscoplasticDesai.compute_stress_invariants-1096"><span class="linenos">1096</span></a>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1097"><a href="#ViscoplasticDesai.compute_stress_invariants-1097"><span class="linenos">1097</span></a>        <span class="n">I1_star</span> <span class="o">=</span> <span class="n">I1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_t</span>
</span><span id="ViscoplasticDesai.compute_stress_invariants-1098"><a href="#ViscoplasticDesai.compute_stress_invariants-1098"><span class="linenos">1098</span></a>        <span class="k">return</span> <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">ind_J2_leq_0</span>
</span></pre></div>


            <div class="docstring"><p>Compute invariants (I1, I2, I3, J2, J3) and auxiliary quantities.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>s_xx, s_yy, s_zz, s_xy, s_xz, s_yz</strong> (torch.Tensor):
Normal and shear components (MPa-scaled as provided), each shape (N,).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>I1, I2, I3, J2, J3, Sr, I1_star, ind_J2_leq_0</strong> (tuple of torch.Tensor):
Invariants and helper arrays; <code>ind_J2_leq_0</code> are indices where <code>J2 &lt;= 0</code>.</li>
</ul>
</div>


                            </div>
                            <div id="ViscoplasticDesai.extract_stress_components" class="classattr">
                                        <input id="ViscoplasticDesai.extract_stress_components-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_stress_components</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.extract_stress_components-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.extract_stress_components"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.extract_stress_components-1100"><a href="#ViscoplasticDesai.extract_stress_components-1100"><span class="linenos">1100</span></a>    <span class="k">def</span> <span class="nf">extract_stress_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1101"><a href="#ViscoplasticDesai.extract_stress_components-1101"><span class="linenos">1101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1102"><a href="#ViscoplasticDesai.extract_stress_components-1102"><span class="linenos">1102</span></a><span class="sd">        Extract and scale stress components from a 33 tensor.</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1103"><a href="#ViscoplasticDesai.extract_stress_components-1103"><span class="linenos">1103</span></a>
</span><span id="ViscoplasticDesai.extract_stress_components-1104"><a href="#ViscoplasticDesai.extract_stress_components-1104"><span class="linenos">1104</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1105"><a href="#ViscoplasticDesai.extract_stress_components-1105"><span class="linenos">1105</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1106"><a href="#ViscoplasticDesai.extract_stress_components-1106"><span class="linenos">1106</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1107"><a href="#ViscoplasticDesai.extract_stress_components-1107"><span class="linenos">1107</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1108"><a href="#ViscoplasticDesai.extract_stress_components-1108"><span class="linenos">1108</span></a>
</span><span id="ViscoplasticDesai.extract_stress_components-1109"><a href="#ViscoplasticDesai.extract_stress_components-1109"><span class="linenos">1109</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1110"><a href="#ViscoplasticDesai.extract_stress_components-1110"><span class="linenos">1110</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1111"><a href="#ViscoplasticDesai.extract_stress_components-1111"><span class="linenos">1111</span></a><span class="sd">        tuple[torch.Tensor, ...]</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1112"><a href="#ViscoplasticDesai.extract_stress_components-1112"><span class="linenos">1112</span></a><span class="sd">            `(s_xx, s_yy, s_zz, s_xy, s_xz, s_yz)`, each shape (N,).</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1113"><a href="#ViscoplasticDesai.extract_stress_components-1113"><span class="linenos">1113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1114"><a href="#ViscoplasticDesai.extract_stress_components-1114"><span class="linenos">1114</span></a>        <span class="n">stress_vec</span> <span class="o">=</span> <span class="o">-</span><span class="n">stress</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1115"><a href="#ViscoplasticDesai.extract_stress_components-1115"><span class="linenos">1115</span></a>        <span class="n">s_xx</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1116"><a href="#ViscoplasticDesai.extract_stress_components-1116"><span class="linenos">1116</span></a>        <span class="n">s_yy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1117"><a href="#ViscoplasticDesai.extract_stress_components-1117"><span class="linenos">1117</span></a>        <span class="n">s_zz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1118"><a href="#ViscoplasticDesai.extract_stress_components-1118"><span class="linenos">1118</span></a>        <span class="n">s_xy</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1119"><a href="#ViscoplasticDesai.extract_stress_components-1119"><span class="linenos">1119</span></a>        <span class="n">s_xz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1120"><a href="#ViscoplasticDesai.extract_stress_components-1120"><span class="linenos">1120</span></a>        <span class="n">s_yz</span> <span class="o">=</span> <span class="n">stress_vec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">MPa</span>
</span><span id="ViscoplasticDesai.extract_stress_components-1121"><a href="#ViscoplasticDesai.extract_stress_components-1121"><span class="linenos">1121</span></a>        <span class="k">return</span> <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span>
</span></pre></div>


            <div class="docstring"><p>Extract and scale stress components from a 33 tensor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple[torch.Tensor, ...]</strong>: <code>(s_xx, s_yy, s_zz, s_xy, s_xz, s_yz)</code>, each shape (N,).</li>
</ul>
</div>


                            </div>
                            <div id="ViscoplasticDesai.compute_Fvp" class="classattr">
                                        <input id="ViscoplasticDesai.compute_Fvp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_Fvp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">alpha</span>, </span><span class="param"><span class="n">I1</span>, </span><span class="param"><span class="n">J2</span>, </span><span class="param"><span class="n">Sr</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_Fvp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_Fvp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_Fvp-1123"><a href="#ViscoplasticDesai.compute_Fvp-1123"><span class="linenos">1123</span></a>    <span class="k">def</span> <span class="nf">compute_Fvp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">I1</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">Sr</span><span class="p">):</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1124"><a href="#ViscoplasticDesai.compute_Fvp-1124"><span class="linenos">1124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1125"><a href="#ViscoplasticDesai.compute_Fvp-1125"><span class="linenos">1125</span></a><span class="sd">        Compute the Desai viscoplastic yield function value `Fvp`.</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1126"><a href="#ViscoplasticDesai.compute_Fvp-1126"><span class="linenos">1126</span></a>
</span><span id="ViscoplasticDesai.compute_Fvp-1127"><a href="#ViscoplasticDesai.compute_Fvp-1127"><span class="linenos">1127</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1128"><a href="#ViscoplasticDesai.compute_Fvp-1128"><span class="linenos">1128</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1129"><a href="#ViscoplasticDesai.compute_Fvp-1129"><span class="linenos">1129</span></a><span class="sd">        alpha : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1130"><a href="#ViscoplasticDesai.compute_Fvp-1130"><span class="linenos">1130</span></a><span class="sd">            Hardening variable per element, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1131"><a href="#ViscoplasticDesai.compute_Fvp-1131"><span class="linenos">1131</span></a><span class="sd">        I1 : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1132"><a href="#ViscoplasticDesai.compute_Fvp-1132"><span class="linenos">1132</span></a><span class="sd">            First invariant, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1133"><a href="#ViscoplasticDesai.compute_Fvp-1133"><span class="linenos">1133</span></a><span class="sd">        J2 : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1134"><a href="#ViscoplasticDesai.compute_Fvp-1134"><span class="linenos">1134</span></a><span class="sd">            Second deviatoric invariant, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1135"><a href="#ViscoplasticDesai.compute_Fvp-1135"><span class="linenos">1135</span></a><span class="sd">        Sr : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1136"><a href="#ViscoplasticDesai.compute_Fvp-1136"><span class="linenos">1136</span></a><span class="sd">            Lode-related parameter, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1137"><a href="#ViscoplasticDesai.compute_Fvp-1137"><span class="linenos">1137</span></a>
</span><span id="ViscoplasticDesai.compute_Fvp-1138"><a href="#ViscoplasticDesai.compute_Fvp-1138"><span class="linenos">1138</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1139"><a href="#ViscoplasticDesai.compute_Fvp-1139"><span class="linenos">1139</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1140"><a href="#ViscoplasticDesai.compute_Fvp-1140"><span class="linenos">1140</span></a><span class="sd">        torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1141"><a href="#ViscoplasticDesai.compute_Fvp-1141"><span class="linenos">1141</span></a><span class="sd">            `Fvp` per element, shape (N,).</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1142"><a href="#ViscoplasticDesai.compute_Fvp-1142"><span class="linenos">1142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1143"><a href="#ViscoplasticDesai.compute_Fvp-1143"><span class="linenos">1143</span></a>        <span class="n">F1</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1144"><a href="#ViscoplasticDesai.compute_Fvp-1144"><span class="linenos">1144</span></a>        <span class="n">F2</span> <span class="o">=</span> <span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1145"><a href="#ViscoplasticDesai.compute_Fvp-1145"><span class="linenos">1145</span></a>        <span class="n">Fvp</span> <span class="o">=</span> <span class="n">J2</span> <span class="o">+</span> <span class="n">F1</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span>
</span><span id="ViscoplasticDesai.compute_Fvp-1146"><a href="#ViscoplasticDesai.compute_Fvp-1146"><span class="linenos">1146</span></a>        <span class="k">return</span> <span class="n">Fvp</span>
</span></pre></div>


            <div class="docstring"><p>Compute the Desai viscoplastic yield function value <code><a href="#ViscoplasticDesai.Fvp">Fvp</a></code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>alpha</strong> (torch.Tensor):
Hardening variable per element, shape (N,).</li>
<li><strong>I1</strong> (torch.Tensor):
First invariant, shape (N,).</li>
<li><strong>J2</strong> (torch.Tensor):
Second deviatoric invariant, shape (N,).</li>
<li><strong>Sr</strong> (torch.Tensor):
Lode-related parameter, shape (N,).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: <code><a href="#ViscoplasticDesai.Fvp">Fvp</a></code> per element, shape (N,).</li>
</ul>
</div>


                            </div>
                            <div id="ViscoplasticDesai.compute_initial_hardening" class="classattr">
                                        <input id="ViscoplasticDesai.compute_initial_hardening-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_initial_hardening</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">Fvp_0</span><span class="o">=</span><span class="mf">0.0</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_initial_hardening-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_initial_hardening"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_initial_hardening-1148"><a href="#ViscoplasticDesai.compute_initial_hardening-1148"><span class="linenos">1148</span></a>    <span class="k">def</span> <span class="nf">compute_initial_hardening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">Fvp_0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1149"><a href="#ViscoplasticDesai.compute_initial_hardening-1149"><span class="linenos">1149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1150"><a href="#ViscoplasticDesai.compute_initial_hardening-1150"><span class="linenos">1150</span></a><span class="sd">        Initialize `alpha` from a target `Fvp_0` and the current stress state.</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1151"><a href="#ViscoplasticDesai.compute_initial_hardening-1151"><span class="linenos">1151</span></a>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1152"><a href="#ViscoplasticDesai.compute_initial_hardening-1152"><span class="linenos">1152</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1153"><a href="#ViscoplasticDesai.compute_initial_hardening-1153"><span class="linenos">1153</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1154"><a href="#ViscoplasticDesai.compute_initial_hardening-1154"><span class="linenos">1154</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1155"><a href="#ViscoplasticDesai.compute_initial_hardening-1155"><span class="linenos">1155</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1156"><a href="#ViscoplasticDesai.compute_initial_hardening-1156"><span class="linenos">1156</span></a><span class="sd">        Fvp_0 : float, default=0.0</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1157"><a href="#ViscoplasticDesai.compute_initial_hardening-1157"><span class="linenos">1157</span></a><span class="sd">            Target initial value for `Fvp`.</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1158"><a href="#ViscoplasticDesai.compute_initial_hardening-1158"><span class="linenos">1158</span></a>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1159"><a href="#ViscoplasticDesai.compute_initial_hardening-1159"><span class="linenos">1159</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1160"><a href="#ViscoplasticDesai.compute_initial_hardening-1160"><span class="linenos">1160</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1161"><a href="#ViscoplasticDesai.compute_initial_hardening-1161"><span class="linenos">1161</span></a><span class="sd">        None</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1162"><a href="#ViscoplasticDesai.compute_initial_hardening-1162"><span class="linenos">1162</span></a>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1163"><a href="#ViscoplasticDesai.compute_initial_hardening-1163"><span class="linenos">1163</span></a><span class="sd">        Side Effects</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1164"><a href="#ViscoplasticDesai.compute_initial_hardening-1164"><span class="linenos">1164</span></a><span class="sd">        ------------</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1165"><a href="#ViscoplasticDesai.compute_initial_hardening-1165"><span class="linenos">1165</span></a><span class="sd">        Sets `self.alpha_0`, `self.alpha`, and `self.Fvp`.</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1166"><a href="#ViscoplasticDesai.compute_initial_hardening-1166"><span class="linenos">1166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1167"><a href="#ViscoplasticDesai.compute_initial_hardening-1167"><span class="linenos">1167</span></a>        <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stress_components</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1168"><a href="#ViscoplasticDesai.compute_initial_hardening-1168"><span class="linenos">1168</span></a>        <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_stress_invariants</span><span class="p">(</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1169"><a href="#ViscoplasticDesai.compute_initial_hardening-1169"><span class="linenos">1169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1_star</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Fvp_0</span> <span class="o">-</span> <span class="n">J2</span><span class="p">)</span><span class="o">*</span><span class="n">I1_star</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1_star</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">Sr</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1170"><a href="#ViscoplasticDesai.compute_initial_hardening-1170"><span class="linenos">1170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_0</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1171"><a href="#ViscoplasticDesai.compute_initial_hardening-1171"><span class="linenos">1171</span></a>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1172"><a href="#ViscoplasticDesai.compute_initial_hardening-1172"><span class="linenos">1172</span></a>        <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stress_components</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1173"><a href="#ViscoplasticDesai.compute_initial_hardening-1173"><span class="linenos">1173</span></a>        <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">ind_J2_leq_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_stress_invariants</span><span class="p">(</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_initial_hardening-1174"><a href="#ViscoplasticDesai.compute_initial_hardening-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Fvp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Fvp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">Sr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize <code><a href="#ViscoplasticDesai.alpha">alpha</a></code> from a target <code>Fvp_0</code> and the current stress state.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3).</li>
<li><strong>Fvp_0</strong> (float, default=0.0):
Target initial value for <code><a href="#ViscoplasticDesai.Fvp">Fvp</a></code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<p>Sets <code>self.alpha_0</code>, <code>self.alpha</code>, and <code>self.Fvp</code>.</p>
</div>


                            </div>
                            <div id="ViscoplasticDesai.compute_eps_ne_rate" class="classattr">
                                        <input id="ViscoplasticDesai.compute_eps_ne_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_ne_rate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">alpha</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_eps_ne_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_eps_ne_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_eps_ne_rate-1177"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1177"><span class="linenos">1177</span></a>    <span class="k">def</span> <span class="nf">compute_eps_ne_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">phi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1178"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1179"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1179"><span class="linenos">1179</span></a><span class="sd">        Compute viscoplastic strain rate and optionally return it.</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1180"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1180"><span class="linenos">1180</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1181"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1181"><span class="linenos">1181</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1182"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1182"><span class="linenos">1182</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1183"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1183"><span class="linenos">1183</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1184"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1184"><span class="linenos">1184</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1185"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1185"><span class="linenos">1185</span></a><span class="sd">        phi1 : float</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1186"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1186"><span class="linenos">1186</span></a><span class="sd">            Time integration factor (dt*theta).</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1187"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1187"><span class="linenos">1187</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1188"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1188"><span class="linenos">1188</span></a><span class="sd">            Temperature per element (unused).</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1189"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1189"><span class="linenos">1189</span></a><span class="sd">        alpha : torch.Tensor or None, optional</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1190"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1190"><span class="linenos">1190</span></a><span class="sd">            Hardening variable override; if `None`, use `self.alpha`.</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1191"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1191"><span class="linenos">1191</span></a><span class="sd">        return_eps_ne : bool, default=False</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1192"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1192"><span class="linenos">1192</span></a><span class="sd">            If True, return rate; else store it.</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1193"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1193"><span class="linenos">1193</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1194"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1194"><span class="linenos">1194</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1195"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1195"><span class="linenos">1195</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1196"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1196"><span class="linenos">1196</span></a><span class="sd">        None or torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1197"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1197"><span class="linenos">1197</span></a><span class="sd">            (N, 3, 3) if `return_eps_ne=True`, else `None`.</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1198"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1198"><span class="linenos">1198</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1199"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1199"><span class="linenos">1199</span></a><span class="sd">        Notes</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1200"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1200"><span class="linenos">1200</span></a><span class="sd">        -----</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1201"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1201"><span class="linenos">1201</span></a><span class="sd">        Also updates `self.Fvp` when `return_eps_ne=False`.</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1202"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1202"><span class="linenos">1202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1203"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1203"><span class="linenos">1203</span></a>        <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1204"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1204"><span class="linenos">1204</span></a>        	<span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1205"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1205"><span class="linenos">1205</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1206"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1206"><span class="linenos">1206</span></a>        <span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stress_components</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1207"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1207"><span class="linenos">1207</span></a>        <span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I3</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">J3</span><span class="p">,</span> <span class="n">Sr</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">ind_J2_leq_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_stress_invariants</span><span class="p">(</span><span class="n">s_xx</span><span class="p">,</span> <span class="n">s_yy</span><span class="p">,</span> <span class="n">s_zz</span><span class="p">,</span> <span class="n">s_xy</span><span class="p">,</span> <span class="n">s_xz</span><span class="p">,</span> <span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1208"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1208"><span class="linenos">1208</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1209"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1209"><span class="linenos">1209</span></a>        <span class="c1"># Compute yield function</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1210"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1210"><span class="linenos">1210</span></a>        <span class="n">Fvp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Fvp</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">I1_star</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1211"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1211"><span class="linenos">1211</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1212"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1212"><span class="linenos">1212</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">Fvp</span> <span class="o">=</span> <span class="n">Fvp</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1213"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1213"><span class="linenos">1213</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1214"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1214"><span class="linenos">1214</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1215"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1215"><span class="linenos">1215</span></a>        <span class="c1"># Compute flow direction, i.e. d(Fvp)/d(stress)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1216"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1216"><span class="linenos">1216</span></a>        <span class="n">F1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1217"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1217"><span class="linenos">1217</span></a>        <span class="n">F2</span> <span class="o">=</span> <span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">Sr</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1218"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1218"><span class="linenos">1218</span></a>        <span class="n">dF1_dI1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="n">I1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1219"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1219"><span class="linenos">1219</span></a>        <span class="n">dF2m_dI1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="n">to</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta_1</span><span class="o">*</span><span class="n">I1</span><span class="p">)</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1220"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1220"><span class="linenos">1220</span></a>        <span class="n">dF_dI1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">dF1_dI1</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">F1</span><span class="o">*</span><span class="n">dF2m_dI1</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1221"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1221"><span class="linenos">1221</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1222"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1222"><span class="linenos">1222</span></a>        <span class="n">dF2_dJ2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">J3</span><span class="o">*</span><span class="mi">27</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">J2</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1223"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1223"><span class="linenos">1223</span></a>        <span class="n">dF_dJ2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">F1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dF2_dJ2</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1224"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1224"><span class="linenos">1224</span></a>        <span class="n">dF_dJ3</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="n">F1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span><span class="o">*</span><span class="n">F2</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J2</span><span class="o">**</span><span class="mf">1.5</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1225"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1225"><span class="linenos">1225</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1226"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1226"><span class="linenos">1226</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1227"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1227"><span class="linenos">1227</span></a>        <span class="n">dI1_dSxx</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1228"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1228"><span class="linenos">1228</span></a>        <span class="n">dI1_dSyy</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1229"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1229"><span class="linenos">1229</span></a>        <span class="n">dI1_dSzz</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1230"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1230"><span class="linenos">1230</span></a>        <span class="n">dI1_dSxy</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1231"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1231"><span class="linenos">1231</span></a>        <span class="n">dI1_dSxz</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1232"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1232"><span class="linenos">1232</span></a>        <span class="n">dI1_dSyz</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1233"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1233"><span class="linenos">1233</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1234"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1234"><span class="linenos">1234</span></a>        <span class="n">dI2_dSxx</span> <span class="o">=</span> <span class="n">s_yy</span> <span class="o">+</span> <span class="n">s_zz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1235"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1235"><span class="linenos">1235</span></a>        <span class="n">dI2_dSyy</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_zz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1236"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1236"><span class="linenos">1236</span></a>        <span class="n">dI2_dSzz</span> <span class="o">=</span> <span class="n">s_xx</span> <span class="o">+</span> <span class="n">s_yy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1237"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1237"><span class="linenos">1237</span></a>        <span class="n">dI2_dSxy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s_xy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1238"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1238"><span class="linenos">1238</span></a>        <span class="n">dI2_dSxz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s_xz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1239"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1239"><span class="linenos">1239</span></a>        <span class="n">dI2_dSyz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s_yz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1240"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1240"><span class="linenos">1240</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1241"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1241"><span class="linenos">1241</span></a>        <span class="n">dI3_dSxx</span> <span class="o">=</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">-</span> <span class="n">s_yz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1242"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1242"><span class="linenos">1242</span></a>        <span class="n">dI3_dSyy</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_zz</span> <span class="o">-</span> <span class="n">s_xz</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1243"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1243"><span class="linenos">1243</span></a>        <span class="n">dI3_dSzz</span> <span class="o">=</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yy</span> <span class="o">-</span> <span class="n">s_xy</span><span class="o">**</span><span class="mi">2</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1244"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1244"><span class="linenos">1244</span></a>        <span class="n">dI3_dSxy</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_xz</span><span class="o">*</span><span class="n">s_yz</span> <span class="o">-</span> <span class="n">s_zz</span><span class="o">*</span><span class="n">s_xy</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1245"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1245"><span class="linenos">1245</span></a>        <span class="n">dI3_dSxz</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_xy</span><span class="o">*</span><span class="n">s_yz</span> <span class="o">-</span> <span class="n">s_yy</span><span class="o">*</span><span class="n">s_xz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1246"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1246"><span class="linenos">1246</span></a>        <span class="n">dI3_dSyz</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_xz</span><span class="o">*</span><span class="n">s_xy</span> <span class="o">-</span> <span class="n">s_xx</span><span class="o">*</span><span class="n">s_yz</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1247"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1247"><span class="linenos">1247</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1248"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1248"><span class="linenos">1248</span></a>        <span class="n">dJ2_dI1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1249"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1249"><span class="linenos">1249</span></a>        <span class="n">dJ2_dI2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1250"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1250"><span class="linenos">1250</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1251"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1251"><span class="linenos">1251</span></a>        <span class="n">dJ2_dSxx</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSxx</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSxx</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1252"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1252"><span class="linenos">1252</span></a>        <span class="n">dJ2_dSyy</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSyy</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSyy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1253"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1253"><span class="linenos">1253</span></a>        <span class="n">dJ2_dSzz</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSzz</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSzz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1254"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1254"><span class="linenos">1254</span></a>        <span class="n">dJ2_dSxy</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSxy</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSxy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1255"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1255"><span class="linenos">1255</span></a>        <span class="n">dJ2_dSxz</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSxz</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSxz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1256"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1256"><span class="linenos">1256</span></a>        <span class="n">dJ2_dSyz</span> <span class="o">=</span> <span class="n">dJ2_dI1</span><span class="o">*</span><span class="n">dI1_dSyz</span> <span class="o">+</span> <span class="n">dJ2_dI2</span><span class="o">*</span><span class="n">dI2_dSyz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1257"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1257"><span class="linenos">1257</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1258"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1258"><span class="linenos">1258</span></a>        <span class="n">dJ3_dI1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I2</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1259"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1259"><span class="linenos">1259</span></a>        <span class="n">dJ3_dI2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1260"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1260"><span class="linenos">1260</span></a>        <span class="n">dJ3_dI3</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1261"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1261"><span class="linenos">1261</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1262"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1262"><span class="linenos">1262</span></a>        <span class="n">dJ3_dSxx</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSxx</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSxx</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSxx</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1263"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1263"><span class="linenos">1263</span></a>        <span class="n">dJ3_dSyy</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSyy</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSyy</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSyy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1264"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1264"><span class="linenos">1264</span></a>        <span class="n">dJ3_dSzz</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSzz</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSzz</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSzz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1265"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1265"><span class="linenos">1265</span></a>        <span class="n">dJ3_dSxy</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSxy</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSxy</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSxy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1266"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1266"><span class="linenos">1266</span></a>        <span class="n">dJ3_dSxz</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSxz</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSxz</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSxz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1267"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1267"><span class="linenos">1267</span></a>        <span class="n">dJ3_dSyz</span> <span class="o">=</span> <span class="n">dJ3_dI1</span><span class="o">*</span><span class="n">dI1_dSyz</span> <span class="o">+</span> <span class="n">dJ3_dI2</span><span class="o">*</span><span class="n">dI2_dSyz</span> <span class="o">+</span> <span class="n">dJ3_dI3</span><span class="o">*</span><span class="n">dI3_dSyz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1268"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1268"><span class="linenos">1268</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1269"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1269"><span class="linenos">1269</span></a>        <span class="n">dQdS_00</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSxx</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSxx</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSxx</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1270"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1270"><span class="linenos">1270</span></a>        <span class="n">dQdS_11</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSyy</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSyy</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSyy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1271"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1271"><span class="linenos">1271</span></a>        <span class="n">dQdS_22</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSzz</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSzz</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSzz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1272"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1272"><span class="linenos">1272</span></a>        <span class="n">dQdS_01</span> <span class="o">=</span> <span class="n">dQdS_10</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSxy</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSxy</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSxy</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1273"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1273"><span class="linenos">1273</span></a>        <span class="n">dQdS_02</span> <span class="o">=</span> <span class="n">dQdS_20</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSxz</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSxz</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSxz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1274"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1274"><span class="linenos">1274</span></a>        <span class="n">dQdS_12</span> <span class="o">=</span> <span class="n">dQdS_21</span> <span class="o">=</span> <span class="n">dF_dI1</span><span class="o">*</span><span class="n">dI1_dSyz</span> <span class="o">+</span> <span class="n">dF_dJ2</span><span class="o">*</span><span class="n">dJ2_dSyz</span> <span class="o">+</span> <span class="n">dF_dJ3</span><span class="o">*</span><span class="n">dJ3_dSyz</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1275"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1275"><span class="linenos">1275</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1276"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1276"><span class="linenos">1276</span></a>        <span class="c1"># Initialize viscoplastic direction</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1277"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1277"><span class="linenos">1277</span></a>        <span class="n">dQdS</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1278"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1278"><span class="linenos">1278</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_00</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1279"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1279"><span class="linenos">1279</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_11</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1280"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1280"><span class="linenos">1280</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_22</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1281"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1281"><span class="linenos">1281</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_01</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1282"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1282"><span class="linenos">1282</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_02</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1283"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1283"><span class="linenos">1283</span></a>        <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dQdS_12</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1284"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1284"><span class="linenos">1284</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1285"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1285"><span class="linenos">1285</span></a>        <span class="c1"># Wherever J2=0, make viscoplasticity to be zero</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1286"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1286"><span class="linenos">1286</span></a>        <span class="n">dQdS</span><span class="p">[</span><span class="n">ind_J2_leq_0</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1287"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1287"><span class="linenos">1287</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1288"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1288"><span class="linenos">1288</span></a>        <span class="c1"># Calculate strain rate</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1289"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1289"><span class="linenos">1289</span></a>        <span class="n">ramp_idx</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Fvp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1290"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1290"><span class="linenos">1290</span></a>        <span class="n">lmbda</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1291"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ramp_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1292"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1292"><span class="linenos">1292</span></a>        	<span class="n">lmbda</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_1</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Fvp</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">F_0</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">N_1</span><span class="p">[</span><span class="n">ramp_idx</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1293"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1293"><span class="linenos">1293</span></a>        <span class="n">eps_vp_rate</span> <span class="o">=</span> <span class="o">-</span><span class="n">dQdS</span><span class="o">*</span><span class="n">lmbda</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1294"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1294"><span class="linenos">1294</span></a>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1295"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1295"><span class="linenos">1295</span></a>        <span class="k">if</span> <span class="n">return_eps_ne</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1296"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1296"><span class="linenos">1296</span></a>        	<span class="k">return</span> <span class="n">eps_vp_rate</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1297"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1297"><span class="linenos">1297</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_eps_ne_rate-1298"><a href="#ViscoplasticDesai.compute_eps_ne_rate-1298"><span class="linenos">1298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span> <span class="o">=</span> <span class="n">eps_vp_rate</span>
</span></pre></div>


            <div class="docstring"><p>Compute viscoplastic strain rate and optionally return it.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3).</li>
<li><strong>phi1</strong> (float):
Time integration factor (dt*theta).</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element (unused).</li>
<li><strong>alpha</strong> (torch.Tensor or None, optional):
Hardening variable override; if <code>None</code>, use <code>self.alpha</code>.</li>
<li><strong>return_eps_ne</strong> (bool, default=False):
If True, return rate; else store it.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None or torch.Tensor</strong>: (N, 3, 3) if <code>return_eps_ne=True</code>, else <code>None</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Also updates <code>self.Fvp</code> when <code>return_eps_ne=False</code>.</p>
</div>


                            </div>
                            <div id="ViscoplasticDesai.compute_B_and_H_over_h" class="classattr">
                                        <input id="ViscoplasticDesai.compute_B_and_H_over_h-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_B_and_H_over_h</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stress</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">Temp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_B_and_H_over_h-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_B_and_H_over_h"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1301"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1301"><span class="linenos">1301</span></a>    <span class="k">def</span> <span class="nf">compute_B_and_H_over_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stress</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Temp</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1302"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1302"><span class="linenos">1302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1303"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1303"><span class="linenos">1303</span></a><span class="sd">        Compute `B` and `H/h` via perturbations of `alpha` and stress.</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1304"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1304"><span class="linenos">1304</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1305"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1305"><span class="linenos">1305</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1306"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1306"><span class="linenos">1306</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1307"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1307"><span class="linenos">1307</span></a><span class="sd">        stress : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1308"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1308"><span class="linenos">1308</span></a><span class="sd">            Stress per element, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1309"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1309"><span class="linenos">1309</span></a><span class="sd">        dt : float</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1310"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1310"><span class="linenos">1310</span></a><span class="sd">            Time step.</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1311"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1311"><span class="linenos">1311</span></a><span class="sd">        theta : float</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1312"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1312"><span class="linenos">1312</span></a><span class="sd">            Time integration parameter.</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1313"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1313"><span class="linenos">1313</span></a><span class="sd">        Temp : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1314"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1314"><span class="linenos">1314</span></a><span class="sd">            Temperature per element (unused).</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1315"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1315"><span class="linenos">1315</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1316"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1316"><span class="linenos">1316</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1317"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1317"><span class="linenos">1317</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1318"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1318"><span class="linenos">1318</span></a><span class="sd">        B : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1319"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1319"><span class="linenos">1319</span></a><span class="sd">            Driving term, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1320"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1320"><span class="linenos">1320</span></a><span class="sd">        H_over_h : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1321"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1321"><span class="linenos">1321</span></a><span class="sd">            Linearization ratio, shape (N, 6, 6).</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1322"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1322"><span class="linenos">1322</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1323"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1323"><span class="linenos">1323</span></a><span class="sd">        Notes</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1324"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1324"><span class="linenos">1324</span></a><span class="sd">        -----</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1325"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1325"><span class="linenos">1325</span></a><span class="sd">        Uses finite differences to approximate sensitivities.</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1326"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1326"><span class="linenos">1326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1327"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1327"><span class="linenos">1327</span></a>        <span class="c1"># EPSILON_ALPHA = 1e-7</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1328"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1328"><span class="linenos">1328</span></a>        <span class="n">EPSILON_ALPHA</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1329"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1329"><span class="linenos">1329</span></a>        <span class="n">EPSILON_STRESS</span> <span class="o">=</span> <span class="mf">1e-1</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1330"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1330"><span class="linenos">1330</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1331"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1331"><span class="linenos">1331</span></a>        <span class="n">alpha_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">EPSILON_ALPHA</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1332"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1332"><span class="linenos">1332</span></a>        <span class="n">eps_ne_rate_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_eps</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1333"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1333"><span class="linenos">1333</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1334"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1334"><span class="linenos">1334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_residue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1335"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1335"><span class="linenos">1335</span></a>        <span class="n">r_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_residue</span><span class="p">(</span><span class="n">eps_ne_rate_eps</span><span class="p">,</span> <span class="n">alpha_eps</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1336"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1336"><span class="linenos">1336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_eps</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">EPSILON_ALPHA</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1337"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1337"><span class="linenos">1337</span></a>        <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">eps_ne_rate_eps</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps_ne_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">EPSILON_ALPHA</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1338"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1338"><span class="linenos">1338</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1339"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1339"><span class="linenos">1339</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1340"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1340"><span class="linenos">1340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1341"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1341"><span class="linenos">1341</span></a>        <span class="n">stress_eps</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1342"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1342"><span class="linenos">1342</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)]:</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1343"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1343"><span class="linenos">1343</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">EPSILON_STRESS</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1344"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1344"><span class="linenos">1344</span></a>        	<span class="n">eps_ne_rate_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_eps</span><span class="p">,</span> <span class="n">dt</span><span class="o">*</span><span class="n">theta</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">return_eps_ne</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1345"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1345"><span class="linenos">1345</span></a>        	<span class="n">r_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_residue</span><span class="p">(</span><span class="n">eps_ne_rate_eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1346"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1346"><span class="linenos">1346</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_eps</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">EPSILON_STRESS</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1347"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1347"><span class="linenos">1347</span></a>        	<span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1348"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1348"><span class="linenos">1348</span></a>        	<span class="n">stress_eps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">EPSILON_STRESS</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1349"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1349"><span class="linenos">1349</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1350"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1350"><span class="linenos">1350</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_H</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1351"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1351"><span class="linenos">1351</span></a>        <span class="n">H_over_h</span> <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1352"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1352"><span class="linenos">1352</span></a>
</span><span id="ViscoplasticDesai.compute_B_and_H_over_h-1353"><a href="#ViscoplasticDesai.compute_B_and_H_over_h-1353"><span class="linenos">1353</span></a>        <span class="k">return</span> <span class="n">B</span><span class="p">,</span> <span class="n">H_over_h</span>
</span></pre></div>


            <div class="docstring"><p>Compute <code><a href="#ViscoplasticDesai.B">B</a></code> and <code>H/h</code> via perturbations of <code><a href="#ViscoplasticDesai.alpha">alpha</a></code> and stress.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stress</strong> (torch.Tensor):
Stress per element, shape (N, 3, 3).</li>
<li><strong>dt</strong> (float):
Time step.</li>
<li><strong>theta</strong> (float):
Time integration parameter.</li>
<li><strong>Temp</strong> (torch.Tensor):
Temperature per element (unused).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>B</strong> (torch.Tensor):
Driving term, shape (N, 3, 3).</li>
<li><strong>H_over_h</strong> (torch.Tensor):
Linearization ratio, shape (N, 6, 6).</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Uses finite differences to approximate sensitivities.</p>
</div>


                            </div>
                            <div id="ViscoplasticDesai.compute_H" class="classattr">
                                        <input id="ViscoplasticDesai.compute_H-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_H</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">Q</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">P</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="ViscoplasticDesai.compute_H-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ViscoplasticDesai.compute_H"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ViscoplasticDesai.compute_H-1356"><a href="#ViscoplasticDesai.compute_H-1356"><span class="linenos">1356</span></a>    <span class="k">def</span> <span class="nf">compute_H</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">P</span><span class="p">:</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">to</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ViscoplasticDesai.compute_H-1357"><a href="#ViscoplasticDesai.compute_H-1357"><span class="linenos">1357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_H-1358"><a href="#ViscoplasticDesai.compute_H-1358"><span class="linenos">1358</span></a><span class="sd">        Build the 66 matrix `H` from tensors `Q` and `P`.</span>
</span><span id="ViscoplasticDesai.compute_H-1359"><a href="#ViscoplasticDesai.compute_H-1359"><span class="linenos">1359</span></a>
</span><span id="ViscoplasticDesai.compute_H-1360"><a href="#ViscoplasticDesai.compute_H-1360"><span class="linenos">1360</span></a><span class="sd">        Parameters</span>
</span><span id="ViscoplasticDesai.compute_H-1361"><a href="#ViscoplasticDesai.compute_H-1361"><span class="linenos">1361</span></a><span class="sd">        ----------</span>
</span><span id="ViscoplasticDesai.compute_H-1362"><a href="#ViscoplasticDesai.compute_H-1362"><span class="linenos">1362</span></a><span class="sd">        Q : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_H-1363"><a href="#ViscoplasticDesai.compute_H-1363"><span class="linenos">1363</span></a><span class="sd">            Sensitivity of rate to `alpha`, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_H-1364"><a href="#ViscoplasticDesai.compute_H-1364"><span class="linenos">1364</span></a><span class="sd">        P : torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_H-1365"><a href="#ViscoplasticDesai.compute_H-1365"><span class="linenos">1365</span></a><span class="sd">            Sensitivity of residue to stress, shape (N, 3, 3).</span>
</span><span id="ViscoplasticDesai.compute_H-1366"><a href="#ViscoplasticDesai.compute_H-1366"><span class="linenos">1366</span></a>
</span><span id="ViscoplasticDesai.compute_H-1367"><a href="#ViscoplasticDesai.compute_H-1367"><span class="linenos">1367</span></a><span class="sd">        Returns</span>
</span><span id="ViscoplasticDesai.compute_H-1368"><a href="#ViscoplasticDesai.compute_H-1368"><span class="linenos">1368</span></a><span class="sd">        -------</span>
</span><span id="ViscoplasticDesai.compute_H-1369"><a href="#ViscoplasticDesai.compute_H-1369"><span class="linenos">1369</span></a><span class="sd">        torch.Tensor</span>
</span><span id="ViscoplasticDesai.compute_H-1370"><a href="#ViscoplasticDesai.compute_H-1370"><span class="linenos">1370</span></a><span class="sd">            `H` with shape (N, 6, 6) in tensorial Voigt ordering.</span>
</span><span id="ViscoplasticDesai.compute_H-1371"><a href="#ViscoplasticDesai.compute_H-1371"><span class="linenos">1371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ViscoplasticDesai.compute_H-1372"><a href="#ViscoplasticDesai.compute_H-1372"><span class="linenos">1372</span></a>        <span class="n">n_elems</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span>
</span><span id="ViscoplasticDesai.compute_H-1373"><a href="#ViscoplasticDesai.compute_H-1373"><span class="linenos">1373</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="ViscoplasticDesai.compute_H-1374"><a href="#ViscoplasticDesai.compute_H-1374"><span class="linenos">1374</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1375"><a href="#ViscoplasticDesai.compute_H-1375"><span class="linenos">1375</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1376"><a href="#ViscoplasticDesai.compute_H-1376"><span class="linenos">1376</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1377"><a href="#ViscoplasticDesai.compute_H-1377"><span class="linenos">1377</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1378"><a href="#ViscoplasticDesai.compute_H-1378"><span class="linenos">1378</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1379"><a href="#ViscoplasticDesai.compute_H-1379"><span class="linenos">1379</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1380"><a href="#ViscoplasticDesai.compute_H-1380"><span class="linenos">1380</span></a>
</span><span id="ViscoplasticDesai.compute_H-1381"><a href="#ViscoplasticDesai.compute_H-1381"><span class="linenos">1381</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1382"><a href="#ViscoplasticDesai.compute_H-1382"><span class="linenos">1382</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1383"><a href="#ViscoplasticDesai.compute_H-1383"><span class="linenos">1383</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1384"><a href="#ViscoplasticDesai.compute_H-1384"><span class="linenos">1384</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1385"><a href="#ViscoplasticDesai.compute_H-1385"><span class="linenos">1385</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1386"><a href="#ViscoplasticDesai.compute_H-1386"><span class="linenos">1386</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1387"><a href="#ViscoplasticDesai.compute_H-1387"><span class="linenos">1387</span></a>
</span><span id="ViscoplasticDesai.compute_H-1388"><a href="#ViscoplasticDesai.compute_H-1388"><span class="linenos">1388</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1389"><a href="#ViscoplasticDesai.compute_H-1389"><span class="linenos">1389</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1390"><a href="#ViscoplasticDesai.compute_H-1390"><span class="linenos">1390</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1391"><a href="#ViscoplasticDesai.compute_H-1391"><span class="linenos">1391</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1392"><a href="#ViscoplasticDesai.compute_H-1392"><span class="linenos">1392</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1393"><a href="#ViscoplasticDesai.compute_H-1393"><span class="linenos">1393</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1394"><a href="#ViscoplasticDesai.compute_H-1394"><span class="linenos">1394</span></a>
</span><span id="ViscoplasticDesai.compute_H-1395"><a href="#ViscoplasticDesai.compute_H-1395"><span class="linenos">1395</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1396"><a href="#ViscoplasticDesai.compute_H-1396"><span class="linenos">1396</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1397"><a href="#ViscoplasticDesai.compute_H-1397"><span class="linenos">1397</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1398"><a href="#ViscoplasticDesai.compute_H-1398"><span class="linenos">1398</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1399"><a href="#ViscoplasticDesai.compute_H-1399"><span class="linenos">1399</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1400"><a href="#ViscoplasticDesai.compute_H-1400"><span class="linenos">1400</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1401"><a href="#ViscoplasticDesai.compute_H-1401"><span class="linenos">1401</span></a>
</span><span id="ViscoplasticDesai.compute_H-1402"><a href="#ViscoplasticDesai.compute_H-1402"><span class="linenos">1402</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1403"><a href="#ViscoplasticDesai.compute_H-1403"><span class="linenos">1403</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1404"><a href="#ViscoplasticDesai.compute_H-1404"><span class="linenos">1404</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1405"><a href="#ViscoplasticDesai.compute_H-1405"><span class="linenos">1405</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1406"><a href="#ViscoplasticDesai.compute_H-1406"><span class="linenos">1406</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1407"><a href="#ViscoplasticDesai.compute_H-1407"><span class="linenos">1407</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1408"><a href="#ViscoplasticDesai.compute_H-1408"><span class="linenos">1408</span></a>
</span><span id="ViscoplasticDesai.compute_H-1409"><a href="#ViscoplasticDesai.compute_H-1409"><span class="linenos">1409</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1410"><a href="#ViscoplasticDesai.compute_H-1410"><span class="linenos">1410</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1411"><a href="#ViscoplasticDesai.compute_H-1411"><span class="linenos">1411</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1412"><a href="#ViscoplasticDesai.compute_H-1412"><span class="linenos">1412</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1413"><a href="#ViscoplasticDesai.compute_H-1413"><span class="linenos">1413</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1414"><a href="#ViscoplasticDesai.compute_H-1414"><span class="linenos">1414</span></a>        <span class="n">H</span><span class="p">[:,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ViscoplasticDesai.compute_H-1415"><a href="#ViscoplasticDesai.compute_H-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="n">H</span>
</span></pre></div>


            <div class="docstring"><p>Build the 66 matrix <code>H</code> from tensors <code>Q</code> and <code>P</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Q</strong> (torch.Tensor):
Sensitivity of rate to <code><a href="#ViscoplasticDesai.alpha">alpha</a></code>, shape (N, 3, 3).</li>
<li><strong>P</strong> (torch.Tensor):
Sensitivity of residue to stress, shape (N, 3, 3).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>torch.Tensor</strong>: <code>H</code> with shape (N, 6, 6) in tensorial Voigt ordering.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="SaveFields">
                            <input id="SaveFields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SaveFields</span>:

                <label class="view-source-button" for="SaveFields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields-35"><a href="#SaveFields-35"><span class="linenos"> 35</span></a><span class="k">class</span> <span class="nc">SaveFields</span><span class="p">():</span>
</span><span id="SaveFields-36"><a href="#SaveFields-36"><span class="linenos"> 36</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields-37"><a href="#SaveFields-37"><span class="linenos"> 37</span></a><span class="sd">	Manage writing FEniCSx fields to XDMF over time.</span>
</span><span id="SaveFields-38"><a href="#SaveFields-38"><span class="linenos"> 38</span></a>
</span><span id="SaveFields-39"><a href="#SaveFields-39"><span class="linenos"> 39</span></a><span class="sd">	This helper collects references to fields stored on an equation object</span>
</span><span id="SaveFields-40"><a href="#SaveFields-40"><span class="linenos"> 40</span></a><span class="sd">	(either :class:`LinearMomentum` or :class:`HeatDiffusion`), opens one</span>
</span><span id="SaveFields-41"><a href="#SaveFields-41"><span class="linenos"> 41</span></a><span class="sd">	XDMF writer per field, and writes time-stamped data during a simulation.</span>
</span><span id="SaveFields-42"><a href="#SaveFields-42"><span class="linenos"> 42</span></a><span class="sd">	It can also copy the original Gmsh mesh file into the output directory</span>
</span><span id="SaveFields-43"><a href="#SaveFields-43"><span class="linenos"> 43</span></a><span class="sd">	for provenance.</span>
</span><span id="SaveFields-44"><a href="#SaveFields-44"><span class="linenos"> 44</span></a>
</span><span id="SaveFields-45"><a href="#SaveFields-45"><span class="linenos"> 45</span></a><span class="sd">	Parameters</span>
</span><span id="SaveFields-46"><a href="#SaveFields-46"><span class="linenos"> 46</span></a><span class="sd">	----------</span>
</span><span id="SaveFields-47"><a href="#SaveFields-47"><span class="linenos"> 47</span></a><span class="sd">	eq : EqType</span>
</span><span id="SaveFields-48"><a href="#SaveFields-48"><span class="linenos"> 48</span></a><span class="sd">	    Equation/model object. Must expose:</span>
</span><span id="SaveFields-49"><a href="#SaveFields-49"><span class="linenos"> 49</span></a><span class="sd">	    - ``eq.grid.mesh`` (a DOLFINx mesh with communicator),</span>
</span><span id="SaveFields-50"><a href="#SaveFields-50"><span class="linenos"> 50</span></a><span class="sd">	    - ``eq.grid.grid_folder`` (path where the original ``.msh`` lives),</span>
</span><span id="SaveFields-51"><a href="#SaveFields-51"><span class="linenos"> 51</span></a><span class="sd">	    - ``eq.grid.geometry_name`` (base filename of the ``.msh``),</span>
</span><span id="SaveFields-52"><a href="#SaveFields-52"><span class="linenos"> 52</span></a><span class="sd">	    - attributes for each field you register via :meth:`add_output_field`.</span>
</span><span id="SaveFields-53"><a href="#SaveFields-53"><span class="linenos"> 53</span></a>
</span><span id="SaveFields-54"><a href="#SaveFields-54"><span class="linenos"> 54</span></a><span class="sd">	Attributes</span>
</span><span id="SaveFields-55"><a href="#SaveFields-55"><span class="linenos"> 55</span></a><span class="sd">	----------</span>
</span><span id="SaveFields-56"><a href="#SaveFields-56"><span class="linenos"> 56</span></a><span class="sd">	eq : EqType</span>
</span><span id="SaveFields-57"><a href="#SaveFields-57"><span class="linenos"> 57</span></a><span class="sd">	    Stored equation/model handle.</span>
</span><span id="SaveFields-58"><a href="#SaveFields-58"><span class="linenos"> 58</span></a><span class="sd">	fields_data : list of dict</span>
</span><span id="SaveFields-59"><a href="#SaveFields-59"><span class="linenos"> 59</span></a><span class="sd">	    Registered field descriptors, each with keys</span>
</span><span id="SaveFields-60"><a href="#SaveFields-60"><span class="linenos"> 60</span></a><span class="sd">	    ``{&quot;field_name&quot;: str, &quot;label_name&quot;: str}``.</span>
</span><span id="SaveFields-61"><a href="#SaveFields-61"><span class="linenos"> 61</span></a><span class="sd">	output_fields : list of dolfinx.io.XDMFFile</span>
</span><span id="SaveFields-62"><a href="#SaveFields-62"><span class="linenos"> 62</span></a><span class="sd">	    Open writers, in the same order as ``fields_data``.</span>
</span><span id="SaveFields-63"><a href="#SaveFields-63"><span class="linenos"> 63</span></a><span class="sd">	output_folder : str</span>
</span><span id="SaveFields-64"><a href="#SaveFields-64"><span class="linenos"> 64</span></a><span class="sd">	    Base directory for outputs (set via :meth:`set_output_folder`).</span>
</span><span id="SaveFields-65"><a href="#SaveFields-65"><span class="linenos"> 65</span></a>
</span><span id="SaveFields-66"><a href="#SaveFields-66"><span class="linenos"> 66</span></a><span class="sd">	Notes</span>
</span><span id="SaveFields-67"><a href="#SaveFields-67"><span class="linenos"> 67</span></a><span class="sd">	-----</span>
</span><span id="SaveFields-68"><a href="#SaveFields-68"><span class="linenos"> 68</span></a><span class="sd">	- Voigt/tensor conventions, function ranks, and meshtags are not managed</span>
</span><span id="SaveFields-69"><a href="#SaveFields-69"><span class="linenos"> 69</span></a><span class="sd">	  here; this class only writes whatever :mod:`dolfinx` ``Function`` you</span>
</span><span id="SaveFields-70"><a href="#SaveFields-70"><span class="linenos"> 70</span></a><span class="sd">	  provide in ``eq``.</span>
</span><span id="SaveFields-71"><a href="#SaveFields-71"><span class="linenos"> 71</span></a><span class="sd">	  created by :meth:`initialize`. Ensure they exist beforehand.</span>
</span><span id="SaveFields-72"><a href="#SaveFields-72"><span class="linenos"> 72</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="SaveFields-73"><a href="#SaveFields-73"><span class="linenos"> 73</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq</span><span class="p">:</span> <span class="n">EqType</span><span class="p">):</span>
</span><span id="SaveFields-74"><a href="#SaveFields-74"><span class="linenos"> 74</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span>
</span><span id="SaveFields-75"><a href="#SaveFields-75"><span class="linenos"> 75</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SaveFields-76"><a href="#SaveFields-76"><span class="linenos"> 76</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">output_fields</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SaveFields-77"><a href="#SaveFields-77"><span class="linenos"> 77</span></a>
</span><span id="SaveFields-78"><a href="#SaveFields-78"><span class="linenos"> 78</span></a>	<span class="k">def</span> <span class="nf">set_output_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields-79"><a href="#SaveFields-79"><span class="linenos"> 79</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields-80"><a href="#SaveFields-80"><span class="linenos"> 80</span></a><span class="sd">        Set the base directory for all outputs.</span>
</span><span id="SaveFields-81"><a href="#SaveFields-81"><span class="linenos"> 81</span></a>
</span><span id="SaveFields-82"><a href="#SaveFields-82"><span class="linenos"> 82</span></a><span class="sd">        Parameters</span>
</span><span id="SaveFields-83"><a href="#SaveFields-83"><span class="linenos"> 83</span></a><span class="sd">        ----------</span>
</span><span id="SaveFields-84"><a href="#SaveFields-84"><span class="linenos"> 84</span></a><span class="sd">        output_folder : str</span>
</span><span id="SaveFields-85"><a href="#SaveFields-85"><span class="linenos"> 85</span></a><span class="sd">            Path to the directory where subfolders and XDMF files will be placed.</span>
</span><span id="SaveFields-86"><a href="#SaveFields-86"><span class="linenos"> 86</span></a>
</span><span id="SaveFields-87"><a href="#SaveFields-87"><span class="linenos"> 87</span></a><span class="sd">        Returns</span>
</span><span id="SaveFields-88"><a href="#SaveFields-88"><span class="linenos"> 88</span></a><span class="sd">        -------</span>
</span><span id="SaveFields-89"><a href="#SaveFields-89"><span class="linenos"> 89</span></a><span class="sd">        None</span>
</span><span id="SaveFields-90"><a href="#SaveFields-90"><span class="linenos"> 90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SaveFields-91"><a href="#SaveFields-91"><span class="linenos"> 91</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="n">output_folder</span>
</span><span id="SaveFields-92"><a href="#SaveFields-92"><span class="linenos"> 92</span></a>
</span><span id="SaveFields-93"><a href="#SaveFields-93"><span class="linenos"> 93</span></a>	<span class="k">def</span> <span class="nf">add_output_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields-94"><a href="#SaveFields-94"><span class="linenos"> 94</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields-95"><a href="#SaveFields-95"><span class="linenos"> 95</span></a><span class="sd">        Register a field to be written, with a display label.</span>
</span><span id="SaveFields-96"><a href="#SaveFields-96"><span class="linenos"> 96</span></a>
</span><span id="SaveFields-97"><a href="#SaveFields-97"><span class="linenos"> 97</span></a><span class="sd">        Parameters</span>
</span><span id="SaveFields-98"><a href="#SaveFields-98"><span class="linenos"> 98</span></a><span class="sd">        ----------</span>
</span><span id="SaveFields-99"><a href="#SaveFields-99"><span class="linenos"> 99</span></a><span class="sd">        field_name : str</span>
</span><span id="SaveFields-100"><a href="#SaveFields-100"><span class="linenos">100</span></a><span class="sd">            Attribute name on ``self.eq`` that refers to a</span>
</span><span id="SaveFields-101"><a href="#SaveFields-101"><span class="linenos">101</span></a><span class="sd">            :class:`dolfinx.fem.Function` (e.g., ``&quot;u&quot;``, ``&quot;T&quot;``, ``&quot;sigma&quot;``).</span>
</span><span id="SaveFields-102"><a href="#SaveFields-102"><span class="linenos">102</span></a><span class="sd">        label_name : str</span>
</span><span id="SaveFields-103"><a href="#SaveFields-103"><span class="linenos">103</span></a><span class="sd">            Human-readable name assigned to ``field.name`` when writing</span>
</span><span id="SaveFields-104"><a href="#SaveFields-104"><span class="linenos">104</span></a><span class="sd">            (appears in XDMF/ParaView).</span>
</span><span id="SaveFields-105"><a href="#SaveFields-105"><span class="linenos">105</span></a>
</span><span id="SaveFields-106"><a href="#SaveFields-106"><span class="linenos">106</span></a><span class="sd">        Returns</span>
</span><span id="SaveFields-107"><a href="#SaveFields-107"><span class="linenos">107</span></a><span class="sd">        -------</span>
</span><span id="SaveFields-108"><a href="#SaveFields-108"><span class="linenos">108</span></a><span class="sd">        None</span>
</span><span id="SaveFields-109"><a href="#SaveFields-109"><span class="linenos">109</span></a>
</span><span id="SaveFields-110"><a href="#SaveFields-110"><span class="linenos">110</span></a><span class="sd">        Notes</span>
</span><span id="SaveFields-111"><a href="#SaveFields-111"><span class="linenos">111</span></a><span class="sd">        -----</span>
</span><span id="SaveFields-112"><a href="#SaveFields-112"><span class="linenos">112</span></a><span class="sd">        You may call this multiple times before :meth:`initialize`.</span>
</span><span id="SaveFields-113"><a href="#SaveFields-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SaveFields-114"><a href="#SaveFields-114"><span class="linenos">114</span></a>		<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SaveFields-115"><a href="#SaveFields-115"><span class="linenos">115</span></a>			<span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
</span><span id="SaveFields-116"><a href="#SaveFields-116"><span class="linenos">116</span></a>			<span class="s2">&quot;label_name&quot;</span><span class="p">:</span> <span class="n">label_name</span><span class="p">,</span>
</span><span id="SaveFields-117"><a href="#SaveFields-117"><span class="linenos">117</span></a>		<span class="p">}</span>
</span><span id="SaveFields-118"><a href="#SaveFields-118"><span class="linenos">118</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="SaveFields-119"><a href="#SaveFields-119"><span class="linenos">119</span></a>
</span><span id="SaveFields-120"><a href="#SaveFields-120"><span class="linenos">120</span></a>	<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields-121"><a href="#SaveFields-121"><span class="linenos">121</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields-122"><a href="#SaveFields-122"><span class="linenos">122</span></a><span class="sd">        Open one XDMF writer per registered field and write the mesh.</span>
</span><span id="SaveFields-123"><a href="#SaveFields-123"><span class="linenos">123</span></a>
</span><span id="SaveFields-124"><a href="#SaveFields-124"><span class="linenos">124</span></a><span class="sd">        For each entry in :attr:`fields_data`, opens an XDMF at</span>
</span><span id="SaveFields-125"><a href="#SaveFields-125"><span class="linenos">125</span></a><span class="sd">        ``{output_folder}/{field_name}/{field_name}.xdmf`` and writes</span>
</span><span id="SaveFields-126"><a href="#SaveFields-126"><span class="linenos">126</span></a><span class="sd">        ``self.eq.grid.mesh`` once.</span>
</span><span id="SaveFields-127"><a href="#SaveFields-127"><span class="linenos">127</span></a>
</span><span id="SaveFields-128"><a href="#SaveFields-128"><span class="linenos">128</span></a><span class="sd">        Parameters</span>
</span><span id="SaveFields-129"><a href="#SaveFields-129"><span class="linenos">129</span></a><span class="sd">        ----------</span>
</span><span id="SaveFields-130"><a href="#SaveFields-130"><span class="linenos">130</span></a><span class="sd">        None</span>
</span><span id="SaveFields-131"><a href="#SaveFields-131"><span class="linenos">131</span></a>
</span><span id="SaveFields-132"><a href="#SaveFields-132"><span class="linenos">132</span></a><span class="sd">        Returns</span>
</span><span id="SaveFields-133"><a href="#SaveFields-133"><span class="linenos">133</span></a><span class="sd">        -------</span>
</span><span id="SaveFields-134"><a href="#SaveFields-134"><span class="linenos">134</span></a><span class="sd">        None</span>
</span><span id="SaveFields-135"><a href="#SaveFields-135"><span class="linenos">135</span></a>
</span><span id="SaveFields-136"><a href="#SaveFields-136"><span class="linenos">136</span></a><span class="sd">        Raises</span>
</span><span id="SaveFields-137"><a href="#SaveFields-137"><span class="linenos">137</span></a><span class="sd">        ------</span>
</span><span id="SaveFields-138"><a href="#SaveFields-138"><span class="linenos">138</span></a><span class="sd">        OSError</span>
</span><span id="SaveFields-139"><a href="#SaveFields-139"><span class="linenos">139</span></a><span class="sd">            If the per-field output directory does not exist.</span>
</span><span id="SaveFields-140"><a href="#SaveFields-140"><span class="linenos">140</span></a>
</span><span id="SaveFields-141"><a href="#SaveFields-141"><span class="linenos">141</span></a><span class="sd">        Notes</span>
</span><span id="SaveFields-142"><a href="#SaveFields-142"><span class="linenos">142</span></a><span class="sd">        -----</span>
</span><span id="SaveFields-143"><a href="#SaveFields-143"><span class="linenos">143</span></a><span class="sd">        - Files are opened in ``&quot;w&quot;`` mode (overwrite).</span>
</span><span id="SaveFields-144"><a href="#SaveFields-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SaveFields-145"><a href="#SaveFields-145"><span class="linenos">145</span></a>		<span class="k">for</span> <span class="n">field_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span><span class="p">:</span>
</span><span id="SaveFields-146"><a href="#SaveFields-146"><span class="linenos">146</span></a>			<span class="n">field_name</span> <span class="o">=</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span>
</span><span id="SaveFields-147"><a href="#SaveFields-147"><span class="linenos">147</span></a>			<span class="n">output_field</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">XDMFFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">.xdmf&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="SaveFields-148"><a href="#SaveFields-148"><span class="linenos">148</span></a>			<span class="n">output_field</span><span class="o">.</span><span class="n">write_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="SaveFields-149"><a href="#SaveFields-149"><span class="linenos">149</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">output_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_field</span><span class="p">)</span>
</span><span id="SaveFields-150"><a href="#SaveFields-150"><span class="linenos">150</span></a>
</span><span id="SaveFields-151"><a href="#SaveFields-151"><span class="linenos">151</span></a>	<span class="k">def</span> <span class="nf">save_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields-152"><a href="#SaveFields-152"><span class="linenos">152</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields-153"><a href="#SaveFields-153"><span class="linenos">153</span></a><span class="sd">		Write all registered fields at simulation time ``t``.</span>
</span><span id="SaveFields-154"><a href="#SaveFields-154"><span class="linenos">154</span></a>
</span><span id="SaveFields-155"><a href="#SaveFields-155"><span class="linenos">155</span></a><span class="sd">		Parameters</span>
</span><span id="SaveFields-156"><a href="#SaveFields-156"><span class="linenos">156</span></a><span class="sd">		----------</span>
</span><span id="SaveFields-157"><a href="#SaveFields-157"><span class="linenos">157</span></a><span class="sd">		t : float</span>
</span><span id="SaveFields-158"><a href="#SaveFields-158"><span class="linenos">158</span></a><span class="sd">		    Time value to associate with this write.</span>
</span><span id="SaveFields-159"><a href="#SaveFields-159"><span class="linenos">159</span></a>
</span><span id="SaveFields-160"><a href="#SaveFields-160"><span class="linenos">160</span></a><span class="sd">		Returns</span>
</span><span id="SaveFields-161"><a href="#SaveFields-161"><span class="linenos">161</span></a><span class="sd">		-------</span>
</span><span id="SaveFields-162"><a href="#SaveFields-162"><span class="linenos">162</span></a><span class="sd">		None</span>
</span><span id="SaveFields-163"><a href="#SaveFields-163"><span class="linenos">163</span></a>
</span><span id="SaveFields-164"><a href="#SaveFields-164"><span class="linenos">164</span></a><span class="sd">		Notes</span>
</span><span id="SaveFields-165"><a href="#SaveFields-165"><span class="linenos">165</span></a><span class="sd">		-----</span>
</span><span id="SaveFields-166"><a href="#SaveFields-166"><span class="linenos">166</span></a><span class="sd">		For each descriptor in :attr:`fields_data`:</span>
</span><span id="SaveFields-167"><a href="#SaveFields-167"><span class="linenos">167</span></a><span class="sd">		1. Fetches the field via ``getattr(self.eq, field_name)``.</span>
</span><span id="SaveFields-168"><a href="#SaveFields-168"><span class="linenos">168</span></a><span class="sd">		2. Sets ``field.name = label_name``.</span>
</span><span id="SaveFields-169"><a href="#SaveFields-169"><span class="linenos">169</span></a><span class="sd">		3. Calls ``XDMFFile.write_function(field, t)`` on the corresponding writer.</span>
</span><span id="SaveFields-170"><a href="#SaveFields-170"><span class="linenos">170</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="SaveFields-171"><a href="#SaveFields-171"><span class="linenos">171</span></a>		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span><span class="p">):</span>
</span><span id="SaveFields-172"><a href="#SaveFields-172"><span class="linenos">172</span></a>			<span class="n">field</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">])</span>
</span><span id="SaveFields-173"><a href="#SaveFields-173"><span class="linenos">173</span></a>			<span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;label_name&quot;</span><span class="p">]</span>
</span><span id="SaveFields-174"><a href="#SaveFields-174"><span class="linenos">174</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">output_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">write_function</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span><span id="SaveFields-175"><a href="#SaveFields-175"><span class="linenos">175</span></a>
</span><span id="SaveFields-176"><a href="#SaveFields-176"><span class="linenos">176</span></a>	<span class="k">def</span> <span class="nf">save_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields-177"><a href="#SaveFields-177"><span class="linenos">177</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields-178"><a href="#SaveFields-178"><span class="linenos">178</span></a><span class="sd">		Copy the original Gmsh mesh file into ``{output_folder}/mesh/``.</span>
</span><span id="SaveFields-179"><a href="#SaveFields-179"><span class="linenos">179</span></a>
</span><span id="SaveFields-180"><a href="#SaveFields-180"><span class="linenos">180</span></a><span class="sd">		Parameters</span>
</span><span id="SaveFields-181"><a href="#SaveFields-181"><span class="linenos">181</span></a><span class="sd">		----------</span>
</span><span id="SaveFields-182"><a href="#SaveFields-182"><span class="linenos">182</span></a><span class="sd">		None</span>
</span><span id="SaveFields-183"><a href="#SaveFields-183"><span class="linenos">183</span></a>
</span><span id="SaveFields-184"><a href="#SaveFields-184"><span class="linenos">184</span></a><span class="sd">		Returns</span>
</span><span id="SaveFields-185"><a href="#SaveFields-185"><span class="linenos">185</span></a><span class="sd">		-------</span>
</span><span id="SaveFields-186"><a href="#SaveFields-186"><span class="linenos">186</span></a><span class="sd">		None</span>
</span><span id="SaveFields-187"><a href="#SaveFields-187"><span class="linenos">187</span></a>
</span><span id="SaveFields-188"><a href="#SaveFields-188"><span class="linenos">188</span></a><span class="sd">		Side Effects</span>
</span><span id="SaveFields-189"><a href="#SaveFields-189"><span class="linenos">189</span></a><span class="sd">		------------</span>
</span><span id="SaveFields-190"><a href="#SaveFields-190"><span class="linenos">190</span></a><span class="sd">		- Creates ``{output_folder}/mesh`` if it does not exist.</span>
</span><span id="SaveFields-191"><a href="#SaveFields-191"><span class="linenos">191</span></a><span class="sd">		- Copies</span>
</span><span id="SaveFields-192"><a href="#SaveFields-192"><span class="linenos">192</span></a><span class="sd">		  ``{eq.grid.grid_folder}/{eq.grid.geometry_name}.msh``</span>
</span><span id="SaveFields-193"><a href="#SaveFields-193"><span class="linenos">193</span></a><span class="sd">		  to that directory.</span>
</span><span id="SaveFields-194"><a href="#SaveFields-194"><span class="linenos">194</span></a>
</span><span id="SaveFields-195"><a href="#SaveFields-195"><span class="linenos">195</span></a><span class="sd">		Raises</span>
</span><span id="SaveFields-196"><a href="#SaveFields-196"><span class="linenos">196</span></a><span class="sd">		------</span>
</span><span id="SaveFields-197"><a href="#SaveFields-197"><span class="linenos">197</span></a><span class="sd">		FileNotFoundError</span>
</span><span id="SaveFields-198"><a href="#SaveFields-198"><span class="linenos">198</span></a><span class="sd">		    If the source ``.msh`` file does not exist.</span>
</span><span id="SaveFields-199"><a href="#SaveFields-199"><span class="linenos">199</span></a><span class="sd">		OSError</span>
</span><span id="SaveFields-200"><a href="#SaveFields-200"><span class="linenos">200</span></a><span class="sd">		    If the copy fails for other I/O reasons.</span>
</span><span id="SaveFields-201"><a href="#SaveFields-201"><span class="linenos">201</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="SaveFields-202"><a href="#SaveFields-202"><span class="linenos">202</span></a>		<span class="n">mesh_origin_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">geometry_name</span><span class="si">}</span><span class="s2">.msh&quot;</span><span class="p">)</span>
</span><span id="SaveFields-203"><a href="#SaveFields-203"><span class="linenos">203</span></a>		<span class="n">mesh_destination_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;mesh&quot;</span><span class="p">)</span>
</span><span id="SaveFields-204"><a href="#SaveFields-204"><span class="linenos">204</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mesh_destination_folder</span><span class="p">):</span>
</span><span id="SaveFields-205"><a href="#SaveFields-205"><span class="linenos">205</span></a>			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">mesh_destination_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SaveFields-206"><a href="#SaveFields-206"><span class="linenos">206</span></a>		<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mesh_origin_file</span><span class="p">,</span> <span class="n">mesh_destination_folder</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Manage writing FEniCSx fields to XDMF over time.</p>

<p>This helper collects references to fields stored on an equation object
(either <code><a href="#LinearMomentum">LinearMomentum</a></code> or <code><a href="#HeatDiffusion">HeatDiffusion</a></code>), opens one
XDMF writer per field, and writes time-stamped data during a simulation.
It can also copy the original Gmsh mesh file into the output directory
for provenance.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eq</strong> (EqType):
Equation/model object. Must expose:
<ul>
<li><code>eq.grid.mesh</code> (a DOLFINx mesh with communicator),</li>
<li><code>eq.grid.grid_folder</code> (path where the original <code>.msh</code> lives),</li>
<li><code>eq.grid.geometry_name</code> (base filename of the <code>.msh</code>),</li>
<li>attributes for each field you register via <code><a href="#SaveFields.add_output_field">add_output_field()</a></code>.</li>
</ul></li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>eq</strong> (EqType):
Stored equation/model handle.</li>
<li><strong>fields_data</strong> (list of dict):
Registered field descriptors, each with keys
<code>{"field_name": str, "label_name": str}</code>.</li>
<li><strong>output_fields</strong> (list of dolfinx.io.XDMFFile):
Open writers, in the same order as <code><a href="#SaveFields.fields_data">fields_data</a></code>.</li>
<li><strong>output_folder</strong> (str):
Base directory for outputs (set via <code><a href="#SaveFields.set_output_folder">set_output_folder()</a></code>).</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Voigt/tensor conventions, function ranks, and meshtags are not managed
here; this class only writes whatever <code>dolfinx</code> <code>Function</code> you
provide in <code><a href="#SaveFields.eq">eq</a></code>.
created by <code><a href="#SaveFields.initialize">initialize()</a></code>. Ensure they exist beforehand.</li>
</ul>
</div>


                            <div id="SaveFields.__init__" class="classattr">
                                        <input id="SaveFields.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SaveFields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">eq</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="SaveFields.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields.__init__-73"><a href="#SaveFields.__init__-73"><span class="linenos">73</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq</span><span class="p">:</span> <span class="n">EqType</span><span class="p">):</span>
</span><span id="SaveFields.__init__-74"><a href="#SaveFields.__init__-74"><span class="linenos">74</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span>
</span><span id="SaveFields.__init__-75"><a href="#SaveFields.__init__-75"><span class="linenos">75</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SaveFields.__init__-76"><a href="#SaveFields.__init__-76"><span class="linenos">76</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">output_fields</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


    

                            </div>
                            <div id="SaveFields.eq" class="classattr">
                                <div class="attr variable">
            <span class="name">eq</span>

        
    </div>
    <a class="headerlink" href="#SaveFields.eq"></a>
    
    

                            </div>
                            <div id="SaveFields.fields_data" class="classattr">
                                <div class="attr variable">
            <span class="name">fields_data</span>

        
    </div>
    <a class="headerlink" href="#SaveFields.fields_data"></a>
    
    

                            </div>
                            <div id="SaveFields.output_fields" class="classattr">
                                <div class="attr variable">
            <span class="name">output_fields</span>

        
    </div>
    <a class="headerlink" href="#SaveFields.output_fields"></a>
    
    

                            </div>
                            <div id="SaveFields.set_output_folder" class="classattr">
                                        <input id="SaveFields.set_output_folder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_output_folder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SaveFields.set_output_folder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields.set_output_folder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields.set_output_folder-78"><a href="#SaveFields.set_output_folder-78"><span class="linenos">78</span></a>	<span class="k">def</span> <span class="nf">set_output_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields.set_output_folder-79"><a href="#SaveFields.set_output_folder-79"><span class="linenos">79</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields.set_output_folder-80"><a href="#SaveFields.set_output_folder-80"><span class="linenos">80</span></a><span class="sd">        Set the base directory for all outputs.</span>
</span><span id="SaveFields.set_output_folder-81"><a href="#SaveFields.set_output_folder-81"><span class="linenos">81</span></a>
</span><span id="SaveFields.set_output_folder-82"><a href="#SaveFields.set_output_folder-82"><span class="linenos">82</span></a><span class="sd">        Parameters</span>
</span><span id="SaveFields.set_output_folder-83"><a href="#SaveFields.set_output_folder-83"><span class="linenos">83</span></a><span class="sd">        ----------</span>
</span><span id="SaveFields.set_output_folder-84"><a href="#SaveFields.set_output_folder-84"><span class="linenos">84</span></a><span class="sd">        output_folder : str</span>
</span><span id="SaveFields.set_output_folder-85"><a href="#SaveFields.set_output_folder-85"><span class="linenos">85</span></a><span class="sd">            Path to the directory where subfolders and XDMF files will be placed.</span>
</span><span id="SaveFields.set_output_folder-86"><a href="#SaveFields.set_output_folder-86"><span class="linenos">86</span></a>
</span><span id="SaveFields.set_output_folder-87"><a href="#SaveFields.set_output_folder-87"><span class="linenos">87</span></a><span class="sd">        Returns</span>
</span><span id="SaveFields.set_output_folder-88"><a href="#SaveFields.set_output_folder-88"><span class="linenos">88</span></a><span class="sd">        -------</span>
</span><span id="SaveFields.set_output_folder-89"><a href="#SaveFields.set_output_folder-89"><span class="linenos">89</span></a><span class="sd">        None</span>
</span><span id="SaveFields.set_output_folder-90"><a href="#SaveFields.set_output_folder-90"><span class="linenos">90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SaveFields.set_output_folder-91"><a href="#SaveFields.set_output_folder-91"><span class="linenos">91</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="n">output_folder</span>
</span></pre></div>


            <div class="docstring"><p>Set the base directory for all outputs.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>output_folder</strong> (str):
Path to the directory where subfolders and XDMF files will be placed.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="SaveFields.add_output_field" class="classattr">
                                        <input id="SaveFields.add_output_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_output_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">label_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SaveFields.add_output_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields.add_output_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields.add_output_field-93"><a href="#SaveFields.add_output_field-93"><span class="linenos"> 93</span></a>	<span class="k">def</span> <span class="nf">add_output_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_name</span> <span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields.add_output_field-94"><a href="#SaveFields.add_output_field-94"><span class="linenos"> 94</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields.add_output_field-95"><a href="#SaveFields.add_output_field-95"><span class="linenos"> 95</span></a><span class="sd">        Register a field to be written, with a display label.</span>
</span><span id="SaveFields.add_output_field-96"><a href="#SaveFields.add_output_field-96"><span class="linenos"> 96</span></a>
</span><span id="SaveFields.add_output_field-97"><a href="#SaveFields.add_output_field-97"><span class="linenos"> 97</span></a><span class="sd">        Parameters</span>
</span><span id="SaveFields.add_output_field-98"><a href="#SaveFields.add_output_field-98"><span class="linenos"> 98</span></a><span class="sd">        ----------</span>
</span><span id="SaveFields.add_output_field-99"><a href="#SaveFields.add_output_field-99"><span class="linenos"> 99</span></a><span class="sd">        field_name : str</span>
</span><span id="SaveFields.add_output_field-100"><a href="#SaveFields.add_output_field-100"><span class="linenos">100</span></a><span class="sd">            Attribute name on ``self.eq`` that refers to a</span>
</span><span id="SaveFields.add_output_field-101"><a href="#SaveFields.add_output_field-101"><span class="linenos">101</span></a><span class="sd">            :class:`dolfinx.fem.Function` (e.g., ``&quot;u&quot;``, ``&quot;T&quot;``, ``&quot;sigma&quot;``).</span>
</span><span id="SaveFields.add_output_field-102"><a href="#SaveFields.add_output_field-102"><span class="linenos">102</span></a><span class="sd">        label_name : str</span>
</span><span id="SaveFields.add_output_field-103"><a href="#SaveFields.add_output_field-103"><span class="linenos">103</span></a><span class="sd">            Human-readable name assigned to ``field.name`` when writing</span>
</span><span id="SaveFields.add_output_field-104"><a href="#SaveFields.add_output_field-104"><span class="linenos">104</span></a><span class="sd">            (appears in XDMF/ParaView).</span>
</span><span id="SaveFields.add_output_field-105"><a href="#SaveFields.add_output_field-105"><span class="linenos">105</span></a>
</span><span id="SaveFields.add_output_field-106"><a href="#SaveFields.add_output_field-106"><span class="linenos">106</span></a><span class="sd">        Returns</span>
</span><span id="SaveFields.add_output_field-107"><a href="#SaveFields.add_output_field-107"><span class="linenos">107</span></a><span class="sd">        -------</span>
</span><span id="SaveFields.add_output_field-108"><a href="#SaveFields.add_output_field-108"><span class="linenos">108</span></a><span class="sd">        None</span>
</span><span id="SaveFields.add_output_field-109"><a href="#SaveFields.add_output_field-109"><span class="linenos">109</span></a>
</span><span id="SaveFields.add_output_field-110"><a href="#SaveFields.add_output_field-110"><span class="linenos">110</span></a><span class="sd">        Notes</span>
</span><span id="SaveFields.add_output_field-111"><a href="#SaveFields.add_output_field-111"><span class="linenos">111</span></a><span class="sd">        -----</span>
</span><span id="SaveFields.add_output_field-112"><a href="#SaveFields.add_output_field-112"><span class="linenos">112</span></a><span class="sd">        You may call this multiple times before :meth:`initialize`.</span>
</span><span id="SaveFields.add_output_field-113"><a href="#SaveFields.add_output_field-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SaveFields.add_output_field-114"><a href="#SaveFields.add_output_field-114"><span class="linenos">114</span></a>		<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SaveFields.add_output_field-115"><a href="#SaveFields.add_output_field-115"><span class="linenos">115</span></a>			<span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
</span><span id="SaveFields.add_output_field-116"><a href="#SaveFields.add_output_field-116"><span class="linenos">116</span></a>			<span class="s2">&quot;label_name&quot;</span><span class="p">:</span> <span class="n">label_name</span><span class="p">,</span>
</span><span id="SaveFields.add_output_field-117"><a href="#SaveFields.add_output_field-117"><span class="linenos">117</span></a>		<span class="p">}</span>
</span><span id="SaveFields.add_output_field-118"><a href="#SaveFields.add_output_field-118"><span class="linenos">118</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Register a field to be written, with a display label.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>field_name</strong> (str):
Attribute name on <code>self.eq</code> that refers to a
<code>dolfinx.fem.Function</code> (e.g., <code>"u"</code>, <code>"T"</code>, <code>"sigma"</code>).</li>
<li><strong>label_name</strong> (str):
Human-readable name assigned to <code>field.name</code> when writing
(appears in XDMF/ParaView).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>You may call this multiple times before <code><a href="#SaveFields.initialize">initialize()</a></code>.</p>
</div>


                            </div>
                            <div id="SaveFields.initialize" class="classattr">
                                        <input id="SaveFields.initialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SaveFields.initialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields.initialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields.initialize-120"><a href="#SaveFields.initialize-120"><span class="linenos">120</span></a>	<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields.initialize-121"><a href="#SaveFields.initialize-121"><span class="linenos">121</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields.initialize-122"><a href="#SaveFields.initialize-122"><span class="linenos">122</span></a><span class="sd">        Open one XDMF writer per registered field and write the mesh.</span>
</span><span id="SaveFields.initialize-123"><a href="#SaveFields.initialize-123"><span class="linenos">123</span></a>
</span><span id="SaveFields.initialize-124"><a href="#SaveFields.initialize-124"><span class="linenos">124</span></a><span class="sd">        For each entry in :attr:`fields_data`, opens an XDMF at</span>
</span><span id="SaveFields.initialize-125"><a href="#SaveFields.initialize-125"><span class="linenos">125</span></a><span class="sd">        ``{output_folder}/{field_name}/{field_name}.xdmf`` and writes</span>
</span><span id="SaveFields.initialize-126"><a href="#SaveFields.initialize-126"><span class="linenos">126</span></a><span class="sd">        ``self.eq.grid.mesh`` once.</span>
</span><span id="SaveFields.initialize-127"><a href="#SaveFields.initialize-127"><span class="linenos">127</span></a>
</span><span id="SaveFields.initialize-128"><a href="#SaveFields.initialize-128"><span class="linenos">128</span></a><span class="sd">        Parameters</span>
</span><span id="SaveFields.initialize-129"><a href="#SaveFields.initialize-129"><span class="linenos">129</span></a><span class="sd">        ----------</span>
</span><span id="SaveFields.initialize-130"><a href="#SaveFields.initialize-130"><span class="linenos">130</span></a><span class="sd">        None</span>
</span><span id="SaveFields.initialize-131"><a href="#SaveFields.initialize-131"><span class="linenos">131</span></a>
</span><span id="SaveFields.initialize-132"><a href="#SaveFields.initialize-132"><span class="linenos">132</span></a><span class="sd">        Returns</span>
</span><span id="SaveFields.initialize-133"><a href="#SaveFields.initialize-133"><span class="linenos">133</span></a><span class="sd">        -------</span>
</span><span id="SaveFields.initialize-134"><a href="#SaveFields.initialize-134"><span class="linenos">134</span></a><span class="sd">        None</span>
</span><span id="SaveFields.initialize-135"><a href="#SaveFields.initialize-135"><span class="linenos">135</span></a>
</span><span id="SaveFields.initialize-136"><a href="#SaveFields.initialize-136"><span class="linenos">136</span></a><span class="sd">        Raises</span>
</span><span id="SaveFields.initialize-137"><a href="#SaveFields.initialize-137"><span class="linenos">137</span></a><span class="sd">        ------</span>
</span><span id="SaveFields.initialize-138"><a href="#SaveFields.initialize-138"><span class="linenos">138</span></a><span class="sd">        OSError</span>
</span><span id="SaveFields.initialize-139"><a href="#SaveFields.initialize-139"><span class="linenos">139</span></a><span class="sd">            If the per-field output directory does not exist.</span>
</span><span id="SaveFields.initialize-140"><a href="#SaveFields.initialize-140"><span class="linenos">140</span></a>
</span><span id="SaveFields.initialize-141"><a href="#SaveFields.initialize-141"><span class="linenos">141</span></a><span class="sd">        Notes</span>
</span><span id="SaveFields.initialize-142"><a href="#SaveFields.initialize-142"><span class="linenos">142</span></a><span class="sd">        -----</span>
</span><span id="SaveFields.initialize-143"><a href="#SaveFields.initialize-143"><span class="linenos">143</span></a><span class="sd">        - Files are opened in ``&quot;w&quot;`` mode (overwrite).</span>
</span><span id="SaveFields.initialize-144"><a href="#SaveFields.initialize-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SaveFields.initialize-145"><a href="#SaveFields.initialize-145"><span class="linenos">145</span></a>		<span class="k">for</span> <span class="n">field_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span><span class="p">:</span>
</span><span id="SaveFields.initialize-146"><a href="#SaveFields.initialize-146"><span class="linenos">146</span></a>			<span class="n">field_name</span> <span class="o">=</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span>
</span><span id="SaveFields.initialize-147"><a href="#SaveFields.initialize-147"><span class="linenos">147</span></a>			<span class="n">output_field</span> <span class="o">=</span> <span class="n">do</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">XDMFFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">.xdmf&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="SaveFields.initialize-148"><a href="#SaveFields.initialize-148"><span class="linenos">148</span></a>			<span class="n">output_field</span><span class="o">.</span><span class="n">write_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="SaveFields.initialize-149"><a href="#SaveFields.initialize-149"><span class="linenos">149</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">output_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_field</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Open one XDMF writer per registered field and write the mesh.</p>

<p>For each entry in <code><a href="#SaveFields.fields_data">fields_data</a></code>, opens an XDMF at
<code>{output_folder}/{field_name}/{field_name}.xdmf</code> and writes
<code>self.eq.grid.mesh</code> once.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>OSError</strong>: If the per-field output directory does not exist.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Files are opened in <code>"w"</code> mode (overwrite).</li>
</ul>
</div>


                            </div>
                            <div id="SaveFields.save_fields" class="classattr">
                                        <input id="SaveFields.save_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SaveFields.save_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields.save_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields.save_fields-151"><a href="#SaveFields.save_fields-151"><span class="linenos">151</span></a>	<span class="k">def</span> <span class="nf">save_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields.save_fields-152"><a href="#SaveFields.save_fields-152"><span class="linenos">152</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields.save_fields-153"><a href="#SaveFields.save_fields-153"><span class="linenos">153</span></a><span class="sd">		Write all registered fields at simulation time ``t``.</span>
</span><span id="SaveFields.save_fields-154"><a href="#SaveFields.save_fields-154"><span class="linenos">154</span></a>
</span><span id="SaveFields.save_fields-155"><a href="#SaveFields.save_fields-155"><span class="linenos">155</span></a><span class="sd">		Parameters</span>
</span><span id="SaveFields.save_fields-156"><a href="#SaveFields.save_fields-156"><span class="linenos">156</span></a><span class="sd">		----------</span>
</span><span id="SaveFields.save_fields-157"><a href="#SaveFields.save_fields-157"><span class="linenos">157</span></a><span class="sd">		t : float</span>
</span><span id="SaveFields.save_fields-158"><a href="#SaveFields.save_fields-158"><span class="linenos">158</span></a><span class="sd">		    Time value to associate with this write.</span>
</span><span id="SaveFields.save_fields-159"><a href="#SaveFields.save_fields-159"><span class="linenos">159</span></a>
</span><span id="SaveFields.save_fields-160"><a href="#SaveFields.save_fields-160"><span class="linenos">160</span></a><span class="sd">		Returns</span>
</span><span id="SaveFields.save_fields-161"><a href="#SaveFields.save_fields-161"><span class="linenos">161</span></a><span class="sd">		-------</span>
</span><span id="SaveFields.save_fields-162"><a href="#SaveFields.save_fields-162"><span class="linenos">162</span></a><span class="sd">		None</span>
</span><span id="SaveFields.save_fields-163"><a href="#SaveFields.save_fields-163"><span class="linenos">163</span></a>
</span><span id="SaveFields.save_fields-164"><a href="#SaveFields.save_fields-164"><span class="linenos">164</span></a><span class="sd">		Notes</span>
</span><span id="SaveFields.save_fields-165"><a href="#SaveFields.save_fields-165"><span class="linenos">165</span></a><span class="sd">		-----</span>
</span><span id="SaveFields.save_fields-166"><a href="#SaveFields.save_fields-166"><span class="linenos">166</span></a><span class="sd">		For each descriptor in :attr:`fields_data`:</span>
</span><span id="SaveFields.save_fields-167"><a href="#SaveFields.save_fields-167"><span class="linenos">167</span></a><span class="sd">		1. Fetches the field via ``getattr(self.eq, field_name)``.</span>
</span><span id="SaveFields.save_fields-168"><a href="#SaveFields.save_fields-168"><span class="linenos">168</span></a><span class="sd">		2. Sets ``field.name = label_name``.</span>
</span><span id="SaveFields.save_fields-169"><a href="#SaveFields.save_fields-169"><span class="linenos">169</span></a><span class="sd">		3. Calls ``XDMFFile.write_function(field, t)`` on the corresponding writer.</span>
</span><span id="SaveFields.save_fields-170"><a href="#SaveFields.save_fields-170"><span class="linenos">170</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="SaveFields.save_fields-171"><a href="#SaveFields.save_fields-171"><span class="linenos">171</span></a>		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields_data</span><span class="p">):</span>
</span><span id="SaveFields.save_fields-172"><a href="#SaveFields.save_fields-172"><span class="linenos">172</span></a>			<span class="n">field</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">])</span>
</span><span id="SaveFields.save_fields-173"><a href="#SaveFields.save_fields-173"><span class="linenos">173</span></a>			<span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;label_name&quot;</span><span class="p">]</span>
</span><span id="SaveFields.save_fields-174"><a href="#SaveFields.save_fields-174"><span class="linenos">174</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">output_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">write_function</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write all registered fields at simulation time <code>t</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>t</strong> (float):
Time value to associate with this write.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>For each descriptor in <code><a href="#SaveFields.fields_data">fields_data</a></code>:</p>

<ol>
<li>Fetches the field via <code>getattr(self.eq, field_name)</code>.</li>
<li>Sets <code>field.name = label_name</code>.</li>
<li>Calls <code>XDMFFile.write_function(field, t)</code> on the corresponding writer.</li>
</ol>
</div>


                            </div>
                            <div id="SaveFields.save_mesh" class="classattr">
                                        <input id="SaveFields.save_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_mesh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SaveFields.save_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SaveFields.save_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SaveFields.save_mesh-176"><a href="#SaveFields.save_mesh-176"><span class="linenos">176</span></a>	<span class="k">def</span> <span class="nf">save_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SaveFields.save_mesh-177"><a href="#SaveFields.save_mesh-177"><span class="linenos">177</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SaveFields.save_mesh-178"><a href="#SaveFields.save_mesh-178"><span class="linenos">178</span></a><span class="sd">		Copy the original Gmsh mesh file into ``{output_folder}/mesh/``.</span>
</span><span id="SaveFields.save_mesh-179"><a href="#SaveFields.save_mesh-179"><span class="linenos">179</span></a>
</span><span id="SaveFields.save_mesh-180"><a href="#SaveFields.save_mesh-180"><span class="linenos">180</span></a><span class="sd">		Parameters</span>
</span><span id="SaveFields.save_mesh-181"><a href="#SaveFields.save_mesh-181"><span class="linenos">181</span></a><span class="sd">		----------</span>
</span><span id="SaveFields.save_mesh-182"><a href="#SaveFields.save_mesh-182"><span class="linenos">182</span></a><span class="sd">		None</span>
</span><span id="SaveFields.save_mesh-183"><a href="#SaveFields.save_mesh-183"><span class="linenos">183</span></a>
</span><span id="SaveFields.save_mesh-184"><a href="#SaveFields.save_mesh-184"><span class="linenos">184</span></a><span class="sd">		Returns</span>
</span><span id="SaveFields.save_mesh-185"><a href="#SaveFields.save_mesh-185"><span class="linenos">185</span></a><span class="sd">		-------</span>
</span><span id="SaveFields.save_mesh-186"><a href="#SaveFields.save_mesh-186"><span class="linenos">186</span></a><span class="sd">		None</span>
</span><span id="SaveFields.save_mesh-187"><a href="#SaveFields.save_mesh-187"><span class="linenos">187</span></a>
</span><span id="SaveFields.save_mesh-188"><a href="#SaveFields.save_mesh-188"><span class="linenos">188</span></a><span class="sd">		Side Effects</span>
</span><span id="SaveFields.save_mesh-189"><a href="#SaveFields.save_mesh-189"><span class="linenos">189</span></a><span class="sd">		------------</span>
</span><span id="SaveFields.save_mesh-190"><a href="#SaveFields.save_mesh-190"><span class="linenos">190</span></a><span class="sd">		- Creates ``{output_folder}/mesh`` if it does not exist.</span>
</span><span id="SaveFields.save_mesh-191"><a href="#SaveFields.save_mesh-191"><span class="linenos">191</span></a><span class="sd">		- Copies</span>
</span><span id="SaveFields.save_mesh-192"><a href="#SaveFields.save_mesh-192"><span class="linenos">192</span></a><span class="sd">		  ``{eq.grid.grid_folder}/{eq.grid.geometry_name}.msh``</span>
</span><span id="SaveFields.save_mesh-193"><a href="#SaveFields.save_mesh-193"><span class="linenos">193</span></a><span class="sd">		  to that directory.</span>
</span><span id="SaveFields.save_mesh-194"><a href="#SaveFields.save_mesh-194"><span class="linenos">194</span></a>
</span><span id="SaveFields.save_mesh-195"><a href="#SaveFields.save_mesh-195"><span class="linenos">195</span></a><span class="sd">		Raises</span>
</span><span id="SaveFields.save_mesh-196"><a href="#SaveFields.save_mesh-196"><span class="linenos">196</span></a><span class="sd">		------</span>
</span><span id="SaveFields.save_mesh-197"><a href="#SaveFields.save_mesh-197"><span class="linenos">197</span></a><span class="sd">		FileNotFoundError</span>
</span><span id="SaveFields.save_mesh-198"><a href="#SaveFields.save_mesh-198"><span class="linenos">198</span></a><span class="sd">		    If the source ``.msh`` file does not exist.</span>
</span><span id="SaveFields.save_mesh-199"><a href="#SaveFields.save_mesh-199"><span class="linenos">199</span></a><span class="sd">		OSError</span>
</span><span id="SaveFields.save_mesh-200"><a href="#SaveFields.save_mesh-200"><span class="linenos">200</span></a><span class="sd">		    If the copy fails for other I/O reasons.</span>
</span><span id="SaveFields.save_mesh-201"><a href="#SaveFields.save_mesh-201"><span class="linenos">201</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="SaveFields.save_mesh-202"><a href="#SaveFields.save_mesh-202"><span class="linenos">202</span></a>		<span class="n">mesh_origin_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">geometry_name</span><span class="si">}</span><span class="s2">.msh&quot;</span><span class="p">)</span>
</span><span id="SaveFields.save_mesh-203"><a href="#SaveFields.save_mesh-203"><span class="linenos">203</span></a>		<span class="n">mesh_destination_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;mesh&quot;</span><span class="p">)</span>
</span><span id="SaveFields.save_mesh-204"><a href="#SaveFields.save_mesh-204"><span class="linenos">204</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mesh_destination_folder</span><span class="p">):</span>
</span><span id="SaveFields.save_mesh-205"><a href="#SaveFields.save_mesh-205"><span class="linenos">205</span></a>			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">mesh_destination_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SaveFields.save_mesh-206"><a href="#SaveFields.save_mesh-206"><span class="linenos">206</span></a>		<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mesh_origin_file</span><span class="p">,</span> <span class="n">mesh_destination_folder</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Copy the original Gmsh mesh file into <code>{output_folder}/mesh/</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="side-effects">Side Effects</h6>

<ul>
<li>Creates <code>{output_folder}/mesh</code> if it does not exist.</li>
<li>Copies
<code>{eq.grid.grid_folder}/{eq.grid.geometry_name}.msh</code>
to that directory.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>FileNotFoundError</strong>: If the source <code>.msh</code> file does not exist.</li>
<li><strong>OSError</strong>: If the copy fails for other I/O reasons.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="Simulator_TM">
                            <input id="Simulator_TM-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Simulator_TM</span><wbr>(<span class="base">safeincave.Simulators.Simulator</span>):

                <label class="view-source-button" for="Simulator_TM-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_TM"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_TM-51"><a href="#Simulator_TM-51"><span class="linenos"> 51</span></a><span class="k">class</span> <span class="nc">Simulator_TM</span><span class="p">(</span><span class="n">Simulator</span><span class="p">):</span>
</span><span id="Simulator_TM-52"><a href="#Simulator_TM-52"><span class="linenos"> 52</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_TM-53"><a href="#Simulator_TM-53"><span class="linenos"> 53</span></a><span class="sd">	Run the coupled thermomechanical simulation.</span>
</span><span id="Simulator_TM-54"><a href="#Simulator_TM-54"><span class="linenos"> 54</span></a>
</span><span id="Simulator_TM-55"><a href="#Simulator_TM-55"><span class="linenos"> 55</span></a><span class="sd">	Workflow</span>
</span><span id="Simulator_TM-56"><a href="#Simulator_TM-56"><span class="linenos"> 56</span></a><span class="sd">	--------</span>
</span><span id="Simulator_TM-57"><a href="#Simulator_TM-57"><span class="linenos"> 57</span></a><span class="sd">	1. Initialize outputs.</span>
</span><span id="Simulator_TM-58"><a href="#Simulator_TM-58"><span class="linenos"> 58</span></a><span class="sd">	2. Initialize momentum temperature from the heat solution and update BCs.</span>
</span><span id="Simulator_TM-59"><a href="#Simulator_TM-59"><span class="linenos"> 59</span></a><span class="sd">	3. Optionally solve a purely elastic response.</span>
</span><span id="Simulator_TM-60"><a href="#Simulator_TM-60"><span class="linenos"> 60</span></a><span class="sd">	4. Initialize non-elastic rates.</span>
</span><span id="Simulator_TM-61"><a href="#Simulator_TM-61"><span class="linenos"> 61</span></a><span class="sd">	5. For each time step:</span>
</span><span id="Simulator_TM-62"><a href="#Simulator_TM-62"><span class="linenos"> 62</span></a>
</span><span id="Simulator_TM-63"><a href="#Simulator_TM-63"><span class="linenos"> 63</span></a><span class="sd">	   - Advance time and update boundary conditions for both equations.</span>
</span><span id="Simulator_TM-64"><a href="#Simulator_TM-64"><span class="linenos"> 64</span></a><span class="sd">	   - Solve the heat equation for ``(t, dt)`` and set temperatures in momentum.</span>
</span><span id="Simulator_TM-65"><a href="#Simulator_TM-65"><span class="linenos"> 65</span></a><span class="sd">	   - Iterate the momentum step (assemble/solve, update internal variables and rates).</span>
</span><span id="Simulator_TM-66"><a href="#Simulator_TM-66"><span class="linenos"> 66</span></a><span class="sd">	   - Save requested fields.</span>
</span><span id="Simulator_TM-67"><a href="#Simulator_TM-67"><span class="linenos"> 67</span></a>
</span><span id="Simulator_TM-68"><a href="#Simulator_TM-68"><span class="linenos"> 68</span></a><span class="sd">	Returns</span>
</span><span id="Simulator_TM-69"><a href="#Simulator_TM-69"><span class="linenos"> 69</span></a><span class="sd">	-------</span>
</span><span id="Simulator_TM-70"><a href="#Simulator_TM-70"><span class="linenos"> 70</span></a><span class="sd">	None</span>
</span><span id="Simulator_TM-71"><a href="#Simulator_TM-71"><span class="linenos"> 71</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="Simulator_TM-72"><a href="#Simulator_TM-72"><span class="linenos"> 72</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq_mom</span><span class="p">:</span> <span class="n">LinearMomentum</span><span class="p">,</span> 
</span><span id="Simulator_TM-73"><a href="#Simulator_TM-73"><span class="linenos"> 73</span></a>					   <span class="n">eq_heat</span><span class="p">:</span> <span class="n">HeatDiffusion</span><span class="p">,</span> 
</span><span id="Simulator_TM-74"><a href="#Simulator_TM-74"><span class="linenos"> 74</span></a>					   <span class="n">t_control</span><span class="p">:</span> <span class="n">TimeControllerBase</span><span class="p">,</span> 
</span><span id="Simulator_TM-75"><a href="#Simulator_TM-75"><span class="linenos"> 75</span></a>					   <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SaveFields</span><span class="p">],</span>
</span><span id="Simulator_TM-76"><a href="#Simulator_TM-76"><span class="linenos"> 76</span></a>					   <span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Simulator_TM-77"><a href="#Simulator_TM-77"><span class="linenos"> 77</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span> <span class="o">=</span> <span class="n">eq_mom</span>
</span><span id="Simulator_TM-78"><a href="#Simulator_TM-78"><span class="linenos"> 78</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span> <span class="o">=</span> <span class="n">eq_heat</span>
</span><span id="Simulator_TM-79"><a href="#Simulator_TM-79"><span class="linenos"> 79</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span> <span class="o">=</span> <span class="n">t_control</span>
</span><span id="Simulator_TM-80"><a href="#Simulator_TM-80"><span class="linenos"> 80</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
</span><span id="Simulator_TM-81"><a href="#Simulator_TM-81"><span class="linenos"> 81</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span> <span class="o">=</span> <span class="n">compute_elastic_response</span>
</span><span id="Simulator_TM-82"><a href="#Simulator_TM-82"><span class="linenos"> 82</span></a>
</span><span id="Simulator_TM-83"><a href="#Simulator_TM-83"><span class="linenos"> 83</span></a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Simulator_TM-84"><a href="#Simulator_TM-84"><span class="linenos"> 84</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_TM-85"><a href="#Simulator_TM-85"><span class="linenos"> 85</span></a><span class="sd">		Run the coupled thermomechanical simulation.</span>
</span><span id="Simulator_TM-86"><a href="#Simulator_TM-86"><span class="linenos"> 86</span></a>
</span><span id="Simulator_TM-87"><a href="#Simulator_TM-87"><span class="linenos"> 87</span></a><span class="sd">		Workflow</span>
</span><span id="Simulator_TM-88"><a href="#Simulator_TM-88"><span class="linenos"> 88</span></a><span class="sd">		--------</span>
</span><span id="Simulator_TM-89"><a href="#Simulator_TM-89"><span class="linenos"> 89</span></a><span class="sd">		1. Initialize outputs.</span>
</span><span id="Simulator_TM-90"><a href="#Simulator_TM-90"><span class="linenos"> 90</span></a><span class="sd">		2. Initialize momentum temperature history from the heat solution.</span>
</span><span id="Simulator_TM-91"><a href="#Simulator_TM-91"><span class="linenos"> 91</span></a><span class="sd">		3. Update BCs and optionally solve a purely elastic step.</span>
</span><span id="Simulator_TM-92"><a href="#Simulator_TM-92"><span class="linenos"> 92</span></a><span class="sd">		4. Initialize non-elastic rates.</span>
</span><span id="Simulator_TM-93"><a href="#Simulator_TM-93"><span class="linenos"> 93</span></a><span class="sd">		5. Time loop:</span>
</span><span id="Simulator_TM-94"><a href="#Simulator_TM-94"><span class="linenos"> 94</span></a>
</span><span id="Simulator_TM-95"><a href="#Simulator_TM-95"><span class="linenos"> 95</span></a><span class="sd">		   - Advance time, update BCs, solve heat step.</span>
</span><span id="Simulator_TM-96"><a href="#Simulator_TM-96"><span class="linenos"> 96</span></a><span class="sd">		   - Fixed-point (or single-pass) iterate the momentum step with the</span>
</span><span id="Simulator_TM-97"><a href="#Simulator_TM-97"><span class="linenos"> 97</span></a><span class="sd">		     current temperature, updating internal variables and rates.</span>
</span><span id="Simulator_TM-98"><a href="#Simulator_TM-98"><span class="linenos"> 98</span></a><span class="sd">		   - Save requested fields.</span>
</span><span id="Simulator_TM-99"><a href="#Simulator_TM-99"><span class="linenos"> 99</span></a>
</span><span id="Simulator_TM-100"><a href="#Simulator_TM-100"><span class="linenos">100</span></a><span class="sd">		Convergence</span>
</span><span id="Simulator_TM-101"><a href="#Simulator_TM-101"><span class="linenos">101</span></a><span class="sd">		-----------</span>
</span><span id="Simulator_TM-102"><a href="#Simulator_TM-102"><span class="linenos">102</span></a><span class="sd">		Uses a relative change in total strain between iterations as error.</span>
</span><span id="Simulator_TM-103"><a href="#Simulator_TM-103"><span class="linenos">103</span></a><span class="sd">		If ``theta == 1.0`` (backward Euler) or there are no non-elastic</span>
</span><span id="Simulator_TM-104"><a href="#Simulator_TM-104"><span class="linenos">104</span></a><span class="sd">		elements, iteration terminates immediately.</span>
</span><span id="Simulator_TM-105"><a href="#Simulator_TM-105"><span class="linenos">105</span></a>
</span><span id="Simulator_TM-106"><a href="#Simulator_TM-106"><span class="linenos">106</span></a><span class="sd">		Returns</span>
</span><span id="Simulator_TM-107"><a href="#Simulator_TM-107"><span class="linenos">107</span></a><span class="sd">		-------</span>
</span><span id="Simulator_TM-108"><a href="#Simulator_TM-108"><span class="linenos">108</span></a><span class="sd">		None</span>
</span><span id="Simulator_TM-109"><a href="#Simulator_TM-109"><span class="linenos">109</span></a>
</span><span id="Simulator_TM-110"><a href="#Simulator_TM-110"><span class="linenos">110</span></a><span class="sd">		Notes</span>
</span><span id="Simulator_TM-111"><a href="#Simulator_TM-111"><span class="linenos">111</span></a><span class="sd">		-----</span>
</span><span id="Simulator_TM-112"><a href="#Simulator_TM-112"><span class="linenos">112</span></a><span class="sd">		- Calls ``SaveFields.initialize()`` once and ``save_fields(t)`` at each</span>
</span><span id="Simulator_TM-113"><a href="#Simulator_TM-113"><span class="linenos">113</span></a><span class="sd">		  saved time, followed by ``save_mesh()`` after the loop.</span>
</span><span id="Simulator_TM-114"><a href="#Simulator_TM-114"><span class="linenos">114</span></a><span class="sd">		- Printing of progress occurs on rank 0 only.</span>
</span><span id="Simulator_TM-115"><a href="#Simulator_TM-115"><span class="linenos">115</span></a><span class="sd">		- The first ``output.save_fields(0)`` call targets the last ``output``</span>
</span><span id="Simulator_TM-116"><a href="#Simulator_TM-116"><span class="linenos">116</span></a><span class="sd">		  from the preceding loop variable; ensure all outputs are saved by</span>
</span><span id="Simulator_TM-117"><a href="#Simulator_TM-117"><span class="linenos">117</span></a><span class="sd">		  iterating over ``self.outputs``.</span>
</span><span id="Simulator_TM-118"><a href="#Simulator_TM-118"><span class="linenos">118</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Simulator_TM-119"><a href="#Simulator_TM-119"><span class="linenos">119</span></a>		<span class="c1"># Output field</span>
</span><span id="Simulator_TM-120"><a href="#Simulator_TM-120"><span class="linenos">120</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_TM-121"><a href="#Simulator_TM-121"><span class="linenos">121</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Simulator_TM-122"><a href="#Simulator_TM-122"><span class="linenos">122</span></a>
</span><span id="Simulator_TM-123"><a href="#Simulator_TM-123"><span class="linenos">123</span></a>		<span class="c1"># Set initial temperature</span>
</span><span id="Simulator_TM-124"><a href="#Simulator_TM-124"><span class="linenos">124</span></a>		<span class="n">T_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">get_T_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-125"><a href="#Simulator_TM-125"><span class="linenos">125</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T0</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM-126"><a href="#Simulator_TM-126"><span class="linenos">126</span></a>
</span><span id="Simulator_TM-127"><a href="#Simulator_TM-127"><span class="linenos">127</span></a>		<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_TM-128"><a href="#Simulator_TM-128"><span class="linenos">128</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-129"><a href="#Simulator_TM-129"><span class="linenos">129</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-130"><a href="#Simulator_TM-130"><span class="linenos">130</span></a>
</span><span id="Simulator_TM-131"><a href="#Simulator_TM-131"><span class="linenos">131</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span><span class="p">:</span>
</span><span id="Simulator_TM-132"><a href="#Simulator_TM-132"><span class="linenos">132</span></a>			<span class="c1"># Solve elasticity</span>
</span><span id="Simulator_TM-133"><a href="#Simulator_TM-133"><span class="linenos">133</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve_elastic_response</span><span class="p">()</span>
</span><span id="Simulator_TM-134"><a href="#Simulator_TM-134"><span class="linenos">134</span></a>
</span><span id="Simulator_TM-135"><a href="#Simulator_TM-135"><span class="linenos">135</span></a>			<span class="c1"># Calculate total (elastic) strain</span>
</span><span id="Simulator_TM-136"><a href="#Simulator_TM-136"><span class="linenos">136</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_TM-137"><a href="#Simulator_TM-137"><span class="linenos">137</span></a>
</span><span id="Simulator_TM-138"><a href="#Simulator_TM-138"><span class="linenos">138</span></a>			<span class="c1"># Compute stress</span>
</span><span id="Simulator_TM-139"><a href="#Simulator_TM-139"><span class="linenos">139</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_elastic_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_TM-140"><a href="#Simulator_TM-140"><span class="linenos">140</span></a>
</span><span id="Simulator_TM-141"><a href="#Simulator_TM-141"><span class="linenos">141</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_TM-142"><a href="#Simulator_TM-142"><span class="linenos">142</span></a>			<span class="c1"># Calculate total strain</span>
</span><span id="Simulator_TM-143"><a href="#Simulator_TM-143"><span class="linenos">143</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_TM-144"><a href="#Simulator_TM-144"><span class="linenos">144</span></a>
</span><span id="Simulator_TM-145"><a href="#Simulator_TM-145"><span class="linenos">145</span></a>			<span class="c1"># Retrieve stress</span>
</span><span id="Simulator_TM-146"><a href="#Simulator_TM-146"><span class="linenos">146</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="Simulator_TM-147"><a href="#Simulator_TM-147"><span class="linenos">147</span></a>
</span><span id="Simulator_TM-148"><a href="#Simulator_TM-148"><span class="linenos">148</span></a>		<span class="c1"># Set new temperature to momentum equation</span>
</span><span id="Simulator_TM-149"><a href="#Simulator_TM-149"><span class="linenos">149</span></a>		<span class="n">T_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">get_T_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-150"><a href="#Simulator_TM-150"><span class="linenos">150</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM-151"><a href="#Simulator_TM-151"><span class="linenos">151</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T0</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM-152"><a href="#Simulator_TM-152"><span class="linenos">152</span></a>
</span><span id="Simulator_TM-153"><a href="#Simulator_TM-153"><span class="linenos">153</span></a>		<span class="c1"># Calculate and eps_ie_rate_old</span>
</span><span id="Simulator_TM-154"><a href="#Simulator_TM-154"><span class="linenos">154</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-155"><a href="#Simulator_TM-155"><span class="linenos">155</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_TM-156"><a href="#Simulator_TM-156"><span class="linenos">156</span></a>
</span><span id="Simulator_TM-157"><a href="#Simulator_TM-157"><span class="linenos">157</span></a>
</span><span id="Simulator_TM-158"><a href="#Simulator_TM-158"><span class="linenos">158</span></a>		<span class="c1"># self.eq_heat.solve(0, self.t_control.dt)</span>
</span><span id="Simulator_TM-159"><a href="#Simulator_TM-159"><span class="linenos">159</span></a>
</span><span id="Simulator_TM-160"><a href="#Simulator_TM-160"><span class="linenos">160</span></a>		<span class="c1"># Save fields</span>
</span><span id="Simulator_TM-161"><a href="#Simulator_TM-161"><span class="linenos">161</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-162"><a href="#Simulator_TM-162"><span class="linenos">162</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-163"><a href="#Simulator_TM-163"><span class="linenos">163</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM-164"><a href="#Simulator_TM-164"><span class="linenos">164</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM-165"><a href="#Simulator_TM-165"><span class="linenos">165</span></a>		<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Simulator_TM-166"><a href="#Simulator_TM-166"><span class="linenos">166</span></a>
</span><span id="Simulator_TM-167"><a href="#Simulator_TM-167"><span class="linenos">167</span></a>		<span class="c1"># Time loop</span>
</span><span id="Simulator_TM-168"><a href="#Simulator_TM-168"><span class="linenos">168</span></a>		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">keep_looping</span><span class="p">():</span>
</span><span id="Simulator_TM-169"><a href="#Simulator_TM-169"><span class="linenos">169</span></a>
</span><span id="Simulator_TM-170"><a href="#Simulator_TM-170"><span class="linenos">170</span></a>			<span class="c1"># Advance time</span>
</span><span id="Simulator_TM-171"><a href="#Simulator_TM-171"><span class="linenos">171</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">advance_time</span><span class="p">()</span>
</span><span id="Simulator_TM-172"><a href="#Simulator_TM-172"><span class="linenos">172</span></a>			<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span>
</span><span id="Simulator_TM-173"><a href="#Simulator_TM-173"><span class="linenos">173</span></a>			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">dt</span>
</span><span id="Simulator_TM-174"><a href="#Simulator_TM-174"><span class="linenos">174</span></a>
</span><span id="Simulator_TM-175"><a href="#Simulator_TM-175"><span class="linenos">175</span></a>			<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_TM-176"><a href="#Simulator_TM-176"><span class="linenos">176</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-177"><a href="#Simulator_TM-177"><span class="linenos">177</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-178"><a href="#Simulator_TM-178"><span class="linenos">178</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-179"><a href="#Simulator_TM-179"><span class="linenos">179</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-180"><a href="#Simulator_TM-180"><span class="linenos">180</span></a>
</span><span id="Simulator_TM-181"><a href="#Simulator_TM-181"><span class="linenos">181</span></a>			<span class="c1"># Solve heat</span>
</span><span id="Simulator_TM-182"><a href="#Simulator_TM-182"><span class="linenos">182</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM-183"><a href="#Simulator_TM-183"><span class="linenos">183</span></a>
</span><span id="Simulator_TM-184"><a href="#Simulator_TM-184"><span class="linenos">184</span></a>			<span class="c1"># Set new temperature to momentum equation</span>
</span><span id="Simulator_TM-185"><a href="#Simulator_TM-185"><span class="linenos">185</span></a>			<span class="n">T_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">get_T_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-186"><a href="#Simulator_TM-186"><span class="linenos">186</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM-187"><a href="#Simulator_TM-187"><span class="linenos">187</span></a>
</span><span id="Simulator_TM-188"><a href="#Simulator_TM-188"><span class="linenos">188</span></a>			<span class="c1"># Iterative loop settings</span>
</span><span id="Simulator_TM-189"><a href="#Simulator_TM-189"><span class="linenos">189</span></a>			<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="Simulator_TM-190"><a href="#Simulator_TM-190"><span class="linenos">190</span></a>			<span class="n">error</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tol</span>
</span><span id="Simulator_TM-191"><a href="#Simulator_TM-191"><span class="linenos">191</span></a>			<span class="n">ite</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Simulator_TM-192"><a href="#Simulator_TM-192"><span class="linenos">192</span></a>			<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="Simulator_TM-193"><a href="#Simulator_TM-193"><span class="linenos">193</span></a>
</span><span id="Simulator_TM-194"><a href="#Simulator_TM-194"><span class="linenos">194</span></a>			<span class="k">while</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">tol</span> <span class="ow">and</span> <span class="n">ite</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">:</span>
</span><span id="Simulator_TM-195"><a href="#Simulator_TM-195"><span class="linenos">195</span></a>
</span><span id="Simulator_TM-196"><a href="#Simulator_TM-196"><span class="linenos">196</span></a>				<span class="c1"># Update total strain of previous iteration (eps_tot_k &lt;-- eps_tot)</span>
</span><span id="Simulator_TM-197"><a href="#Simulator_TM-197"><span class="linenos">197</span></a>				<span class="n">eps_tot_k_to</span> <span class="o">=</span> <span class="n">eps_tot_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_TM-198"><a href="#Simulator_TM-198"><span class="linenos">198</span></a>
</span><span id="Simulator_TM-199"><a href="#Simulator_TM-199"><span class="linenos">199</span></a>				<span class="c1"># Update stress</span>
</span><span id="Simulator_TM-200"><a href="#Simulator_TM-200"><span class="linenos">200</span></a>				<span class="n">stress_k_to</span> <span class="o">=</span> <span class="n">stress_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_TM-201"><a href="#Simulator_TM-201"><span class="linenos">201</span></a>
</span><span id="Simulator_TM-202"><a href="#Simulator_TM-202"><span class="linenos">202</span></a>				<span class="c1"># Build bi-linear form</span>
</span><span id="Simulator_TM-203"><a href="#Simulator_TM-203"><span class="linenos">203</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">stress_k_to</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM-204"><a href="#Simulator_TM-204"><span class="linenos">204</span></a>
</span><span id="Simulator_TM-205"><a href="#Simulator_TM-205"><span class="linenos">205</span></a>				<span class="c1"># Compute total strain</span>
</span><span id="Simulator_TM-206"><a href="#Simulator_TM-206"><span class="linenos">206</span></a>				<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_TM-207"><a href="#Simulator_TM-207"><span class="linenos">207</span></a>
</span><span id="Simulator_TM-208"><a href="#Simulator_TM-208"><span class="linenos">208</span></a>				<span class="c1"># Compute stress</span>
</span><span id="Simulator_TM-209"><a href="#Simulator_TM-209"><span class="linenos">209</span></a>				<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_TM-210"><a href="#Simulator_TM-210"><span class="linenos">210</span></a>
</span><span id="Simulator_TM-211"><a href="#Simulator_TM-211"><span class="linenos">211</span></a>				<span class="c1"># Increment internal variables</span>
</span><span id="Simulator_TM-212"><a href="#Simulator_TM-212"><span class="linenos">212</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">increment_internal_variables</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM-213"><a href="#Simulator_TM-213"><span class="linenos">213</span></a>
</span><span id="Simulator_TM-214"><a href="#Simulator_TM-214"><span class="linenos">214</span></a>				<span class="c1"># Compute inelastic strain rates</span>
</span><span id="Simulator_TM-215"><a href="#Simulator_TM-215"><span class="linenos">215</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM-216"><a href="#Simulator_TM-216"><span class="linenos">216</span></a>
</span><span id="Simulator_TM-217"><a href="#Simulator_TM-217"><span class="linenos">217</span></a>				<span class="c1"># Compute error</span>
</span><span id="Simulator_TM-218"><a href="#Simulator_TM-218"><span class="linenos">218</span></a>				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Simulator_TM-219"><a href="#Simulator_TM-219"><span class="linenos">219</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_TM-220"><a href="#Simulator_TM-220"><span class="linenos">220</span></a>				<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_TM-221"><a href="#Simulator_TM-221"><span class="linenos">221</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_TM-222"><a href="#Simulator_TM-222"><span class="linenos">222</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_TM-223"><a href="#Simulator_TM-223"><span class="linenos">223</span></a>					<span class="n">eps_tot_k_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_k_to</span><span class="p">)</span>
</span><span id="Simulator_TM-224"><a href="#Simulator_TM-224"><span class="linenos">224</span></a>					<span class="n">eps_tot_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_TM-225"><a href="#Simulator_TM-225"><span class="linenos">225</span></a>					<span class="n">local_error</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_k_flat</span> <span class="o">-</span> <span class="n">eps_tot_flat</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_flat</span><span class="p">)</span>
</span><span id="Simulator_TM-226"><a href="#Simulator_TM-226"><span class="linenos">226</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">local_error</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>
</span><span id="Simulator_TM-227"><a href="#Simulator_TM-227"><span class="linenos">227</span></a>
</span><span id="Simulator_TM-228"><a href="#Simulator_TM-228"><span class="linenos">228</span></a>				<span class="n">ite</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Simulator_TM-229"><a href="#Simulator_TM-229"><span class="linenos">229</span></a>
</span><span id="Simulator_TM-230"><a href="#Simulator_TM-230"><span class="linenos">230</span></a>			<span class="c1"># Update internal variables</span>
</span><span id="Simulator_TM-231"><a href="#Simulator_TM-231"><span class="linenos">231</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_internal_variables</span><span class="p">()</span>
</span><span id="Simulator_TM-232"><a href="#Simulator_TM-232"><span class="linenos">232</span></a>
</span><span id="Simulator_TM-233"><a href="#Simulator_TM-233"><span class="linenos">233</span></a>			<span class="c1"># Update strain rates</span>
</span><span id="Simulator_TM-234"><a href="#Simulator_TM-234"><span class="linenos">234</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_TM-235"><a href="#Simulator_TM-235"><span class="linenos">235</span></a>
</span><span id="Simulator_TM-236"><a href="#Simulator_TM-236"><span class="linenos">236</span></a>			<span class="c1"># Update strain</span>
</span><span id="Simulator_TM-237"><a href="#Simulator_TM-237"><span class="linenos">237</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_old</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM-238"><a href="#Simulator_TM-238"><span class="linenos">238</span></a>
</span><span id="Simulator_TM-239"><a href="#Simulator_TM-239"><span class="linenos">239</span></a>			<span class="c1"># Print stuff</span>
</span><span id="Simulator_TM-240"><a href="#Simulator_TM-240"><span class="linenos">240</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_TM-241"><a href="#Simulator_TM-241"><span class="linenos">241</span></a>				<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">ite</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span id="Simulator_TM-242"><a href="#Simulator_TM-242"><span class="linenos">242</span></a>				<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_TM-243"><a href="#Simulator_TM-243"><span class="linenos">243</span></a>
</span><span id="Simulator_TM-244"><a href="#Simulator_TM-244"><span class="linenos">244</span></a>			<span class="c1"># Save fields</span>
</span><span id="Simulator_TM-245"><a href="#Simulator_TM-245"><span class="linenos">245</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-246"><a href="#Simulator_TM-246"><span class="linenos">246</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_TM-247"><a href="#Simulator_TM-247"><span class="linenos">247</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM-248"><a href="#Simulator_TM-248"><span class="linenos">248</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM-249"><a href="#Simulator_TM-249"><span class="linenos">249</span></a>			<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_TM-250"><a href="#Simulator_TM-250"><span class="linenos">250</span></a>				<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM-251"><a href="#Simulator_TM-251"><span class="linenos">251</span></a>
</span><span id="Simulator_TM-252"><a href="#Simulator_TM-252"><span class="linenos">252</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_TM-253"><a href="#Simulator_TM-253"><span class="linenos">253</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Run the coupled thermomechanical simulation.</p>

<h6 id="workflow">Workflow</h6>

<ol>
<li>Initialize outputs.</li>
<li>Initialize momentum temperature from the heat solution and update BCs.</li>
<li>Optionally solve a purely elastic response.</li>
<li>Initialize non-elastic rates.</li>
<li><p>For each time step:</p>

<ul>
<li>Advance time and update boundary conditions for both equations.</li>
<li>Solve the heat equation for <code>(t, dt)</code> and set temperatures in momentum.</li>
<li>Iterate the momentum step (assemble/solve, update internal variables and rates).</li>
<li>Save requested fields.</li>
</ul></li>
</ol>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            <div id="Simulator_TM.__init__" class="classattr">
                                        <input id="Simulator_TM.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Simulator_TM</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">eq_mom</span><span class="p">:</span> <span class="n"><a href="#LinearMomentum">LinearMomentum</a></span>,</span><span class="param">	<span class="n">eq_heat</span><span class="p">:</span> <span class="n"><a href="#HeatDiffusion">HeatDiffusion</a></span>,</span><span class="param">	<span class="n">t_control</span><span class="p">:</span> <span class="n"><a href="#TimeControllerBase">TimeControllerBase</a></span>,</span><span class="param">	<span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#SaveFields">SaveFields</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="Simulator_TM.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_TM.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_TM.__init__-72"><a href="#Simulator_TM.__init__-72"><span class="linenos">72</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq_mom</span><span class="p">:</span> <span class="n">LinearMomentum</span><span class="p">,</span> 
</span><span id="Simulator_TM.__init__-73"><a href="#Simulator_TM.__init__-73"><span class="linenos">73</span></a>					   <span class="n">eq_heat</span><span class="p">:</span> <span class="n">HeatDiffusion</span><span class="p">,</span> 
</span><span id="Simulator_TM.__init__-74"><a href="#Simulator_TM.__init__-74"><span class="linenos">74</span></a>					   <span class="n">t_control</span><span class="p">:</span> <span class="n">TimeControllerBase</span><span class="p">,</span> 
</span><span id="Simulator_TM.__init__-75"><a href="#Simulator_TM.__init__-75"><span class="linenos">75</span></a>					   <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SaveFields</span><span class="p">],</span>
</span><span id="Simulator_TM.__init__-76"><a href="#Simulator_TM.__init__-76"><span class="linenos">76</span></a>					   <span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Simulator_TM.__init__-77"><a href="#Simulator_TM.__init__-77"><span class="linenos">77</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span> <span class="o">=</span> <span class="n">eq_mom</span>
</span><span id="Simulator_TM.__init__-78"><a href="#Simulator_TM.__init__-78"><span class="linenos">78</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span> <span class="o">=</span> <span class="n">eq_heat</span>
</span><span id="Simulator_TM.__init__-79"><a href="#Simulator_TM.__init__-79"><span class="linenos">79</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span> <span class="o">=</span> <span class="n">t_control</span>
</span><span id="Simulator_TM.__init__-80"><a href="#Simulator_TM.__init__-80"><span class="linenos">80</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
</span><span id="Simulator_TM.__init__-81"><a href="#Simulator_TM.__init__-81"><span class="linenos">81</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span> <span class="o">=</span> <span class="n">compute_elastic_response</span>
</span></pre></div>


    

                            </div>
                            <div id="Simulator_TM.eq_mom" class="classattr">
                                <div class="attr variable">
            <span class="name">eq_mom</span>

        
    </div>
    <a class="headerlink" href="#Simulator_TM.eq_mom"></a>
    
    

                            </div>
                            <div id="Simulator_TM.eq_heat" class="classattr">
                                <div class="attr variable">
            <span class="name">eq_heat</span>

        
    </div>
    <a class="headerlink" href="#Simulator_TM.eq_heat"></a>
    
    

                            </div>
                            <div id="Simulator_TM.t_control" class="classattr">
                                <div class="attr variable">
            <span class="name">t_control</span>

        
    </div>
    <a class="headerlink" href="#Simulator_TM.t_control"></a>
    
    

                            </div>
                            <div id="Simulator_TM.outputs" class="classattr">
                                <div class="attr variable">
            <span class="name">outputs</span>

        
    </div>
    <a class="headerlink" href="#Simulator_TM.outputs"></a>
    
    

                            </div>
                            <div id="Simulator_TM.compute_elastic_response" class="classattr">
                                <div class="attr variable">
            <span class="name">compute_elastic_response</span>

        
    </div>
    <a class="headerlink" href="#Simulator_TM.compute_elastic_response"></a>
    
    

                            </div>
                            <div id="Simulator_TM.run" class="classattr">
                                        <input id="Simulator_TM.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Simulator_TM.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_TM.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_TM.run-83"><a href="#Simulator_TM.run-83"><span class="linenos"> 83</span></a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Simulator_TM.run-84"><a href="#Simulator_TM.run-84"><span class="linenos"> 84</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_TM.run-85"><a href="#Simulator_TM.run-85"><span class="linenos"> 85</span></a><span class="sd">		Run the coupled thermomechanical simulation.</span>
</span><span id="Simulator_TM.run-86"><a href="#Simulator_TM.run-86"><span class="linenos"> 86</span></a>
</span><span id="Simulator_TM.run-87"><a href="#Simulator_TM.run-87"><span class="linenos"> 87</span></a><span class="sd">		Workflow</span>
</span><span id="Simulator_TM.run-88"><a href="#Simulator_TM.run-88"><span class="linenos"> 88</span></a><span class="sd">		--------</span>
</span><span id="Simulator_TM.run-89"><a href="#Simulator_TM.run-89"><span class="linenos"> 89</span></a><span class="sd">		1. Initialize outputs.</span>
</span><span id="Simulator_TM.run-90"><a href="#Simulator_TM.run-90"><span class="linenos"> 90</span></a><span class="sd">		2. Initialize momentum temperature history from the heat solution.</span>
</span><span id="Simulator_TM.run-91"><a href="#Simulator_TM.run-91"><span class="linenos"> 91</span></a><span class="sd">		3. Update BCs and optionally solve a purely elastic step.</span>
</span><span id="Simulator_TM.run-92"><a href="#Simulator_TM.run-92"><span class="linenos"> 92</span></a><span class="sd">		4. Initialize non-elastic rates.</span>
</span><span id="Simulator_TM.run-93"><a href="#Simulator_TM.run-93"><span class="linenos"> 93</span></a><span class="sd">		5. Time loop:</span>
</span><span id="Simulator_TM.run-94"><a href="#Simulator_TM.run-94"><span class="linenos"> 94</span></a>
</span><span id="Simulator_TM.run-95"><a href="#Simulator_TM.run-95"><span class="linenos"> 95</span></a><span class="sd">		   - Advance time, update BCs, solve heat step.</span>
</span><span id="Simulator_TM.run-96"><a href="#Simulator_TM.run-96"><span class="linenos"> 96</span></a><span class="sd">		   - Fixed-point (or single-pass) iterate the momentum step with the</span>
</span><span id="Simulator_TM.run-97"><a href="#Simulator_TM.run-97"><span class="linenos"> 97</span></a><span class="sd">		     current temperature, updating internal variables and rates.</span>
</span><span id="Simulator_TM.run-98"><a href="#Simulator_TM.run-98"><span class="linenos"> 98</span></a><span class="sd">		   - Save requested fields.</span>
</span><span id="Simulator_TM.run-99"><a href="#Simulator_TM.run-99"><span class="linenos"> 99</span></a>
</span><span id="Simulator_TM.run-100"><a href="#Simulator_TM.run-100"><span class="linenos">100</span></a><span class="sd">		Convergence</span>
</span><span id="Simulator_TM.run-101"><a href="#Simulator_TM.run-101"><span class="linenos">101</span></a><span class="sd">		-----------</span>
</span><span id="Simulator_TM.run-102"><a href="#Simulator_TM.run-102"><span class="linenos">102</span></a><span class="sd">		Uses a relative change in total strain between iterations as error.</span>
</span><span id="Simulator_TM.run-103"><a href="#Simulator_TM.run-103"><span class="linenos">103</span></a><span class="sd">		If ``theta == 1.0`` (backward Euler) or there are no non-elastic</span>
</span><span id="Simulator_TM.run-104"><a href="#Simulator_TM.run-104"><span class="linenos">104</span></a><span class="sd">		elements, iteration terminates immediately.</span>
</span><span id="Simulator_TM.run-105"><a href="#Simulator_TM.run-105"><span class="linenos">105</span></a>
</span><span id="Simulator_TM.run-106"><a href="#Simulator_TM.run-106"><span class="linenos">106</span></a><span class="sd">		Returns</span>
</span><span id="Simulator_TM.run-107"><a href="#Simulator_TM.run-107"><span class="linenos">107</span></a><span class="sd">		-------</span>
</span><span id="Simulator_TM.run-108"><a href="#Simulator_TM.run-108"><span class="linenos">108</span></a><span class="sd">		None</span>
</span><span id="Simulator_TM.run-109"><a href="#Simulator_TM.run-109"><span class="linenos">109</span></a>
</span><span id="Simulator_TM.run-110"><a href="#Simulator_TM.run-110"><span class="linenos">110</span></a><span class="sd">		Notes</span>
</span><span id="Simulator_TM.run-111"><a href="#Simulator_TM.run-111"><span class="linenos">111</span></a><span class="sd">		-----</span>
</span><span id="Simulator_TM.run-112"><a href="#Simulator_TM.run-112"><span class="linenos">112</span></a><span class="sd">		- Calls ``SaveFields.initialize()`` once and ``save_fields(t)`` at each</span>
</span><span id="Simulator_TM.run-113"><a href="#Simulator_TM.run-113"><span class="linenos">113</span></a><span class="sd">		  saved time, followed by ``save_mesh()`` after the loop.</span>
</span><span id="Simulator_TM.run-114"><a href="#Simulator_TM.run-114"><span class="linenos">114</span></a><span class="sd">		- Printing of progress occurs on rank 0 only.</span>
</span><span id="Simulator_TM.run-115"><a href="#Simulator_TM.run-115"><span class="linenos">115</span></a><span class="sd">		- The first ``output.save_fields(0)`` call targets the last ``output``</span>
</span><span id="Simulator_TM.run-116"><a href="#Simulator_TM.run-116"><span class="linenos">116</span></a><span class="sd">		  from the preceding loop variable; ensure all outputs are saved by</span>
</span><span id="Simulator_TM.run-117"><a href="#Simulator_TM.run-117"><span class="linenos">117</span></a><span class="sd">		  iterating over ``self.outputs``.</span>
</span><span id="Simulator_TM.run-118"><a href="#Simulator_TM.run-118"><span class="linenos">118</span></a><span class="sd">		&quot;&quot;&quot;</span>
</span><span id="Simulator_TM.run-119"><a href="#Simulator_TM.run-119"><span class="linenos">119</span></a>		<span class="c1"># Output field</span>
</span><span id="Simulator_TM.run-120"><a href="#Simulator_TM.run-120"><span class="linenos">120</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_TM.run-121"><a href="#Simulator_TM.run-121"><span class="linenos">121</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Simulator_TM.run-122"><a href="#Simulator_TM.run-122"><span class="linenos">122</span></a>
</span><span id="Simulator_TM.run-123"><a href="#Simulator_TM.run-123"><span class="linenos">123</span></a>		<span class="c1"># Set initial temperature</span>
</span><span id="Simulator_TM.run-124"><a href="#Simulator_TM.run-124"><span class="linenos">124</span></a>		<span class="n">T_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">get_T_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-125"><a href="#Simulator_TM.run-125"><span class="linenos">125</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T0</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM.run-126"><a href="#Simulator_TM.run-126"><span class="linenos">126</span></a>
</span><span id="Simulator_TM.run-127"><a href="#Simulator_TM.run-127"><span class="linenos">127</span></a>		<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_TM.run-128"><a href="#Simulator_TM.run-128"><span class="linenos">128</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-129"><a href="#Simulator_TM.run-129"><span class="linenos">129</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-130"><a href="#Simulator_TM.run-130"><span class="linenos">130</span></a>
</span><span id="Simulator_TM.run-131"><a href="#Simulator_TM.run-131"><span class="linenos">131</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span><span class="p">:</span>
</span><span id="Simulator_TM.run-132"><a href="#Simulator_TM.run-132"><span class="linenos">132</span></a>			<span class="c1"># Solve elasticity</span>
</span><span id="Simulator_TM.run-133"><a href="#Simulator_TM.run-133"><span class="linenos">133</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve_elastic_response</span><span class="p">()</span>
</span><span id="Simulator_TM.run-134"><a href="#Simulator_TM.run-134"><span class="linenos">134</span></a>
</span><span id="Simulator_TM.run-135"><a href="#Simulator_TM.run-135"><span class="linenos">135</span></a>			<span class="c1"># Calculate total (elastic) strain</span>
</span><span id="Simulator_TM.run-136"><a href="#Simulator_TM.run-136"><span class="linenos">136</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_TM.run-137"><a href="#Simulator_TM.run-137"><span class="linenos">137</span></a>
</span><span id="Simulator_TM.run-138"><a href="#Simulator_TM.run-138"><span class="linenos">138</span></a>			<span class="c1"># Compute stress</span>
</span><span id="Simulator_TM.run-139"><a href="#Simulator_TM.run-139"><span class="linenos">139</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_elastic_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_TM.run-140"><a href="#Simulator_TM.run-140"><span class="linenos">140</span></a>
</span><span id="Simulator_TM.run-141"><a href="#Simulator_TM.run-141"><span class="linenos">141</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_TM.run-142"><a href="#Simulator_TM.run-142"><span class="linenos">142</span></a>			<span class="c1"># Calculate total strain</span>
</span><span id="Simulator_TM.run-143"><a href="#Simulator_TM.run-143"><span class="linenos">143</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_TM.run-144"><a href="#Simulator_TM.run-144"><span class="linenos">144</span></a>
</span><span id="Simulator_TM.run-145"><a href="#Simulator_TM.run-145"><span class="linenos">145</span></a>			<span class="c1"># Retrieve stress</span>
</span><span id="Simulator_TM.run-146"><a href="#Simulator_TM.run-146"><span class="linenos">146</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="Simulator_TM.run-147"><a href="#Simulator_TM.run-147"><span class="linenos">147</span></a>
</span><span id="Simulator_TM.run-148"><a href="#Simulator_TM.run-148"><span class="linenos">148</span></a>		<span class="c1"># Set new temperature to momentum equation</span>
</span><span id="Simulator_TM.run-149"><a href="#Simulator_TM.run-149"><span class="linenos">149</span></a>		<span class="n">T_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">get_T_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-150"><a href="#Simulator_TM.run-150"><span class="linenos">150</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM.run-151"><a href="#Simulator_TM.run-151"><span class="linenos">151</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T0</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM.run-152"><a href="#Simulator_TM.run-152"><span class="linenos">152</span></a>
</span><span id="Simulator_TM.run-153"><a href="#Simulator_TM.run-153"><span class="linenos">153</span></a>		<span class="c1"># Calculate and eps_ie_rate_old</span>
</span><span id="Simulator_TM.run-154"><a href="#Simulator_TM.run-154"><span class="linenos">154</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-155"><a href="#Simulator_TM.run-155"><span class="linenos">155</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_TM.run-156"><a href="#Simulator_TM.run-156"><span class="linenos">156</span></a>
</span><span id="Simulator_TM.run-157"><a href="#Simulator_TM.run-157"><span class="linenos">157</span></a>
</span><span id="Simulator_TM.run-158"><a href="#Simulator_TM.run-158"><span class="linenos">158</span></a>		<span class="c1"># self.eq_heat.solve(0, self.t_control.dt)</span>
</span><span id="Simulator_TM.run-159"><a href="#Simulator_TM.run-159"><span class="linenos">159</span></a>
</span><span id="Simulator_TM.run-160"><a href="#Simulator_TM.run-160"><span class="linenos">160</span></a>		<span class="c1"># Save fields</span>
</span><span id="Simulator_TM.run-161"><a href="#Simulator_TM.run-161"><span class="linenos">161</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-162"><a href="#Simulator_TM.run-162"><span class="linenos">162</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-163"><a href="#Simulator_TM.run-163"><span class="linenos">163</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM.run-164"><a href="#Simulator_TM.run-164"><span class="linenos">164</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM.run-165"><a href="#Simulator_TM.run-165"><span class="linenos">165</span></a>		<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Simulator_TM.run-166"><a href="#Simulator_TM.run-166"><span class="linenos">166</span></a>
</span><span id="Simulator_TM.run-167"><a href="#Simulator_TM.run-167"><span class="linenos">167</span></a>		<span class="c1"># Time loop</span>
</span><span id="Simulator_TM.run-168"><a href="#Simulator_TM.run-168"><span class="linenos">168</span></a>		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">keep_looping</span><span class="p">():</span>
</span><span id="Simulator_TM.run-169"><a href="#Simulator_TM.run-169"><span class="linenos">169</span></a>
</span><span id="Simulator_TM.run-170"><a href="#Simulator_TM.run-170"><span class="linenos">170</span></a>			<span class="c1"># Advance time</span>
</span><span id="Simulator_TM.run-171"><a href="#Simulator_TM.run-171"><span class="linenos">171</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">advance_time</span><span class="p">()</span>
</span><span id="Simulator_TM.run-172"><a href="#Simulator_TM.run-172"><span class="linenos">172</span></a>			<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span>
</span><span id="Simulator_TM.run-173"><a href="#Simulator_TM.run-173"><span class="linenos">173</span></a>			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">dt</span>
</span><span id="Simulator_TM.run-174"><a href="#Simulator_TM.run-174"><span class="linenos">174</span></a>
</span><span id="Simulator_TM.run-175"><a href="#Simulator_TM.run-175"><span class="linenos">175</span></a>			<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_TM.run-176"><a href="#Simulator_TM.run-176"><span class="linenos">176</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-177"><a href="#Simulator_TM.run-177"><span class="linenos">177</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-178"><a href="#Simulator_TM.run-178"><span class="linenos">178</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-179"><a href="#Simulator_TM.run-179"><span class="linenos">179</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-180"><a href="#Simulator_TM.run-180"><span class="linenos">180</span></a>
</span><span id="Simulator_TM.run-181"><a href="#Simulator_TM.run-181"><span class="linenos">181</span></a>			<span class="c1"># Solve heat</span>
</span><span id="Simulator_TM.run-182"><a href="#Simulator_TM.run-182"><span class="linenos">182</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM.run-183"><a href="#Simulator_TM.run-183"><span class="linenos">183</span></a>
</span><span id="Simulator_TM.run-184"><a href="#Simulator_TM.run-184"><span class="linenos">184</span></a>			<span class="c1"># Set new temperature to momentum equation</span>
</span><span id="Simulator_TM.run-185"><a href="#Simulator_TM.run-185"><span class="linenos">185</span></a>			<span class="n">T_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">get_T_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-186"><a href="#Simulator_TM.run-186"><span class="linenos">186</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">set_T</span><span class="p">(</span><span class="n">T_elems</span><span class="p">)</span>
</span><span id="Simulator_TM.run-187"><a href="#Simulator_TM.run-187"><span class="linenos">187</span></a>
</span><span id="Simulator_TM.run-188"><a href="#Simulator_TM.run-188"><span class="linenos">188</span></a>			<span class="c1"># Iterative loop settings</span>
</span><span id="Simulator_TM.run-189"><a href="#Simulator_TM.run-189"><span class="linenos">189</span></a>			<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="Simulator_TM.run-190"><a href="#Simulator_TM.run-190"><span class="linenos">190</span></a>			<span class="n">error</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tol</span>
</span><span id="Simulator_TM.run-191"><a href="#Simulator_TM.run-191"><span class="linenos">191</span></a>			<span class="n">ite</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Simulator_TM.run-192"><a href="#Simulator_TM.run-192"><span class="linenos">192</span></a>			<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="Simulator_TM.run-193"><a href="#Simulator_TM.run-193"><span class="linenos">193</span></a>
</span><span id="Simulator_TM.run-194"><a href="#Simulator_TM.run-194"><span class="linenos">194</span></a>			<span class="k">while</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">tol</span> <span class="ow">and</span> <span class="n">ite</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">:</span>
</span><span id="Simulator_TM.run-195"><a href="#Simulator_TM.run-195"><span class="linenos">195</span></a>
</span><span id="Simulator_TM.run-196"><a href="#Simulator_TM.run-196"><span class="linenos">196</span></a>				<span class="c1"># Update total strain of previous iteration (eps_tot_k &lt;-- eps_tot)</span>
</span><span id="Simulator_TM.run-197"><a href="#Simulator_TM.run-197"><span class="linenos">197</span></a>				<span class="n">eps_tot_k_to</span> <span class="o">=</span> <span class="n">eps_tot_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_TM.run-198"><a href="#Simulator_TM.run-198"><span class="linenos">198</span></a>
</span><span id="Simulator_TM.run-199"><a href="#Simulator_TM.run-199"><span class="linenos">199</span></a>				<span class="c1"># Update stress</span>
</span><span id="Simulator_TM.run-200"><a href="#Simulator_TM.run-200"><span class="linenos">200</span></a>				<span class="n">stress_k_to</span> <span class="o">=</span> <span class="n">stress_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_TM.run-201"><a href="#Simulator_TM.run-201"><span class="linenos">201</span></a>
</span><span id="Simulator_TM.run-202"><a href="#Simulator_TM.run-202"><span class="linenos">202</span></a>				<span class="c1"># Build bi-linear form</span>
</span><span id="Simulator_TM.run-203"><a href="#Simulator_TM.run-203"><span class="linenos">203</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">stress_k_to</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM.run-204"><a href="#Simulator_TM.run-204"><span class="linenos">204</span></a>
</span><span id="Simulator_TM.run-205"><a href="#Simulator_TM.run-205"><span class="linenos">205</span></a>				<span class="c1"># Compute total strain</span>
</span><span id="Simulator_TM.run-206"><a href="#Simulator_TM.run-206"><span class="linenos">206</span></a>				<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_TM.run-207"><a href="#Simulator_TM.run-207"><span class="linenos">207</span></a>
</span><span id="Simulator_TM.run-208"><a href="#Simulator_TM.run-208"><span class="linenos">208</span></a>				<span class="c1"># Compute stress</span>
</span><span id="Simulator_TM.run-209"><a href="#Simulator_TM.run-209"><span class="linenos">209</span></a>				<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_TM.run-210"><a href="#Simulator_TM.run-210"><span class="linenos">210</span></a>
</span><span id="Simulator_TM.run-211"><a href="#Simulator_TM.run-211"><span class="linenos">211</span></a>				<span class="c1"># Increment internal variables</span>
</span><span id="Simulator_TM.run-212"><a href="#Simulator_TM.run-212"><span class="linenos">212</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">increment_internal_variables</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM.run-213"><a href="#Simulator_TM.run-213"><span class="linenos">213</span></a>
</span><span id="Simulator_TM.run-214"><a href="#Simulator_TM.run-214"><span class="linenos">214</span></a>				<span class="c1"># Compute inelastic strain rates</span>
</span><span id="Simulator_TM.run-215"><a href="#Simulator_TM.run-215"><span class="linenos">215</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM.run-216"><a href="#Simulator_TM.run-216"><span class="linenos">216</span></a>
</span><span id="Simulator_TM.run-217"><a href="#Simulator_TM.run-217"><span class="linenos">217</span></a>				<span class="c1"># Compute error</span>
</span><span id="Simulator_TM.run-218"><a href="#Simulator_TM.run-218"><span class="linenos">218</span></a>				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Simulator_TM.run-219"><a href="#Simulator_TM.run-219"><span class="linenos">219</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_TM.run-220"><a href="#Simulator_TM.run-220"><span class="linenos">220</span></a>				<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_TM.run-221"><a href="#Simulator_TM.run-221"><span class="linenos">221</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_TM.run-222"><a href="#Simulator_TM.run-222"><span class="linenos">222</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_TM.run-223"><a href="#Simulator_TM.run-223"><span class="linenos">223</span></a>					<span class="n">eps_tot_k_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_k_to</span><span class="p">)</span>
</span><span id="Simulator_TM.run-224"><a href="#Simulator_TM.run-224"><span class="linenos">224</span></a>					<span class="n">eps_tot_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_TM.run-225"><a href="#Simulator_TM.run-225"><span class="linenos">225</span></a>					<span class="n">local_error</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_k_flat</span> <span class="o">-</span> <span class="n">eps_tot_flat</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_flat</span><span class="p">)</span>
</span><span id="Simulator_TM.run-226"><a href="#Simulator_TM.run-226"><span class="linenos">226</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">local_error</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>
</span><span id="Simulator_TM.run-227"><a href="#Simulator_TM.run-227"><span class="linenos">227</span></a>
</span><span id="Simulator_TM.run-228"><a href="#Simulator_TM.run-228"><span class="linenos">228</span></a>				<span class="n">ite</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Simulator_TM.run-229"><a href="#Simulator_TM.run-229"><span class="linenos">229</span></a>
</span><span id="Simulator_TM.run-230"><a href="#Simulator_TM.run-230"><span class="linenos">230</span></a>			<span class="c1"># Update internal variables</span>
</span><span id="Simulator_TM.run-231"><a href="#Simulator_TM.run-231"><span class="linenos">231</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_internal_variables</span><span class="p">()</span>
</span><span id="Simulator_TM.run-232"><a href="#Simulator_TM.run-232"><span class="linenos">232</span></a>
</span><span id="Simulator_TM.run-233"><a href="#Simulator_TM.run-233"><span class="linenos">233</span></a>			<span class="c1"># Update strain rates</span>
</span><span id="Simulator_TM.run-234"><a href="#Simulator_TM.run-234"><span class="linenos">234</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_TM.run-235"><a href="#Simulator_TM.run-235"><span class="linenos">235</span></a>
</span><span id="Simulator_TM.run-236"><a href="#Simulator_TM.run-236"><span class="linenos">236</span></a>			<span class="c1"># Update strain</span>
</span><span id="Simulator_TM.run-237"><a href="#Simulator_TM.run-237"><span class="linenos">237</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_old</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_TM.run-238"><a href="#Simulator_TM.run-238"><span class="linenos">238</span></a>
</span><span id="Simulator_TM.run-239"><a href="#Simulator_TM.run-239"><span class="linenos">239</span></a>			<span class="c1"># Print stuff</span>
</span><span id="Simulator_TM.run-240"><a href="#Simulator_TM.run-240"><span class="linenos">240</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_TM.run-241"><a href="#Simulator_TM.run-241"><span class="linenos">241</span></a>				<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">ite</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span id="Simulator_TM.run-242"><a href="#Simulator_TM.run-242"><span class="linenos">242</span></a>				<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_TM.run-243"><a href="#Simulator_TM.run-243"><span class="linenos">243</span></a>
</span><span id="Simulator_TM.run-244"><a href="#Simulator_TM.run-244"><span class="linenos">244</span></a>			<span class="c1"># Save fields</span>
</span><span id="Simulator_TM.run-245"><a href="#Simulator_TM.run-245"><span class="linenos">245</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-246"><a href="#Simulator_TM.run-246"><span class="linenos">246</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_TM.run-247"><a href="#Simulator_TM.run-247"><span class="linenos">247</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM.run-248"><a href="#Simulator_TM.run-248"><span class="linenos">248</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_TM.run-249"><a href="#Simulator_TM.run-249"><span class="linenos">249</span></a>			<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_TM.run-250"><a href="#Simulator_TM.run-250"><span class="linenos">250</span></a>				<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_TM.run-251"><a href="#Simulator_TM.run-251"><span class="linenos">251</span></a>
</span><span id="Simulator_TM.run-252"><a href="#Simulator_TM.run-252"><span class="linenos">252</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_TM.run-253"><a href="#Simulator_TM.run-253"><span class="linenos">253</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Run the coupled thermomechanical simulation.</p>

<h6 id="workflow">Workflow</h6>

<ol>
<li>Initialize outputs.</li>
<li>Initialize momentum temperature history from the heat solution.</li>
<li>Update BCs and optionally solve a purely elastic step.</li>
<li>Initialize non-elastic rates.</li>
<li><p>Time loop:</p>

<ul>
<li>Advance time, update BCs, solve heat step.</li>
<li>Fixed-point (or single-pass) iterate the momentum step with the
current temperature, updating internal variables and rates.</li>
<li>Save requested fields.</li>
</ul></li>
</ol>

<h6 id="convergence">Convergence</h6>

<p>Uses a relative change in total strain between iterations as error.
If <code>theta == 1.0</code> (backward Euler) or there are no non-elastic
elements, iteration terminates immediately.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Calls <code><a href="#SaveFields.initialize">SaveFields.initialize()</a></code> once and <code>save_fields(t)</code> at each
saved time, followed by <code>save_mesh()</code> after the loop.</li>
<li>Printing of progress occurs on rank 0 only.</li>
<li>The first <code>output.save_fields(0)</code> call targets the last <code>output</code>
from the preceding loop variable; ensure all outputs are saved by
iterating over <code>self.outputs</code>.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="Simulator_T">
                            <input id="Simulator_T-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Simulator_T</span><wbr>(<span class="base">safeincave.Simulators.Simulator</span>):

                <label class="view-source-button" for="Simulator_T-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_T"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_T-439"><a href="#Simulator_T-439"><span class="linenos">439</span></a><span class="k">class</span> <span class="nc">Simulator_T</span><span class="p">(</span><span class="n">Simulator</span><span class="p">):</span>
</span><span id="Simulator_T-440"><a href="#Simulator_T-440"><span class="linenos">440</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_T-441"><a href="#Simulator_T-441"><span class="linenos">441</span></a><span class="sd">    Thermal-only simulator (heat diffusion).</span>
</span><span id="Simulator_T-442"><a href="#Simulator_T-442"><span class="linenos">442</span></a>
</span><span id="Simulator_T-443"><a href="#Simulator_T-443"><span class="linenos">443</span></a><span class="sd">    Advances the heat equation with fully-implicit time loop and writes fields.</span>
</span><span id="Simulator_T-444"><a href="#Simulator_T-444"><span class="linenos">444</span></a>
</span><span id="Simulator_T-445"><a href="#Simulator_T-445"><span class="linenos">445</span></a><span class="sd">    Parameters</span>
</span><span id="Simulator_T-446"><a href="#Simulator_T-446"><span class="linenos">446</span></a><span class="sd">    ----------</span>
</span><span id="Simulator_T-447"><a href="#Simulator_T-447"><span class="linenos">447</span></a><span class="sd">    eq_heat : HeatDiffusion</span>
</span><span id="Simulator_T-448"><a href="#Simulator_T-448"><span class="linenos">448</span></a><span class="sd">        Configured heat equation (materials, BCs, solver set).</span>
</span><span id="Simulator_T-449"><a href="#Simulator_T-449"><span class="linenos">449</span></a><span class="sd">    t_control : TimeControllerBase</span>
</span><span id="Simulator_T-450"><a href="#Simulator_T-450"><span class="linenos">450</span></a><span class="sd">        Time controller providing `t`, `dt`, and loop control.</span>
</span><span id="Simulator_T-451"><a href="#Simulator_T-451"><span class="linenos">451</span></a><span class="sd">    outputs : list of SaveFields</span>
</span><span id="Simulator_T-452"><a href="#Simulator_T-452"><span class="linenos">452</span></a><span class="sd">        Output writers to initialize and use at each saved time.</span>
</span><span id="Simulator_T-453"><a href="#Simulator_T-453"><span class="linenos">453</span></a><span class="sd">    compute_elastic_response : bool, default=True</span>
</span><span id="Simulator_T-454"><a href="#Simulator_T-454"><span class="linenos">454</span></a><span class="sd">        Unused placeholder kept for interface parity.</span>
</span><span id="Simulator_T-455"><a href="#Simulator_T-455"><span class="linenos">455</span></a>
</span><span id="Simulator_T-456"><a href="#Simulator_T-456"><span class="linenos">456</span></a><span class="sd">    Attributes</span>
</span><span id="Simulator_T-457"><a href="#Simulator_T-457"><span class="linenos">457</span></a><span class="sd">    ----------</span>
</span><span id="Simulator_T-458"><a href="#Simulator_T-458"><span class="linenos">458</span></a><span class="sd">    eq_heat : HeatDiffusion</span>
</span><span id="Simulator_T-459"><a href="#Simulator_T-459"><span class="linenos">459</span></a><span class="sd">    t_control : TimeControllerBase</span>
</span><span id="Simulator_T-460"><a href="#Simulator_T-460"><span class="linenos">460</span></a><span class="sd">    outputs : list[SaveFields]</span>
</span><span id="Simulator_T-461"><a href="#Simulator_T-461"><span class="linenos">461</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Simulator_T-462"><a href="#Simulator_T-462"><span class="linenos">462</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq_heat</span><span class="p">:</span> <span class="n">HeatDiffusion</span><span class="p">,</span>
</span><span id="Simulator_T-463"><a href="#Simulator_T-463"><span class="linenos">463</span></a>					   <span class="n">t_control</span><span class="p">:</span> <span class="n">TimeControllerBase</span><span class="p">,</span>
</span><span id="Simulator_T-464"><a href="#Simulator_T-464"><span class="linenos">464</span></a>					   <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SaveFields</span><span class="p">],</span>
</span><span id="Simulator_T-465"><a href="#Simulator_T-465"><span class="linenos">465</span></a>					   <span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Simulator_T-466"><a href="#Simulator_T-466"><span class="linenos">466</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span> <span class="o">=</span> <span class="n">eq_heat</span>
</span><span id="Simulator_T-467"><a href="#Simulator_T-467"><span class="linenos">467</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span> <span class="o">=</span> <span class="n">t_control</span>
</span><span id="Simulator_T-468"><a href="#Simulator_T-468"><span class="linenos">468</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
</span><span id="Simulator_T-469"><a href="#Simulator_T-469"><span class="linenos">469</span></a>
</span><span id="Simulator_T-470"><a href="#Simulator_T-470"><span class="linenos">470</span></a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Simulator_T-471"><a href="#Simulator_T-471"><span class="linenos">471</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_T-472"><a href="#Simulator_T-472"><span class="linenos">472</span></a><span class="sd">        Run the thermal simulation.</span>
</span><span id="Simulator_T-473"><a href="#Simulator_T-473"><span class="linenos">473</span></a>
</span><span id="Simulator_T-474"><a href="#Simulator_T-474"><span class="linenos">474</span></a><span class="sd">        Workflow</span>
</span><span id="Simulator_T-475"><a href="#Simulator_T-475"><span class="linenos">475</span></a><span class="sd">        --------</span>
</span><span id="Simulator_T-476"><a href="#Simulator_T-476"><span class="linenos">476</span></a><span class="sd">        1. Initialize outputs.</span>
</span><span id="Simulator_T-477"><a href="#Simulator_T-477"><span class="linenos">477</span></a><span class="sd">        2. (Optionally) solve an initial step.</span>
</span><span id="Simulator_T-478"><a href="#Simulator_T-478"><span class="linenos">478</span></a><span class="sd">        3. Time loop: update BCs, solve heat equation for `(t, dt)`, and save.</span>
</span><span id="Simulator_T-479"><a href="#Simulator_T-479"><span class="linenos">479</span></a>
</span><span id="Simulator_T-480"><a href="#Simulator_T-480"><span class="linenos">480</span></a><span class="sd">        Returns</span>
</span><span id="Simulator_T-481"><a href="#Simulator_T-481"><span class="linenos">481</span></a><span class="sd">        -------</span>
</span><span id="Simulator_T-482"><a href="#Simulator_T-482"><span class="linenos">482</span></a><span class="sd">        None</span>
</span><span id="Simulator_T-483"><a href="#Simulator_T-483"><span class="linenos">483</span></a>
</span><span id="Simulator_T-484"><a href="#Simulator_T-484"><span class="linenos">484</span></a><span class="sd">        Notes</span>
</span><span id="Simulator_T-485"><a href="#Simulator_T-485"><span class="linenos">485</span></a><span class="sd">        -----</span>
</span><span id="Simulator_T-486"><a href="#Simulator_T-486"><span class="linenos">486</span></a><span class="sd">        Printing of progress occurs on rank 0 only.</span>
</span><span id="Simulator_T-487"><a href="#Simulator_T-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Simulator_T-488"><a href="#Simulator_T-488"><span class="linenos">488</span></a>		<span class="c1"># Output field</span>
</span><span id="Simulator_T-489"><a href="#Simulator_T-489"><span class="linenos">489</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_T-490"><a href="#Simulator_T-490"><span class="linenos">490</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Simulator_T-491"><a href="#Simulator_T-491"><span class="linenos">491</span></a>
</span><span id="Simulator_T-492"><a href="#Simulator_T-492"><span class="linenos">492</span></a>		<span class="c1"># # Solve initial T field</span>
</span><span id="Simulator_T-493"><a href="#Simulator_T-493"><span class="linenos">493</span></a>		<span class="c1"># self.eq_heat.solve(0, self.t_control.dt)</span>
</span><span id="Simulator_T-494"><a href="#Simulator_T-494"><span class="linenos">494</span></a>
</span><span id="Simulator_T-495"><a href="#Simulator_T-495"><span class="linenos">495</span></a>		<span class="c1"># Save fields</span>
</span><span id="Simulator_T-496"><a href="#Simulator_T-496"><span class="linenos">496</span></a>		<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Simulator_T-497"><a href="#Simulator_T-497"><span class="linenos">497</span></a>
</span><span id="Simulator_T-498"><a href="#Simulator_T-498"><span class="linenos">498</span></a>		<span class="c1"># Time loop</span>
</span><span id="Simulator_T-499"><a href="#Simulator_T-499"><span class="linenos">499</span></a>		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">keep_looping</span><span class="p">():</span>
</span><span id="Simulator_T-500"><a href="#Simulator_T-500"><span class="linenos">500</span></a>
</span><span id="Simulator_T-501"><a href="#Simulator_T-501"><span class="linenos">501</span></a>			<span class="c1"># Advance time</span>
</span><span id="Simulator_T-502"><a href="#Simulator_T-502"><span class="linenos">502</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">advance_time</span><span class="p">()</span>
</span><span id="Simulator_T-503"><a href="#Simulator_T-503"><span class="linenos">503</span></a>			<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span>
</span><span id="Simulator_T-504"><a href="#Simulator_T-504"><span class="linenos">504</span></a>			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">dt</span>
</span><span id="Simulator_T-505"><a href="#Simulator_T-505"><span class="linenos">505</span></a>
</span><span id="Simulator_T-506"><a href="#Simulator_T-506"><span class="linenos">506</span></a>			<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_T-507"><a href="#Simulator_T-507"><span class="linenos">507</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_T-508"><a href="#Simulator_T-508"><span class="linenos">508</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_T-509"><a href="#Simulator_T-509"><span class="linenos">509</span></a>
</span><span id="Simulator_T-510"><a href="#Simulator_T-510"><span class="linenos">510</span></a>			<span class="c1"># Solve heat</span>
</span><span id="Simulator_T-511"><a href="#Simulator_T-511"><span class="linenos">511</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_T-512"><a href="#Simulator_T-512"><span class="linenos">512</span></a>
</span><span id="Simulator_T-513"><a href="#Simulator_T-513"><span class="linenos">513</span></a>			<span class="c1"># Print stuff</span>
</span><span id="Simulator_T-514"><a href="#Simulator_T-514"><span class="linenos">514</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_T-515"><a href="#Simulator_T-515"><span class="linenos">515</span></a>				<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
</span><span id="Simulator_T-516"><a href="#Simulator_T-516"><span class="linenos">516</span></a>				<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_T-517"><a href="#Simulator_T-517"><span class="linenos">517</span></a>
</span><span id="Simulator_T-518"><a href="#Simulator_T-518"><span class="linenos">518</span></a>			<span class="c1"># Save fields</span>
</span><span id="Simulator_T-519"><a href="#Simulator_T-519"><span class="linenos">519</span></a>			<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_T-520"><a href="#Simulator_T-520"><span class="linenos">520</span></a>				<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_T-521"><a href="#Simulator_T-521"><span class="linenos">521</span></a>
</span><span id="Simulator_T-522"><a href="#Simulator_T-522"><span class="linenos">522</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_T-523"><a href="#Simulator_T-523"><span class="linenos">523</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Thermal-only simulator (heat diffusion).</p>

<p>Advances the heat equation with fully-implicit time loop and writes fields.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eq_heat</strong> (HeatDiffusion):
Configured heat equation (materials, BCs, solver set).</li>
<li><strong>t_control</strong> (TimeControllerBase):
Time controller providing <code>t</code>, <code>dt</code>, and loop control.</li>
<li><strong>outputs</strong> (list of SaveFields):
Output writers to initialize and use at each saved time.</li>
<li><strong>compute_elastic_response</strong> (bool, default=True):
Unused placeholder kept for interface parity.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><p><strong>eq_heat</strong> (HeatDiffusion):</p></li>
<li><p><strong>t_control</strong> (TimeControllerBase):</p></li>
<li><p><strong>outputs</strong> (list[SaveFields]):</p></li>
</ul>
</div>


                            <div id="Simulator_T.__init__" class="classattr">
                                        <input id="Simulator_T.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Simulator_T</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">eq_heat</span><span class="p">:</span> <span class="n"><a href="#HeatDiffusion">HeatDiffusion</a></span>,</span><span class="param">	<span class="n">t_control</span><span class="p">:</span> <span class="n"><a href="#TimeControllerBase">TimeControllerBase</a></span>,</span><span class="param">	<span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#SaveFields">SaveFields</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="Simulator_T.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_T.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_T.__init__-462"><a href="#Simulator_T.__init__-462"><span class="linenos">462</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq_heat</span><span class="p">:</span> <span class="n">HeatDiffusion</span><span class="p">,</span>
</span><span id="Simulator_T.__init__-463"><a href="#Simulator_T.__init__-463"><span class="linenos">463</span></a>					   <span class="n">t_control</span><span class="p">:</span> <span class="n">TimeControllerBase</span><span class="p">,</span>
</span><span id="Simulator_T.__init__-464"><a href="#Simulator_T.__init__-464"><span class="linenos">464</span></a>					   <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SaveFields</span><span class="p">],</span>
</span><span id="Simulator_T.__init__-465"><a href="#Simulator_T.__init__-465"><span class="linenos">465</span></a>					   <span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Simulator_T.__init__-466"><a href="#Simulator_T.__init__-466"><span class="linenos">466</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span> <span class="o">=</span> <span class="n">eq_heat</span>
</span><span id="Simulator_T.__init__-467"><a href="#Simulator_T.__init__-467"><span class="linenos">467</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span> <span class="o">=</span> <span class="n">t_control</span>
</span><span id="Simulator_T.__init__-468"><a href="#Simulator_T.__init__-468"><span class="linenos">468</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
</span></pre></div>


    

                            </div>
                            <div id="Simulator_T.eq_heat" class="classattr">
                                <div class="attr variable">
            <span class="name">eq_heat</span>

        
    </div>
    <a class="headerlink" href="#Simulator_T.eq_heat"></a>
    
    

                            </div>
                            <div id="Simulator_T.t_control" class="classattr">
                                <div class="attr variable">
            <span class="name">t_control</span>

        
    </div>
    <a class="headerlink" href="#Simulator_T.t_control"></a>
    
    

                            </div>
                            <div id="Simulator_T.outputs" class="classattr">
                                <div class="attr variable">
            <span class="name">outputs</span>

        
    </div>
    <a class="headerlink" href="#Simulator_T.outputs"></a>
    
    

                            </div>
                            <div id="Simulator_T.run" class="classattr">
                                        <input id="Simulator_T.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Simulator_T.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_T.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_T.run-470"><a href="#Simulator_T.run-470"><span class="linenos">470</span></a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Simulator_T.run-471"><a href="#Simulator_T.run-471"><span class="linenos">471</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_T.run-472"><a href="#Simulator_T.run-472"><span class="linenos">472</span></a><span class="sd">        Run the thermal simulation.</span>
</span><span id="Simulator_T.run-473"><a href="#Simulator_T.run-473"><span class="linenos">473</span></a>
</span><span id="Simulator_T.run-474"><a href="#Simulator_T.run-474"><span class="linenos">474</span></a><span class="sd">        Workflow</span>
</span><span id="Simulator_T.run-475"><a href="#Simulator_T.run-475"><span class="linenos">475</span></a><span class="sd">        --------</span>
</span><span id="Simulator_T.run-476"><a href="#Simulator_T.run-476"><span class="linenos">476</span></a><span class="sd">        1. Initialize outputs.</span>
</span><span id="Simulator_T.run-477"><a href="#Simulator_T.run-477"><span class="linenos">477</span></a><span class="sd">        2. (Optionally) solve an initial step.</span>
</span><span id="Simulator_T.run-478"><a href="#Simulator_T.run-478"><span class="linenos">478</span></a><span class="sd">        3. Time loop: update BCs, solve heat equation for `(t, dt)`, and save.</span>
</span><span id="Simulator_T.run-479"><a href="#Simulator_T.run-479"><span class="linenos">479</span></a>
</span><span id="Simulator_T.run-480"><a href="#Simulator_T.run-480"><span class="linenos">480</span></a><span class="sd">        Returns</span>
</span><span id="Simulator_T.run-481"><a href="#Simulator_T.run-481"><span class="linenos">481</span></a><span class="sd">        -------</span>
</span><span id="Simulator_T.run-482"><a href="#Simulator_T.run-482"><span class="linenos">482</span></a><span class="sd">        None</span>
</span><span id="Simulator_T.run-483"><a href="#Simulator_T.run-483"><span class="linenos">483</span></a>
</span><span id="Simulator_T.run-484"><a href="#Simulator_T.run-484"><span class="linenos">484</span></a><span class="sd">        Notes</span>
</span><span id="Simulator_T.run-485"><a href="#Simulator_T.run-485"><span class="linenos">485</span></a><span class="sd">        -----</span>
</span><span id="Simulator_T.run-486"><a href="#Simulator_T.run-486"><span class="linenos">486</span></a><span class="sd">        Printing of progress occurs on rank 0 only.</span>
</span><span id="Simulator_T.run-487"><a href="#Simulator_T.run-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Simulator_T.run-488"><a href="#Simulator_T.run-488"><span class="linenos">488</span></a>		<span class="c1"># Output field</span>
</span><span id="Simulator_T.run-489"><a href="#Simulator_T.run-489"><span class="linenos">489</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_T.run-490"><a href="#Simulator_T.run-490"><span class="linenos">490</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Simulator_T.run-491"><a href="#Simulator_T.run-491"><span class="linenos">491</span></a>
</span><span id="Simulator_T.run-492"><a href="#Simulator_T.run-492"><span class="linenos">492</span></a>		<span class="c1"># # Solve initial T field</span>
</span><span id="Simulator_T.run-493"><a href="#Simulator_T.run-493"><span class="linenos">493</span></a>		<span class="c1"># self.eq_heat.solve(0, self.t_control.dt)</span>
</span><span id="Simulator_T.run-494"><a href="#Simulator_T.run-494"><span class="linenos">494</span></a>
</span><span id="Simulator_T.run-495"><a href="#Simulator_T.run-495"><span class="linenos">495</span></a>		<span class="c1"># Save fields</span>
</span><span id="Simulator_T.run-496"><a href="#Simulator_T.run-496"><span class="linenos">496</span></a>		<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Simulator_T.run-497"><a href="#Simulator_T.run-497"><span class="linenos">497</span></a>
</span><span id="Simulator_T.run-498"><a href="#Simulator_T.run-498"><span class="linenos">498</span></a>		<span class="c1"># Time loop</span>
</span><span id="Simulator_T.run-499"><a href="#Simulator_T.run-499"><span class="linenos">499</span></a>		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">keep_looping</span><span class="p">():</span>
</span><span id="Simulator_T.run-500"><a href="#Simulator_T.run-500"><span class="linenos">500</span></a>
</span><span id="Simulator_T.run-501"><a href="#Simulator_T.run-501"><span class="linenos">501</span></a>			<span class="c1"># Advance time</span>
</span><span id="Simulator_T.run-502"><a href="#Simulator_T.run-502"><span class="linenos">502</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">advance_time</span><span class="p">()</span>
</span><span id="Simulator_T.run-503"><a href="#Simulator_T.run-503"><span class="linenos">503</span></a>			<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span>
</span><span id="Simulator_T.run-504"><a href="#Simulator_T.run-504"><span class="linenos">504</span></a>			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">dt</span>
</span><span id="Simulator_T.run-505"><a href="#Simulator_T.run-505"><span class="linenos">505</span></a>
</span><span id="Simulator_T.run-506"><a href="#Simulator_T.run-506"><span class="linenos">506</span></a>			<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_T.run-507"><a href="#Simulator_T.run-507"><span class="linenos">507</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_T.run-508"><a href="#Simulator_T.run-508"><span class="linenos">508</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_T.run-509"><a href="#Simulator_T.run-509"><span class="linenos">509</span></a>
</span><span id="Simulator_T.run-510"><a href="#Simulator_T.run-510"><span class="linenos">510</span></a>			<span class="c1"># Solve heat</span>
</span><span id="Simulator_T.run-511"><a href="#Simulator_T.run-511"><span class="linenos">511</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_T.run-512"><a href="#Simulator_T.run-512"><span class="linenos">512</span></a>
</span><span id="Simulator_T.run-513"><a href="#Simulator_T.run-513"><span class="linenos">513</span></a>			<span class="c1"># Print stuff</span>
</span><span id="Simulator_T.run-514"><a href="#Simulator_T.run-514"><span class="linenos">514</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_heat</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_T.run-515"><a href="#Simulator_T.run-515"><span class="linenos">515</span></a>				<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
</span><span id="Simulator_T.run-516"><a href="#Simulator_T.run-516"><span class="linenos">516</span></a>				<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_T.run-517"><a href="#Simulator_T.run-517"><span class="linenos">517</span></a>
</span><span id="Simulator_T.run-518"><a href="#Simulator_T.run-518"><span class="linenos">518</span></a>			<span class="c1"># Save fields</span>
</span><span id="Simulator_T.run-519"><a href="#Simulator_T.run-519"><span class="linenos">519</span></a>			<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_T.run-520"><a href="#Simulator_T.run-520"><span class="linenos">520</span></a>				<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_T.run-521"><a href="#Simulator_T.run-521"><span class="linenos">521</span></a>
</span><span id="Simulator_T.run-522"><a href="#Simulator_T.run-522"><span class="linenos">522</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_T.run-523"><a href="#Simulator_T.run-523"><span class="linenos">523</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Run the thermal simulation.</p>

<h6 id="workflow">Workflow</h6>

<ol>
<li>Initialize outputs.</li>
<li>(Optionally) solve an initial step.</li>
<li>Time loop: update BCs, solve heat equation for <code>(t, dt)</code>, and save.</li>
</ol>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>Printing of progress occurs on rank 0 only.</p>
</div>


                            </div>
                </section>
                <section id="Simulator_M">
                            <input id="Simulator_M-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Simulator_M</span><wbr>(<span class="base">safeincave.Simulators.Simulator</span>):

                <label class="view-source-button" for="Simulator_M-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_M"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_M-256"><a href="#Simulator_M-256"><span class="linenos">256</span></a><span class="k">class</span> <span class="nc">Simulator_M</span><span class="p">(</span><span class="n">Simulator</span><span class="p">):</span>
</span><span id="Simulator_M-257"><a href="#Simulator_M-257"><span class="linenos">257</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_M-258"><a href="#Simulator_M-258"><span class="linenos">258</span></a><span class="sd">    Mechanical-only simulator (linear momentum).</span>
</span><span id="Simulator_M-259"><a href="#Simulator_M-259"><span class="linenos">259</span></a>
</span><span id="Simulator_M-260"><a href="#Simulator_M-260"><span class="linenos">260</span></a><span class="sd">    Solves the momentum equation with possible non-elastic behavior using a</span>
</span><span id="Simulator_M-261"><a href="#Simulator_M-261"><span class="linenos">261</span></a><span class="sd">    -method loop and fixed-point iterations per step. No thermal coupling.</span>
</span><span id="Simulator_M-262"><a href="#Simulator_M-262"><span class="linenos">262</span></a>
</span><span id="Simulator_M-263"><a href="#Simulator_M-263"><span class="linenos">263</span></a><span class="sd">    Parameters</span>
</span><span id="Simulator_M-264"><a href="#Simulator_M-264"><span class="linenos">264</span></a><span class="sd">    ----------</span>
</span><span id="Simulator_M-265"><a href="#Simulator_M-265"><span class="linenos">265</span></a><span class="sd">    eq_mom : LinearMomentum</span>
</span><span id="Simulator_M-266"><a href="#Simulator_M-266"><span class="linenos">266</span></a><span class="sd">        Configured momentum equation (materials, BCs, solver set).</span>
</span><span id="Simulator_M-267"><a href="#Simulator_M-267"><span class="linenos">267</span></a><span class="sd">    t_control : TimeControllerBase</span>
</span><span id="Simulator_M-268"><a href="#Simulator_M-268"><span class="linenos">268</span></a><span class="sd">        Time controller providing `t`, `dt`, and loop control.</span>
</span><span id="Simulator_M-269"><a href="#Simulator_M-269"><span class="linenos">269</span></a><span class="sd">    outputs : list of SaveFields</span>
</span><span id="Simulator_M-270"><a href="#Simulator_M-270"><span class="linenos">270</span></a><span class="sd">        Output writers to initialize and use at each saved time.</span>
</span><span id="Simulator_M-271"><a href="#Simulator_M-271"><span class="linenos">271</span></a><span class="sd">    compute_elastic_response : bool, default=True</span>
</span><span id="Simulator_M-272"><a href="#Simulator_M-272"><span class="linenos">272</span></a><span class="sd">        If True, starts with a purely elastic solve to initialize fields.</span>
</span><span id="Simulator_M-273"><a href="#Simulator_M-273"><span class="linenos">273</span></a>
</span><span id="Simulator_M-274"><a href="#Simulator_M-274"><span class="linenos">274</span></a><span class="sd">    Attributes</span>
</span><span id="Simulator_M-275"><a href="#Simulator_M-275"><span class="linenos">275</span></a><span class="sd">    ----------</span>
</span><span id="Simulator_M-276"><a href="#Simulator_M-276"><span class="linenos">276</span></a><span class="sd">    eq_mom : LinearMomentum</span>
</span><span id="Simulator_M-277"><a href="#Simulator_M-277"><span class="linenos">277</span></a><span class="sd">    t_control : TimeControllerBase</span>
</span><span id="Simulator_M-278"><a href="#Simulator_M-278"><span class="linenos">278</span></a><span class="sd">    outputs : list[SaveFields]</span>
</span><span id="Simulator_M-279"><a href="#Simulator_M-279"><span class="linenos">279</span></a><span class="sd">    compute_elastic_response : bool</span>
</span><span id="Simulator_M-280"><a href="#Simulator_M-280"><span class="linenos">280</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Simulator_M-281"><a href="#Simulator_M-281"><span class="linenos">281</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq_mom</span><span class="p">:</span> <span class="n">LinearMomentum</span><span class="p">,</span> 
</span><span id="Simulator_M-282"><a href="#Simulator_M-282"><span class="linenos">282</span></a>					   <span class="n">t_control</span><span class="p">:</span> <span class="n">TimeControllerBase</span><span class="p">,</span>
</span><span id="Simulator_M-283"><a href="#Simulator_M-283"><span class="linenos">283</span></a>					   <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SaveFields</span><span class="p">],</span>
</span><span id="Simulator_M-284"><a href="#Simulator_M-284"><span class="linenos">284</span></a>					   <span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Simulator_M-285"><a href="#Simulator_M-285"><span class="linenos">285</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span> <span class="o">=</span> <span class="n">eq_mom</span>
</span><span id="Simulator_M-286"><a href="#Simulator_M-286"><span class="linenos">286</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span> <span class="o">=</span> <span class="n">t_control</span>
</span><span id="Simulator_M-287"><a href="#Simulator_M-287"><span class="linenos">287</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
</span><span id="Simulator_M-288"><a href="#Simulator_M-288"><span class="linenos">288</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span> <span class="o">=</span> <span class="n">compute_elastic_response</span>
</span><span id="Simulator_M-289"><a href="#Simulator_M-289"><span class="linenos">289</span></a>
</span><span id="Simulator_M-290"><a href="#Simulator_M-290"><span class="linenos">290</span></a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Simulator_M-291"><a href="#Simulator_M-291"><span class="linenos">291</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_M-292"><a href="#Simulator_M-292"><span class="linenos">292</span></a><span class="sd">        Run the mechanical simulation.</span>
</span><span id="Simulator_M-293"><a href="#Simulator_M-293"><span class="linenos">293</span></a>
</span><span id="Simulator_M-294"><a href="#Simulator_M-294"><span class="linenos">294</span></a><span class="sd">        Workflow</span>
</span><span id="Simulator_M-295"><a href="#Simulator_M-295"><span class="linenos">295</span></a><span class="sd">        --------</span>
</span><span id="Simulator_M-296"><a href="#Simulator_M-296"><span class="linenos">296</span></a><span class="sd">        1. Initialize outputs and boundary conditions.</span>
</span><span id="Simulator_M-297"><a href="#Simulator_M-297"><span class="linenos">297</span></a><span class="sd">        2. Optionally solve a purely elastic step.</span>
</span><span id="Simulator_M-298"><a href="#Simulator_M-298"><span class="linenos">298</span></a><span class="sd">        3. Initialize non-elastic rates.</span>
</span><span id="Simulator_M-299"><a href="#Simulator_M-299"><span class="linenos">299</span></a><span class="sd">        4. For each time step: assemble/solve, update internal variables and</span>
</span><span id="Simulator_M-300"><a href="#Simulator_M-300"><span class="linenos">300</span></a><span class="sd">           rates, compute relevant quantities, and save fields.</span>
</span><span id="Simulator_M-301"><a href="#Simulator_M-301"><span class="linenos">301</span></a>
</span><span id="Simulator_M-302"><a href="#Simulator_M-302"><span class="linenos">302</span></a><span class="sd">        Convergence</span>
</span><span id="Simulator_M-303"><a href="#Simulator_M-303"><span class="linenos">303</span></a><span class="sd">        -----------</span>
</span><span id="Simulator_M-304"><a href="#Simulator_M-304"><span class="linenos">304</span></a><span class="sd">        Uses a relative change in total strain between iterations as error.</span>
</span><span id="Simulator_M-305"><a href="#Simulator_M-305"><span class="linenos">305</span></a><span class="sd">        If `theta == 1.0` or no non-elastic elements exist, iteration ends</span>
</span><span id="Simulator_M-306"><a href="#Simulator_M-306"><span class="linenos">306</span></a><span class="sd">        immediately.</span>
</span><span id="Simulator_M-307"><a href="#Simulator_M-307"><span class="linenos">307</span></a>
</span><span id="Simulator_M-308"><a href="#Simulator_M-308"><span class="linenos">308</span></a><span class="sd">        Returns</span>
</span><span id="Simulator_M-309"><a href="#Simulator_M-309"><span class="linenos">309</span></a><span class="sd">        -------</span>
</span><span id="Simulator_M-310"><a href="#Simulator_M-310"><span class="linenos">310</span></a><span class="sd">        None</span>
</span><span id="Simulator_M-311"><a href="#Simulator_M-311"><span class="linenos">311</span></a>
</span><span id="Simulator_M-312"><a href="#Simulator_M-312"><span class="linenos">312</span></a><span class="sd">        Notes</span>
</span><span id="Simulator_M-313"><a href="#Simulator_M-313"><span class="linenos">313</span></a><span class="sd">        -----</span>
</span><span id="Simulator_M-314"><a href="#Simulator_M-314"><span class="linenos">314</span></a><span class="sd">        - Printing occurs on rank 0 only.</span>
</span><span id="Simulator_M-315"><a href="#Simulator_M-315"><span class="linenos">315</span></a><span class="sd">        - The first `output.save_fields(0)` call uses the last `output`</span>
</span><span id="Simulator_M-316"><a href="#Simulator_M-316"><span class="linenos">316</span></a><span class="sd">          from the preceding loop variable.</span>
</span><span id="Simulator_M-317"><a href="#Simulator_M-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Simulator_M-318"><a href="#Simulator_M-318"><span class="linenos">318</span></a>		<span class="c1"># Output field</span>
</span><span id="Simulator_M-319"><a href="#Simulator_M-319"><span class="linenos">319</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_M-320"><a href="#Simulator_M-320"><span class="linenos">320</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Simulator_M-321"><a href="#Simulator_M-321"><span class="linenos">321</span></a>
</span><span id="Simulator_M-322"><a href="#Simulator_M-322"><span class="linenos">322</span></a>		<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_M-323"><a href="#Simulator_M-323"><span class="linenos">323</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M-324"><a href="#Simulator_M-324"><span class="linenos">324</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M-325"><a href="#Simulator_M-325"><span class="linenos">325</span></a>
</span><span id="Simulator_M-326"><a href="#Simulator_M-326"><span class="linenos">326</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span><span class="p">:</span>
</span><span id="Simulator_M-327"><a href="#Simulator_M-327"><span class="linenos">327</span></a>			<span class="c1"># Solve elasticity</span>
</span><span id="Simulator_M-328"><a href="#Simulator_M-328"><span class="linenos">328</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve_elastic_response</span><span class="p">()</span>
</span><span id="Simulator_M-329"><a href="#Simulator_M-329"><span class="linenos">329</span></a>
</span><span id="Simulator_M-330"><a href="#Simulator_M-330"><span class="linenos">330</span></a>			<span class="c1"># Calculate total (elastic) strain</span>
</span><span id="Simulator_M-331"><a href="#Simulator_M-331"><span class="linenos">331</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_M-332"><a href="#Simulator_M-332"><span class="linenos">332</span></a>
</span><span id="Simulator_M-333"><a href="#Simulator_M-333"><span class="linenos">333</span></a>			<span class="c1"># Compute stress</span>
</span><span id="Simulator_M-334"><a href="#Simulator_M-334"><span class="linenos">334</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_elastic_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_M-335"><a href="#Simulator_M-335"><span class="linenos">335</span></a>
</span><span id="Simulator_M-336"><a href="#Simulator_M-336"><span class="linenos">336</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_M-337"><a href="#Simulator_M-337"><span class="linenos">337</span></a>			<span class="c1"># Calculate total strain</span>
</span><span id="Simulator_M-338"><a href="#Simulator_M-338"><span class="linenos">338</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_M-339"><a href="#Simulator_M-339"><span class="linenos">339</span></a>
</span><span id="Simulator_M-340"><a href="#Simulator_M-340"><span class="linenos">340</span></a>			<span class="c1"># Retrieve stress</span>
</span><span id="Simulator_M-341"><a href="#Simulator_M-341"><span class="linenos">341</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="Simulator_M-342"><a href="#Simulator_M-342"><span class="linenos">342</span></a>
</span><span id="Simulator_M-343"><a href="#Simulator_M-343"><span class="linenos">343</span></a>		<span class="c1"># Calculate and eps_ie_rate_old</span>
</span><span id="Simulator_M-344"><a href="#Simulator_M-344"><span class="linenos">344</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M-345"><a href="#Simulator_M-345"><span class="linenos">345</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_M-346"><a href="#Simulator_M-346"><span class="linenos">346</span></a>
</span><span id="Simulator_M-347"><a href="#Simulator_M-347"><span class="linenos">347</span></a>		<span class="c1"># Save fields</span>
</span><span id="Simulator_M-348"><a href="#Simulator_M-348"><span class="linenos">348</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_M-349"><a href="#Simulator_M-349"><span class="linenos">349</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_M-350"><a href="#Simulator_M-350"><span class="linenos">350</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_M-351"><a href="#Simulator_M-351"><span class="linenos">351</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_M-352"><a href="#Simulator_M-352"><span class="linenos">352</span></a>		<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Simulator_M-353"><a href="#Simulator_M-353"><span class="linenos">353</span></a>
</span><span id="Simulator_M-354"><a href="#Simulator_M-354"><span class="linenos">354</span></a>		<span class="c1"># Time loop</span>
</span><span id="Simulator_M-355"><a href="#Simulator_M-355"><span class="linenos">355</span></a>		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">keep_looping</span><span class="p">():</span>
</span><span id="Simulator_M-356"><a href="#Simulator_M-356"><span class="linenos">356</span></a>
</span><span id="Simulator_M-357"><a href="#Simulator_M-357"><span class="linenos">357</span></a>			<span class="c1"># Advance time</span>
</span><span id="Simulator_M-358"><a href="#Simulator_M-358"><span class="linenos">358</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">advance_time</span><span class="p">()</span>
</span><span id="Simulator_M-359"><a href="#Simulator_M-359"><span class="linenos">359</span></a>			<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span>
</span><span id="Simulator_M-360"><a href="#Simulator_M-360"><span class="linenos">360</span></a>			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">dt</span>
</span><span id="Simulator_M-361"><a href="#Simulator_M-361"><span class="linenos">361</span></a>
</span><span id="Simulator_M-362"><a href="#Simulator_M-362"><span class="linenos">362</span></a>			<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_M-363"><a href="#Simulator_M-363"><span class="linenos">363</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M-364"><a href="#Simulator_M-364"><span class="linenos">364</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M-365"><a href="#Simulator_M-365"><span class="linenos">365</span></a>
</span><span id="Simulator_M-366"><a href="#Simulator_M-366"><span class="linenos">366</span></a>			<span class="c1"># Iterative loop settings</span>
</span><span id="Simulator_M-367"><a href="#Simulator_M-367"><span class="linenos">367</span></a>			<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-8</span>
</span><span id="Simulator_M-368"><a href="#Simulator_M-368"><span class="linenos">368</span></a>			<span class="n">error</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tol</span>
</span><span id="Simulator_M-369"><a href="#Simulator_M-369"><span class="linenos">369</span></a>			<span class="n">ite</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Simulator_M-370"><a href="#Simulator_M-370"><span class="linenos">370</span></a>			<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="Simulator_M-371"><a href="#Simulator_M-371"><span class="linenos">371</span></a>
</span><span id="Simulator_M-372"><a href="#Simulator_M-372"><span class="linenos">372</span></a>			<span class="k">while</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">tol</span> <span class="ow">and</span> <span class="n">ite</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">:</span>
</span><span id="Simulator_M-373"><a href="#Simulator_M-373"><span class="linenos">373</span></a>
</span><span id="Simulator_M-374"><a href="#Simulator_M-374"><span class="linenos">374</span></a>				<span class="c1"># Update total strain of previous iteration (eps_tot_k &lt;-- eps_tot)</span>
</span><span id="Simulator_M-375"><a href="#Simulator_M-375"><span class="linenos">375</span></a>				<span class="n">eps_tot_k_to</span> <span class="o">=</span> <span class="n">eps_tot_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_M-376"><a href="#Simulator_M-376"><span class="linenos">376</span></a>
</span><span id="Simulator_M-377"><a href="#Simulator_M-377"><span class="linenos">377</span></a>				<span class="c1"># Update stress</span>
</span><span id="Simulator_M-378"><a href="#Simulator_M-378"><span class="linenos">378</span></a>				<span class="n">stress_k_to</span> <span class="o">=</span> <span class="n">stress_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_M-379"><a href="#Simulator_M-379"><span class="linenos">379</span></a>
</span><span id="Simulator_M-380"><a href="#Simulator_M-380"><span class="linenos">380</span></a>				<span class="c1"># Build bi-linear form</span>
</span><span id="Simulator_M-381"><a href="#Simulator_M-381"><span class="linenos">381</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">stress_k_to</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M-382"><a href="#Simulator_M-382"><span class="linenos">382</span></a>
</span><span id="Simulator_M-383"><a href="#Simulator_M-383"><span class="linenos">383</span></a>				<span class="c1"># Compute total strain</span>
</span><span id="Simulator_M-384"><a href="#Simulator_M-384"><span class="linenos">384</span></a>				<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_M-385"><a href="#Simulator_M-385"><span class="linenos">385</span></a>
</span><span id="Simulator_M-386"><a href="#Simulator_M-386"><span class="linenos">386</span></a>				<span class="c1"># Compute stress</span>
</span><span id="Simulator_M-387"><a href="#Simulator_M-387"><span class="linenos">387</span></a>				<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_M-388"><a href="#Simulator_M-388"><span class="linenos">388</span></a>
</span><span id="Simulator_M-389"><a href="#Simulator_M-389"><span class="linenos">389</span></a>				<span class="c1"># Increment internal variables</span>
</span><span id="Simulator_M-390"><a href="#Simulator_M-390"><span class="linenos">390</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">increment_internal_variables</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M-391"><a href="#Simulator_M-391"><span class="linenos">391</span></a>
</span><span id="Simulator_M-392"><a href="#Simulator_M-392"><span class="linenos">392</span></a>				<span class="c1"># Compute inelastic strain rates</span>
</span><span id="Simulator_M-393"><a href="#Simulator_M-393"><span class="linenos">393</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M-394"><a href="#Simulator_M-394"><span class="linenos">394</span></a>
</span><span id="Simulator_M-395"><a href="#Simulator_M-395"><span class="linenos">395</span></a>				<span class="c1"># Compute error</span>
</span><span id="Simulator_M-396"><a href="#Simulator_M-396"><span class="linenos">396</span></a>				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Simulator_M-397"><a href="#Simulator_M-397"><span class="linenos">397</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_M-398"><a href="#Simulator_M-398"><span class="linenos">398</span></a>				<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_M-399"><a href="#Simulator_M-399"><span class="linenos">399</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_M-400"><a href="#Simulator_M-400"><span class="linenos">400</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_M-401"><a href="#Simulator_M-401"><span class="linenos">401</span></a>					<span class="n">eps_tot_k_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_k_to</span><span class="p">)</span>
</span><span id="Simulator_M-402"><a href="#Simulator_M-402"><span class="linenos">402</span></a>					<span class="n">eps_tot_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_M-403"><a href="#Simulator_M-403"><span class="linenos">403</span></a>					<span class="n">local_error</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_k_flat</span> <span class="o">-</span> <span class="n">eps_tot_flat</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_flat</span><span class="p">)</span>
</span><span id="Simulator_M-404"><a href="#Simulator_M-404"><span class="linenos">404</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">local_error</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>
</span><span id="Simulator_M-405"><a href="#Simulator_M-405"><span class="linenos">405</span></a>
</span><span id="Simulator_M-406"><a href="#Simulator_M-406"><span class="linenos">406</span></a>				<span class="n">ite</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Simulator_M-407"><a href="#Simulator_M-407"><span class="linenos">407</span></a>
</span><span id="Simulator_M-408"><a href="#Simulator_M-408"><span class="linenos">408</span></a>			<span class="c1"># Update internal variables</span>
</span><span id="Simulator_M-409"><a href="#Simulator_M-409"><span class="linenos">409</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_internal_variables</span><span class="p">()</span>
</span><span id="Simulator_M-410"><a href="#Simulator_M-410"><span class="linenos">410</span></a>
</span><span id="Simulator_M-411"><a href="#Simulator_M-411"><span class="linenos">411</span></a>			<span class="c1"># Update strain rates</span>
</span><span id="Simulator_M-412"><a href="#Simulator_M-412"><span class="linenos">412</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_M-413"><a href="#Simulator_M-413"><span class="linenos">413</span></a>
</span><span id="Simulator_M-414"><a href="#Simulator_M-414"><span class="linenos">414</span></a>			<span class="c1"># Update strain</span>
</span><span id="Simulator_M-415"><a href="#Simulator_M-415"><span class="linenos">415</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_old</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M-416"><a href="#Simulator_M-416"><span class="linenos">416</span></a>
</span><span id="Simulator_M-417"><a href="#Simulator_M-417"><span class="linenos">417</span></a>			<span class="c1"># Save fields</span>
</span><span id="Simulator_M-418"><a href="#Simulator_M-418"><span class="linenos">418</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_M-419"><a href="#Simulator_M-419"><span class="linenos">419</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_M-420"><a href="#Simulator_M-420"><span class="linenos">420</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_M-421"><a href="#Simulator_M-421"><span class="linenos">421</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_M-422"><a href="#Simulator_M-422"><span class="linenos">422</span></a>			<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_M-423"><a href="#Simulator_M-423"><span class="linenos">423</span></a>				<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M-424"><a href="#Simulator_M-424"><span class="linenos">424</span></a>
</span><span id="Simulator_M-425"><a href="#Simulator_M-425"><span class="linenos">425</span></a>			<span class="c1"># Print stuff</span>
</span><span id="Simulator_M-426"><a href="#Simulator_M-426"><span class="linenos">426</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_M-427"><a href="#Simulator_M-427"><span class="linenos">427</span></a>				<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">ite</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span id="Simulator_M-428"><a href="#Simulator_M-428"><span class="linenos">428</span></a>				<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_M-429"><a href="#Simulator_M-429"><span class="linenos">429</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="Simulator_M-430"><a href="#Simulator_M-430"><span class="linenos">430</span></a>					<span class="nb">print</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Fvp</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Simulator_M-431"><a href="#Simulator_M-431"><span class="linenos">431</span></a>					<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_M-432"><a href="#Simulator_M-432"><span class="linenos">432</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="Simulator_M-433"><a href="#Simulator_M-433"><span class="linenos">433</span></a>					<span class="k">pass</span>
</span><span id="Simulator_M-434"><a href="#Simulator_M-434"><span class="linenos">434</span></a>
</span><span id="Simulator_M-435"><a href="#Simulator_M-435"><span class="linenos">435</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_M-436"><a href="#Simulator_M-436"><span class="linenos">436</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Mechanical-only simulator (linear momentum).</p>

<p>Solves the momentum equation with possible non-elastic behavior using a
-method loop and fixed-point iterations per step. No thermal coupling.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eq_mom</strong> (LinearMomentum):
Configured momentum equation (materials, BCs, solver set).</li>
<li><strong>t_control</strong> (TimeControllerBase):
Time controller providing <code>t</code>, <code>dt</code>, and loop control.</li>
<li><strong>outputs</strong> (list of SaveFields):
Output writers to initialize and use at each saved time.</li>
<li><strong>compute_elastic_response</strong> (bool, default=True):
If True, starts with a purely elastic solve to initialize fields.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><p><strong>eq_mom</strong> (LinearMomentum):</p></li>
<li><p><strong>t_control</strong> (TimeControllerBase):</p></li>
<li><p><strong>outputs</strong> (list[SaveFields]):</p></li>
<li><p><strong>compute_elastic_response</strong> (bool):</p></li>
</ul>
</div>


                            <div id="Simulator_M.__init__" class="classattr">
                                        <input id="Simulator_M.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Simulator_M</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">eq_mom</span><span class="p">:</span> <span class="n"><a href="#LinearMomentum">LinearMomentum</a></span>,</span><span class="param">	<span class="n">t_control</span><span class="p">:</span> <span class="n"><a href="#TimeControllerBase">TimeControllerBase</a></span>,</span><span class="param">	<span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n"><a href="#SaveFields">SaveFields</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="Simulator_M.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_M.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_M.__init__-281"><a href="#Simulator_M.__init__-281"><span class="linenos">281</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq_mom</span><span class="p">:</span> <span class="n">LinearMomentum</span><span class="p">,</span> 
</span><span id="Simulator_M.__init__-282"><a href="#Simulator_M.__init__-282"><span class="linenos">282</span></a>					   <span class="n">t_control</span><span class="p">:</span> <span class="n">TimeControllerBase</span><span class="p">,</span>
</span><span id="Simulator_M.__init__-283"><a href="#Simulator_M.__init__-283"><span class="linenos">283</span></a>					   <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SaveFields</span><span class="p">],</span>
</span><span id="Simulator_M.__init__-284"><a href="#Simulator_M.__init__-284"><span class="linenos">284</span></a>					   <span class="n">compute_elastic_response</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Simulator_M.__init__-285"><a href="#Simulator_M.__init__-285"><span class="linenos">285</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span> <span class="o">=</span> <span class="n">eq_mom</span>
</span><span id="Simulator_M.__init__-286"><a href="#Simulator_M.__init__-286"><span class="linenos">286</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span> <span class="o">=</span> <span class="n">t_control</span>
</span><span id="Simulator_M.__init__-287"><a href="#Simulator_M.__init__-287"><span class="linenos">287</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
</span><span id="Simulator_M.__init__-288"><a href="#Simulator_M.__init__-288"><span class="linenos">288</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span> <span class="o">=</span> <span class="n">compute_elastic_response</span>
</span></pre></div>


    

                            </div>
                            <div id="Simulator_M.eq_mom" class="classattr">
                                <div class="attr variable">
            <span class="name">eq_mom</span>

        
    </div>
    <a class="headerlink" href="#Simulator_M.eq_mom"></a>
    
    

                            </div>
                            <div id="Simulator_M.t_control" class="classattr">
                                <div class="attr variable">
            <span class="name">t_control</span>

        
    </div>
    <a class="headerlink" href="#Simulator_M.t_control"></a>
    
    

                            </div>
                            <div id="Simulator_M.outputs" class="classattr">
                                <div class="attr variable">
            <span class="name">outputs</span>

        
    </div>
    <a class="headerlink" href="#Simulator_M.outputs"></a>
    
    

                            </div>
                            <div id="Simulator_M.compute_elastic_response" class="classattr">
                                <div class="attr variable">
            <span class="name">compute_elastic_response</span>

        
    </div>
    <a class="headerlink" href="#Simulator_M.compute_elastic_response"></a>
    
    

                            </div>
                            <div id="Simulator_M.run" class="classattr">
                                        <input id="Simulator_M.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Simulator_M.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Simulator_M.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Simulator_M.run-290"><a href="#Simulator_M.run-290"><span class="linenos">290</span></a>	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Simulator_M.run-291"><a href="#Simulator_M.run-291"><span class="linenos">291</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Simulator_M.run-292"><a href="#Simulator_M.run-292"><span class="linenos">292</span></a><span class="sd">        Run the mechanical simulation.</span>
</span><span id="Simulator_M.run-293"><a href="#Simulator_M.run-293"><span class="linenos">293</span></a>
</span><span id="Simulator_M.run-294"><a href="#Simulator_M.run-294"><span class="linenos">294</span></a><span class="sd">        Workflow</span>
</span><span id="Simulator_M.run-295"><a href="#Simulator_M.run-295"><span class="linenos">295</span></a><span class="sd">        --------</span>
</span><span id="Simulator_M.run-296"><a href="#Simulator_M.run-296"><span class="linenos">296</span></a><span class="sd">        1. Initialize outputs and boundary conditions.</span>
</span><span id="Simulator_M.run-297"><a href="#Simulator_M.run-297"><span class="linenos">297</span></a><span class="sd">        2. Optionally solve a purely elastic step.</span>
</span><span id="Simulator_M.run-298"><a href="#Simulator_M.run-298"><span class="linenos">298</span></a><span class="sd">        3. Initialize non-elastic rates.</span>
</span><span id="Simulator_M.run-299"><a href="#Simulator_M.run-299"><span class="linenos">299</span></a><span class="sd">        4. For each time step: assemble/solve, update internal variables and</span>
</span><span id="Simulator_M.run-300"><a href="#Simulator_M.run-300"><span class="linenos">300</span></a><span class="sd">           rates, compute relevant quantities, and save fields.</span>
</span><span id="Simulator_M.run-301"><a href="#Simulator_M.run-301"><span class="linenos">301</span></a>
</span><span id="Simulator_M.run-302"><a href="#Simulator_M.run-302"><span class="linenos">302</span></a><span class="sd">        Convergence</span>
</span><span id="Simulator_M.run-303"><a href="#Simulator_M.run-303"><span class="linenos">303</span></a><span class="sd">        -----------</span>
</span><span id="Simulator_M.run-304"><a href="#Simulator_M.run-304"><span class="linenos">304</span></a><span class="sd">        Uses a relative change in total strain between iterations as error.</span>
</span><span id="Simulator_M.run-305"><a href="#Simulator_M.run-305"><span class="linenos">305</span></a><span class="sd">        If `theta == 1.0` or no non-elastic elements exist, iteration ends</span>
</span><span id="Simulator_M.run-306"><a href="#Simulator_M.run-306"><span class="linenos">306</span></a><span class="sd">        immediately.</span>
</span><span id="Simulator_M.run-307"><a href="#Simulator_M.run-307"><span class="linenos">307</span></a>
</span><span id="Simulator_M.run-308"><a href="#Simulator_M.run-308"><span class="linenos">308</span></a><span class="sd">        Returns</span>
</span><span id="Simulator_M.run-309"><a href="#Simulator_M.run-309"><span class="linenos">309</span></a><span class="sd">        -------</span>
</span><span id="Simulator_M.run-310"><a href="#Simulator_M.run-310"><span class="linenos">310</span></a><span class="sd">        None</span>
</span><span id="Simulator_M.run-311"><a href="#Simulator_M.run-311"><span class="linenos">311</span></a>
</span><span id="Simulator_M.run-312"><a href="#Simulator_M.run-312"><span class="linenos">312</span></a><span class="sd">        Notes</span>
</span><span id="Simulator_M.run-313"><a href="#Simulator_M.run-313"><span class="linenos">313</span></a><span class="sd">        -----</span>
</span><span id="Simulator_M.run-314"><a href="#Simulator_M.run-314"><span class="linenos">314</span></a><span class="sd">        - Printing occurs on rank 0 only.</span>
</span><span id="Simulator_M.run-315"><a href="#Simulator_M.run-315"><span class="linenos">315</span></a><span class="sd">        - The first `output.save_fields(0)` call uses the last `output`</span>
</span><span id="Simulator_M.run-316"><a href="#Simulator_M.run-316"><span class="linenos">316</span></a><span class="sd">          from the preceding loop variable.</span>
</span><span id="Simulator_M.run-317"><a href="#Simulator_M.run-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Simulator_M.run-318"><a href="#Simulator_M.run-318"><span class="linenos">318</span></a>		<span class="c1"># Output field</span>
</span><span id="Simulator_M.run-319"><a href="#Simulator_M.run-319"><span class="linenos">319</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_M.run-320"><a href="#Simulator_M.run-320"><span class="linenos">320</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="Simulator_M.run-321"><a href="#Simulator_M.run-321"><span class="linenos">321</span></a>
</span><span id="Simulator_M.run-322"><a href="#Simulator_M.run-322"><span class="linenos">322</span></a>		<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_M.run-323"><a href="#Simulator_M.run-323"><span class="linenos">323</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M.run-324"><a href="#Simulator_M.run-324"><span class="linenos">324</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M.run-325"><a href="#Simulator_M.run-325"><span class="linenos">325</span></a>
</span><span id="Simulator_M.run-326"><a href="#Simulator_M.run-326"><span class="linenos">326</span></a>		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_elastic_response</span><span class="p">:</span>
</span><span id="Simulator_M.run-327"><a href="#Simulator_M.run-327"><span class="linenos">327</span></a>			<span class="c1"># Solve elasticity</span>
</span><span id="Simulator_M.run-328"><a href="#Simulator_M.run-328"><span class="linenos">328</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve_elastic_response</span><span class="p">()</span>
</span><span id="Simulator_M.run-329"><a href="#Simulator_M.run-329"><span class="linenos">329</span></a>
</span><span id="Simulator_M.run-330"><a href="#Simulator_M.run-330"><span class="linenos">330</span></a>			<span class="c1"># Calculate total (elastic) strain</span>
</span><span id="Simulator_M.run-331"><a href="#Simulator_M.run-331"><span class="linenos">331</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_M.run-332"><a href="#Simulator_M.run-332"><span class="linenos">332</span></a>
</span><span id="Simulator_M.run-333"><a href="#Simulator_M.run-333"><span class="linenos">333</span></a>			<span class="c1"># Compute stress</span>
</span><span id="Simulator_M.run-334"><a href="#Simulator_M.run-334"><span class="linenos">334</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_elastic_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_M.run-335"><a href="#Simulator_M.run-335"><span class="linenos">335</span></a>
</span><span id="Simulator_M.run-336"><a href="#Simulator_M.run-336"><span class="linenos">336</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_M.run-337"><a href="#Simulator_M.run-337"><span class="linenos">337</span></a>			<span class="c1"># Calculate total strain</span>
</span><span id="Simulator_M.run-338"><a href="#Simulator_M.run-338"><span class="linenos">338</span></a>			<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_M.run-339"><a href="#Simulator_M.run-339"><span class="linenos">339</span></a>
</span><span id="Simulator_M.run-340"><a href="#Simulator_M.run-340"><span class="linenos">340</span></a>			<span class="c1"># Retrieve stress</span>
</span><span id="Simulator_M.run-341"><a href="#Simulator_M.run-341"><span class="linenos">341</span></a>			<span class="n">stress_to</span> <span class="o">=</span> <span class="n">numpy2torch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">n_elems</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</span><span id="Simulator_M.run-342"><a href="#Simulator_M.run-342"><span class="linenos">342</span></a>
</span><span id="Simulator_M.run-343"><a href="#Simulator_M.run-343"><span class="linenos">343</span></a>		<span class="c1"># Calculate and eps_ie_rate_old</span>
</span><span id="Simulator_M.run-344"><a href="#Simulator_M.run-344"><span class="linenos">344</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M.run-345"><a href="#Simulator_M.run-345"><span class="linenos">345</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_M.run-346"><a href="#Simulator_M.run-346"><span class="linenos">346</span></a>
</span><span id="Simulator_M.run-347"><a href="#Simulator_M.run-347"><span class="linenos">347</span></a>		<span class="c1"># Save fields</span>
</span><span id="Simulator_M.run-348"><a href="#Simulator_M.run-348"><span class="linenos">348</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_M.run-349"><a href="#Simulator_M.run-349"><span class="linenos">349</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_M.run-350"><a href="#Simulator_M.run-350"><span class="linenos">350</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_M.run-351"><a href="#Simulator_M.run-351"><span class="linenos">351</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_M.run-352"><a href="#Simulator_M.run-352"><span class="linenos">352</span></a>		<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Simulator_M.run-353"><a href="#Simulator_M.run-353"><span class="linenos">353</span></a>
</span><span id="Simulator_M.run-354"><a href="#Simulator_M.run-354"><span class="linenos">354</span></a>		<span class="c1"># Time loop</span>
</span><span id="Simulator_M.run-355"><a href="#Simulator_M.run-355"><span class="linenos">355</span></a>		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">keep_looping</span><span class="p">():</span>
</span><span id="Simulator_M.run-356"><a href="#Simulator_M.run-356"><span class="linenos">356</span></a>
</span><span id="Simulator_M.run-357"><a href="#Simulator_M.run-357"><span class="linenos">357</span></a>			<span class="c1"># Advance time</span>
</span><span id="Simulator_M.run-358"><a href="#Simulator_M.run-358"><span class="linenos">358</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">advance_time</span><span class="p">()</span>
</span><span id="Simulator_M.run-359"><a href="#Simulator_M.run-359"><span class="linenos">359</span></a>			<span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">t</span>
</span><span id="Simulator_M.run-360"><a href="#Simulator_M.run-360"><span class="linenos">360</span></a>			<span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">dt</span>
</span><span id="Simulator_M.run-361"><a href="#Simulator_M.run-361"><span class="linenos">361</span></a>
</span><span id="Simulator_M.run-362"><a href="#Simulator_M.run-362"><span class="linenos">362</span></a>			<span class="c1"># Update boundary conditions</span>
</span><span id="Simulator_M.run-363"><a href="#Simulator_M.run-363"><span class="linenos">363</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_dirichlet</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M.run-364"><a href="#Simulator_M.run-364"><span class="linenos">364</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">update_neumann</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M.run-365"><a href="#Simulator_M.run-365"><span class="linenos">365</span></a>
</span><span id="Simulator_M.run-366"><a href="#Simulator_M.run-366"><span class="linenos">366</span></a>			<span class="c1"># Iterative loop settings</span>
</span><span id="Simulator_M.run-367"><a href="#Simulator_M.run-367"><span class="linenos">367</span></a>			<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-8</span>
</span><span id="Simulator_M.run-368"><a href="#Simulator_M.run-368"><span class="linenos">368</span></a>			<span class="n">error</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tol</span>
</span><span id="Simulator_M.run-369"><a href="#Simulator_M.run-369"><span class="linenos">369</span></a>			<span class="n">ite</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Simulator_M.run-370"><a href="#Simulator_M.run-370"><span class="linenos">370</span></a>			<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="Simulator_M.run-371"><a href="#Simulator_M.run-371"><span class="linenos">371</span></a>
</span><span id="Simulator_M.run-372"><a href="#Simulator_M.run-372"><span class="linenos">372</span></a>			<span class="k">while</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">tol</span> <span class="ow">and</span> <span class="n">ite</span> <span class="o">&lt;</span> <span class="n">maxiter</span><span class="p">:</span>
</span><span id="Simulator_M.run-373"><a href="#Simulator_M.run-373"><span class="linenos">373</span></a>
</span><span id="Simulator_M.run-374"><a href="#Simulator_M.run-374"><span class="linenos">374</span></a>				<span class="c1"># Update total strain of previous iteration (eps_tot_k &lt;-- eps_tot)</span>
</span><span id="Simulator_M.run-375"><a href="#Simulator_M.run-375"><span class="linenos">375</span></a>				<span class="n">eps_tot_k_to</span> <span class="o">=</span> <span class="n">eps_tot_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_M.run-376"><a href="#Simulator_M.run-376"><span class="linenos">376</span></a>
</span><span id="Simulator_M.run-377"><a href="#Simulator_M.run-377"><span class="linenos">377</span></a>				<span class="c1"># Update stress</span>
</span><span id="Simulator_M.run-378"><a href="#Simulator_M.run-378"><span class="linenos">378</span></a>				<span class="n">stress_k_to</span> <span class="o">=</span> <span class="n">stress_to</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="Simulator_M.run-379"><a href="#Simulator_M.run-379"><span class="linenos">379</span></a>
</span><span id="Simulator_M.run-380"><a href="#Simulator_M.run-380"><span class="linenos">380</span></a>				<span class="c1"># Build bi-linear form</span>
</span><span id="Simulator_M.run-381"><a href="#Simulator_M.run-381"><span class="linenos">381</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">stress_k_to</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M.run-382"><a href="#Simulator_M.run-382"><span class="linenos">382</span></a>
</span><span id="Simulator_M.run-383"><a href="#Simulator_M.run-383"><span class="linenos">383</span></a>				<span class="c1"># Compute total strain</span>
</span><span id="Simulator_M.run-384"><a href="#Simulator_M.run-384"><span class="linenos">384</span></a>				<span class="n">eps_tot_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_total_strain</span><span class="p">()</span>
</span><span id="Simulator_M.run-385"><a href="#Simulator_M.run-385"><span class="linenos">385</span></a>
</span><span id="Simulator_M.run-386"><a href="#Simulator_M.run-386"><span class="linenos">386</span></a>				<span class="c1"># Compute stress</span>
</span><span id="Simulator_M.run-387"><a href="#Simulator_M.run-387"><span class="linenos">387</span></a>				<span class="n">stress_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_stress</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_M.run-388"><a href="#Simulator_M.run-388"><span class="linenos">388</span></a>
</span><span id="Simulator_M.run-389"><a href="#Simulator_M.run-389"><span class="linenos">389</span></a>				<span class="c1"># Increment internal variables</span>
</span><span id="Simulator_M.run-390"><a href="#Simulator_M.run-390"><span class="linenos">390</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">increment_internal_variables</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M.run-391"><a href="#Simulator_M.run-391"><span class="linenos">391</span></a>
</span><span id="Simulator_M.run-392"><a href="#Simulator_M.run-392"><span class="linenos">392</span></a>				<span class="c1"># Compute inelastic strain rates</span>
</span><span id="Simulator_M.run-393"><a href="#Simulator_M.run-393"><span class="linenos">393</span></a>				<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_eps_ne_rate</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M.run-394"><a href="#Simulator_M.run-394"><span class="linenos">394</span></a>
</span><span id="Simulator_M.run-395"><a href="#Simulator_M.run-395"><span class="linenos">395</span></a>				<span class="c1"># Compute error</span>
</span><span id="Simulator_M.run-396"><a href="#Simulator_M.run-396"><span class="linenos">396</span></a>				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Simulator_M.run-397"><a href="#Simulator_M.run-397"><span class="linenos">397</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_M.run-398"><a href="#Simulator_M.run-398"><span class="linenos">398</span></a>				<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_M.run-399"><a href="#Simulator_M.run-399"><span class="linenos">399</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Simulator_M.run-400"><a href="#Simulator_M.run-400"><span class="linenos">400</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="Simulator_M.run-401"><a href="#Simulator_M.run-401"><span class="linenos">401</span></a>					<span class="n">eps_tot_k_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_k_to</span><span class="p">)</span>
</span><span id="Simulator_M.run-402"><a href="#Simulator_M.run-402"><span class="linenos">402</span></a>					<span class="n">eps_tot_flat</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">eps_tot_to</span><span class="p">)</span>
</span><span id="Simulator_M.run-403"><a href="#Simulator_M.run-403"><span class="linenos">403</span></a>					<span class="n">local_error</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_k_flat</span> <span class="o">-</span> <span class="n">eps_tot_flat</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eps_tot_flat</span><span class="p">)</span>
</span><span id="Simulator_M.run-404"><a href="#Simulator_M.run-404"><span class="linenos">404</span></a>					<span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">local_error</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">SUM</span><span class="p">)</span>
</span><span id="Simulator_M.run-405"><a href="#Simulator_M.run-405"><span class="linenos">405</span></a>
</span><span id="Simulator_M.run-406"><a href="#Simulator_M.run-406"><span class="linenos">406</span></a>				<span class="n">ite</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Simulator_M.run-407"><a href="#Simulator_M.run-407"><span class="linenos">407</span></a>
</span><span id="Simulator_M.run-408"><a href="#Simulator_M.run-408"><span class="linenos">408</span></a>			<span class="c1"># Update internal variables</span>
</span><span id="Simulator_M.run-409"><a href="#Simulator_M.run-409"><span class="linenos">409</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_internal_variables</span><span class="p">()</span>
</span><span id="Simulator_M.run-410"><a href="#Simulator_M.run-410"><span class="linenos">410</span></a>
</span><span id="Simulator_M.run-411"><a href="#Simulator_M.run-411"><span class="linenos">411</span></a>			<span class="c1"># Update strain rates</span>
</span><span id="Simulator_M.run-412"><a href="#Simulator_M.run-412"><span class="linenos">412</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_rate_old</span><span class="p">()</span>
</span><span id="Simulator_M.run-413"><a href="#Simulator_M.run-413"><span class="linenos">413</span></a>
</span><span id="Simulator_M.run-414"><a href="#Simulator_M.run-414"><span class="linenos">414</span></a>			<span class="c1"># Update strain</span>
</span><span id="Simulator_M.run-415"><a href="#Simulator_M.run-415"><span class="linenos">415</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">update_eps_ne_old</span><span class="p">(</span><span class="n">stress_to</span><span class="p">,</span> <span class="n">stress_k_to</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</span><span id="Simulator_M.run-416"><a href="#Simulator_M.run-416"><span class="linenos">416</span></a>
</span><span id="Simulator_M.run-417"><a href="#Simulator_M.run-417"><span class="linenos">417</span></a>			<span class="c1"># Save fields</span>
</span><span id="Simulator_M.run-418"><a href="#Simulator_M.run-418"><span class="linenos">418</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_elems</span><span class="p">()</span>
</span><span id="Simulator_M.run-419"><a href="#Simulator_M.run-419"><span class="linenos">419</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_elems</span><span class="p">()</span>
</span><span id="Simulator_M.run-420"><a href="#Simulator_M.run-420"><span class="linenos">420</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_p_nodes</span><span class="p">()</span>
</span><span id="Simulator_M.run-421"><a href="#Simulator_M.run-421"><span class="linenos">421</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">compute_q_nodes</span><span class="p">()</span>
</span><span id="Simulator_M.run-422"><a href="#Simulator_M.run-422"><span class="linenos">422</span></a>			<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_M.run-423"><a href="#Simulator_M.run-423"><span class="linenos">423</span></a>				<span class="n">output</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Simulator_M.run-424"><a href="#Simulator_M.run-424"><span class="linenos">424</span></a>
</span><span id="Simulator_M.run-425"><a href="#Simulator_M.run-425"><span class="linenos">425</span></a>			<span class="c1"># Print stuff</span>
</span><span id="Simulator_M.run-426"><a href="#Simulator_M.run-426"><span class="linenos">426</span></a>			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Simulator_M.run-427"><a href="#Simulator_M.run-427"><span class="linenos">427</span></a>				<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t_control</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">ite</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span id="Simulator_M.run-428"><a href="#Simulator_M.run-428"><span class="linenos">428</span></a>				<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_M.run-429"><a href="#Simulator_M.run-429"><span class="linenos">429</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="Simulator_M.run-430"><a href="#Simulator_M.run-430"><span class="linenos">430</span></a>					<span class="nb">print</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_mom</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elems_ne</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Fvp</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Simulator_M.run-431"><a href="#Simulator_M.run-431"><span class="linenos">431</span></a>					<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Simulator_M.run-432"><a href="#Simulator_M.run-432"><span class="linenos">432</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="Simulator_M.run-433"><a href="#Simulator_M.run-433"><span class="linenos">433</span></a>					<span class="k">pass</span>
</span><span id="Simulator_M.run-434"><a href="#Simulator_M.run-434"><span class="linenos">434</span></a>
</span><span id="Simulator_M.run-435"><a href="#Simulator_M.run-435"><span class="linenos">435</span></a>		<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="Simulator_M.run-436"><a href="#Simulator_M.run-436"><span class="linenos">436</span></a>			<span class="n">output</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Run the mechanical simulation.</p>

<h6 id="workflow">Workflow</h6>

<ol>
<li>Initialize outputs and boundary conditions.</li>
<li>Optionally solve a purely elastic step.</li>
<li>Initialize non-elastic rates.</li>
<li>For each time step: assemble/solve, update internal variables and
rates, compute relevant quantities, and save fields.</li>
</ol>

<h6 id="convergence">Convergence</h6>

<p>Uses a relative change in total strain between iterations as error.
If <code>theta == 1.0</code> or no non-elastic elements exist, iteration ends
immediately.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Printing occurs on rank 0 only.</li>
<li>The first <code>output.save_fields(0)</code> call uses the last <code>output</code>
from the preceding loop variable.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="TimeControllerBase">
                            <input id="TimeControllerBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeControllerBase</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="TimeControllerBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerBase-28"><a href="#TimeControllerBase-28"><span class="linenos"> 28</span></a><span class="k">class</span> <span class="nc">TimeControllerBase</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="TimeControllerBase-29"><a href="#TimeControllerBase-29"><span class="linenos"> 29</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-30"><a href="#TimeControllerBase-30"><span class="linenos"> 30</span></a><span class="sd">    Base class for advancing and tracking simulation time.</span>
</span><span id="TimeControllerBase-31"><a href="#TimeControllerBase-31"><span class="linenos"> 31</span></a>
</span><span id="TimeControllerBase-32"><a href="#TimeControllerBase-32"><span class="linenos"> 32</span></a><span class="sd">    Converts user-provided times into a chosen unit (seconds, minutes, hours,</span>
</span><span id="TimeControllerBase-33"><a href="#TimeControllerBase-33"><span class="linenos"> 33</span></a><span class="sd">    days, or years) and keeps common state used by concrete controllers.</span>
</span><span id="TimeControllerBase-34"><a href="#TimeControllerBase-34"><span class="linenos"> 34</span></a>
</span><span id="TimeControllerBase-35"><a href="#TimeControllerBase-35"><span class="linenos"> 35</span></a><span class="sd">    Parameters</span>
</span><span id="TimeControllerBase-36"><a href="#TimeControllerBase-36"><span class="linenos"> 36</span></a><span class="sd">    ----------</span>
</span><span id="TimeControllerBase-37"><a href="#TimeControllerBase-37"><span class="linenos"> 37</span></a><span class="sd">    initial_time : float</span>
</span><span id="TimeControllerBase-38"><a href="#TimeControllerBase-38"><span class="linenos"> 38</span></a><span class="sd">        Start time expressed in the units given by `time_unit`.</span>
</span><span id="TimeControllerBase-39"><a href="#TimeControllerBase-39"><span class="linenos"> 39</span></a><span class="sd">    final_time : float</span>
</span><span id="TimeControllerBase-40"><a href="#TimeControllerBase-40"><span class="linenos"> 40</span></a><span class="sd">        Final time expressed in the units given by `time_unit`.</span>
</span><span id="TimeControllerBase-41"><a href="#TimeControllerBase-41"><span class="linenos"> 41</span></a><span class="sd">    time_unit : {&quot;second&quot;, &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;year&quot;}, default=&quot;second&quot;</span>
</span><span id="TimeControllerBase-42"><a href="#TimeControllerBase-42"><span class="linenos"> 42</span></a><span class="sd">        Unit used to interpret `initial_time` and `final_time`.</span>
</span><span id="TimeControllerBase-43"><a href="#TimeControllerBase-43"><span class="linenos"> 43</span></a>
</span><span id="TimeControllerBase-44"><a href="#TimeControllerBase-44"><span class="linenos"> 44</span></a><span class="sd">    Attributes</span>
</span><span id="TimeControllerBase-45"><a href="#TimeControllerBase-45"><span class="linenos"> 45</span></a><span class="sd">    ----------</span>
</span><span id="TimeControllerBase-46"><a href="#TimeControllerBase-46"><span class="linenos"> 46</span></a><span class="sd">    time_unit : float</span>
</span><span id="TimeControllerBase-47"><a href="#TimeControllerBase-47"><span class="linenos"> 47</span></a><span class="sd">        Conversion factor to seconds for the selected unit (e.g., 60 for &quot;minute&quot;).</span>
</span><span id="TimeControllerBase-48"><a href="#TimeControllerBase-48"><span class="linenos"> 48</span></a><span class="sd">    t_initial : float</span>
</span><span id="TimeControllerBase-49"><a href="#TimeControllerBase-49"><span class="linenos"> 49</span></a><span class="sd">        Initial time in **seconds**.</span>
</span><span id="TimeControllerBase-50"><a href="#TimeControllerBase-50"><span class="linenos"> 50</span></a><span class="sd">    t_final : float</span>
</span><span id="TimeControllerBase-51"><a href="#TimeControllerBase-51"><span class="linenos"> 51</span></a><span class="sd">        Final time in **seconds**.</span>
</span><span id="TimeControllerBase-52"><a href="#TimeControllerBase-52"><span class="linenos"> 52</span></a><span class="sd">    t : float</span>
</span><span id="TimeControllerBase-53"><a href="#TimeControllerBase-53"><span class="linenos"> 53</span></a><span class="sd">        Current time in **seconds**.</span>
</span><span id="TimeControllerBase-54"><a href="#TimeControllerBase-54"><span class="linenos"> 54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-55"><a href="#TimeControllerBase-55"><span class="linenos"> 55</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;second&quot;</span><span class="p">):</span>
</span><span id="TimeControllerBase-56"><a href="#TimeControllerBase-56"><span class="linenos"> 56</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">__decide_time_unit</span><span class="p">(</span><span class="n">time_unit</span><span class="p">)</span>
</span><span id="TimeControllerBase-57"><a href="#TimeControllerBase-57"><span class="linenos"> 57</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_final</span> <span class="o">=</span> <span class="n">final_time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span>
</span><span id="TimeControllerBase-58"><a href="#TimeControllerBase-58"><span class="linenos"> 58</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t_initial</span> <span class="o">=</span> <span class="n">initial_time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span>
</span><span id="TimeControllerBase-59"><a href="#TimeControllerBase-59"><span class="linenos"> 59</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">initial_time</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span>
</span><span id="TimeControllerBase-60"><a href="#TimeControllerBase-60"><span class="linenos"> 60</span></a>
</span><span id="TimeControllerBase-61"><a href="#TimeControllerBase-61"><span class="linenos"> 61</span></a>	<span class="k">def</span> <span class="nf">__decide_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerBase-62"><a href="#TimeControllerBase-62"><span class="linenos"> 62</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-63"><a href="#TimeControllerBase-63"><span class="linenos"> 63</span></a><span class="sd">        Map a textual time unit to its conversion factor to seconds.</span>
</span><span id="TimeControllerBase-64"><a href="#TimeControllerBase-64"><span class="linenos"> 64</span></a>
</span><span id="TimeControllerBase-65"><a href="#TimeControllerBase-65"><span class="linenos"> 65</span></a><span class="sd">        Parameters</span>
</span><span id="TimeControllerBase-66"><a href="#TimeControllerBase-66"><span class="linenos"> 66</span></a><span class="sd">        ----------</span>
</span><span id="TimeControllerBase-67"><a href="#TimeControllerBase-67"><span class="linenos"> 67</span></a><span class="sd">        time_unit : {&quot;second&quot;, &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;year&quot;}</span>
</span><span id="TimeControllerBase-68"><a href="#TimeControllerBase-68"><span class="linenos"> 68</span></a><span class="sd">            Name of the time unit.</span>
</span><span id="TimeControllerBase-69"><a href="#TimeControllerBase-69"><span class="linenos"> 69</span></a>
</span><span id="TimeControllerBase-70"><a href="#TimeControllerBase-70"><span class="linenos"> 70</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerBase-71"><a href="#TimeControllerBase-71"><span class="linenos"> 71</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerBase-72"><a href="#TimeControllerBase-72"><span class="linenos"> 72</span></a><span class="sd">        None</span>
</span><span id="TimeControllerBase-73"><a href="#TimeControllerBase-73"><span class="linenos"> 73</span></a>
</span><span id="TimeControllerBase-74"><a href="#TimeControllerBase-74"><span class="linenos"> 74</span></a><span class="sd">        Raises</span>
</span><span id="TimeControllerBase-75"><a href="#TimeControllerBase-75"><span class="linenos"> 75</span></a><span class="sd">        ------</span>
</span><span id="TimeControllerBase-76"><a href="#TimeControllerBase-76"><span class="linenos"> 76</span></a><span class="sd">        Exception</span>
</span><span id="TimeControllerBase-77"><a href="#TimeControllerBase-77"><span class="linenos"> 77</span></a><span class="sd">            If `time_unit` is not one of the supported values.</span>
</span><span id="TimeControllerBase-78"><a href="#TimeControllerBase-78"><span class="linenos"> 78</span></a>
</span><span id="TimeControllerBase-79"><a href="#TimeControllerBase-79"><span class="linenos"> 79</span></a><span class="sd">        Notes</span>
</span><span id="TimeControllerBase-80"><a href="#TimeControllerBase-80"><span class="linenos"> 80</span></a><span class="sd">        -----</span>
</span><span id="TimeControllerBase-81"><a href="#TimeControllerBase-81"><span class="linenos"> 81</span></a><span class="sd">        This is an internal helper that sets :attr:`time_unit` to a scalar factor.</span>
</span><span id="TimeControllerBase-82"><a href="#TimeControllerBase-82"><span class="linenos"> 82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-83"><a href="#TimeControllerBase-83"><span class="linenos"> 83</span></a>		<span class="k">if</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s2">&quot;second&quot;</span><span class="p">:</span>
</span><span id="TimeControllerBase-84"><a href="#TimeControllerBase-84"><span class="linenos"> 84</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="TimeControllerBase-85"><a href="#TimeControllerBase-85"><span class="linenos"> 85</span></a>		<span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s2">&quot;minute&quot;</span><span class="p">:</span>
</span><span id="TimeControllerBase-86"><a href="#TimeControllerBase-86"><span class="linenos"> 86</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">minute</span>
</span><span id="TimeControllerBase-87"><a href="#TimeControllerBase-87"><span class="linenos"> 87</span></a>		<span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s2">&quot;hour&quot;</span><span class="p">:</span>
</span><span id="TimeControllerBase-88"><a href="#TimeControllerBase-88"><span class="linenos"> 88</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">hour</span>
</span><span id="TimeControllerBase-89"><a href="#TimeControllerBase-89"><span class="linenos"> 89</span></a>		<span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s2">&quot;day&quot;</span><span class="p">:</span>
</span><span id="TimeControllerBase-90"><a href="#TimeControllerBase-90"><span class="linenos"> 90</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">day</span>
</span><span id="TimeControllerBase-91"><a href="#TimeControllerBase-91"><span class="linenos"> 91</span></a>		<span class="k">elif</span> <span class="n">time_unit</span> <span class="o">==</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span>
</span><span id="TimeControllerBase-92"><a href="#TimeControllerBase-92"><span class="linenos"> 92</span></a>			<span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">year</span>
</span><span id="TimeControllerBase-93"><a href="#TimeControllerBase-93"><span class="linenos"> 93</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="TimeControllerBase-94"><a href="#TimeControllerBase-94"><span class="linenos"> 94</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time unit </span><span class="si">{</span><span class="n">time_unit</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>
</span><span id="TimeControllerBase-95"><a href="#TimeControllerBase-95"><span class="linenos"> 95</span></a>
</span><span id="TimeControllerBase-96"><a href="#TimeControllerBase-96"><span class="linenos"> 96</span></a>	<span class="k">def</span> <span class="nf">keep_looping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerBase-97"><a href="#TimeControllerBase-97"><span class="linenos"> 97</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-98"><a href="#TimeControllerBase-98"><span class="linenos"> 98</span></a><span class="sd">        Check whether the controller should continue advancing time.</span>
</span><span id="TimeControllerBase-99"><a href="#TimeControllerBase-99"><span class="linenos"> 99</span></a>
</span><span id="TimeControllerBase-100"><a href="#TimeControllerBase-100"><span class="linenos">100</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerBase-101"><a href="#TimeControllerBase-101"><span class="linenos">101</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerBase-102"><a href="#TimeControllerBase-102"><span class="linenos">102</span></a><span class="sd">        bool</span>
</span><span id="TimeControllerBase-103"><a href="#TimeControllerBase-103"><span class="linenos">103</span></a><span class="sd">            ``True`` while the current time `t` is strictly less than `t_final`,</span>
</span><span id="TimeControllerBase-104"><a href="#TimeControllerBase-104"><span class="linenos">104</span></a><span class="sd">            otherwise ``False``.</span>
</span><span id="TimeControllerBase-105"><a href="#TimeControllerBase-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-106"><a href="#TimeControllerBase-106"><span class="linenos">106</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_final</span>
</span><span id="TimeControllerBase-107"><a href="#TimeControllerBase-107"><span class="linenos">107</span></a>
</span><span id="TimeControllerBase-108"><a href="#TimeControllerBase-108"><span class="linenos">108</span></a>	<span class="nd">@abstractmethod</span>
</span><span id="TimeControllerBase-109"><a href="#TimeControllerBase-109"><span class="linenos">109</span></a>	<span class="k">def</span> <span class="nf">advance_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerBase-110"><a href="#TimeControllerBase-110"><span class="linenos">110</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-111"><a href="#TimeControllerBase-111"><span class="linenos">111</span></a><span class="sd">        Advance the internal time by one step.</span>
</span><span id="TimeControllerBase-112"><a href="#TimeControllerBase-112"><span class="linenos">112</span></a>
</span><span id="TimeControllerBase-113"><a href="#TimeControllerBase-113"><span class="linenos">113</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerBase-114"><a href="#TimeControllerBase-114"><span class="linenos">114</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerBase-115"><a href="#TimeControllerBase-115"><span class="linenos">115</span></a><span class="sd">        None</span>
</span><span id="TimeControllerBase-116"><a href="#TimeControllerBase-116"><span class="linenos">116</span></a>
</span><span id="TimeControllerBase-117"><a href="#TimeControllerBase-117"><span class="linenos">117</span></a><span class="sd">        Notes</span>
</span><span id="TimeControllerBase-118"><a href="#TimeControllerBase-118"><span class="linenos">118</span></a><span class="sd">        -----</span>
</span><span id="TimeControllerBase-119"><a href="#TimeControllerBase-119"><span class="linenos">119</span></a><span class="sd">        Subclasses must implement the time-update rule (e.g., add a fixed `dt`</span>
</span><span id="TimeControllerBase-120"><a href="#TimeControllerBase-120"><span class="linenos">120</span></a><span class="sd">        or follow a varying schedule).</span>
</span><span id="TimeControllerBase-121"><a href="#TimeControllerBase-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerBase-122"><a href="#TimeControllerBase-122"><span class="linenos">122</span></a>		<span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Base class for advancing and tracking simulation time.</p>

<p>Converts user-provided times into a chosen unit (seconds, minutes, hours,
days, or years) and keeps common state used by concrete controllers.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>initial_time</strong> (float):
Start time expressed in the units given by <code>time_unit</code>.</li>
<li><strong>final_time</strong> (float):
Final time expressed in the units given by <code>time_unit</code>.</li>
<li><strong>time_unit</strong> ({"second", "minute", "hour", "day", "year"}, default="second"):
Unit used to interpret <code>initial_time</code> and <code>final_time</code>.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>time_unit</strong> (float):
Conversion factor to seconds for the selected unit (e.g., 60 for "minute").</li>
<li><strong>t_initial</strong> (float):
Initial time in <strong>seconds</strong>.</li>
<li><strong>t_final</strong> (float):
Final time in <strong>seconds</strong>.</li>
<li><strong>t</strong> (float):
Current time in <strong>seconds</strong>.</li>
</ul>
</div>


                            <div id="TimeControllerBase.t_final" class="classattr">
                                <div class="attr variable">
            <span class="name">t_final</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerBase.t_final"></a>
    
    

                            </div>
                            <div id="TimeControllerBase.t_initial" class="classattr">
                                <div class="attr variable">
            <span class="name">t_initial</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerBase.t_initial"></a>
    
    

                            </div>
                            <div id="TimeControllerBase.t" class="classattr">
                                <div class="attr variable">
            <span class="name">t</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerBase.t"></a>
    
    

                            </div>
                            <div id="TimeControllerBase.keep_looping" class="classattr">
                                        <input id="TimeControllerBase.keep_looping-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep_looping</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="TimeControllerBase.keep_looping-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerBase.keep_looping"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerBase.keep_looping-96"><a href="#TimeControllerBase.keep_looping-96"><span class="linenos"> 96</span></a>	<span class="k">def</span> <span class="nf">keep_looping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerBase.keep_looping-97"><a href="#TimeControllerBase.keep_looping-97"><span class="linenos"> 97</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerBase.keep_looping-98"><a href="#TimeControllerBase.keep_looping-98"><span class="linenos"> 98</span></a><span class="sd">        Check whether the controller should continue advancing time.</span>
</span><span id="TimeControllerBase.keep_looping-99"><a href="#TimeControllerBase.keep_looping-99"><span class="linenos"> 99</span></a>
</span><span id="TimeControllerBase.keep_looping-100"><a href="#TimeControllerBase.keep_looping-100"><span class="linenos">100</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerBase.keep_looping-101"><a href="#TimeControllerBase.keep_looping-101"><span class="linenos">101</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerBase.keep_looping-102"><a href="#TimeControllerBase.keep_looping-102"><span class="linenos">102</span></a><span class="sd">        bool</span>
</span><span id="TimeControllerBase.keep_looping-103"><a href="#TimeControllerBase.keep_looping-103"><span class="linenos">103</span></a><span class="sd">            ``True`` while the current time `t` is strictly less than `t_final`,</span>
</span><span id="TimeControllerBase.keep_looping-104"><a href="#TimeControllerBase.keep_looping-104"><span class="linenos">104</span></a><span class="sd">            otherwise ``False``.</span>
</span><span id="TimeControllerBase.keep_looping-105"><a href="#TimeControllerBase.keep_looping-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerBase.keep_looping-106"><a href="#TimeControllerBase.keep_looping-106"><span class="linenos">106</span></a>		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_final</span>
</span></pre></div>


            <div class="docstring"><p>Check whether the controller should continue advancing time.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>bool</strong>: <code>True</code> while the current time <code><a href="#TimeControllerBase.t">t</a></code> is strictly less than <code><a href="#TimeControllerBase.t_final">t_final</a></code>,
otherwise <code>False</code>.</li>
</ul>
</div>


                            </div>
                            <div id="TimeControllerBase.advance_time" class="classattr">
                                        <input id="TimeControllerBase.advance_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">advance_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="TimeControllerBase.advance_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerBase.advance_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerBase.advance_time-108"><a href="#TimeControllerBase.advance_time-108"><span class="linenos">108</span></a>	<span class="nd">@abstractmethod</span>
</span><span id="TimeControllerBase.advance_time-109"><a href="#TimeControllerBase.advance_time-109"><span class="linenos">109</span></a>	<span class="k">def</span> <span class="nf">advance_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerBase.advance_time-110"><a href="#TimeControllerBase.advance_time-110"><span class="linenos">110</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerBase.advance_time-111"><a href="#TimeControllerBase.advance_time-111"><span class="linenos">111</span></a><span class="sd">        Advance the internal time by one step.</span>
</span><span id="TimeControllerBase.advance_time-112"><a href="#TimeControllerBase.advance_time-112"><span class="linenos">112</span></a>
</span><span id="TimeControllerBase.advance_time-113"><a href="#TimeControllerBase.advance_time-113"><span class="linenos">113</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerBase.advance_time-114"><a href="#TimeControllerBase.advance_time-114"><span class="linenos">114</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerBase.advance_time-115"><a href="#TimeControllerBase.advance_time-115"><span class="linenos">115</span></a><span class="sd">        None</span>
</span><span id="TimeControllerBase.advance_time-116"><a href="#TimeControllerBase.advance_time-116"><span class="linenos">116</span></a>
</span><span id="TimeControllerBase.advance_time-117"><a href="#TimeControllerBase.advance_time-117"><span class="linenos">117</span></a><span class="sd">        Notes</span>
</span><span id="TimeControllerBase.advance_time-118"><a href="#TimeControllerBase.advance_time-118"><span class="linenos">118</span></a><span class="sd">        -----</span>
</span><span id="TimeControllerBase.advance_time-119"><a href="#TimeControllerBase.advance_time-119"><span class="linenos">119</span></a><span class="sd">        Subclasses must implement the time-update rule (e.g., add a fixed `dt`</span>
</span><span id="TimeControllerBase.advance_time-120"><a href="#TimeControllerBase.advance_time-120"><span class="linenos">120</span></a><span class="sd">        or follow a varying schedule).</span>
</span><span id="TimeControllerBase.advance_time-121"><a href="#TimeControllerBase.advance_time-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerBase.advance_time-122"><a href="#TimeControllerBase.advance_time-122"><span class="linenos">122</span></a>		<span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Advance the internal time by one step.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>Subclasses must implement the time-update rule (e.g., add a fixed <code>dt</code>
or follow a varying schedule).</p>
</div>


                            </div>
                </section>
                <section id="TimeController">
                            <input id="TimeController-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeController</span><wbr>(<span class="base"><a href="#TimeControllerBase">safeincave.TimeControllerBase</a></span>):

                <label class="view-source-button" for="TimeController-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeController"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeController-126"><a href="#TimeController-126"><span class="linenos">126</span></a><span class="k">class</span> <span class="nc">TimeController</span><span class="p">(</span><span class="n">TimeControllerBase</span><span class="p">):</span>
</span><span id="TimeController-127"><a href="#TimeController-127"><span class="linenos">127</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeController-128"><a href="#TimeController-128"><span class="linenos">128</span></a><span class="sd">    Fixed-step time controller.</span>
</span><span id="TimeController-129"><a href="#TimeController-129"><span class="linenos">129</span></a>
</span><span id="TimeController-130"><a href="#TimeController-130"><span class="linenos">130</span></a><span class="sd">    Advances the current time by a constant step `dt` expressed in the chosen</span>
</span><span id="TimeController-131"><a href="#TimeController-131"><span class="linenos">131</span></a><span class="sd">    unit.</span>
</span><span id="TimeController-132"><a href="#TimeController-132"><span class="linenos">132</span></a>
</span><span id="TimeController-133"><a href="#TimeController-133"><span class="linenos">133</span></a><span class="sd">    Parameters</span>
</span><span id="TimeController-134"><a href="#TimeController-134"><span class="linenos">134</span></a><span class="sd">    ----------</span>
</span><span id="TimeController-135"><a href="#TimeController-135"><span class="linenos">135</span></a><span class="sd">    dt : float</span>
</span><span id="TimeController-136"><a href="#TimeController-136"><span class="linenos">136</span></a><span class="sd">        Time-step size expressed in the units given by `time_unit`.</span>
</span><span id="TimeController-137"><a href="#TimeController-137"><span class="linenos">137</span></a><span class="sd">    initial_time : float</span>
</span><span id="TimeController-138"><a href="#TimeController-138"><span class="linenos">138</span></a><span class="sd">        Start time expressed in the units given by `time_unit`.</span>
</span><span id="TimeController-139"><a href="#TimeController-139"><span class="linenos">139</span></a><span class="sd">    final_time : float</span>
</span><span id="TimeController-140"><a href="#TimeController-140"><span class="linenos">140</span></a><span class="sd">        Final time expressed in the units given by `time_unit`.</span>
</span><span id="TimeController-141"><a href="#TimeController-141"><span class="linenos">141</span></a><span class="sd">    time_unit : {&quot;second&quot;, &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;year&quot;}, default=&quot;second&quot;</span>
</span><span id="TimeController-142"><a href="#TimeController-142"><span class="linenos">142</span></a><span class="sd">        Unit used to interpret `dt`, `initial_time`, and `final_time`.</span>
</span><span id="TimeController-143"><a href="#TimeController-143"><span class="linenos">143</span></a>
</span><span id="TimeController-144"><a href="#TimeController-144"><span class="linenos">144</span></a><span class="sd">    Attributes</span>
</span><span id="TimeController-145"><a href="#TimeController-145"><span class="linenos">145</span></a><span class="sd">    ----------</span>
</span><span id="TimeController-146"><a href="#TimeController-146"><span class="linenos">146</span></a><span class="sd">    dt : float</span>
</span><span id="TimeController-147"><a href="#TimeController-147"><span class="linenos">147</span></a><span class="sd">        Fixed time-step size in **seconds**.</span>
</span><span id="TimeController-148"><a href="#TimeController-148"><span class="linenos">148</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TimeController-149"><a href="#TimeController-149"><span class="linenos">149</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;second&quot;</span><span class="p">):</span>
</span><span id="TimeController-150"><a href="#TimeController-150"><span class="linenos">150</span></a>		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span>
</span><span id="TimeController-151"><a href="#TimeController-151"><span class="linenos">151</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span>
</span><span id="TimeController-152"><a href="#TimeController-152"><span class="linenos">152</span></a>
</span><span id="TimeController-153"><a href="#TimeController-153"><span class="linenos">153</span></a>	<span class="k">def</span> <span class="nf">advance_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeController-154"><a href="#TimeController-154"><span class="linenos">154</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeController-155"><a href="#TimeController-155"><span class="linenos">155</span></a><span class="sd">        Increment the current time by the fixed step `dt`.</span>
</span><span id="TimeController-156"><a href="#TimeController-156"><span class="linenos">156</span></a>
</span><span id="TimeController-157"><a href="#TimeController-157"><span class="linenos">157</span></a><span class="sd">        Returns</span>
</span><span id="TimeController-158"><a href="#TimeController-158"><span class="linenos">158</span></a><span class="sd">        -------</span>
</span><span id="TimeController-159"><a href="#TimeController-159"><span class="linenos">159</span></a><span class="sd">        None</span>
</span><span id="TimeController-160"><a href="#TimeController-160"><span class="linenos">160</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeController-161"><a href="#TimeController-161"><span class="linenos">161</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
</span></pre></div>


            <div class="docstring"><p>Fixed-step time controller.</p>

<p>Advances the current time by a constant step <code><a href="#TimeController.dt">dt</a></code> expressed in the chosen
unit.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (float):
Time-step size expressed in the units given by <code>time_unit</code>.</li>
<li><strong>initial_time</strong> (float):
Start time expressed in the units given by <code>time_unit</code>.</li>
<li><strong>final_time</strong> (float):
Final time expressed in the units given by <code>time_unit</code>.</li>
<li><strong>time_unit</strong> ({"second", "minute", "hour", "day", "year"}, default="second"):
Unit used to interpret <code><a href="#TimeController.dt">dt</a></code>, <code>initial_time</code>, and <code>final_time</code>.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>dt</strong> (float):
Fixed time-step size in <strong>seconds</strong>.</li>
</ul>
</div>


                            <div id="TimeController.__init__" class="classattr">
                                        <input id="TimeController.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TimeController</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;second&#39;</span></span>)</span>

                <label class="view-source-button" for="TimeController.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeController.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeController.__init__-149"><a href="#TimeController.__init__-149"><span class="linenos">149</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;second&quot;</span><span class="p">):</span>
</span><span id="TimeController.__init__-150"><a href="#TimeController.__init__-150"><span class="linenos">150</span></a>		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span>
</span><span id="TimeController.__init__-151"><a href="#TimeController.__init__-151"><span class="linenos">151</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span>
</span></pre></div>


    

                            </div>
                            <div id="TimeController.dt" class="classattr">
                                <div class="attr variable">
            <span class="name">dt</span>

        
    </div>
    <a class="headerlink" href="#TimeController.dt"></a>
    
    

                            </div>
                            <div id="TimeController.advance_time" class="classattr">
                                        <input id="TimeController.advance_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">advance_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="TimeController.advance_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeController.advance_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeController.advance_time-153"><a href="#TimeController.advance_time-153"><span class="linenos">153</span></a>	<span class="k">def</span> <span class="nf">advance_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeController.advance_time-154"><a href="#TimeController.advance_time-154"><span class="linenos">154</span></a><span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeController.advance_time-155"><a href="#TimeController.advance_time-155"><span class="linenos">155</span></a><span class="sd">        Increment the current time by the fixed step `dt`.</span>
</span><span id="TimeController.advance_time-156"><a href="#TimeController.advance_time-156"><span class="linenos">156</span></a>
</span><span id="TimeController.advance_time-157"><a href="#TimeController.advance_time-157"><span class="linenos">157</span></a><span class="sd">        Returns</span>
</span><span id="TimeController.advance_time-158"><a href="#TimeController.advance_time-158"><span class="linenos">158</span></a><span class="sd">        -------</span>
</span><span id="TimeController.advance_time-159"><a href="#TimeController.advance_time-159"><span class="linenos">159</span></a><span class="sd">        None</span>
</span><span id="TimeController.advance_time-160"><a href="#TimeController.advance_time-160"><span class="linenos">160</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeController.advance_time-161"><a href="#TimeController.advance_time-161"><span class="linenos">161</span></a>		<span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
</span></pre></div>


            <div class="docstring"><p>Increment the current time by the fixed step <code><a href="#TimeController.dt">dt</a></code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                </section>
                <section id="TimeControllerParabolic">
                            <input id="TimeControllerParabolic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimeControllerParabolic</span><wbr>(<span class="base"><a href="#TimeControllerBase">safeincave.TimeControllerBase</a></span>):

                <label class="view-source-button" for="TimeControllerParabolic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerParabolic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerParabolic-165"><a href="#TimeControllerParabolic-165"><span class="linenos">165</span></a><span class="k">class</span> <span class="nc">TimeControllerParabolic</span><span class="p">(</span><span class="n">TimeControllerBase</span><span class="p">):</span>
</span><span id="TimeControllerParabolic-166"><a href="#TimeControllerParabolic-166"><span class="linenos">166</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-167"><a href="#TimeControllerParabolic-167"><span class="linenos">167</span></a><span class="sd">    Nonuniform (parabolic) time controller.</span>
</span><span id="TimeControllerParabolic-168"><a href="#TimeControllerParabolic-168"><span class="linenos">168</span></a>
</span><span id="TimeControllerParabolic-169"><a href="#TimeControllerParabolic-169"><span class="linenos">169</span></a><span class="sd">    Builds a monotonically increasing list of `n_time_steps` time instants</span>
</span><span id="TimeControllerParabolic-170"><a href="#TimeControllerParabolic-170"><span class="linenos">170</span></a><span class="sd">    between `initial_time` and `final_time` by mapping an equally spaced grid</span>
</span><span id="TimeControllerParabolic-171"><a href="#TimeControllerParabolic-171"><span class="linenos">171</span></a><span class="sd">    through a parabolic function and rescaling it back to the original range.</span>
</span><span id="TimeControllerParabolic-172"><a href="#TimeControllerParabolic-172"><span class="linenos">172</span></a><span class="sd">    The step size `dt` changes over time.</span>
</span><span id="TimeControllerParabolic-173"><a href="#TimeControllerParabolic-173"><span class="linenos">173</span></a>
</span><span id="TimeControllerParabolic-174"><a href="#TimeControllerParabolic-174"><span class="linenos">174</span></a><span class="sd">    Parameters</span>
</span><span id="TimeControllerParabolic-175"><a href="#TimeControllerParabolic-175"><span class="linenos">175</span></a><span class="sd">    ----------</span>
</span><span id="TimeControllerParabolic-176"><a href="#TimeControllerParabolic-176"><span class="linenos">176</span></a><span class="sd">    n_time_steps : int</span>
</span><span id="TimeControllerParabolic-177"><a href="#TimeControllerParabolic-177"><span class="linenos">177</span></a><span class="sd">        Number of time instants (length of the time list).</span>
</span><span id="TimeControllerParabolic-178"><a href="#TimeControllerParabolic-178"><span class="linenos">178</span></a><span class="sd">    initial_time : float</span>
</span><span id="TimeControllerParabolic-179"><a href="#TimeControllerParabolic-179"><span class="linenos">179</span></a><span class="sd">        Start time expressed in the units given by `time_unit`.</span>
</span><span id="TimeControllerParabolic-180"><a href="#TimeControllerParabolic-180"><span class="linenos">180</span></a><span class="sd">    final_time : float</span>
</span><span id="TimeControllerParabolic-181"><a href="#TimeControllerParabolic-181"><span class="linenos">181</span></a><span class="sd">        Final time expressed in the units given by `time_unit`.</span>
</span><span id="TimeControllerParabolic-182"><a href="#TimeControllerParabolic-182"><span class="linenos">182</span></a><span class="sd">    time_unit : {&quot;second&quot;, &quot;minute&quot;, &quot;hour&quot;, &quot;day&quot;, &quot;year&quot;}, default=&quot;second&quot;</span>
</span><span id="TimeControllerParabolic-183"><a href="#TimeControllerParabolic-183"><span class="linenos">183</span></a><span class="sd">        Unit used to interpret `initial_time` and `final_time`.</span>
</span><span id="TimeControllerParabolic-184"><a href="#TimeControllerParabolic-184"><span class="linenos">184</span></a>
</span><span id="TimeControllerParabolic-185"><a href="#TimeControllerParabolic-185"><span class="linenos">185</span></a><span class="sd">    Attributes</span>
</span><span id="TimeControllerParabolic-186"><a href="#TimeControllerParabolic-186"><span class="linenos">186</span></a><span class="sd">    ----------</span>
</span><span id="TimeControllerParabolic-187"><a href="#TimeControllerParabolic-187"><span class="linenos">187</span></a><span class="sd">    n_time_steps : int</span>
</span><span id="TimeControllerParabolic-188"><a href="#TimeControllerParabolic-188"><span class="linenos">188</span></a><span class="sd">        Number of generated time instants.</span>
</span><span id="TimeControllerParabolic-189"><a href="#TimeControllerParabolic-189"><span class="linenos">189</span></a><span class="sd">    time_list : numpy.ndarray</span>
</span><span id="TimeControllerParabolic-190"><a href="#TimeControllerParabolic-190"><span class="linenos">190</span></a><span class="sd">        Monotone array of times (in **seconds**) of length `n_time_steps`.</span>
</span><span id="TimeControllerParabolic-191"><a href="#TimeControllerParabolic-191"><span class="linenos">191</span></a><span class="sd">    dt : float</span>
</span><span id="TimeControllerParabolic-192"><a href="#TimeControllerParabolic-192"><span class="linenos">192</span></a><span class="sd">        Current time step size (in **seconds**); initialized as</span>
</span><span id="TimeControllerParabolic-193"><a href="#TimeControllerParabolic-193"><span class="linenos">193</span></a><span class="sd">        ``time_list[1] - time_list[0]``.</span>
</span><span id="TimeControllerParabolic-194"><a href="#TimeControllerParabolic-194"><span class="linenos">194</span></a>
</span><span id="TimeControllerParabolic-195"><a href="#TimeControllerParabolic-195"><span class="linenos">195</span></a><span class="sd">    Notes</span>
</span><span id="TimeControllerParabolic-196"><a href="#TimeControllerParabolic-196"><span class="linenos">196</span></a><span class="sd">    -----</span>
</span><span id="TimeControllerParabolic-197"><a href="#TimeControllerParabolic-197"><span class="linenos">197</span></a><span class="sd">    - This class expects attributes like :attr:`t_initial`, :attr:`t_final`,</span>
</span><span id="TimeControllerParabolic-198"><a href="#TimeControllerParabolic-198"><span class="linenos">198</span></a><span class="sd">      and :attr:`time_unit` to be available (typically provided by a base</span>
</span><span id="TimeControllerParabolic-199"><a href="#TimeControllerParabolic-199"><span class="linenos">199</span></a><span class="sd">      initializer). Ensure those are set before use.</span>
</span><span id="TimeControllerParabolic-200"><a href="#TimeControllerParabolic-200"><span class="linenos">200</span></a><span class="sd">    - Advance logic uses an internal index ``self.step_counter``.</span>
</span><span id="TimeControllerParabolic-201"><a href="#TimeControllerParabolic-201"><span class="linenos">201</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-202"><a href="#TimeControllerParabolic-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_time_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;second&quot;</span><span class="p">):</span>
</span><span id="TimeControllerParabolic-203"><a href="#TimeControllerParabolic-203"><span class="linenos">203</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-204"><a href="#TimeControllerParabolic-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_time_steps</span> <span class="o">=</span> <span class="n">n_time_steps</span>
</span><span id="TimeControllerParabolic-205"><a href="#TimeControllerParabolic-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_varying_times</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_parabolic</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-206"><a href="#TimeControllerParabolic-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeControllerParabolic-207"><a href="#TimeControllerParabolic-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TimeControllerParabolic-208"><a href="#TimeControllerParabolic-208"><span class="linenos">208</span></a>
</span><span id="TimeControllerParabolic-209"><a href="#TimeControllerParabolic-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">fun_parabolic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="TimeControllerParabolic-210"><a href="#TimeControllerParabolic-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-211"><a href="#TimeControllerParabolic-211"><span class="linenos">211</span></a><span class="sd">        Parabolic mapping used to skew an equally spaced time grid.</span>
</span><span id="TimeControllerParabolic-212"><a href="#TimeControllerParabolic-212"><span class="linenos">212</span></a>
</span><span id="TimeControllerParabolic-213"><a href="#TimeControllerParabolic-213"><span class="linenos">213</span></a><span class="sd">        Parameters</span>
</span><span id="TimeControllerParabolic-214"><a href="#TimeControllerParabolic-214"><span class="linenos">214</span></a><span class="sd">        ----------</span>
</span><span id="TimeControllerParabolic-215"><a href="#TimeControllerParabolic-215"><span class="linenos">215</span></a><span class="sd">        t_array : numpy.ndarray</span>
</span><span id="TimeControllerParabolic-216"><a href="#TimeControllerParabolic-216"><span class="linenos">216</span></a><span class="sd">            Input array (typically an equally spaced grid).</span>
</span><span id="TimeControllerParabolic-217"><a href="#TimeControllerParabolic-217"><span class="linenos">217</span></a>
</span><span id="TimeControllerParabolic-218"><a href="#TimeControllerParabolic-218"><span class="linenos">218</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerParabolic-219"><a href="#TimeControllerParabolic-219"><span class="linenos">219</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerParabolic-220"><a href="#TimeControllerParabolic-220"><span class="linenos">220</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="TimeControllerParabolic-221"><a href="#TimeControllerParabolic-221"><span class="linenos">221</span></a><span class="sd">            Elementwise square of `t_array` (i.e., ``t_array**2``).</span>
</span><span id="TimeControllerParabolic-222"><a href="#TimeControllerParabolic-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-223"><a href="#TimeControllerParabolic-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="n">t_array</span><span class="o">**</span><span class="mi">2</span>
</span><span id="TimeControllerParabolic-224"><a href="#TimeControllerParabolic-224"><span class="linenos">224</span></a>
</span><span id="TimeControllerParabolic-225"><a href="#TimeControllerParabolic-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">calculate_varying_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">:</span> <span class="n">Fn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="TimeControllerParabolic-226"><a href="#TimeControllerParabolic-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-227"><a href="#TimeControllerParabolic-227"><span class="linenos">227</span></a><span class="sd">        Generate a nonuniform time grid via a monotone mapping and rescaling.</span>
</span><span id="TimeControllerParabolic-228"><a href="#TimeControllerParabolic-228"><span class="linenos">228</span></a>
</span><span id="TimeControllerParabolic-229"><a href="#TimeControllerParabolic-229"><span class="linenos">229</span></a><span class="sd">        Steps</span>
</span><span id="TimeControllerParabolic-230"><a href="#TimeControllerParabolic-230"><span class="linenos">230</span></a><span class="sd">        -----</span>
</span><span id="TimeControllerParabolic-231"><a href="#TimeControllerParabolic-231"><span class="linenos">231</span></a><span class="sd">        1. Build an equally spaced grid on ``[t_initial, t_final]``.</span>
</span><span id="TimeControllerParabolic-232"><a href="#TimeControllerParabolic-232"><span class="linenos">232</span></a><span class="sd">        2. Apply ``fun`` to this grid to skew the spacing.</span>
</span><span id="TimeControllerParabolic-233"><a href="#TimeControllerParabolic-233"><span class="linenos">233</span></a><span class="sd">        3. Linearly rescale the mapped values back to the original range so that</span>
</span><span id="TimeControllerParabolic-234"><a href="#TimeControllerParabolic-234"><span class="linenos">234</span></a><span class="sd">           the first and last times remain ``t_initial`` and ``t_final``.</span>
</span><span id="TimeControllerParabolic-235"><a href="#TimeControllerParabolic-235"><span class="linenos">235</span></a>
</span><span id="TimeControllerParabolic-236"><a href="#TimeControllerParabolic-236"><span class="linenos">236</span></a><span class="sd">        Parameters</span>
</span><span id="TimeControllerParabolic-237"><a href="#TimeControllerParabolic-237"><span class="linenos">237</span></a><span class="sd">        ----------</span>
</span><span id="TimeControllerParabolic-238"><a href="#TimeControllerParabolic-238"><span class="linenos">238</span></a><span class="sd">        fun : Callable[[numpy.ndarray], numpy.ndarray]</span>
</span><span id="TimeControllerParabolic-239"><a href="#TimeControllerParabolic-239"><span class="linenos">239</span></a><span class="sd">            Monotone mapping to skew the spacing (e.g., :meth:`fun_parabolic`).</span>
</span><span id="TimeControllerParabolic-240"><a href="#TimeControllerParabolic-240"><span class="linenos">240</span></a>
</span><span id="TimeControllerParabolic-241"><a href="#TimeControllerParabolic-241"><span class="linenos">241</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerParabolic-242"><a href="#TimeControllerParabolic-242"><span class="linenos">242</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerParabolic-243"><a href="#TimeControllerParabolic-243"><span class="linenos">243</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="TimeControllerParabolic-244"><a href="#TimeControllerParabolic-244"><span class="linenos">244</span></a><span class="sd">            Monotone array of times (in seconds) of length ``n_time_steps``.</span>
</span><span id="TimeControllerParabolic-245"><a href="#TimeControllerParabolic-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-246"><a href="#TimeControllerParabolic-246"><span class="linenos">246</span></a>        <span class="n">t_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_initial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_final</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-247"><a href="#TimeControllerParabolic-247"><span class="linenos">247</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">t_eq</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-248"><a href="#TimeControllerParabolic-248"><span class="linenos">248</span></a>        <span class="n">f_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">t_eq</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-249"><a href="#TimeControllerParabolic-249"><span class="linenos">249</span></a>        <span class="n">f_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-250"><a href="#TimeControllerParabolic-250"><span class="linenos">250</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_eq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_eq</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">f_max</span> <span class="o">-</span> <span class="n">f_min</span><span class="p">)</span>
</span><span id="TimeControllerParabolic-251"><a href="#TimeControllerParabolic-251"><span class="linenos">251</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">f_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">t_eq</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="TimeControllerParabolic-252"><a href="#TimeControllerParabolic-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">y</span>
</span><span id="TimeControllerParabolic-253"><a href="#TimeControllerParabolic-253"><span class="linenos">253</span></a>
</span><span id="TimeControllerParabolic-254"><a href="#TimeControllerParabolic-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">advance_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerParabolic-255"><a href="#TimeControllerParabolic-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-256"><a href="#TimeControllerParabolic-256"><span class="linenos">256</span></a><span class="sd">        Advance to the next time in :attr:`time_list` and update `dt`.</span>
</span><span id="TimeControllerParabolic-257"><a href="#TimeControllerParabolic-257"><span class="linenos">257</span></a>
</span><span id="TimeControllerParabolic-258"><a href="#TimeControllerParabolic-258"><span class="linenos">258</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerParabolic-259"><a href="#TimeControllerParabolic-259"><span class="linenos">259</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerParabolic-260"><a href="#TimeControllerParabolic-260"><span class="linenos">260</span></a><span class="sd">        None</span>
</span><span id="TimeControllerParabolic-261"><a href="#TimeControllerParabolic-261"><span class="linenos">261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic-262"><a href="#TimeControllerParabolic-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TimeControllerParabolic-263"><a href="#TimeControllerParabolic-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span><span class="p">]</span>
</span><span id="TimeControllerParabolic-264"><a href="#TimeControllerParabolic-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Nonuniform (parabolic) time controller.</p>

<p>Builds a monotonically increasing list of <code><a href="#TimeControllerParabolic.n_time_steps">n_time_steps</a></code> time instants
between <code>initial_time</code> and <code>final_time</code> by mapping an equally spaced grid
through a parabolic function and rescaling it back to the original range.
The step size <code><a href="#TimeControllerParabolic.dt">dt</a></code> changes over time.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_time_steps</strong> (int):
Number of time instants (length of the time list).</li>
<li><strong>initial_time</strong> (float):
Start time expressed in the units given by <code>time_unit</code>.</li>
<li><strong>final_time</strong> (float):
Final time expressed in the units given by <code>time_unit</code>.</li>
<li><strong>time_unit</strong> ({"second", "minute", "hour", "day", "year"}, default="second"):
Unit used to interpret <code>initial_time</code> and <code>final_time</code>.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>n_time_steps</strong> (int):
Number of generated time instants.</li>
<li><strong>time_list</strong> (numpy.ndarray):
Monotone array of times (in <strong>seconds</strong>) of length <code><a href="#TimeControllerParabolic.n_time_steps">n_time_steps</a></code>.</li>
<li><strong>dt</strong> (float):
Current time step size (in <strong>seconds</strong>); initialized as
<code>time_list[1] - time_list[0]</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>This class expects attributes like <code><a href="#TimeControllerParabolic.t_initial">t_initial</a></code>, <code><a href="#TimeControllerParabolic.t_final">t_final</a></code>,
and <code>time_unit</code> to be available (typically provided by a base
initializer). Ensure those are set before use.</li>
<li>Advance logic uses an internal index <code>self.step_counter</code>.</li>
</ul>
</div>


                            <div id="TimeControllerParabolic.__init__" class="classattr">
                                        <input id="TimeControllerParabolic.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TimeControllerParabolic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_time_steps</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;second&#39;</span></span>)</span>

                <label class="view-source-button" for="TimeControllerParabolic.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerParabolic.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerParabolic.__init__-202"><a href="#TimeControllerParabolic.__init__-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_time_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">final_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;second&quot;</span><span class="p">):</span>
</span><span id="TimeControllerParabolic.__init__-203"><a href="#TimeControllerParabolic.__init__-203"><span class="linenos">203</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.__init__-204"><a href="#TimeControllerParabolic.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_time_steps</span> <span class="o">=</span> <span class="n">n_time_steps</span>
</span><span id="TimeControllerParabolic.__init__-205"><a href="#TimeControllerParabolic.__init__-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_varying_times</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_parabolic</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.__init__-206"><a href="#TimeControllerParabolic.__init__-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TimeControllerParabolic.__init__-207"><a href="#TimeControllerParabolic.__init__-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


    

                            </div>
                            <div id="TimeControllerParabolic.n_time_steps" class="classattr">
                                <div class="attr variable">
            <span class="name">n_time_steps</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerParabolic.n_time_steps"></a>
    
    

                            </div>
                            <div id="TimeControllerParabolic.time_list" class="classattr">
                                <div class="attr variable">
            <span class="name">time_list</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerParabolic.time_list"></a>
    
    

                            </div>
                            <div id="TimeControllerParabolic.dt" class="classattr">
                                <div class="attr variable">
            <span class="name">dt</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerParabolic.dt"></a>
    
    

                            </div>
                            <div id="TimeControllerParabolic.step_counter" class="classattr">
                                <div class="attr variable">
            <span class="name">step_counter</span>

        
    </div>
    <a class="headerlink" href="#TimeControllerParabolic.step_counter"></a>
    
    

                            </div>
                            <div id="TimeControllerParabolic.fun_parabolic" class="classattr">
                                        <input id="TimeControllerParabolic.fun_parabolic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fun_parabolic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t_array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="TimeControllerParabolic.fun_parabolic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerParabolic.fun_parabolic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerParabolic.fun_parabolic-209"><a href="#TimeControllerParabolic.fun_parabolic-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">fun_parabolic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="TimeControllerParabolic.fun_parabolic-210"><a href="#TimeControllerParabolic.fun_parabolic-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic.fun_parabolic-211"><a href="#TimeControllerParabolic.fun_parabolic-211"><span class="linenos">211</span></a><span class="sd">        Parabolic mapping used to skew an equally spaced time grid.</span>
</span><span id="TimeControllerParabolic.fun_parabolic-212"><a href="#TimeControllerParabolic.fun_parabolic-212"><span class="linenos">212</span></a>
</span><span id="TimeControllerParabolic.fun_parabolic-213"><a href="#TimeControllerParabolic.fun_parabolic-213"><span class="linenos">213</span></a><span class="sd">        Parameters</span>
</span><span id="TimeControllerParabolic.fun_parabolic-214"><a href="#TimeControllerParabolic.fun_parabolic-214"><span class="linenos">214</span></a><span class="sd">        ----------</span>
</span><span id="TimeControllerParabolic.fun_parabolic-215"><a href="#TimeControllerParabolic.fun_parabolic-215"><span class="linenos">215</span></a><span class="sd">        t_array : numpy.ndarray</span>
</span><span id="TimeControllerParabolic.fun_parabolic-216"><a href="#TimeControllerParabolic.fun_parabolic-216"><span class="linenos">216</span></a><span class="sd">            Input array (typically an equally spaced grid).</span>
</span><span id="TimeControllerParabolic.fun_parabolic-217"><a href="#TimeControllerParabolic.fun_parabolic-217"><span class="linenos">217</span></a>
</span><span id="TimeControllerParabolic.fun_parabolic-218"><a href="#TimeControllerParabolic.fun_parabolic-218"><span class="linenos">218</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerParabolic.fun_parabolic-219"><a href="#TimeControllerParabolic.fun_parabolic-219"><span class="linenos">219</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerParabolic.fun_parabolic-220"><a href="#TimeControllerParabolic.fun_parabolic-220"><span class="linenos">220</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="TimeControllerParabolic.fun_parabolic-221"><a href="#TimeControllerParabolic.fun_parabolic-221"><span class="linenos">221</span></a><span class="sd">            Elementwise square of `t_array` (i.e., ``t_array**2``).</span>
</span><span id="TimeControllerParabolic.fun_parabolic-222"><a href="#TimeControllerParabolic.fun_parabolic-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic.fun_parabolic-223"><a href="#TimeControllerParabolic.fun_parabolic-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="n">t_array</span><span class="o">**</span><span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p>Parabolic mapping used to skew an equally spaced time grid.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>t_array</strong> (numpy.ndarray):
Input array (typically an equally spaced grid).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray</strong>: Elementwise square of <code>t_array</code> (i.e., <code>t_array**2</code>).</li>
</ul>
</div>


                            </div>
                            <div id="TimeControllerParabolic.calculate_varying_times" class="classattr">
                                        <input id="TimeControllerParabolic.calculate_varying_times-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_varying_times</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="TimeControllerParabolic.calculate_varying_times-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerParabolic.calculate_varying_times"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerParabolic.calculate_varying_times-225"><a href="#TimeControllerParabolic.calculate_varying_times-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">calculate_varying_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">:</span> <span class="n">Fn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-226"><a href="#TimeControllerParabolic.calculate_varying_times-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-227"><a href="#TimeControllerParabolic.calculate_varying_times-227"><span class="linenos">227</span></a><span class="sd">        Generate a nonuniform time grid via a monotone mapping and rescaling.</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-228"><a href="#TimeControllerParabolic.calculate_varying_times-228"><span class="linenos">228</span></a>
</span><span id="TimeControllerParabolic.calculate_varying_times-229"><a href="#TimeControllerParabolic.calculate_varying_times-229"><span class="linenos">229</span></a><span class="sd">        Steps</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-230"><a href="#TimeControllerParabolic.calculate_varying_times-230"><span class="linenos">230</span></a><span class="sd">        -----</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-231"><a href="#TimeControllerParabolic.calculate_varying_times-231"><span class="linenos">231</span></a><span class="sd">        1. Build an equally spaced grid on ``[t_initial, t_final]``.</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-232"><a href="#TimeControllerParabolic.calculate_varying_times-232"><span class="linenos">232</span></a><span class="sd">        2. Apply ``fun`` to this grid to skew the spacing.</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-233"><a href="#TimeControllerParabolic.calculate_varying_times-233"><span class="linenos">233</span></a><span class="sd">        3. Linearly rescale the mapped values back to the original range so that</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-234"><a href="#TimeControllerParabolic.calculate_varying_times-234"><span class="linenos">234</span></a><span class="sd">           the first and last times remain ``t_initial`` and ``t_final``.</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-235"><a href="#TimeControllerParabolic.calculate_varying_times-235"><span class="linenos">235</span></a>
</span><span id="TimeControllerParabolic.calculate_varying_times-236"><a href="#TimeControllerParabolic.calculate_varying_times-236"><span class="linenos">236</span></a><span class="sd">        Parameters</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-237"><a href="#TimeControllerParabolic.calculate_varying_times-237"><span class="linenos">237</span></a><span class="sd">        ----------</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-238"><a href="#TimeControllerParabolic.calculate_varying_times-238"><span class="linenos">238</span></a><span class="sd">        fun : Callable[[numpy.ndarray], numpy.ndarray]</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-239"><a href="#TimeControllerParabolic.calculate_varying_times-239"><span class="linenos">239</span></a><span class="sd">            Monotone mapping to skew the spacing (e.g., :meth:`fun_parabolic`).</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-240"><a href="#TimeControllerParabolic.calculate_varying_times-240"><span class="linenos">240</span></a>
</span><span id="TimeControllerParabolic.calculate_varying_times-241"><a href="#TimeControllerParabolic.calculate_varying_times-241"><span class="linenos">241</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-242"><a href="#TimeControllerParabolic.calculate_varying_times-242"><span class="linenos">242</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-243"><a href="#TimeControllerParabolic.calculate_varying_times-243"><span class="linenos">243</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-244"><a href="#TimeControllerParabolic.calculate_varying_times-244"><span class="linenos">244</span></a><span class="sd">            Monotone array of times (in seconds) of length ``n_time_steps``.</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-245"><a href="#TimeControllerParabolic.calculate_varying_times-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-246"><a href="#TimeControllerParabolic.calculate_varying_times-246"><span class="linenos">246</span></a>        <span class="n">t_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_initial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_final</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_time_steps</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-247"><a href="#TimeControllerParabolic.calculate_varying_times-247"><span class="linenos">247</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">t_eq</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-248"><a href="#TimeControllerParabolic.calculate_varying_times-248"><span class="linenos">248</span></a>        <span class="n">f_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">t_eq</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-249"><a href="#TimeControllerParabolic.calculate_varying_times-249"><span class="linenos">249</span></a>        <span class="n">f_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-250"><a href="#TimeControllerParabolic.calculate_varying_times-250"><span class="linenos">250</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_eq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_eq</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">f_max</span> <span class="o">-</span> <span class="n">f_min</span><span class="p">)</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-251"><a href="#TimeControllerParabolic.calculate_varying_times-251"><span class="linenos">251</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">f_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">t_eq</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="TimeControllerParabolic.calculate_varying_times-252"><a href="#TimeControllerParabolic.calculate_varying_times-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">y</span>
</span></pre></div>


            <div class="docstring"><p>Generate a nonuniform time grid via a monotone mapping and rescaling.</p>

<h6 id="steps">Steps</h6>

<ol>
<li>Build an equally spaced grid on <code>[t_initial, t_final]</code>.</li>
<li>Apply <code>fun</code> to this grid to skew the spacing.</li>
<li>Linearly rescale the mapped values back to the original range so that
the first and last times remain <code><a href="#TimeControllerParabolic.t_initial">t_initial</a></code> and <code><a href="#TimeControllerParabolic.t_final">t_final</a></code>.</li>
</ol>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fun</strong> (Callable[[numpy.ndarray], numpy.ndarray]):
Monotone mapping to skew the spacing (e.g., <code><a href="#TimeControllerParabolic.fun_parabolic">fun_parabolic()</a></code>).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray</strong>: Monotone array of times (in seconds) of length <code><a href="#TimeControllerParabolic.n_time_steps">n_time_steps</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="TimeControllerParabolic.advance_time" class="classattr">
                                        <input id="TimeControllerParabolic.advance_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">advance_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="TimeControllerParabolic.advance_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimeControllerParabolic.advance_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimeControllerParabolic.advance_time-254"><a href="#TimeControllerParabolic.advance_time-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">advance_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimeControllerParabolic.advance_time-255"><a href="#TimeControllerParabolic.advance_time-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic.advance_time-256"><a href="#TimeControllerParabolic.advance_time-256"><span class="linenos">256</span></a><span class="sd">        Advance to the next time in :attr:`time_list` and update `dt`.</span>
</span><span id="TimeControllerParabolic.advance_time-257"><a href="#TimeControllerParabolic.advance_time-257"><span class="linenos">257</span></a>
</span><span id="TimeControllerParabolic.advance_time-258"><a href="#TimeControllerParabolic.advance_time-258"><span class="linenos">258</span></a><span class="sd">        Returns</span>
</span><span id="TimeControllerParabolic.advance_time-259"><a href="#TimeControllerParabolic.advance_time-259"><span class="linenos">259</span></a><span class="sd">        -------</span>
</span><span id="TimeControllerParabolic.advance_time-260"><a href="#TimeControllerParabolic.advance_time-260"><span class="linenos">260</span></a><span class="sd">        None</span>
</span><span id="TimeControllerParabolic.advance_time-261"><a href="#TimeControllerParabolic.advance_time-261"><span class="linenos">261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimeControllerParabolic.advance_time-262"><a href="#TimeControllerParabolic.advance_time-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="TimeControllerParabolic.advance_time-263"><a href="#TimeControllerParabolic.advance_time-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span><span class="p">]</span>
</span><span id="TimeControllerParabolic.advance_time-264"><a href="#TimeControllerParabolic.advance_time-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step_counter</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Advance to the next time in <code><a href="#TimeControllerParabolic.time_list">time_list</a></code> and update <code><a href="#TimeControllerParabolic.dt">dt</a></code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>